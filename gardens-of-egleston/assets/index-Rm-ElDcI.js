var pu=Object.defineProperty;var yu=(n,t,e)=>t in n?pu(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e;var Ba=(n,t,e)=>yu(n,typeof t!="symbol"?t+"":t,e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function e(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerPolicy&&(r.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?r.credentials="include":s.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(s){if(s.ep)return;s.ep=!0;const r=e(s);fetch(s.href,r)}})();const Ka=!1;var hh=Array.isArray,vu=Array.prototype.indexOf,xu=Array.from,wu=Object.defineProperty,Xn=Object.getOwnPropertyDescriptor,ch=Object.getOwnPropertyDescriptors,Eu=Object.prototype,Cu=Array.prototype,Go=Object.getPrototypeOf;function Ru(n){return typeof n=="function"}const Sn=()=>{};function Iu(n){return n()}function uo(n){for(var t=0;t<n.length;t++)n[t]()}const fe=2,uh=4,or=8,ar=16,Ue=32,is=64,Ds=128,ne=256,ks=512,Nt=1024,Ze=2048,yn=4096,ln=8192,lr=16384,dh=32768,hr=65536,Su=1<<19,fh=1<<20,nn=Symbol("$state"),Tu=Symbol("");function gh(n){return n===this.v}function bu(n){throw new Error("https://svelte.dev/e/effect_in_teardown")}function Mu(){throw new Error("https://svelte.dev/e/effect_in_unowned_derived")}function Au(n){throw new Error("https://svelte.dev/e/effect_orphan")}function Lu(){throw new Error("https://svelte.dev/e/effect_update_depth_exceeded")}function Pu(){throw new Error("https://svelte.dev/e/state_descriptors_fixed")}function Ou(){throw new Error("https://svelte.dev/e/state_prototype_fixed")}function Fu(){throw new Error("https://svelte.dev/e/state_unsafe_local_read")}function Du(){throw new Error("https://svelte.dev/e/state_unsafe_mutation")}let cr=!1,ku=!1;function Nu(){cr=!0}const Gu=1,zu=2,Xu=4,Wu=2,zt=Symbol();function Yu(n){throw new Error("https://svelte.dev/e/lifecycle_outside_component")}let pt=null;function Ua(n){pt=n}function ur(n,t=!1,e){pt={p:pt,c:null,e:null,m:!1,s:n,x:null,l:null},cr&&!t&&(pt.l={s:null,u:null,r1:[],r2:ve(!1)})}function dr(n){const t=pt;if(t!==null){const o=t.e;if(o!==null){var e=ot,i=st;t.e=null;try{for(var s=0;s<o.length;s++){var r=o[s];be(r.effect),Te(r.reaction),gr(r.fn)}}finally{be(e),Te(i)}}pt=t.p,t.m=!0}return{}}function fr(){return!cr||pt!==null&&pt.l===null}function ve(n,t){var e={f:0,v:n,reactions:null,equals:gh,rv:0,wv:0};return e}function _h(n){return ju(ve(n))}function ju(n){return st!==null&&!le&&(st.f&fe)!==0&&(Ie===null?id([n]):Ie.push(n)),n}function xe(n,t){return st!==null&&!le&&fr()&&(st.f&(fe|ar))!==0&&(Ie===null||!Ie.includes(n))&&Du(),Bu(n,t)}function Bu(n,t){return n.equals(t)||(n.v,n.v=t,n.wv=Ph(),mh(n,Ze),fr()&&ot!==null&&(ot.f&Nt)!==0&&(ot.f&(Ue|is))===0&&(ze===null?nd([n]):ze.push(n))),t}function mh(n,t){var e=n.reactions;if(e!==null)for(var i=fr(),s=e.length,r=0;r<s;r++){var o=e[r],a=o.f;(a&Ze)===0&&(!i&&o===ot||(Me(o,t),(a&(Nt|ne))!==0&&((a&fe)!==0?mh(o,yn):mr(o))))}}function Hi(n,t=null,e){if(typeof n!="object"||n===null||nn in n)return n;const i=Go(n);if(i!==Eu&&i!==Cu)return n;var s=new Map,r=hh(n),o=ve(0);r&&s.set("length",ve(n.length));var a;return new Proxy(n,{defineProperty(l,h,c){(!("value"in c)||c.configurable===!1||c.enumerable===!1||c.writable===!1)&&Pu();var u=s.get(h);return u===void 0?(u=ve(c.value),s.set(h,u)):xe(u,Hi(c.value,a)),!0},deleteProperty(l,h){var c=s.get(h);if(c===void 0)h in l&&s.set(h,ve(zt));else{if(r&&typeof h=="string"){var u=s.get("length"),d=Number(h);Number.isInteger(d)&&d<u.v&&xe(u,d)}xe(c,zt),Za(o)}return!0},get(l,h,c){var g;if(h===nn)return n;var u=s.get(h),d=h in l;if(u===void 0&&(!d||(g=Xn(l,h))!=null&&g.writable)&&(u=ve(Hi(d?l[h]:zt,a)),s.set(h,u)),u!==void 0){var f=ce(u);return f===zt?void 0:f}return Reflect.get(l,h,c)},getOwnPropertyDescriptor(l,h){var c=Reflect.getOwnPropertyDescriptor(l,h);if(c&&"value"in c){var u=s.get(h);u&&(c.value=ce(u))}else if(c===void 0){var d=s.get(h),f=d==null?void 0:d.v;if(d!==void 0&&f!==zt)return{enumerable:!0,configurable:!0,value:f,writable:!0}}return c},has(l,h){var f;if(h===nn)return!0;var c=s.get(h),u=c!==void 0&&c.v!==zt||Reflect.has(l,h);if(c!==void 0||ot!==null&&(!u||(f=Xn(l,h))!=null&&f.writable)){c===void 0&&(c=ve(u?Hi(l[h],a):zt),s.set(h,c));var d=ce(c);if(d===zt)return!1}return u},set(l,h,c,u){var w;var d=s.get(h),f=h in l;if(r&&h==="length")for(var g=c;g<d.v;g+=1){var _=s.get(g+"");_!==void 0?xe(_,zt):g in l&&(_=ve(zt),s.set(g+"",_))}d===void 0?(!f||(w=Xn(l,h))!=null&&w.writable)&&(d=ve(void 0),xe(d,Hi(c,a)),s.set(h,d)):(f=d.v!==zt,xe(d,Hi(c,a)));var m=Reflect.getOwnPropertyDescriptor(l,h);if(m!=null&&m.set&&m.set.call(u,c),!f){if(r&&typeof h=="string"){var p=s.get("length"),y=Number(h);Number.isInteger(y)&&y>=p.v&&xe(p,y+1)}Za(o)}return!0},ownKeys(l){ce(o);var h=Reflect.ownKeys(l).filter(d=>{var f=s.get(d);return f===void 0||f.v!==zt});for(var[c,u]of s)u.v!==zt&&!(c in l)&&h.push(c);return h},setPrototypeOf(){Ou()}})}function Za(n,t=1){xe(n,n.v+t)}var Va,ph,yh,vh;function Ku(){if(Va===void 0){Va=window,ph=/Firefox/.test(navigator.userAgent);var n=Element.prototype,t=Node.prototype;yh=Xn(t,"firstChild").get,vh=Xn(t,"nextSibling").get,n.__click=void 0,n.__className=void 0,n.__attributes=null,n.__styles=null,n.__e=void 0,Text.prototype.__t=void 0}}function Uu(n=""){return document.createTextNode(n)}function Yn(n){return yh.call(n)}function xh(n){return vh.call(n)}function z(n,t){return Yn(n)}function rt(n,t=1,e=!1){let i=n;for(;t--;)i=xh(i);return i}function wh(n){var t=fe|Ze,e=st!==null&&(st.f&fe)!==0?st:null;return ot===null||e!==null&&(e.f&ne)!==0?t|=ne:ot.f|=fh,{ctx:pt,deps:null,effects:null,equals:gh,f:t,fn:n,reactions:null,rv:0,v:null,wv:0,parent:e??ot}}function Eh(n){var t=n.effects;if(t!==null){n.effects=null;for(var e=0;e<t.length;e+=1)ui(t[e])}}function Zu(n){for(var t=n.parent;t!==null;){if((t.f&fe)===0)return t;t=t.parent}return null}function Vu(n){var t,e=ot;be(Zu(n));try{Eh(n),t=Fh(n)}finally{be(e)}return t}function Ch(n){var t=Vu(n),e=(si||(n.f&ne)!==0)&&n.deps!==null?yn:Nt;Me(n,e),n.equals(t)||(n.v=t,n.wv=Ph())}function Rh(n){ot===null&&st===null&&Au(),st!==null&&(st.f&ne)!==0&&ot===null&&Mu(),Wo&&bu()}function Hu(n,t){var e=t.last;e===null?t.last=t.first=n:(e.next=n,n.prev=e,t.last=n)}function vn(n,t,e,i=!0){var s=(n&is)!==0,r=ot,o={ctx:pt,deps:null,nodes_start:null,nodes_end:null,f:n|Ze,first:null,fn:t,last:null,next:null,parent:s?null:r,prev:null,teardown:null,transitions:null,wv:0};if(e)try{Yo(o),o.f|=dh}catch(h){throw ui(o),h}else t!==null&&mr(o);var a=e&&o.deps===null&&o.first===null&&o.nodes_start===null&&o.teardown===null&&(o.f&(fh|Ds))===0;if(!a&&!s&&i&&(r!==null&&Hu(o,r),st!==null&&(st.f&fe)!==0)){var l=st;(l.effects??(l.effects=[])).push(o)}return o}function qu(n){const t=vn(or,null,!1);return Me(t,Nt),t.teardown=n,t}function Ns(n){Rh();var t=ot!==null&&(ot.f&Ue)!==0&&pt!==null&&!pt.m;if(t){var e=pt;(e.e??(e.e=[])).push({fn:n,effect:ot,reaction:st})}else{var i=gr(n);return i}}function $u(n){return Rh(),Ih(n)}function Ju(n){const t=vn(is,n,!0);return(e={})=>new Promise(i=>{e.outro?fo(t,()=>{ui(t),i(void 0)}):(ui(t),i(void 0))})}function gr(n){return vn(uh,n,!1)}function Ih(n){return vn(or,n,!0)}function Xt(n,t=[],e=wh){const i=t.map(e);return zo(()=>n(...i.map(ce)))}function zo(n,t=0){return vn(or|ar|t,n,!0)}function Gs(n,t=!0){return vn(or|Ue,n,!0,t)}function Sh(n){var t=n.teardown;if(t!==null){const e=Wo,i=st;qa(!0),Te(null);try{t.call(null)}finally{qa(e),Te(i)}}}function Th(n,t=!1){var e=n.first;for(n.first=n.last=null;e!==null;){var i=e.next;ui(e,t),e=i}}function Qu(n){for(var t=n.first;t!==null;){var e=t.next;(t.f&Ue)===0&&ui(t),t=e}}function ui(n,t=!0){var e=!1;if((t||(n.f&Su)!==0)&&n.nodes_start!==null){for(var i=n.nodes_start,s=n.nodes_end;i!==null;){var r=i===s?null:xh(i);i.remove(),i=r}e=!0}Th(n,t&&!e),Ys(n,0),Me(n,lr);var o=n.transitions;if(o!==null)for(const l of o)l.stop();Sh(n);var a=n.parent;a!==null&&a.first!==null&&bh(n),n.next=n.prev=n.teardown=n.ctx=n.deps=n.fn=n.nodes_start=n.nodes_end=null}function bh(n){var t=n.parent,e=n.prev,i=n.next;e!==null&&(e.next=i),i!==null&&(i.prev=e),t!==null&&(t.first===n&&(t.first=i),t.last===n&&(t.last=e))}function fo(n,t){var e=[];Mh(n,e,!0),td(e,()=>{ui(n),t&&t()})}function td(n,t){var e=n.length;if(e>0){var i=()=>--e||t();for(var s of n)s.out(i)}else t()}function Mh(n,t,e){if((n.f&ln)===0){if(n.f^=ln,n.transitions!==null)for(const o of n.transitions)(o.is_global||e)&&t.push(o);for(var i=n.first;i!==null;){var s=i.next,r=(i.f&hr)!==0||(i.f&Ue)!==0;Mh(i,t,r?e:!1),i=s}}}function Ha(n){Ah(n,!0)}function Ah(n,t){if((n.f&ln)!==0){n.f^=ln,(n.f&Nt)===0&&(n.f^=Nt),ns(n)&&(Me(n,Ze),mr(n));for(var e=n.first;e!==null;){var i=e.next,s=(e.f&hr)!==0||(e.f&Ue)!==0;Ah(e,s?t:!1),e=i}if(n.transitions!==null)for(const r of n.transitions)(r.is_global||t)&&r.in()}}let zs=[];function ed(){var n=zs;zs=[],uo(n)}function Xo(n){zs.length===0&&queueMicrotask(ed),zs.push(n)}let Ls=!1,go=!1,Xs=null,Ps=!1,Wo=!1;function qa(n){Wo=n}let Os=[];let st=null,le=!1;function Te(n){st=n}let ot=null;function be(n){ot=n}let Ie=null;function id(n){Ie=n}let Ft=null,Zt=0,ze=null;function nd(n){ze=n}let Lh=1,Ws=0,si=!1;function Ph(){return++Lh}function ns(n){var u;var t=n.f;if((t&Ze)!==0)return!0;if((t&yn)!==0){var e=n.deps,i=(t&ne)!==0;if(e!==null){var s,r,o=(t&ks)!==0,a=i&&ot!==null&&!si,l=e.length;if(o||a){var h=n,c=h.parent;for(s=0;s<l;s++)r=e[s],(o||!((u=r==null?void 0:r.reactions)!=null&&u.includes(h)))&&(r.reactions??(r.reactions=[])).push(h);o&&(h.f^=ks),a&&c!==null&&(c.f&ne)===0&&(h.f^=ne)}for(s=0;s<l;s++)if(r=e[s],ns(r)&&Ch(r),r.wv>n.wv)return!0}(!i||ot!==null&&!si)&&Me(n,Nt)}return!1}function sd(n,t){for(var e=t;e!==null;){if((e.f&Ds)!==0)try{e.fn(n);return}catch{e.f^=Ds}e=e.parent}throw Ls=!1,n}function rd(n){return(n.f&lr)===0&&(n.parent===null||(n.parent.f&Ds)===0)}function _r(n,t,e,i){if(Ls){if(e===null&&(Ls=!1),rd(t))throw n;return}e!==null&&(Ls=!0);{sd(n,t);return}}function Oh(n,t,e=!0){var i=n.reactions;if(i!==null)for(var s=0;s<i.length;s++){var r=i[s];(r.f&fe)!==0?Oh(r,t,!1):t===r&&(e?Me(r,Ze):(r.f&Nt)!==0&&Me(r,yn),mr(r))}}function Fh(n){var f;var t=Ft,e=Zt,i=ze,s=st,r=si,o=Ie,a=pt,l=le,h=n.f;Ft=null,Zt=0,ze=null,si=(h&ne)!==0&&(le||!Ps||st===null),st=(h&(Ue|is))===0?n:null,Ie=null,Ua(n.ctx),le=!1,Ws++;try{var c=(0,n.fn)(),u=n.deps;if(Ft!==null){var d;if(Ys(n,Zt),u!==null&&Zt>0)for(u.length=Zt+Ft.length,d=0;d<Ft.length;d++)u[Zt+d]=Ft[d];else n.deps=u=Ft;if(!si)for(d=Zt;d<u.length;d++)((f=u[d]).reactions??(f.reactions=[])).push(n)}else u!==null&&Zt<u.length&&(Ys(n,Zt),u.length=Zt);if(fr()&&ze!==null&&!le&&u!==null&&(n.f&(fe|yn|Ze))===0)for(d=0;d<ze.length;d++)Oh(ze[d],n);return s!==null&&Ws++,c}finally{Ft=t,Zt=e,ze=i,st=s,si=r,Ie=o,Ua(a),le=l}}function od(n,t){let e=t.reactions;if(e!==null){var i=vu.call(e,n);if(i!==-1){var s=e.length-1;s===0?e=t.reactions=null:(e[i]=e[s],e.pop())}}e===null&&(t.f&fe)!==0&&(Ft===null||!Ft.includes(t))&&(Me(t,yn),(t.f&(ne|ks))===0&&(t.f^=ks),Eh(t),Ys(t,0))}function Ys(n,t){var e=n.deps;if(e!==null)for(var i=t;i<e.length;i++)od(n,e[i])}function Yo(n){var t=n.f;if((t&lr)===0){Me(n,Nt);var e=ot,i=pt,s=Ps;ot=n,Ps=!0;try{(t&ar)!==0?Qu(n):Th(n),Sh(n);var r=Fh(n);n.teardown=typeof r=="function"?r:null,n.wv=Lh;var o=n.deps,a;Ka&&ku&&n.f&Ze}catch(l){_r(l,n,e,i||n.ctx)}finally{Ps=s,ot=e}}}function ad(){try{Lu()}catch(n){if(Xs!==null)_r(n,Xs,null);else throw n}}function ld(){try{for(var n=0;Os.length>0;){n++>1e3&&ad();var t=Os,e=t.length;Os=[];for(var i=0;i<e;i++){var s=t[i];(s.f&Nt)===0&&(s.f^=Nt);var r=cd(s);hd(r)}}}finally{go=!1,Xs=null}}function hd(n){var t=n.length;if(t!==0)for(var e=0;e<t;e++){var i=n[e];if((i.f&(lr|ln))===0)try{ns(i)&&(Yo(i),i.deps===null&&i.first===null&&i.nodes_start===null&&(i.teardown===null?bh(i):i.fn=null))}catch(s){_r(s,i,null,i.ctx)}}}function mr(n){go||(go=!0,queueMicrotask(ld));for(var t=Xs=n;t.parent!==null;){t=t.parent;var e=t.f;if((e&(is|Ue))!==0){if((e&Nt)===0)return;t.f^=Nt}}Os.push(t)}function cd(n){for(var t=[],e=n.first;e!==null;){var i=e.f,s=(i&Ue)!==0,r=s&&(i&Nt)!==0;if(!r&&(i&ln)===0){if((i&uh)!==0)t.push(e);else if(s)e.f^=Nt;else{var o=st;try{st=e,ns(e)&&Yo(e)}catch(h){_r(h,e,null,e.ctx)}finally{st=o}}var a=e.first;if(a!==null){e=a;continue}}var l=e.parent;for(e=e.next;e===null&&l!==null;)e=l.next,l=l.parent}return t}function ce(n){var t=n.f,e=(t&fe)!==0;if(st!==null&&!le){Ie!==null&&Ie.includes(n)&&Fu();var i=st.deps;n.rv<Ws&&(n.rv=Ws,Ft===null&&i!==null&&i[Zt]===n?Zt++:Ft===null?Ft=[n]:(!si||!Ft.includes(n))&&Ft.push(n))}else if(e&&n.deps===null&&n.effects===null){var s=n,r=s.parent;r!==null&&(r.f&ne)===0&&(s.f^=ne)}return e&&(s=n,ns(s)&&Ch(s)),n.v}function pr(n){var t=le;try{return le=!0,n()}finally{le=t}}const ud=-7169;function Me(n,t){n.f=n.f&ud|t}function dd(n){if(!(typeof n!="object"||!n||n instanceof EventTarget)){if(nn in n)_o(n);else if(!Array.isArray(n))for(let t in n){const e=n[t];typeof e=="object"&&e&&nn in e&&_o(e)}}}function _o(n,t=new Set){if(typeof n=="object"&&n!==null&&!(n instanceof EventTarget)&&!t.has(n)){t.add(n),n instanceof Date&&n.getTime();for(let i in n)try{_o(n[i],t)}catch{}const e=Go(n);if(e!==Object.prototype&&e!==Array.prototype&&e!==Map.prototype&&e!==Set.prototype&&e!==Date.prototype){const i=ch(e);for(let s in i){const r=i[s].get;if(r)try{r.call(n)}catch{}}}}}const fd=["touchstart","touchmove"];function gd(n){return fd.includes(n)}function Dh(n){var t=st,e=ot;Te(null),be(null);try{return n()}finally{Te(t),be(e)}}const kh=new Set,mo=new Set;function _d(n,t,e,i={}){function s(r){if(i.capture||Pn.call(t,r),!r.cancelBubble)return Dh(()=>e==null?void 0:e.call(this,r))}return n.startsWith("pointer")||n.startsWith("touch")||n==="wheel"?Xo(()=>{t.addEventListener(n,s,i)}):t.addEventListener(n,s,i),s}function md(n,t,e,i,s){var r={capture:i,passive:s},o=_d(n,t,e,r);(t===document.body||t===window||t===document)&&qu(()=>{t.removeEventListener(n,o,r)})}function Nh(n){for(var t=0;t<n.length;t++)kh.add(n[t]);for(var e of mo)e(n)}function Pn(n){var y;var t=this,e=t.ownerDocument,i=n.type,s=((y=n.composedPath)==null?void 0:y.call(n))||[],r=s[0]||n.target,o=0,a=n.__root;if(a){var l=s.indexOf(a);if(l!==-1&&(t===document||t===window)){n.__root=t;return}var h=s.indexOf(t);if(h===-1)return;l<=h&&(o=l)}if(r=s[o]||n.target,r!==t){wu(n,"currentTarget",{configurable:!0,get(){return r||e}});var c=st,u=ot;Te(null),be(null);try{for(var d,f=[];r!==null;){var g=r.assignedSlot||r.parentNode||r.host||null;try{var _=r["__"+i];if(_!==void 0&&(!r.disabled||n.target===r))if(hh(_)){var[m,...p]=_;m.apply(r,[n,...p])}else _.call(r,n)}catch(w){d?f.push(w):d=w}if(n.cancelBubble||g===t||g===null)break;r=g}if(d){for(let w of f)queueMicrotask(()=>{throw w});throw d}}finally{n.__root=t,delete n.currentTarget,Te(c),be(u)}}}function jo(n){var t=document.createElement("template");return t.innerHTML=n,t.content}function Bo(n,t){var e=ot;e.nodes_start===null&&(e.nodes_start=n,e.nodes_end=t)}function St(n,t){var e=(t&Wu)!==0,i,s=!n.startsWith("<!>");return()=>{i===void 0&&(i=jo(s?n:"<!>"+n),i=Yn(i));var r=e||ph?document.importNode(i,!0):i.cloneNode(!0);return Bo(r,r),r}}function Gh(n,t,e="svg"){var i=!n.startsWith("<!>"),s=`<${e}>${i?n:"<!>"+n}</${e}>`,r;return()=>{if(!r){var o=jo(s),a=Yn(o);r=Yn(a)}var l=r.cloneNode(!0);return Bo(l,l),l}}function _t(n,t){n!==null&&n.before(t)}let po=!0;function Tn(n,t){var e=t==null?"":typeof t=="object"?t+"":t;e!==(n.__t??(n.__t=n.nodeValue))&&(n.__t=e,n.nodeValue=e+"")}function pd(n,t){return yd(n,t)}const Wi=new Map;function yd(n,{target:t,anchor:e,props:i={},events:s,context:r,intro:o=!0}){Ku();var a=new Set,l=u=>{for(var d=0;d<u.length;d++){var f=u[d];if(!a.has(f)){a.add(f);var g=gd(f);t.addEventListener(f,Pn,{passive:g});var _=Wi.get(f);_===void 0?(document.addEventListener(f,Pn,{passive:g}),Wi.set(f,1)):Wi.set(f,_+1)}}};l(xu(kh)),mo.add(l);var h=void 0,c=Ju(()=>{var u=e??t.appendChild(Uu());return Gs(()=>{if(r){ur({});var d=pt;d.c=r}s&&(i.$$events=s),po=o,h=n(u,i)||{},po=!0,r&&dr()}),()=>{var g;for(var d of a){t.removeEventListener(d,Pn);var f=Wi.get(d);--f===0?(document.removeEventListener(d,Pn),Wi.delete(d)):Wi.set(d,f)}mo.delete(l),u!==e&&((g=u.parentNode)==null||g.removeChild(u))}});return vd.set(h,c),h}let vd=new WeakMap;function te(n,t,e=!1){var i=n,s=null,r=null,o=zt,a=e?hr:0,l=!1;const h=(u,d=!0)=>{l=!0,c(d,u)},c=(u,d)=>{o!==(o=u)&&(o?(s?Ha(s):d&&(s=Gs(()=>d(i))),r&&fo(r,()=>{r=null})):(r?Ha(r):d&&(r=Gs(()=>d(i))),s&&fo(s,()=>{s=null})))};zo(()=>{l=!1,t(h),l||c(null,null)},a)}function ye(n,t,e,i,s){var r=n,o="",a;zo(()=>{o!==(o=t()??"")&&(a!==void 0&&(ui(a),a=void 0),o!==""&&(a=Gs(()=>{var l=o+"",h=jo(l);Bo(Yn(h),h.lastChild),r.before(h)})))})}const $a=[...` 	
\r\f \v\uFEFF`];function xd(n,t,e){var i=n==null?"":""+n;if(t&&(i=i?i+" "+t:t),e){for(var s in e)if(e[s])i=i?i+" "+s:s;else if(i.length)for(var r=s.length,o=0;(o=i.indexOf(s,o))>=0;){var a=o+r;(o===0||$a.includes(i[o-1]))&&(a===i.length||$a.includes(i[a]))?i=(o===0?"":i.substring(0,o))+i.substring(a+1):o=a}}return i===""?null:i}function zh(n,t,e,i,s,r){var o=n.__className;if(o!==e){var a=xd(e,i,r);a==null?n.removeAttribute("class"):n.className=a,n.__className=e}else if(r)for(var l in r){var h=!!r[l];(s==null||h!==!!s[l])&&n.classList.toggle(l,h)}return r}function Gt(n,t,e,i){var s=n.__attributes??(n.__attributes={});s[t]!==(s[t]=e)&&(t==="style"&&"__styles"in n&&(n.__styles={}),t==="loading"&&(n[Tu]=e),e==null?n.removeAttribute(t):typeof e!="string"&&wd(n).includes(t)?n[t]=e:n.setAttribute(t,e))}var Ja=new Map;function wd(n){var t=Ja.get(n.nodeName);if(t)return t;Ja.set(n.nodeName,t=[]);for(var e,i=n,s=Element.prototype;s!==i;){e=ch(i);for(var r in e)e[r].set&&t.push(r);i=Go(i)}return t}const Ed=()=>performance.now(),We={tick:n=>requestAnimationFrame(n),now:()=>Ed(),tasks:new Set};function Xh(){const n=We.now();We.tasks.forEach(t=>{t.c(n)||(We.tasks.delete(t),t.f())}),We.tasks.size!==0&&We.tick(Xh)}function Cd(n){let t;return We.tasks.size===0&&We.tick(Xh),{promise:new Promise(e=>{We.tasks.add(t={c:n,f:e})}),abort(){We.tasks.delete(t)}}}function ps(n,t){Dh(()=>{n.dispatchEvent(new CustomEvent(t))})}function Rd(n){if(n==="float")return"cssFloat";if(n==="offset")return"cssOffset";if(n.startsWith("--"))return n;const t=n.split("-");return t.length===1?t[0]:t[0]+t.slice(1).map(e=>e[0].toUpperCase()+e.slice(1)).join("")}function Qa(n){const t={},e=n.split(";");for(const i of e){const[s,r]=i.split(":");if(!s||r===void 0)break;const o=Rd(s.trim());t[o]=r.trim()}return t}const Id=n=>n;function tl(n,t,e,i){var s=(n&Gu)!==0,r=(n&zu)!==0,o=s&&r,a=(n&Xu)!==0,l=o?"both":s?"in":"out",h,c=t.inert,u=t.style.overflow,d,f;function g(){var w=st,x=ot;Te(null),be(null);try{return h??(h=e()(t,(i==null?void 0:i())??{},{direction:l}))}finally{Te(w),be(x)}}var _={is_global:a,in(){var w;if(t.inert=c,!s){f==null||f.abort(),(w=f==null?void 0:f.reset)==null||w.call(f);return}r||d==null||d.abort(),ps(t,"introstart"),d=yo(t,g(),f,1,()=>{ps(t,"introend"),d==null||d.abort(),d=h=void 0,t.style.overflow=u})},out(w){if(!r){w==null||w(),h=void 0;return}t.inert=!0,ps(t,"outrostart"),f=yo(t,g(),d,0,()=>{ps(t,"outroend"),w==null||w()})},stop:()=>{d==null||d.abort(),f==null||f.abort()}},m=ot;if((m.transitions??(m.transitions=[])).push(_),s&&po){var p=a;if(!p){for(var y=m.parent;y&&(y.f&hr)!==0;)for(;(y=y.parent)&&(y.f&ar)===0;);p=!y||(y.f&dh)!==0}p&&gr(()=>{pr(()=>_.in())})}}function yo(n,t,e,i,s){var r=i===1;if(Ru(t)){var o,a=!1;return Xo(()=>{if(!a){var m=t({direction:r?"in":"out"});o=yo(n,m,e,i,s)}}),{abort:()=>{a=!0,o==null||o.abort()},deactivate:()=>o.deactivate(),reset:()=>o.reset(),t:()=>o.t()}}if(e==null||e.deactivate(),!(t!=null&&t.duration))return s(),{abort:Sn,deactivate:Sn,reset:Sn,t:()=>i};const{delay:l=0,css:h,tick:c,easing:u=Id}=t;var d=[];if(r&&e===void 0&&(c&&c(0,1),h)){var f=Qa(h(0,1));d.push(f,f)}var g=()=>1-i,_=n.animate(d,{duration:l});return _.onfinish=()=>{var m=(e==null?void 0:e.t())??1-i;e==null||e.abort();var p=i-m,y=t.duration*Math.abs(p),w=[];if(y>0){var x=!1;if(h)for(var v=Math.ceil(y/16.666666666666668),R=0;R<=v;R+=1){var S=m+p*u(R/v),C=Qa(h(S,1-S));w.push(C),x||(x=C.overflow==="hidden")}x&&(n.style.overflow="hidden"),g=()=>{var I=_.currentTime;return m+p*u(I/y)},c&&Cd(()=>{if(_.playState!=="running")return!1;var I=g();return c(I,1-I),!0})}_=n.animate(w,{duration:y,fill:"forwards"}),_.onfinish=()=>{g=()=>i,c==null||c(i,1-i),s()}},{abort:()=>{_&&(_.cancel(),_.effect=null,_.onfinish=Sn)},deactivate:()=>{s=Sn},reset:()=>{i===0&&(c==null||c(1,0))},t:()=>g()}}function el(n,t){return n===t||(n==null?void 0:n[nn])===t}function Sd(n={},t,e,i){return gr(()=>{var s,r;return Ih(()=>{s=r,r=[],pr(()=>{n!==e(...r)&&(t(n,...r),s&&el(e(...s),n)&&t(null,...s))})}),()=>{Xo(()=>{r&&el(e(...r),n)&&t(null,...r)})}}),n}function Td(n=!1){const t=pt,e=t.l.u;if(!e)return;let i=()=>dd(t.s);if(n){let s=0,r={};const o=wh(()=>{let a=!1;const l=t.s;for(const h in l)l[h]!==r[h]&&(r[h]=l[h],a=!0);return a&&s++,s});i=()=>ce(o)}e.b.length&&$u(()=>{il(t,i),uo(e.b)}),Ns(()=>{const s=pr(()=>e.m.map(Iu));return()=>{for(const r of s)typeof r=="function"&&r()}}),e.a.length&&Ns(()=>{il(t,i),uo(e.a)})}function il(n,t){if(n.l.s)for(const e of n.l.s)ce(e);t()}function bd(n,t,e,i){var s;s=n[t];var r=i,o=!0,a=()=>(o&&(o=!1,r=i),r);s===void 0&&i!==void 0&&(s=a());var l;return l=()=>{var h=n[t];return h===void 0?a():(o=!0,h)},l}function Md(n){pt===null&&Yu(),cr&&pt.l!==null?Ad(pt).m.push(n):Ns(()=>{const t=pr(n);if(typeof t=="function")return t})}function Ad(n){var t=n.l;return t.u??(t.u={a:[],b:[],m:[]})}const Ld="5";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(Ld);Nu();function Pd(n,t){xe(t,!ce(t))}var Od=St(`<div><div class="fixed inset-0 bg-gray-500/90 transition-opacity"></div> <div class="flex min-h-full items-end justify-center p-4 text-center sm:items-center sm:p-0"><div class="relative transform overflow-hidden rounded-lg bg-gradient-to-tr from-purple-100 to-gray-50 px-4 pb-4 pt-5 text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-sm sm:p-6"><div><div><div class="text-center text-4xl text-yellow-900 uppercase font-black tracking-widest">Gardens of Egleston</div></div> <div class="mt-3 text-center sm:mt-5"><p>Use this map to view the gardens in Boston's Egleston Square</p></div></div> <div class="mt-5 sm:mt-6"><button type="button" class="inline-flex w-full justify-center rounded-md bg-orange-200 ring-2 text-lg px-3 py-2 font-semibold text-slate-900 shadow-sm hover:bg-orange-400 focus-visible:outline focus-visible:outline-4 focus-visible:outline-offset-2 focus-visible:outline-orange-600 svelte-474x4k">Discover gardens</button></div> <div class="mt-4"><p class="text-xs text-center font-semibold">A project of the <a class="text-blue-900 hover:text-blue-600 transition-colors" href="https://leventhalmap.org" target="_blank">Leventhal Map & Education Center at the Boston Public
                        Library</a>, for <a class="text-blue-900 hover:text-blue-600 transition-colors" href="https://gardensofegleston.org/" target="blank">Gardens of Egleston</a></p></div></div></div></div>`);function Fd(n){let t=_h(!1);var e=Od();let i;var s=rt(z(e),2),r=z(s),o=rt(z(r),2),a=z(o);a.__click=[Pd,t],Xt(()=>i=zh(e,1,"",null,i,{hidden:ce(t)})),_t(n,e)}Nh(["click"]);const K={IDLE:0,LOADING:1,LOADED:2,ERROR:3},nl={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};var sl={red:0,orange:60,yellow:120,green:180,blue:240,purple:300};function Dd(n){var c,u;var t,e=[],i=1,s;if(typeof n=="number")return{space:"rgb",values:[n>>>16,(n&65280)>>>8,n&255],alpha:1};if(typeof n=="number")return{space:"rgb",values:[n>>>16,(n&65280)>>>8,n&255],alpha:1};if(n=String(n).toLowerCase(),nl[n])e=nl[n].slice(),s="rgb";else if(n==="transparent")i=0,s="rgb",e=[0,0,0];else if(n[0]==="#"){var r=n.slice(1),o=r.length,a=o<=4;i=1,a?(e=[parseInt(r[0]+r[0],16),parseInt(r[1]+r[1],16),parseInt(r[2]+r[2],16)],o===4&&(i=parseInt(r[3]+r[3],16)/255)):(e=[parseInt(r[0]+r[1],16),parseInt(r[2]+r[3],16),parseInt(r[4]+r[5],16)],o===8&&(i=parseInt(r[6]+r[7],16)/255)),e[0]||(e[0]=0),e[1]||(e[1]=0),e[2]||(e[2]=0),s="rgb"}else if(t=/^((?:rgba?|hs[lvb]a?|hwba?|cmyk?|xy[zy]|gray|lab|lchu?v?|[ly]uv|lms|oklch|oklab|color))\s*\(([^\)]*)\)/.exec(n)){var l=t[1];s=l.replace(/a$/,"");var h=s==="cmyk"?4:s==="gray"?1:3;e=t[2].trim().split(/\s*[,\/]\s*|\s+/),s==="color"&&(s=e.shift()),e=e.map(function(d,f){if(d[d.length-1]==="%")return d=parseFloat(d)/100,f===3?d:s==="rgb"?d*255:s[0]==="h"||s[0]==="l"&&!f?d*100:s==="lab"?d*125:s==="lch"?f<2?d*150:d*360:s[0]==="o"&&!f?d:s==="oklab"?d*.4:s==="oklch"?f<2?d*.4:d*360:d;if(s[f]==="h"||f===2&&s[s.length-1]==="h"){if(sl[d]!==void 0)return sl[d];if(d.endsWith("deg"))return parseFloat(d);if(d.endsWith("turn"))return parseFloat(d)*360;if(d.endsWith("grad"))return parseFloat(d)*360/400;if(d.endsWith("rad"))return parseFloat(d)*180/Math.PI}return d==="none"?0:parseFloat(d)}),i=e.length>h?e.pop():1}else/[0-9](?:\s|\/|,)/.test(n)&&(e=n.match(/([0-9]+)/g).map(function(d){return parseFloat(d)}),s=((u=(c=n.match(/([a-z])/ig))==null?void 0:c.join(""))==null?void 0:u.toLowerCase())||"rgb");return{space:s,values:e,alpha:i}}const jn={name:"rgb",min:[0,0,0],max:[255,255,255],channel:["red","green","blue"],alias:["RGB"]};var jr={name:"hsl",min:[0,0,0],max:[360,100,100],channel:["hue","saturation","lightness"],alias:["HSL"],rgb:function(n){var t=n[0]/360,e=n[1]/100,i=n[2]/100,s,r,o,a,l,h=0;if(e===0)return l=i*255,[l,l,l];for(r=i<.5?i*(1+e):i+e-i*e,s=2*i-r,a=[0,0,0];h<3;)o=t+1/3*-(h-1),o<0?o++:o>1&&o--,l=6*o<1?s+(r-s)*6*o:2*o<1?r:3*o<2?s+(r-s)*(2/3-o)*6:s,a[h++]=l*255;return a}};jn.hsl=function(n){var t=n[0]/255,e=n[1]/255,i=n[2]/255,s=Math.min(t,e,i),r=Math.max(t,e,i),o=r-s,a,l,h;return r===s?a=0:t===r?a=(e-i)/o:e===r?a=2+(i-t)/o:i===r&&(a=4+(t-e)/o),a=Math.min(a*60,360),a<0&&(a+=360),h=(s+r)/2,r===s?l=0:h<=.5?l=o/(r+s):l=o/(2-r-s),[a,l*100,h*100]};function kd(n){Array.isArray(n)&&n.raw&&(n=String.raw(...arguments)),n instanceof Number&&(n=+n);var t,e=Dd(n);if(!e.space)return[];const i=e.space[0]==="h"?jr.min:jn.min,s=e.space[0]==="h"?jr.max:jn.max;return t=Array(3),t[0]=Math.min(Math.max(e.values[0],i[0]),s[0]),t[1]=Math.min(Math.max(e.values[1],i[1]),s[1]),t[2]=Math.min(Math.max(e.values[2],i[2]),s[2]),e.space[0]==="h"&&(t=jr.rgb(t)),t.push(Math.min(Math.max(e.alpha,0),1)),t}const Pt={name:"xyz",min:[0,0,0],channel:["X","Y","Z"],alias:["XYZ","ciexyz","cie1931"],whitepoint:{2:{A:[109.85,100,35.585],C:[98.074,100,118.232],D50:[96.422,100,82.521],D55:[95.682,100,92.149],D65:[95.045592705167,100,108.9057750759878],D75:[94.972,100,122.638],F2:[99.187,100,67.395],F7:[95.044,100,108.755],F11:[100.966,100,64.37],E:[100,100,100]},10:{A:[111.144,100,35.2],C:[97.285,100,116.145],D50:[96.72,100,81.427],D55:[95.799,100,90.926],D65:[94.811,100,107.304],D75:[94.416,100,120.641],F2:[103.28,100,69.026],F7:[95.792,100,107.687],F11:[103.866,100,65.627],E:[100,100,100]}}};Pt.max=Pt.whitepoint[2].D65;Pt.rgb=function(n,t){t=t||Pt.whitepoint[2].E;var e=n[0]/t[0],i=n[1]/t[1],s=n[2]/t[2],r,o,a;return r=e*3.240969941904521+i*-1.537383177570093+s*-.498610760293,o=e*-.96924363628087+i*1.87596750150772+s*.041555057407175,a=e*.055630079696993+i*-.20397695888897+s*1.056971514242878,r=r>.0031308?1.055*Math.pow(r,1/2.4)-.055:r=r*12.92,o=o>.0031308?1.055*Math.pow(o,1/2.4)-.055:o=o*12.92,a=a>.0031308?1.055*Math.pow(a,1/2.4)-.055:a=a*12.92,r=Math.min(Math.max(0,r),1),o=Math.min(Math.max(0,o),1),a=Math.min(Math.max(0,a),1),[r*255,o*255,a*255]};jn.xyz=function(n,t){var e=n[0]/255,i=n[1]/255,s=n[2]/255;e=e>.04045?Math.pow((e+.055)/1.055,2.4):e/12.92,i=i>.04045?Math.pow((i+.055)/1.055,2.4):i/12.92,s=s>.04045?Math.pow((s+.055)/1.055,2.4):s/12.92;var r=e*.41239079926595+i*.35758433938387+s*.18048078840183,o=e*.21263900587151+i*.71516867876775+s*.072192315360733,a=e*.019330818715591+i*.11919477979462+s*.95053215224966;return t=t||Pt.whitepoint[2].E,[r*t[0],o*t[1],a*t[2]]};var Ko={name:"luv",min:[0,-134,-140],max:[100,224,122],channel:["lightness","u","v"],alias:["LUV","cieluv","cie1976"],xyz:function(n,t,e){var i,s,r,o,a,l,h,c,u,d,f,g,_;if(r=n[0],o=n[1],a=n[2],r===0)return[0,0,0];var m=.0011070564598794539;return t=t||"D65",e=e||2,u=Pt.whitepoint[e][t][0],d=Pt.whitepoint[e][t][1],f=Pt.whitepoint[e][t][2],g=4*u/(u+15*d+3*f),_=9*d/(u+15*d+3*f),i=o/(13*r)+g||0,s=a/(13*r)+_||0,h=r>8?d*Math.pow((r+16)/116,3):d*r*m,l=h*9*i/(4*s)||0,c=h*(12-3*i-20*s)/(4*s)||0,[l,h,c]}};Pt.luv=function(n,t,e){var i,s,r,o,a,l,h,c,u,d,f,g,_,m=.008856451679035631,p=903.2962962962961;t=t||"D65",e=e||2,u=Pt.whitepoint[e][t][0],d=Pt.whitepoint[e][t][1],f=Pt.whitepoint[e][t][2],g=4*u/(u+15*d+3*f),_=9*d/(u+15*d+3*f),l=n[0],h=n[1],c=n[2],i=4*l/(l+15*h+3*c)||0,s=9*h/(l+15*h+3*c)||0;var y=h/d;return r=y<=m?p*y:116*Math.pow(y,1/3)-16,o=13*r*(i-g),a=13*r*(s-_),[r,o,a]};var Wh={name:"lchuv",channel:["lightness","chroma","hue"],alias:["LCHuv","cielchuv"],min:[0,0,0],max:[100,100,360],luv:function(n){var t=n[0],e=n[1],i=n[2],s,r,o;return o=i/360*2*Math.PI,s=e*Math.cos(o),r=e*Math.sin(o),[t,s,r]},xyz:function(n){return Ko.xyz(Wh.luv(n))}};Ko.lchuv=function(n){var t=n[0],e=n[1],i=n[2],s=Math.sqrt(e*e+i*i),r=Math.atan2(i,e),o=r*360/2/Math.PI;return o<0&&(o+=360),[t,s,o]};Pt.lchuv=function(n){return Ko.lchuv(Pt.luv(n))};function mt(n,t,e){return Math.min(Math.max(n,t),e)}function Nd(n,t,e,i,s,r){const o=s-e,a=r-i;if(o!==0||a!==0){const l=((n-e)*o+(t-i)*a)/(o*o+a*a);l>1?(e=s,i=r):l>0&&(e+=o*l,i+=a*l)}return bi(n,t,e,i)}function bi(n,t,e,i){const s=e-n,r=i-t;return s*s+r*r}function Gd(n){const t=n.length;for(let i=0;i<t;i++){let s=i,r=Math.abs(n[i][i]);for(let a=i+1;a<t;a++){const l=Math.abs(n[a][i]);l>r&&(r=l,s=a)}if(r===0)return null;const o=n[s];n[s]=n[i],n[i]=o;for(let a=i+1;a<t;a++){const l=-n[a][i]/n[i][i];for(let h=i;h<t+1;h++)i==h?n[a][h]=0:n[a][h]+=l*n[i][h]}}const e=new Array(t);for(let i=t-1;i>=0;i--){e[i]=n[i][t]/n[i][i];for(let s=i-1;s>=0;s--)n[s][t]-=n[s][i]*e[i]}return e}function rl(n){return n*180/Math.PI}function li(n){return n*Math.PI/180}function sn(n,t){const e=n%t;return e*t<0?e+t:e}function Vt(n,t,e){return n+e*(t-n)}function Uo(n,t){const e=Math.pow(10,t);return Math.round(n*e)/e}function ys(n,t){return Math.floor(Uo(n,t))}function vs(n,t){return Math.ceil(Uo(n,t))}function vo(n,t,e){if(n>=t&&n<e)return n;const i=e-t;return((n-t)%i+i)%i+t}const Zo=[NaN,NaN,NaN,0];function zd(n){return typeof n=="string"?n:Ho(n)}const Xd=1024,bn={};let Br=0;function Wd(n){if(n.length===4)return n;const t=n.slice();return t[3]=1,t}function ol(n){const t=Pt.lchuv(jn.xyz(n));return t[3]=n[3],t}function Yd(n){const t=Pt.rgb(Wh.xyz(n));return t[3]=n[3],t}function Vo(n){if(n==="none")return Zo;if(bn.hasOwnProperty(n))return bn[n];if(Br>=Xd){let e=0;for(const i in bn)(e++&3)===0&&(delete bn[i],--Br)}const t=kd(n);if(t.length!==4)throw new Error('failed to parse "'+n+'" as color');for(const e of t)if(isNaN(e))throw new Error('failed to parse "'+n+'" as color');return Yh(t),bn[n]=t,++Br,t}function hn(n){return Array.isArray(n)?n:Vo(n)}function Yh(n){return n[0]=mt(n[0]+.5|0,0,255),n[1]=mt(n[1]+.5|0,0,255),n[2]=mt(n[2]+.5|0,0,255),n[3]=mt(n[3],0,1),n}function Ho(n){let t=n[0];t!=(t|0)&&(t=t+.5|0);let e=n[1];e!=(e|0)&&(e=e+.5|0);let i=n[2];i!=(i|0)&&(i=i+.5|0);const s=n[3]===void 0?1:Math.round(n[3]*1e3)/1e3;return"rgba("+t+","+e+","+i+","+s+")"}const di=typeof navigator<"u"&&typeof navigator.userAgent<"u"?navigator.userAgent.toLowerCase():"",jd=di.includes("firefox"),Bd=di.includes("safari")&&!di.includes("chrom");Bd&&(di.includes("version/15.4")||/cpu (os|iphone os) 15_4 like mac os x/.test(di));const Kd=di.includes("webkit")&&!di.includes("edge"),jh=di.includes("macintosh"),Bh=typeof devicePixelRatio<"u"?devicePixelRatio:1,Kh=typeof WorkerGlobalScope<"u"&&typeof OffscreenCanvas<"u"&&self instanceof WorkerGlobalScope,Uh=typeof Image<"u"&&Image.prototype.decode,Zh=function(){let n=!1;try{const t=Object.defineProperty({},"passive",{get:function(){n=!0}});window.addEventListener("_",null,t),window.removeEventListener("_",null,t)}catch{}return n}();function It(n,t,e,i){let s;return e&&e.length?s=e.shift():Kh?s=new OffscreenCanvas(n||300,t||300):s=document.createElement("canvas"),n&&(s.width=n),t&&(s.height=t),s.getContext("2d",i)}let Kr;function js(){return Kr||(Kr=It(1,1)),Kr}function yr(n){const t=n.canvas;t.width=1,t.height=1,n.clearRect(0,0,1,1)}function al(n,t){const e=t.parentNode;e&&e.replaceChild(n,t)}function Ud(n){for(;n.lastChild;)n.lastChild.remove()}function Zd(n,t){const e=n.childNodes;for(let i=0;;++i){const s=e[i],r=t[i];if(!s&&!r)break;if(s!==r){if(!s){n.appendChild(r);continue}if(!r){n.removeChild(s),--i;continue}n.insertBefore(r,s)}}}const j={CHANGE:"change",ERROR:"error",CONTEXTMENU:"contextmenu",CLICK:"click",DBLCLICK:"dblclick",KEYDOWN:"keydown",KEYPRESS:"keypress",LOAD:"load",TOUCHMOVE:"touchmove",WHEEL:"wheel"};class vr{constructor(){this.disposed=!1}dispose(){this.disposed||(this.disposed=!0,this.disposeInternal())}disposeInternal(){}}function Vd(n,t,e){let i,s;e=e||Ye;let r=0,o=n.length,a=!1;for(;r<o;)i=r+(o-r>>1),s=+e(n[i],t),s<0?r=i+1:(o=i,a=!s);return a?r:~r}function Ye(n,t){return n>t?1:n<t?-1:0}function Hd(n,t){return n<t?1:n>t?-1:0}function qo(n,t,e){if(n[0]<=t)return 0;const i=n.length;if(t<=n[i-1])return i-1;if(typeof e=="function"){for(let s=1;s<i;++s){const r=n[s];if(r===t)return s;if(r<t)return e(t,n[s-1],r)>0?s-1:s}return i-1}if(e>0){for(let s=1;s<i;++s)if(n[s]<t)return s-1;return i-1}if(e<0){for(let s=1;s<i;++s)if(n[s]<=t)return s;return i-1}for(let s=1;s<i;++s){if(n[s]==t)return s;if(n[s]<t)return n[s-1]-t<t-n[s]?s-1:s}return i-1}function qd(n,t,e){for(;t<e;){const i=n[t];n[t]=n[e],n[e]=i,++t,--e}}function Se(n,t){const e=Array.isArray(t)?t:[t],i=e.length;for(let s=0;s<i;s++)n[n.length]=e[s]}function mi(n,t){const e=n.length;if(e!==t.length)return!1;for(let i=0;i<e;i++)if(n[i]!==t[i])return!1;return!0}function $d(n,t,e){const i=t||Ye;return n.every(function(s,r){if(r===0)return!0;const o=i(n[r-1],s);return!(o>0||o===0)})}function Bn(){return!0}function xr(){return!1}function cn(){}function Vh(n){let t,e,i;return function(){const s=Array.prototype.slice.call(arguments);return(!e||this!==i||!mi(s,e))&&(i=this,e=s,t=n.apply(this,arguments)),t}}function Jd(n){function t(){let e;try{e=n()}catch(i){return Promise.reject(i)}return e instanceof Promise?e:Promise.resolve(e)}return t()}function ss(n){for(const t in n)delete n[t]}function Ai(n){let t;for(t in n)return!1;return!t}class Ve{constructor(t){this.propagationStopped,this.defaultPrevented,this.type=t,this.target=null}preventDefault(){this.defaultPrevented=!0}stopPropagation(){this.propagationStopped=!0}}class wr extends vr{constructor(t){super(),this.eventTarget_=t,this.pendingRemovals_=null,this.dispatching_=null,this.listeners_=null}addEventListener(t,e){if(!t||!e)return;const i=this.listeners_||(this.listeners_={}),s=i[t]||(i[t]=[]);s.includes(e)||s.push(e)}dispatchEvent(t){const e=typeof t=="string",i=e?t:t.type,s=this.listeners_&&this.listeners_[i];if(!s)return;const r=e?new Ve(t):t;r.target||(r.target=this.eventTarget_||this);const o=this.dispatching_||(this.dispatching_={}),a=this.pendingRemovals_||(this.pendingRemovals_={});i in o||(o[i]=0,a[i]=0),++o[i];let l;for(let h=0,c=s.length;h<c;++h)if("handleEvent"in s[h]?l=s[h].handleEvent(r):l=s[h].call(this,r),l===!1||r.propagationStopped){l=!1;break}if(--o[i]===0){let h=a[i];for(delete a[i];h--;)this.removeEventListener(i,cn);delete o[i]}return l}disposeInternal(){this.listeners_&&ss(this.listeners_)}getListeners(t){return this.listeners_&&this.listeners_[t]||void 0}hasListener(t){return this.listeners_?t?t in this.listeners_:Object.keys(this.listeners_).length>0:!1}removeEventListener(t,e){if(!this.listeners_)return;const i=this.listeners_[t];if(!i)return;const s=i.indexOf(e);s!==-1&&(this.pendingRemovals_&&t in this.pendingRemovals_?(i[s]=cn,++this.pendingRemovals_[t]):(i.splice(s,1),i.length===0&&delete this.listeners_[t]))}}function q(n,t,e,i,s){if(s){const o=e;e=function(a){return n.removeEventListener(t,e),o.call(i??this,a)}}else i&&i!==n&&(e=e.bind(i));const r={target:n,type:t,listener:e};return n.addEventListener(t,e),r}function Bs(n,t,e,i){return q(n,t,e,i,!0)}function at(n){n&&n.target&&(n.target.removeEventListener(n.type,n.listener),ss(n))}function Qd(n,t,e){const i=n;let s=!0,r=!1,o=!1;const a=[Bs(i,j.LOAD,function(){o=!0,r||t()})];return i.src&&Uh?(r=!0,i.decode().then(function(){s&&t()}).catch(function(l){s&&(o?t():e())})):a.push(Bs(i,j.ERROR,e)),function(){s=!1,a.forEach(at)}}function tf(n,t){return new Promise((e,i)=>{function s(){o(),e(n)}function r(){o(),i(new Error("Image load error"))}function o(){n.removeEventListener("load",s),n.removeEventListener("error",r)}n.addEventListener("load",s),n.addEventListener("error",r)})}function ef(n,t){return t&&(n.src=t),n.src&&Uh?new Promise((e,i)=>n.decode().then(()=>e(n)).catch(s=>n.complete&&n.width?e(n):i(s))):tf(n)}class nf{constructor(){this.cache_={},this.patternCache_={},this.cacheSize_=0,this.maxCacheSize_=1024}clear(){this.cache_={},this.patternCache_={},this.cacheSize_=0}canExpireCache(){return this.cacheSize_>this.maxCacheSize_}expire(){if(this.canExpireCache()){let t=0;for(const e in this.cache_){const i=this.cache_[e];(t++&3)===0&&!i.hasListener()&&(delete this.cache_[e],delete this.patternCache_[e],--this.cacheSize_)}}}get(t,e,i){const s=Ur(t,e,i);return s in this.cache_?this.cache_[s]:null}getPattern(t,e,i){const s=Ur(t,e,i);return s in this.patternCache_?this.patternCache_[s]:null}set(t,e,i,s,r){const o=Ur(t,e,i),a=o in this.cache_;this.cache_[o]=s,r&&(s.getImageState()===K.IDLE&&s.load(),s.getImageState()===K.LOADING?s.ready().then(()=>{this.patternCache_[o]=js().createPattern(s.getImage(1),"repeat")}):this.patternCache_[o]=js().createPattern(s.getImage(1),"repeat")),a||++this.cacheSize_}setSize(t){this.maxCacheSize_=t,this.expire()}}function Ur(n,t,e){const i=e?hn(e):"null";return t+":"+n+":"+i}const ee=new nf;let Mn=null;class Hh extends wr{constructor(t,e,i,s,r){super(),this.hitDetectionImage_=null,this.image_=t,this.crossOrigin_=i,this.canvas_={},this.color_=r,this.imageState_=s===void 0?K.IDLE:s,this.size_=t&&t.width&&t.height?[t.width,t.height]:null,this.src_=e,this.tainted_,this.ready_=null}initializeImage_(){this.image_=new Image,this.crossOrigin_!==null&&(this.image_.crossOrigin=this.crossOrigin_)}isTainted_(){if(this.tainted_===void 0&&this.imageState_===K.LOADED){Mn||(Mn=It(1,1,void 0,{willReadFrequently:!0})),Mn.drawImage(this.image_,0,0);try{Mn.getImageData(0,0,1,1),this.tainted_=!1}catch{Mn=null,this.tainted_=!0}}return this.tainted_===!0}dispatchChangeEvent_(){this.dispatchEvent(j.CHANGE)}handleImageError_(){this.imageState_=K.ERROR,this.dispatchChangeEvent_()}handleImageLoad_(){this.imageState_=K.LOADED,this.size_=[this.image_.width,this.image_.height],this.dispatchChangeEvent_()}getImage(t){return this.image_||this.initializeImage_(),this.replaceColor_(t),this.canvas_[t]?this.canvas_[t]:this.image_}getPixelRatio(t){return this.replaceColor_(t),this.canvas_[t]?t:1}getImageState(){return this.imageState_}getHitDetectionImage(){if(this.image_||this.initializeImage_(),!this.hitDetectionImage_)if(this.isTainted_()){const t=this.size_[0],e=this.size_[1],i=It(t,e);i.fillRect(0,0,t,e),this.hitDetectionImage_=i.canvas}else this.hitDetectionImage_=this.image_;return this.hitDetectionImage_}getSize(){return this.size_}getSrc(){return this.src_}load(){if(this.imageState_===K.IDLE){this.image_||this.initializeImage_(),this.imageState_=K.LOADING;try{this.src_!==void 0&&(this.image_.src=this.src_)}catch{this.handleImageError_()}this.image_ instanceof HTMLImageElement&&ef(this.image_,this.src_).then(t=>{this.image_=t,this.handleImageLoad_()}).catch(this.handleImageError_.bind(this))}}replaceColor_(t){if(!this.color_||this.canvas_[t]||this.imageState_!==K.LOADED)return;const e=this.image_,i=It(Math.ceil(e.width*t),Math.ceil(e.height*t)),s=i.canvas;i.scale(t,t),i.drawImage(e,0,0),i.globalCompositeOperation="multiply",i.fillStyle=zd(this.color_),i.fillRect(0,0,s.width/t,s.height/t),i.globalCompositeOperation="destination-in",i.drawImage(e,0,0),this.canvas_[t]=s}ready(){return this.ready_||(this.ready_=new Promise(t=>{if(this.imageState_===K.LOADED||this.imageState_===K.ERROR)t();else{const e=()=>{(this.imageState_===K.LOADED||this.imageState_===K.ERROR)&&(this.removeEventListener(j.CHANGE,e),t())};this.addEventListener(j.CHANGE,e)}})),this.ready_}}function $o(n,t,e,i,s,r){let o=t===void 0?void 0:ee.get(t,e,s);return o||(o=new Hh(n,n&&"src"in n?n.src||void 0:t,e,i,s),ee.set(t,e,s,o,r)),r&&o&&!ee.getPattern(t,e,s)&&ee.set(t,e,s,o,r),o}function Ce(n){return n?Array.isArray(n)?Ho(n):typeof n=="object"&&"src"in n?sf(n):n:null}function sf(n){if(!n.offset||!n.size)return ee.getPattern(n.src,"anonymous",n.color);const t=n.src+":"+n.offset,e=ee.getPattern(t,void 0,n.color);if(e)return e;const i=ee.get(n.src,"anonymous",null);if(i.getImageState()!==K.LOADED)return null;const s=It(n.size[0],n.size[1]);return s.drawImage(i.getImage(1),n.offset[0],n.offset[1],n.size[0],n.size[1],0,0,n.size[0],n.size[1]),$o(s.canvas,t,void 0,K.LOADED,n.color,!0),ee.getPattern(t,void 0,n.color)}const un={PROPERTYCHANGE:"propertychange"};class rs extends wr{constructor(){super(),this.on=this.onInternal,this.once=this.onceInternal,this.un=this.unInternal,this.revision_=0}changed(){++this.revision_,this.dispatchEvent(j.CHANGE)}getRevision(){return this.revision_}onInternal(t,e){if(Array.isArray(t)){const i=t.length,s=new Array(i);for(let r=0;r<i;++r)s[r]=q(this,t[r],e);return s}return q(this,t,e)}onceInternal(t,e){let i;if(Array.isArray(t)){const s=t.length;i=new Array(s);for(let r=0;r<s;++r)i[r]=Bs(this,t[r],e)}else i=Bs(this,t,e);return e.ol_key=i,i}unInternal(t,e){const i=e.ol_key;if(i)rf(i);else if(Array.isArray(t))for(let s=0,r=t.length;s<r;++s)this.removeEventListener(t[s],e);else this.removeEventListener(t,e)}}rs.prototype.on;rs.prototype.once;rs.prototype.un;function rf(n){if(Array.isArray(n))for(let t=0,e=n.length;t<e;++t)at(n[t]);else at(n)}function G(){throw new Error("Unimplemented abstract method.")}let of=0;function Q(n){return n.ol_uid||(n.ol_uid=String(++of))}class ll extends Ve{constructor(t,e,i){super(t),this.key=e,this.oldValue=i}}class Ae extends rs{constructor(t){super(),this.on,this.once,this.un,Q(this),this.values_=null,t!==void 0&&this.setProperties(t)}get(t){let e;return this.values_&&this.values_.hasOwnProperty(t)&&(e=this.values_[t]),e}getKeys(){return this.values_&&Object.keys(this.values_)||[]}getProperties(){return this.values_&&Object.assign({},this.values_)||{}}getPropertiesInternal(){return this.values_}hasProperties(){return!!this.values_}notify(t,e){let i;i=`change:${t}`,this.hasListener(i)&&this.dispatchEvent(new ll(i,t,e)),i=un.PROPERTYCHANGE,this.hasListener(i)&&this.dispatchEvent(new ll(i,t,e))}addChangeListener(t,e){this.addEventListener(`change:${t}`,e)}removeChangeListener(t,e){this.removeEventListener(`change:${t}`,e)}set(t,e,i){const s=this.values_||(this.values_={});if(i)s[t]=e;else{const r=s[t];s[t]=e,r!==e&&this.notify(t,r)}}setProperties(t,e){for(const i in t)this.set(i,t[i],e)}applyProperties(t){t.values_&&Object.assign(this.values_||(this.values_={}),t.values_)}unset(t,e){if(this.values_&&t in this.values_){const i=this.values_[t];delete this.values_[t],Ai(this.values_)&&(this.values_=null),e||this.notify(t,i)}}}const xs="ol-hidden",Er="ol-unselectable",Jo="ol-control",hl="ol-collapsed",af=new RegExp(["^\\s*(?=(?:(?:[-a-z]+\\s*){0,2}(italic|oblique))?)","(?=(?:(?:[-a-z]+\\s*){0,2}(small-caps))?)","(?=(?:(?:[-a-z]+\\s*){0,2}(bold(?:er)?|lighter|[1-9]00 ))?)","(?:(?:normal|\\1|\\2|\\3)\\s*){0,3}((?:xx?-)?","(?:small|large)|medium|smaller|larger|[\\.\\d]+(?:\\%|in|[cem]m|ex|p[ctx]))","(?:\\s*\\/\\s*(normal|[\\.\\d]+(?:\\%|in|[cem]m|ex|p[ctx])?))",`?\\s*([-,\\"\\'\\sa-z]+?)\\s*$`].join(""),"i"),cl=["style","variant","weight","size","lineHeight","family"],qh=function(n){const t=n.match(af);if(!t)return null;const e={lineHeight:"normal",size:"1.2em",style:"normal",weight:"normal",variant:"normal"};for(let i=0,s=cl.length;i<s;++i){const r=t[i+1];r!==void 0&&(e[cl[i]]=r)}return e.families=e.family.split(/,\s?/),e},$h="10px sans-serif",Wt="#000",dn="round",je=[],Be=0,fn="round",Kn=10,Un="#000",Zn="center",Ks="middle",Ci=[0,0,0,0],Vn=1,Ne=new Ae;let qi=null,xo;const wo={},lf=function(){const t="32px ",e=["monospace","serif"],i=e.length,s="wmytzilWMYTZIL@#/&?$%10";let r,o;function a(h,c,u){let d=!0;for(let f=0;f<i;++f){const g=e[f];if(o=Us(h+" "+c+" "+t+g,s),u!=g){const _=Us(h+" "+c+" "+t+u+","+g,s);d=d&&_!=o}}return!!d}function l(){let h=!0;const c=Ne.getKeys();for(let u=0,d=c.length;u<d;++u){const f=c[u];if(Ne.get(f)<100){const[g,_,m]=f.split(`
`);a(g,_,m)?(ss(wo),qi=null,xo=void 0,Ne.set(f,100)):(Ne.set(f,Ne.get(f)+1,!0),h=!1)}}h&&(clearInterval(r),r=void 0)}return function(h){const c=qh(h);if(!c)return;const u=c.families;for(let d=0,f=u.length;d<f;++d){const g=u[d],_=c.style+`
`+c.weight+`
`+g;Ne.get(_)===void 0&&(Ne.set(_,100,!0),a(c.style,c.weight,g)||(Ne.set(_,0,!0),r===void 0&&(r=setInterval(l,32))))}}}(),hf=function(){let n;return function(t){let e=wo[t];if(e==null){if(Kh){const i=qh(t),s=Jh(t,"Žg");e=(isNaN(Number(i.lineHeight))?1.2:Number(i.lineHeight))*(s.actualBoundingBoxAscent+s.actualBoundingBoxDescent)}else n||(n=document.createElement("div"),n.innerHTML="M",n.style.minHeight="0",n.style.maxHeight="none",n.style.height="auto",n.style.padding="0",n.style.border="none",n.style.position="absolute",n.style.display="block",n.style.left="-99999px"),n.style.font=t,document.body.appendChild(n),e=n.offsetHeight,document.body.removeChild(n);wo[t]=e}return e}}();function Jh(n,t){return qi||(qi=It(1,1)),n!=xo&&(qi.font=n,xo=qi.font),qi.measureText(t)}function Us(n,t){return Jh(n,t).width}function ul(n,t,e){if(t in e)return e[t];const i=t.split(`
`).reduce((s,r)=>Math.max(s,Us(n,r)),0);return e[t]=i,i}function cf(n,t){const e=[],i=[],s=[];let r=0,o=0,a=0,l=0;for(let h=0,c=t.length;h<=c;h+=2){const u=t[h];if(u===`
`||h===c){r=Math.max(r,o),s.push(o),o=0,a+=l,l=0;continue}const d=t[h+1]||n.font,f=Us(d,u);e.push(f),o+=f;const g=hf(d);i.push(g),l=Math.max(l,g)}return{width:r,height:a,widths:e,heights:i,lineWidths:s}}function uf(n,t,e,i,s,r,o,a,l,h,c){n.save(),e!==1&&(n.globalAlpha===void 0?n.globalAlpha=u=>u.globalAlpha*=e:n.globalAlpha*=e),t&&n.transform.apply(n,t),i.contextInstructions?(n.translate(l,h),n.scale(c[0],c[1]),df(i,n)):c[0]<0||c[1]<0?(n.translate(l,h),n.scale(c[0],c[1]),n.drawImage(i,s,r,o,a,0,0,o,a)):n.drawImage(i,s,r,o,a,l,h,o*c[0],a*c[1]),n.restore()}function df(n,t){const e=n.contextInstructions;for(let i=0,s=e.length;i<s;i+=2)Array.isArray(e[i+1])?t[e[i]].apply(t,e[i+1]):t[e[i]]=e[i+1]}function dl(n){return n[0]>0&&n[1]>0}function ff(n,t,e){return e===void 0&&(e=[0,0]),e[0]=n[0]*t+.5|0,e[1]=n[1]*t+.5|0,e}function Ut(n,t){return Array.isArray(n)?n:(t===void 0?t=[n,n]:(t[0]=n,t[1]=n),t)}class Cr{constructor(t){this.opacity_=t.opacity,this.rotateWithView_=t.rotateWithView,this.rotation_=t.rotation,this.scale_=t.scale,this.scaleArray_=Ut(t.scale),this.displacement_=t.displacement,this.declutterMode_=t.declutterMode}clone(){const t=this.getScale();return new Cr({opacity:this.getOpacity(),scale:Array.isArray(t)?t.slice():t,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()})}getOpacity(){return this.opacity_}getRotateWithView(){return this.rotateWithView_}getRotation(){return this.rotation_}getScale(){return this.scale_}getScaleArray(){return this.scaleArray_}getDisplacement(){return this.displacement_}getDeclutterMode(){return this.declutterMode_}getAnchor(){return G()}getImage(t){return G()}getHitDetectionImage(){return G()}getPixelRatio(t){return 1}getImageState(){return G()}getImageSize(){return G()}getOrigin(){return G()}getSize(){return G()}setDisplacement(t){this.displacement_=t}setOpacity(t){this.opacity_=t}setRotateWithView(t){this.rotateWithView_=t}setRotation(t){this.rotation_=t}setScale(t){this.scale_=t,this.scaleArray_=Ut(t)}listenImageChange(t){G()}load(){G()}unlistenImageChange(t){G()}ready(){return Promise.resolve()}}class os extends Cr{constructor(t){super({opacity:1,rotateWithView:t.rotateWithView!==void 0?t.rotateWithView:!1,rotation:t.rotation!==void 0?t.rotation:0,scale:t.scale!==void 0?t.scale:1,displacement:t.displacement!==void 0?t.displacement:[0,0],declutterMode:t.declutterMode}),this.hitDetectionCanvas_=null,this.fill_=t.fill!==void 0?t.fill:null,this.origin_=[0,0],this.points_=t.points,this.radius=t.radius,this.radius2_=t.radius2,this.angle_=t.angle!==void 0?t.angle:0,this.stroke_=t.stroke!==void 0?t.stroke:null,this.size_,this.renderOptions_,this.imageState_=this.fill_&&this.fill_.loading()?K.LOADING:K.LOADED,this.imageState_===K.LOADING&&this.ready().then(()=>this.imageState_=K.LOADED),this.render()}clone(){const t=this.getScale(),e=new os({fill:this.getFill()?this.getFill().clone():void 0,points:this.getPoints(),radius:this.getRadius(),radius2:this.getRadius2(),angle:this.getAngle(),stroke:this.getStroke()?this.getStroke().clone():void 0,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),scale:Array.isArray(t)?t.slice():t,displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()});return e.setOpacity(this.getOpacity()),e}getAnchor(){const t=this.size_,e=this.getDisplacement(),i=this.getScaleArray();return[t[0]/2-e[0]/i[0],t[1]/2+e[1]/i[1]]}getAngle(){return this.angle_}getFill(){return this.fill_}setFill(t){this.fill_=t,this.render()}getHitDetectionImage(){return this.hitDetectionCanvas_||(this.hitDetectionCanvas_=this.createHitDetectionCanvas_(this.renderOptions_)),this.hitDetectionCanvas_}getImage(t){var r,o;const e=(r=this.fill_)==null?void 0:r.getKey(),i=`${t},${this.angle_},${this.radius},${this.radius2_},${this.points_},${e}`+Object.values(this.renderOptions_).join(",");let s=(o=ee.get(i,null,null))==null?void 0:o.getImage(1);if(!s){const a=this.renderOptions_,l=Math.ceil(a.size*t),h=It(l,l);this.draw_(a,h,t),s=h.canvas,ee.set(i,null,null,new Hh(s,void 0,null,K.LOADED,null))}return s}getPixelRatio(t){return t}getImageSize(){return this.size_}getImageState(){return this.imageState_}getOrigin(){return this.origin_}getPoints(){return this.points_}getRadius(){return this.radius}getRadius2(){return this.radius2_}getSize(){return this.size_}getStroke(){return this.stroke_}setStroke(t){this.stroke_=t,this.render()}listenImageChange(t){}load(){}unlistenImageChange(t){}calculateLineJoinSize_(t,e,i){if(e===0||this.points_===1/0||t!=="bevel"&&t!=="miter")return e;let s=this.radius,r=this.radius2_===void 0?s:this.radius2_;if(s<r){const R=s;s=r,r=R}const o=this.radius2_===void 0?this.points_:this.points_*2,a=2*Math.PI/o,l=r*Math.sin(a),h=Math.sqrt(r*r-l*l),c=s-h,u=Math.sqrt(l*l+c*c),d=u/l;if(t==="miter"&&d<=i)return d*e;const f=e/2/d,g=e/2*(c/u),m=Math.sqrt((s+f)*(s+f)+g*g)-s;if(this.radius2_===void 0||t==="bevel")return m*2;const p=s*Math.sin(a),y=Math.sqrt(s*s-p*p),w=r-y,v=Math.sqrt(p*p+w*w)/p;if(v<=i){const R=v*e/2-r-s;return 2*Math.max(m,R)}return m*2}createRenderOptions(){let t=dn,e=fn,i=0,s=null,r=0,o,a=0;this.stroke_&&(o=Ce(this.stroke_.getColor()??Un),a=this.stroke_.getWidth()??Vn,s=this.stroke_.getLineDash(),r=this.stroke_.getLineDashOffset()??0,e=this.stroke_.getLineJoin()??fn,t=this.stroke_.getLineCap()??dn,i=this.stroke_.getMiterLimit()??Kn);const l=this.calculateLineJoinSize_(e,a,i),h=Math.max(this.radius,this.radius2_||0),c=Math.ceil(2*h+l);return{strokeStyle:o,strokeWidth:a,size:c,lineCap:t,lineDash:s,lineDashOffset:r,lineJoin:e,miterLimit:i}}render(){this.renderOptions_=this.createRenderOptions();const t=this.renderOptions_.size;this.hitDetectionCanvas_=null,this.size_=[t,t]}draw_(t,e,i){if(e.scale(i,i),e.translate(t.size/2,t.size/2),this.createPath_(e),this.fill_){let s=this.fill_.getColor();s===null&&(s=Wt),e.fillStyle=Ce(s),e.fill()}t.strokeStyle&&(e.strokeStyle=t.strokeStyle,e.lineWidth=t.strokeWidth,t.lineDash&&(e.setLineDash(t.lineDash),e.lineDashOffset=t.lineDashOffset),e.lineCap=t.lineCap,e.lineJoin=t.lineJoin,e.miterLimit=t.miterLimit,e.stroke())}createHitDetectionCanvas_(t){let e;if(this.fill_){let i=this.fill_.getColor(),s=0;typeof i=="string"&&(i=hn(i)),i===null?s=1:Array.isArray(i)&&(s=i.length===4?i[3]:1),s===0&&(e=It(t.size,t.size),this.drawHitDetectionCanvas_(t,e))}return e?e.canvas:this.getImage(1)}createPath_(t){let e=this.points_;const i=this.radius;if(e===1/0)t.arc(0,0,i,0,2*Math.PI);else{const s=this.radius2_===void 0?i:this.radius2_;this.radius2_!==void 0&&(e*=2);const r=this.angle_-Math.PI/2,o=2*Math.PI/e;for(let a=0;a<e;a++){const l=r+a*o,h=a%2===0?i:s;t.lineTo(h*Math.cos(l),h*Math.sin(l))}t.closePath()}}drawHitDetectionCanvas_(t,e){e.translate(t.size/2,t.size/2),this.createPath_(e),e.fillStyle=Wt,e.fill(),t.strokeStyle&&(e.strokeStyle=t.strokeStyle,e.lineWidth=t.strokeWidth,t.lineDash&&(e.setLineDash(t.lineDash),e.lineDashOffset=t.lineDashOffset),e.lineJoin=t.lineJoin,e.miterLimit=t.miterLimit,e.stroke())}ready(){return this.fill_?this.fill_.ready():Promise.resolve()}}const Ct={UNKNOWN:0,INTERSECTING:1,ABOVE:2,RIGHT:4,BELOW:8,LEFT:16};function fl(n){const t=re();for(let e=0,i=n.length;e<i;++e)Wn(t,n[e]);return t}function Qo(n,t,e){return e?(e[0]=n[0]-t,e[1]=n[1]-t,e[2]=n[2]+t,e[3]=n[3]+t,e):[n[0]-t,n[1]-t,n[2]+t,n[3]+t]}function Qh(n,t){return t?(t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t):n.slice()}function Oi(n,t,e){let i,s;return t<n[0]?i=n[0]-t:n[2]<t?i=t-n[2]:i=0,e<n[1]?s=n[1]-e:n[3]<e?s=e-n[3]:s=0,i*i+s*s}function gn(n,t){return ta(n,t[0],t[1])}function On(n,t){return n[0]<=t[0]&&t[2]<=n[2]&&n[1]<=t[1]&&t[3]<=n[3]}function ta(n,t,e){return n[0]<=t&&t<=n[2]&&n[1]<=e&&e<=n[3]}function Eo(n,t){const e=n[0],i=n[1],s=n[2],r=n[3],o=t[0],a=t[1];let l=Ct.UNKNOWN;return o<e?l=l|Ct.LEFT:o>s&&(l=l|Ct.RIGHT),a<i?l=l|Ct.BELOW:a>r&&(l=l|Ct.ABOVE),l===Ct.UNKNOWN&&(l=Ct.INTERSECTING),l}function re(){return[1/0,1/0,-1/0,-1/0]}function fi(n,t,e,i,s){return s?(s[0]=n,s[1]=t,s[2]=e,s[3]=i,s):[n,t,e,i]}function as(n){return fi(1/0,1/0,-1/0,-1/0,n)}function tc(n,t){const e=n[0],i=n[1];return fi(e,i,e,i,t)}function ea(n,t,e,i,s){const r=as(s);return ic(r,n,t,e,i)}function Hn(n,t){return n[0]==t[0]&&n[2]==t[2]&&n[1]==t[1]&&n[3]==t[3]}function ec(n,t){return t[0]<n[0]&&(n[0]=t[0]),t[2]>n[2]&&(n[2]=t[2]),t[1]<n[1]&&(n[1]=t[1]),t[3]>n[3]&&(n[3]=t[3]),n}function Wn(n,t){t[0]<n[0]&&(n[0]=t[0]),t[0]>n[2]&&(n[2]=t[0]),t[1]<n[1]&&(n[1]=t[1]),t[1]>n[3]&&(n[3]=t[1])}function ic(n,t,e,i,s){for(;e<i;e+=s)gf(n,t[e],t[e+1]);return n}function gf(n,t,e){n[0]=Math.min(n[0],t),n[1]=Math.min(n[1],e),n[2]=Math.max(n[2],t),n[3]=Math.max(n[3],e)}function nc(n,t){let e;return e=t(Rr(n)),e||(e=t(Ir(n)),e)||(e=t(Sr(n)),e)||(e=t(Fi(n)),e)?e:!1}function Co(n){let t=0;return Tr(n)||(t=nt(n)*kt(n)),t}function Rr(n){return[n[0],n[1]]}function Ir(n){return[n[2],n[1]]}function gi(n){return[(n[0]+n[2])/2,(n[1]+n[3])/2]}function _f(n,t){let e;if(t==="bottom-left")e=Rr(n);else if(t==="bottom-right")e=Ir(n);else if(t==="top-left")e=Fi(n);else if(t==="top-right")e=Sr(n);else throw new Error("Invalid corner");return e}function Ro(n,t,e,i,s){const[r,o,a,l,h,c,u,d]=sc(n,t,e,i);return fi(Math.min(r,a,h,u),Math.min(o,l,c,d),Math.max(r,a,h,u),Math.max(o,l,c,d),s)}function sc(n,t,e,i){const s=t*i[0]/2,r=t*i[1]/2,o=Math.cos(e),a=Math.sin(e),l=s*o,h=s*a,c=r*o,u=r*a,d=n[0],f=n[1];return[d-l+u,f-h-c,d-l-u,f-h+c,d+l-u,f+h+c,d+l+u,f+h-c,d-l+u,f-h-c]}function kt(n){return n[3]-n[1]}function Mi(n,t,e){const i=e||re();return Bt(n,t)?(n[0]>t[0]?i[0]=n[0]:i[0]=t[0],n[1]>t[1]?i[1]=n[1]:i[1]=t[1],n[2]<t[2]?i[2]=n[2]:i[2]=t[2],n[3]<t[3]?i[3]=n[3]:i[3]=t[3]):as(i),i}function Fi(n){return[n[0],n[3]]}function Sr(n){return[n[2],n[3]]}function nt(n){return n[2]-n[0]}function Bt(n,t){return n[0]<=t[2]&&n[2]>=t[0]&&n[1]<=t[3]&&n[3]>=t[1]}function Tr(n){return n[2]<n[0]||n[3]<n[1]}function mf(n,t){return t?(t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t):n}function pf(n,t,e){let i=!1;const s=Eo(n,t),r=Eo(n,e);if(s===Ct.INTERSECTING||r===Ct.INTERSECTING)i=!0;else{const o=n[0],a=n[1],l=n[2],h=n[3],c=t[0],u=t[1],d=e[0],f=e[1],g=(f-u)/(d-c);let _,m;r&Ct.ABOVE&&!(s&Ct.ABOVE)&&(_=d-(f-h)/g,i=_>=o&&_<=l),!i&&r&Ct.RIGHT&&!(s&Ct.RIGHT)&&(m=f-(d-l)*g,i=m>=a&&m<=h),!i&&r&Ct.BELOW&&!(s&Ct.BELOW)&&(_=d-(f-a)/g,i=_>=o&&_<=l),!i&&r&Ct.LEFT&&!(s&Ct.LEFT)&&(m=f-(d-o)*g,i=m>=a&&m<=h)}return i}function rc(n,t){const e=t.getExtent(),i=gi(n);if(t.canWrapX()&&(i[0]<e[0]||i[0]>=e[2])){const s=nt(e),o=Math.floor((i[0]-e[0])/s)*s;n[0]-=o,n[2]-=o}return n}function oc(n,t,e){if(t.canWrapX()){const i=t.getExtent();if(!isFinite(n[0])||!isFinite(n[2]))return[[i[0],n[1],i[2],n[3]]];rc(n,t);const s=nt(i);if(nt(n)>s&&!e)return[[i[0],n[1],i[2],n[3]]];if(n[0]<i[0])return[[n[0]+s,n[1],i[2],n[3]],[i[0],n[1],n[2],n[3]]];if(n[2]>i[2])return[[n[0],n[1],i[2],n[3]],[i[0],n[1],n[2]-s,n[3]]]}return[n]}function ac(...n){console.warn(...n)}function yf(n,t){return n[0]+=+t[0],n[1]+=+t[1],n}function Zs(n,t){let e=!0;for(let i=n.length-1;i>=0;--i)if(n[i]!=t[i]){e=!1;break}return e}function ia(n,t){const e=Math.cos(t),i=Math.sin(t),s=n[0]*e-n[1]*i,r=n[1]*e+n[0]*i;return n[0]=s,n[1]=r,n}function vf(n,t){return n[0]*=t,n[1]*=t,n}function lc(n,t){if(t.canWrapX()){const e=nt(t.getExtent()),i=xf(n,t,e);i&&(n[0]-=i*e)}return n}function xf(n,t,e){const i=t.getExtent();let s=0;return t.canWrapX()&&(n[0]<i[0]||n[0]>i[2])&&(e=e||nt(i),s=Math.floor((n[0]-i[0])/e)),s}const na={radians:6370997/(2*Math.PI),degrees:2*Math.PI*6370997/360,ft:.3048,m:1,"us-ft":1200/3937};class sa{constructor(t){this.code_=t.code,this.units_=t.units,this.extent_=t.extent!==void 0?t.extent:null,this.worldExtent_=t.worldExtent!==void 0?t.worldExtent:null,this.axisOrientation_=t.axisOrientation!==void 0?t.axisOrientation:"enu",this.global_=t.global!==void 0?t.global:!1,this.canWrapX_=!!(this.global_&&this.extent_),this.getPointResolutionFunc_=t.getPointResolution,this.defaultTileGrid_=null,this.metersPerUnit_=t.metersPerUnit}canWrapX(){return this.canWrapX_}getCode(){return this.code_}getExtent(){return this.extent_}getUnits(){return this.units_}getMetersPerUnit(){return this.metersPerUnit_||na[this.units_]}getWorldExtent(){return this.worldExtent_}getAxisOrientation(){return this.axisOrientation_}isGlobal(){return this.global_}setGlobal(t){this.global_=t,this.canWrapX_=!!(t&&this.extent_)}getDefaultTileGrid(){return this.defaultTileGrid_}setDefaultTileGrid(t){this.defaultTileGrid_=t}setExtent(t){this.extent_=t,this.canWrapX_=!!(this.global_&&t)}setWorldExtent(t){this.worldExtent_=t}setGetPointResolution(t){this.getPointResolutionFunc_=t}getPointResolutionFunc(){return this.getPointResolutionFunc_}}const ls=6378137,tn=Math.PI*ls,wf=[-tn,-tn,tn,tn],Ef=[-180,-85,180,85],ws=ls*Math.log(Math.tan(Math.PI/2));class Yi extends sa{constructor(t){super({code:t,units:"m",extent:wf,global:!0,worldExtent:Ef,getPointResolution:function(e,i){return e/Math.cosh(i[1]/ls)}})}}const gl=[new Yi("EPSG:3857"),new Yi("EPSG:102100"),new Yi("EPSG:102113"),new Yi("EPSG:900913"),new Yi("http://www.opengis.net/def/crs/EPSG/0/3857"),new Yi("http://www.opengis.net/gml/srs/epsg.xml#3857")];function Cf(n,t,e,i){const s=n.length;e=e>1?e:2,i=i??e,t===void 0&&(e>2?t=n.slice():t=new Array(s));for(let r=0;r<s;r+=i){t[r]=tn*n[r]/180;let o=ls*Math.log(Math.tan(Math.PI*(+n[r+1]+90)/360));o>ws?o=ws:o<-ws&&(o=-ws),t[r+1]=o}return t}function Rf(n,t,e,i){const s=n.length;e=e>1?e:2,i=i??e,t===void 0&&(e>2?t=n.slice():t=new Array(s));for(let r=0;r<s;r+=i)t[r]=180*n[r]/tn,t[r+1]=360*Math.atan(Math.exp(n[r+1]/ls))/Math.PI-90;return t}const If=6378137,_l=[-180,-90,180,90],Sf=Math.PI*If/180;class xi extends sa{constructor(t,e){super({code:t,units:"degrees",extent:_l,axisOrientation:e,global:!0,metersPerUnit:Sf,worldExtent:_l})}}const ml=[new xi("CRS:84"),new xi("EPSG:4326","neu"),new xi("urn:ogc:def:crs:OGC:1.3:CRS84"),new xi("urn:ogc:def:crs:OGC:2:84"),new xi("http://www.opengis.net/def/crs/OGC/1.3/CRS84"),new xi("http://www.opengis.net/gml/srs/epsg.xml#4326","neu"),new xi("http://www.opengis.net/def/crs/EPSG/0/4326","neu")];let Io={};function Tf(n){return Io[n]||Io[n.replace(/urn:(x-)?ogc:def:crs:EPSG:(.*:)?(\w+)$/,"EPSG:$3")]||null}function bf(n,t){Io[n]=t}let rn={};function qn(n,t,e){const i=n.getCode(),s=t.getCode();i in rn||(rn[i]={}),rn[i][s]=e}function Zr(n,t){return n in rn&&t in rn[n]?rn[n][t]:null}const Vs=.9996,se=.00669438,br=se*se,Mr=br*se,Ri=se/(1-se),pl=Math.sqrt(1-se),_n=(1-pl)/(1+pl),hc=_n*_n,ra=hc*_n,oa=ra*_n,cc=oa*_n,uc=1-se/4-3*br/64-5*Mr/256,Mf=3*se/8+3*br/32+45*Mr/1024,Af=15*br/256+45*Mr/1024,Lf=35*Mr/3072,Pf=3/2*_n-27/32*ra+269/512*cc,Of=21/16*hc-55/32*oa,Ff=151/96*ra-417/128*cc,Df=1097/512*oa,Hs=6378137;function kf(n,t,e){const i=n-5e5,o=(e.north?t:t-1e7)/Vs/(Hs*uc),a=o+Pf*Math.sin(2*o)+Of*Math.sin(4*o)+Ff*Math.sin(6*o)+Df*Math.sin(8*o),l=Math.sin(a),h=l*l,c=Math.cos(a),u=l/c,d=u*u,f=d*d,g=1-se*h,_=Math.sqrt(1-se*h),m=Hs/_,p=(1-se)/g,y=Ri*c**2,w=y*y,x=i/(m*Vs),v=x*x,R=v*x,S=R*x,C=S*x,I=C*x,b=a-u/p*(v/2-S/24*(5+3*d+10*y-4*w-9*Ri))+I/720*(61+90*d+298*y+45*f-252*Ri-3*w);let L=(x-R/6*(1+2*d+y)+C/120*(5-2*y+28*d-3*w+8*Ri+24*f))/c;return L=vo(L+li(dc(e.number)),-Math.PI,Math.PI),[rl(L),rl(b)]}const yl=-80,vl=84,Nf=-180,Gf=180;function zf(n,t,e){n=vo(n,Nf,Gf),t<yl?t=yl:t>vl&&(t=vl);const i=li(t),s=Math.sin(i),r=Math.cos(i),o=s/r,a=o*o,l=a*a,h=li(n),c=dc(e.number),u=li(c),d=Hs/Math.sqrt(1-se*s**2),f=Ri*r**2,g=r*vo(h-u,-Math.PI,Math.PI),_=g*g,m=_*g,p=m*g,y=p*g,w=y*g,x=Hs*(uc*i-Mf*Math.sin(2*i)+Af*Math.sin(4*i)-Lf*Math.sin(6*i)),v=Vs*d*(g+m/6*(1-a+f)+y/120*(5-18*a+l+72*f-58*Ri))+5e5;let R=Vs*(x+d*o*(_/2+p/24*(5-a+9*f+4*f**2)+w/720*(61-58*a+l+600*f-330*Ri)));return e.north||(R+=1e7),[v,R]}function dc(n){return(n-1)*6-180+3}const Xf=[/^EPSG:(\d+)$/,/^urn:ogc:def:crs:EPSG::(\d+)$/,/^http:\/\/www\.opengis\.net\/def\/crs\/EPSG\/0\/(\d+)$/];function fc(n){let t=0;for(const s of Xf){const r=n.match(s);if(r){t=parseInt(r[1]);break}}if(!t)return null;let e=0,i=!1;return t>32700&&t<32761?e=t-32700:t>32600&&t<32661&&(i=!0,e=t-32600),e?{number:e,north:i}:null}function xl(n,t){return function(e,i,s,r){const o=e.length;s=s>1?s:2,r=r??s,i||(s>2?i=e.slice():i=new Array(o));for(let a=0;a<o;a+=r){const l=e[a],h=e[a+1],c=n(l,h,t);i[a]=c[0],i[a+1]=c[1]}return i}}function Wf(n){return fc(n)?new sa({code:n,units:"m"}):null}function Yf(n){const t=fc(n.getCode());return t?{forward:xl(zf,t),inverse:xl(kf,t)}:null}const jf=63710088e-1;function wl(n,t,e){e=e||jf;const i=li(n[1]),s=li(t[1]),r=(s-i)/2,o=li(t[0]-n[0])/2,a=Math.sin(r)*Math.sin(r)+Math.sin(o)*Math.sin(o)*Math.cos(i)*Math.cos(s);return 2*e*Math.atan2(Math.sqrt(a),Math.sqrt(1-a))}const Bf=[Yf],Kf=[Wf];let So=!0;function gc(n){So=!1}function aa(n,t){if(t!==void 0){for(let e=0,i=n.length;e<i;++e)t[e]=n[e];t=t}else t=n.slice();return t}function To(n){bf(n.getCode(),n),qn(n,n,aa)}function Uf(n){n.forEach(To)}function dt(n){if(typeof n!="string")return n;const t=Tf(n);if(t)return t;for(const e of Kf){const i=e(n);if(i)return i}return null}function El(n,t,e,i){n=dt(n);let s;const r=n.getPointResolutionFunc();if(r)s=r(t,e);else{const o=n.getUnits();if(o=="degrees"||i=="degrees")s=t;else{const a=ha(n,dt("EPSG:4326"));if(!a&&o!=="degrees")s=t*n.getMetersPerUnit();else{let h=[e[0]-t/2,e[1],e[0]+t/2,e[1],e[0],e[1]-t/2,e[0],e[1]+t/2];h=a(h,h,2);const c=wl(h.slice(0,2),h.slice(2,4)),u=wl(h.slice(4,6),h.slice(6,8));s=(c+u)/2}const l=n.getMetersPerUnit();l!==void 0&&(s/=l)}}return s}function Cl(n){Uf(n),n.forEach(function(t){n.forEach(function(e){t!==e&&qn(t,e,aa)})})}function Zf(n,t,e,i){n.forEach(function(s){t.forEach(function(r){qn(s,r,e),qn(r,s,i)})})}function la(n,t){return n?typeof n=="string"?dt(n):n:dt(t)}function Vf(n){return function(t,e,i,s){const r=t.length;i=i!==void 0?i:2,s=s??i,e=e!==void 0?e:new Array(r);for(let o=0;o<r;o+=s){const a=n(t.slice(o,o+i)),l=a.length;for(let h=0,c=s;h<c;++h)e[o+h]=h>=l?t[o+h]:a[h]}return e}}function Rl(n,t){return gc(),ca(n,"EPSG:4326","EPSG:3857")}function Fs(n,t){if(n===t)return!0;const e=n.getUnits()===t.getUnits();return(n.getCode()===t.getCode()||ha(n,t)===aa)&&e}function ha(n,t){const e=n.getCode(),i=t.getCode();let s=Zr(e,i);if(s)return s;let r=null,o=null;for(const l of Bf)r||(r=l(n)),o||(o=l(t));if(!r&&!o)return null;const a="EPSG:4326";if(o)if(r)s=Vr(r.inverse,o.forward);else{const l=Zr(e,a);l&&(s=Vr(l,o.forward))}else{const l=Zr(a,i);l&&(s=Vr(r.inverse,l))}return s&&(To(n),To(t),qn(n,t,s)),s}function Vr(n,t){return function(e,i,s,r){return i=n(e,i,s,r),t(i,i,s,r)}}function $n(n,t){const e=dt(n),i=dt(t);return ha(e,i)}function ca(n,t,e){const i=$n(t,e);if(!i){const s=dt(t).getCode(),r=dt(e).getCode();throw new Error(`No transform available between ${s} and ${r}`)}return i(n,void 0,n.length)}function bo(n,t){return n}function Ge(n,t){return So&&!Zs(n,[0,0])&&n[0]>=-180&&n[0]<=180&&n[1]>=-90&&n[1]<=90&&(So=!1,ac("Call useGeographic() from ol/proj once to work with [longitude, latitude] coordinates.")),n}function _c(n,t){return n}function ri(n,t){return n}function Hf(){Cl(gl),Cl(ml),Zf(ml,gl,Cf,Rf)}Hf();class ua{constructor(t,e,i,s){this.minX=t,this.maxX=e,this.minY=i,this.maxY=s}contains(t){return this.containsXY(t[1],t[2])}containsTileRange(t){return this.minX<=t.minX&&t.maxX<=this.maxX&&this.minY<=t.minY&&t.maxY<=this.maxY}containsXY(t,e){return this.minX<=t&&t<=this.maxX&&this.minY<=e&&e<=this.maxY}equals(t){return this.minX==t.minX&&this.minY==t.minY&&this.maxX==t.maxX&&this.maxY==t.maxY}extend(t){t.minX<this.minX&&(this.minX=t.minX),t.maxX>this.maxX&&(this.maxX=t.maxX),t.minY<this.minY&&(this.minY=t.minY),t.maxY>this.maxY&&(this.maxY=t.maxY)}getHeight(){return this.maxY-this.minY+1}getSize(){return[this.getWidth(),this.getHeight()]}getWidth(){return this.maxX-this.minX+1}intersects(t){return this.minX<=t.maxX&&this.maxX>=t.minX&&this.minY<=t.maxY&&this.maxY>=t.minY}}function ji(n,t,e,i,s){return s!==void 0?(s.minX=n,s.maxX=t,s.minY=e,s.maxY=i,s):new ua(n,t,e,i)}function $(n,t){if(!n)throw new Error(t)}function qf(n,t,e,i,s){return!nc(s,function(o){return!Ii(n,t,e,i,o[0],o[1])})}function Ii(n,t,e,i,s,r){let o=0,a=n[e-i],l=n[e-i+1];for(;t<e;t+=i){const h=n[t],c=n[t+1];l<=r?c>r&&(h-a)*(r-l)-(s-a)*(c-l)>0&&o++:c<=r&&(h-a)*(r-l)-(s-a)*(c-l)<0&&o--,a=h,l=c}return o!==0}function da(n,t,e,i,s,r){if(e.length===0||!Ii(n,t,e[0],i,s,r))return!1;for(let o=1,a=e.length;o<a;++o)if(Ii(n,e[o-1],e[o],i,s,r))return!1;return!0}function $f(n,t,e,i,s,r){if(e.length===0)return!1;for(let o=0,a=e.length;o<a;++o){const l=e[o];if(da(n,t,l,i,s,r))return!0;t=l[l.length-1]}return!1}function mc(n,t,e,i,s){let r;for(t+=i;t<e;t+=i)if(r=s(n.slice(t-i,t),n.slice(t,t+i)),r)return r;return!1}function Ar(n,t,e,i,s,r){return r=r??ic(re(),n,t,e,i),Bt(s,r)?r[0]>=s[0]&&r[2]<=s[2]||r[1]>=s[1]&&r[3]<=s[3]?!0:mc(n,t,e,i,function(o,a){return pf(s,o,a)}):!1}function Jf(n,t,e,i,s){for(let r=0,o=e.length;r<o;++r){if(Ar(n,t,e[r],i,s))return!0;t=e[r]}return!1}function pc(n,t,e,i,s){return!!(Ar(n,t,e,i,s)||Ii(n,t,e,i,s[0],s[1])||Ii(n,t,e,i,s[0],s[3])||Ii(n,t,e,i,s[2],s[1])||Ii(n,t,e,i,s[2],s[3]))}function yc(n,t,e,i,s){if(!pc(n,t,e[0],i,s))return!1;if(e.length===1)return!0;for(let r=1,o=e.length;r<o;++r)if(qf(n,e[r-1],e[r],i,s)&&!Ar(n,e[r-1],e[r],i,s))return!1;return!0}function Qf(n,t,e,i,s){for(let r=0,o=e.length;r<o;++r){const a=e[r];if(yc(n,t,a,i,s))return!0;t=a[a.length-1]}return!1}function qs(n,t,e,i){return i!==void 0?(i[0]=n,i[1]=t,i[2]=e,i):[n,t,e]}function tg(n,t,e){return n+"/"+t+"/"+e}function eg(n){return ig(n[0],n[1],n[2])}function ig(n,t,e){return(t<<n)+e}function ng(n,t){const e=n[0],i=n[1],s=n[2];if(t.getMinZoom()>e||e>t.getMaxZoom())return!1;const r=t.getFullTileRange(e);return r?r.containsXY(i,s):!0}const sg=42,fa=256,Bi=[0,0,0],qe=5;class vc{constructor(t){this.minZoom=t.minZoom!==void 0?t.minZoom:0,this.resolutions_=t.resolutions,$($d(this.resolutions_,(s,r)=>r-s),"`resolutions` must be sorted in descending order");let e;if(!t.origins){for(let s=0,r=this.resolutions_.length-1;s<r;++s)if(!e)e=this.resolutions_[s]/this.resolutions_[s+1];else if(this.resolutions_[s]/this.resolutions_[s+1]!==e){e=void 0;break}}this.zoomFactor_=e,this.maxZoom=this.resolutions_.length-1,this.origin_=t.origin!==void 0?t.origin:null,this.origins_=null,t.origins!==void 0&&(this.origins_=t.origins,$(this.origins_.length==this.resolutions_.length,"Number of `origins` and `resolutions` must be equal"));const i=t.extent;i!==void 0&&!this.origin_&&!this.origins_&&(this.origin_=Fi(i)),$(!this.origin_&&this.origins_||this.origin_&&!this.origins_,"Either `origin` or `origins` must be configured, never both"),this.tileSizes_=null,t.tileSizes!==void 0&&(this.tileSizes_=t.tileSizes,$(this.tileSizes_.length==this.resolutions_.length,"Number of `tileSizes` and `resolutions` must be equal")),this.tileSize_=t.tileSize!==void 0?t.tileSize:this.tileSizes_?null:fa,$(!this.tileSize_&&this.tileSizes_||this.tileSize_&&!this.tileSizes_,"Either `tileSize` or `tileSizes` must be configured, never both"),this.extent_=i!==void 0?i:null,this.fullTileRanges_=null,this.tmpSize_=[0,0],this.tmpExtent_=[0,0,0,0],t.sizes!==void 0?this.fullTileRanges_=t.sizes.map((s,r)=>{const o=new ua(Math.min(0,s[0]),Math.max(s[0]-1,-1),Math.min(0,s[1]),Math.max(s[1]-1,-1));if(i){const a=this.getTileRangeForExtentAndZ(i,r);o.minX=Math.max(a.minX,o.minX),o.maxX=Math.min(a.maxX,o.maxX),o.minY=Math.max(a.minY,o.minY),o.maxY=Math.min(a.maxY,o.maxY)}return o}):i&&this.calculateTileRanges_(i)}forEachTileCoord(t,e,i){const s=this.getTileRangeForExtentAndZ(t,e);for(let r=s.minX,o=s.maxX;r<=o;++r)for(let a=s.minY,l=s.maxY;a<=l;++a)i([e,r,a])}forEachTileCoordParentTileRange(t,e,i,s){let r,o,a,l=null,h=t[0]-1;for(this.zoomFactor_===2?(o=t[1],a=t[2]):l=this.getTileCoordExtent(t,s);h>=this.minZoom;){if(o!==void 0&&a!==void 0?(o=Math.floor(o/2),a=Math.floor(a/2),r=ji(o,o,a,a,i)):r=this.getTileRangeForExtentAndZ(l,h,i),e(h,r))return!0;--h}return!1}getExtent(){return this.extent_}getMaxZoom(){return this.maxZoom}getMinZoom(){return this.minZoom}getOrigin(t){return this.origin_?this.origin_:this.origins_[t]}getResolution(t){return this.resolutions_[t]}getResolutions(){return this.resolutions_}getTileCoordChildTileRange(t,e,i){if(t[0]<this.maxZoom){if(this.zoomFactor_===2){const r=t[1]*2,o=t[2]*2;return ji(r,r+1,o,o+1,e)}const s=this.getTileCoordExtent(t,i||this.tmpExtent_);return this.getTileRangeForExtentAndZ(s,t[0]+1,e)}return null}getTileRangeForTileCoordAndZ(t,e,i){if(e>this.maxZoom||e<this.minZoom)return null;const s=t[0],r=t[1],o=t[2];if(e===s)return ji(r,o,r,o,i);if(this.zoomFactor_){const l=Math.pow(this.zoomFactor_,e-s),h=Math.floor(r*l),c=Math.floor(o*l);if(e<s)return ji(h,h,c,c,i);const u=Math.floor(l*(r+1))-1,d=Math.floor(l*(o+1))-1;return ji(h,u,c,d,i)}const a=this.getTileCoordExtent(t,this.tmpExtent_);return this.getTileRangeForExtentAndZ(a,e,i)}getTileRangeForExtentAndZ(t,e,i){this.getTileCoordForXYAndZ_(t[0],t[3],e,!1,Bi);const s=Bi[1],r=Bi[2];this.getTileCoordForXYAndZ_(t[2],t[1],e,!0,Bi);const o=Bi[1],a=Bi[2];return ji(s,o,r,a,i)}getTileCoordCenter(t){const e=this.getOrigin(t[0]),i=this.getResolution(t[0]),s=Ut(this.getTileSize(t[0]),this.tmpSize_);return[e[0]+(t[1]+.5)*s[0]*i,e[1]-(t[2]+.5)*s[1]*i]}getTileCoordExtent(t,e){const i=this.getOrigin(t[0]),s=this.getResolution(t[0]),r=Ut(this.getTileSize(t[0]),this.tmpSize_),o=i[0]+t[1]*r[0]*s,a=i[1]-(t[2]+1)*r[1]*s,l=o+r[0]*s,h=a+r[1]*s;return fi(o,a,l,h,e)}getTileCoordForCoordAndResolution(t,e,i){return this.getTileCoordForXYAndResolution_(t[0],t[1],e,!1,i)}getTileCoordForXYAndResolution_(t,e,i,s,r){const o=this.getZForResolution(i),a=i/this.getResolution(o),l=this.getOrigin(o),h=Ut(this.getTileSize(o),this.tmpSize_);let c=a*(t-l[0])/i/h[0],u=a*(l[1]-e)/i/h[1];return s?(c=vs(c,qe)-1,u=vs(u,qe)-1):(c=ys(c,qe),u=ys(u,qe)),qs(o,c,u,r)}getTileCoordForXYAndZ_(t,e,i,s,r){const o=this.getOrigin(i),a=this.getResolution(i),l=Ut(this.getTileSize(i),this.tmpSize_);let h=(t-o[0])/a/l[0],c=(o[1]-e)/a/l[1];return s?(h=vs(h,qe)-1,c=vs(c,qe)-1):(h=ys(h,qe),c=ys(c,qe)),qs(i,h,c,r)}getTileCoordForCoordAndZ(t,e,i){return this.getTileCoordForXYAndZ_(t[0],t[1],e,!1,i)}getTileCoordResolution(t){return this.resolutions_[t[0]]}getTileSize(t){return this.tileSize_?this.tileSize_:this.tileSizes_[t]}getFullTileRange(t){return this.fullTileRanges_?this.fullTileRanges_[t]:this.extent_?this.getTileRangeForExtentAndZ(this.extent_,t):null}getZForResolution(t,e){const i=qo(this.resolutions_,t,e||0);return mt(i,this.minZoom,this.maxZoom)}tileCoordIntersectsViewport(t,e){return pc(e,0,e.length,2,this.getTileCoordExtent(t))}calculateTileRanges_(t){const e=this.resolutions_.length,i=new Array(e);for(let s=this.minZoom;s<e;++s)i[s]=this.getTileRangeForExtentAndZ(t,s);this.fullTileRanges_=i}}function xc(n){let t=n.getDefaultTileGrid();return t||(t=lg(n),n.setDefaultTileGrid(t)),t}function rg(n,t,e){const i=t[0],s=n.getTileCoordCenter(t),r=ga(e);if(!gn(r,s)){const o=nt(r),a=Math.ceil((r[0]-s[0])/o);return s[0]+=o*a,n.getTileCoordForCoordAndZ(s,i)}return t}function og(n,t,e,i){i=i!==void 0?i:"top-left";const s=wc(n,t,e);return new vc({extent:n,origin:_f(n,i),resolutions:s,tileSize:e})}function ag(n){const t=n||{},e=t.extent||dt("EPSG:3857").getExtent(),i={extent:e,minZoom:t.minZoom,tileSize:t.tileSize,resolutions:wc(e,t.maxZoom,t.tileSize,t.maxResolution)};return new vc(i)}function wc(n,t,e,i){t=t!==void 0?t:sg,e=Ut(e!==void 0?e:fa);const s=kt(n),r=nt(n);i=i>0?i:Math.max(r/e[0],s/e[1]);const o=t+1,a=new Array(o);for(let l=0;l<o;++l)a[l]=i/Math.pow(2,l);return a}function lg(n,t,e,i){const s=ga(n);return og(s,t,e,i)}function ga(n){n=dt(n);let t=n.getExtent();if(!t){const e=180*na.degrees/n.getMetersPerUnit();t=fi(-e,-e,e,e)}return t}const O={IDLE:0,LOADING:1,LOADED:2,ERROR:3,EMPTY:4};function Ec(n){return Math.pow(n,3)}function xn(n){return 1-Ec(1-n)}function hg(n){return 3*n*n-2*n*n*n}function cg(n){return n}class _a extends wr{constructor(t,e,i){super(),i=i||{},this.tileCoord=t,this.state=e,this.key="",this.transition_=i.transition===void 0?250:i.transition,this.transitionStarts_={},this.interpolate=!!i.interpolate}changed(){this.dispatchEvent(j.CHANGE)}release(){this.setState(O.EMPTY)}getKey(){return this.key+"/"+this.tileCoord}getTileCoord(){return this.tileCoord}getState(){return this.state}setState(t){if(this.state!==O.EMPTY){if(this.state!==O.ERROR&&this.state>t)throw new Error("Tile load sequence violation");this.state=t,this.changed()}}load(){G()}getAlpha(t,e){if(!this.transition_)return 1;let i=this.transitionStarts_[t];if(!i)i=e,this.transitionStarts_[t]=i;else if(i===-1)return 1;const s=e-i+1e3/60;return s>=this.transition_?1:Ec(s/this.transition_)}inTransition(t){return this.transition_?this.transitionStarts_[t]!==-1:!1}endTransition(t){this.transition_&&(this.transitionStarts_[t]=-1)}disposeInternal(){this.release(),super.disposeInternal()}}class Cc extends _a{constructor(t,e,i,s,r,o){super(t,e,o),this.crossOrigin_=s,this.src_=i,this.key=i,this.image_=new Image,s!==null&&(this.image_.crossOrigin=s),this.unlisten_=null,this.tileLoadFunction_=r}getImage(){return this.image_}setImage(t){this.image_=t,this.state=O.LOADED,this.unlistenImage_(),this.changed()}handleImageError_(){this.state=O.ERROR,this.unlistenImage_(),this.image_=ug(),this.changed()}handleImageLoad_(){const t=this.image_;t.naturalWidth&&t.naturalHeight?this.state=O.LOADED:this.state=O.EMPTY,this.unlistenImage_(),this.changed()}load(){this.state==O.ERROR&&(this.state=O.IDLE,this.image_=new Image,this.crossOrigin_!==null&&(this.image_.crossOrigin=this.crossOrigin_)),this.state==O.IDLE&&(this.state=O.LOADING,this.changed(),this.tileLoadFunction_(this,this.src_),this.unlisten_=Qd(this.image_,this.handleImageLoad_.bind(this),this.handleImageError_.bind(this)))}unlistenImage_(){this.unlisten_&&(this.unlisten_(),this.unlisten_=null)}disposeInternal(){this.unlistenImage_(),this.image_=null,super.disposeInternal()}}function ug(){const n=It(1,1);return n.fillStyle="rgba(0,0,0,0)",n.fillRect(0,0,1,1),n.canvas}let Hr;const on=[];function Il(n,t,e,i,s){n.beginPath(),n.moveTo(0,0),n.lineTo(t,e),n.lineTo(i,s),n.closePath(),n.save(),n.clip(),n.fillRect(0,0,Math.max(t,i)+1,Math.max(e,s)),n.restore()}function qr(n,t){return Math.abs(n[t*4]-210)>2||Math.abs(n[t*4+3]-.75*255)>2}function dg(){if(Hr===void 0){const n=It(6,6,on);n.globalCompositeOperation="lighter",n.fillStyle="rgba(210, 0, 0, 0.75)",Il(n,4,5,4,0),Il(n,4,5,0,5);const t=n.getImageData(0,0,3,3).data;Hr=qr(t,0)||qr(t,4)||qr(t,8),yr(n),on.push(n.canvas)}return Hr}function Sl(n,t,e,i){const s=ca(e,t,n);let r=El(t,i,e);const o=t.getMetersPerUnit();o!==void 0&&(r*=o);const a=n.getMetersPerUnit();a!==void 0&&(r/=a);const l=n.getExtent();if(!l||gn(l,s)){const h=El(n,r,s)/r;isFinite(h)&&h>0&&(r/=h)}return r}function fg(n,t,e,i){const s=gi(e);let r=Sl(n,t,s,i);return(!isFinite(r)||r<=0)&&nc(e,function(o){return r=Sl(n,t,o,i),isFinite(r)&&r>0}),r}function gg(n,t,e,i,s,r,o,a,l,h,c,u,d,f){const g=It(Math.round(e*n),Math.round(e*t),on);if(u||(g.imageSmoothingEnabled=!1),l.length===0)return g.canvas;g.scale(e,e);function _(v){return Math.round(v*e)/e}g.globalCompositeOperation="lighter";const m=re();l.forEach(function(v,R,S){ec(m,v.extent)});let p;const y=e/i,w=(u?1:1+Math.pow(2,-24))/y;p=It(Math.round(nt(m)*y),Math.round(kt(m)*y),on),u||(p.imageSmoothingEnabled=!1),l.forEach(function(v,R,S){if(v.image.width>0&&v.image.height>0){if(v.clipExtent){p.save();const P=(v.clipExtent[0]-m[0])*y,D=-(v.clipExtent[3]-m[3])*y,M=nt(v.clipExtent)*y,V=kt(v.clipExtent)*y;p.rect(u?P:Math.round(P),u?D:Math.round(D),u?M:Math.round(P+M)-Math.round(P),u?V:Math.round(D+V)-Math.round(D)),p.clip()}const C=(v.extent[0]-m[0])*y,I=-(v.extent[3]-m[3])*y,b=nt(v.extent)*y,L=kt(v.extent)*y;p.drawImage(v.image,h,h,v.image.width-2*h,v.image.height-2*h,u?C:Math.round(C),u?I:Math.round(I),u?b:Math.round(C+b)-Math.round(C),u?L:Math.round(I+L)-Math.round(I)),v.clipExtent&&p.restore()}});const x=Fi(o);return a.getTriangles().forEach(function(v,R,S){const C=v.source,I=v.target;let b=C[0][0],L=C[0][1],P=C[1][0],D=C[1][1],M=C[2][0],V=C[2][1];const A=_((I[0][0]-x[0])/r),k=_(-(I[0][1]-x[1])/r),X=_((I[1][0]-x[0])/r),Y=_(-(I[1][1]-x[1])/r),W=_((I[2][0]-x[0])/r),U=_(-(I[2][1]-x[1])/r),T=b,ft=L;b=0,L=0,P-=T,D-=ft,M-=T,V-=ft;const yt=[[P,D,0,0,X-A],[M,V,0,0,W-A],[0,0,P,D,Y-k],[0,0,M,V,U-k]],tt=Gd(yt);if(!tt)return;if(g.save(),g.beginPath(),dg()||!u){g.moveTo(X,Y);const xt=4,wt=A-X,et=k-Y;for(let Z=0;Z<xt;Z++)g.lineTo(X+_((Z+1)*wt/xt),Y+_(Z*et/(xt-1))),Z!=xt-1&&g.lineTo(X+_((Z+1)*wt/xt),Y+_((Z+1)*et/(xt-1)));g.lineTo(W,U)}else g.moveTo(X,Y),g.lineTo(A,k),g.lineTo(W,U);g.clip(),g.transform(tt[0],tt[2],tt[1],tt[3],A,k),g.translate(m[0]-T,m[3]-ft);let gt;if(p)gt=p.canvas,g.scale(w,-w);else{const xt=l[0],wt=xt.extent;gt=xt.image,g.scale(nt(wt)/gt.width,-kt(wt)/gt.height)}g.drawImage(gt,0,0),g.restore()}),p&&(yr(p),on.push(p.canvas)),c&&(g.save(),g.globalCompositeOperation="source-over",g.strokeStyle="black",g.lineWidth=1,a.getTriangles().forEach(function(v,R,S){const C=v.target,I=(C[0][0]-x[0])/r,b=-(C[0][1]-x[1])/r,L=(C[1][0]-x[0])/r,P=-(C[1][1]-x[1])/r,D=(C[2][0]-x[0])/r,M=-(C[2][1]-x[1])/r;g.beginPath(),g.moveTo(L,P),g.lineTo(I,b),g.lineTo(D,M),g.closePath(),g.stroke()}),g.restore()),g.canvas}new Array(6);function de(){return[1,0,0,1,0,0]}function _g(n,t){return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[4]=t[4],n[5]=t[5],n}function Rt(n,t){const e=t[0],i=t[1];return t[0]=n[0]*e+n[2]*i+n[4],t[1]=n[1]*e+n[3]*i+n[5],t}function Ke(n,t,e,i,s,r,o,a){const l=Math.sin(r),h=Math.cos(r);return n[0]=i*h,n[1]=s*l,n[2]=-i*l,n[3]=s*h,n[4]=o*i*h-a*i*l+t,n[5]=o*s*l+a*s*h+e,n}function Rc(n,t){const e=mg(t);$(e!==0,"Transformation matrix cannot be inverted");const i=t[0],s=t[1],r=t[2],o=t[3],a=t[4],l=t[5];return n[0]=o/e,n[1]=-s/e,n[2]=-r/e,n[3]=i/e,n[4]=(r*l-o*a)/e,n[5]=-(i*l-s*a)/e,n}function mg(n){return n[0]*n[3]-n[1]*n[2]}const Tl=[1e6,1e6,1e6,1e6,2,2];function pg(n){return"matrix("+n.map((e,i)=>Math.round(e*Tl[i])/Tl[i]).join(", ")+")"}const yg=10,bl=.25;class vg{constructor(t,e,i,s,r,o,a){this.sourceProj_=t,this.targetProj_=e;let l={};const h=a?Vf(w=>Rt(a,ca(w,this.targetProj_,this.sourceProj_))):$n(this.targetProj_,this.sourceProj_);this.transformInv_=function(w){const x=w[0]+"/"+w[1];return l[x]||(l[x]=h(w)),l[x]},this.maxSourceExtent_=s,this.errorThresholdSquared_=r*r,this.triangles_=[],this.wrapsXInSource_=!1,this.canWrapXInSource_=this.sourceProj_.canWrapX()&&!!s&&!!this.sourceProj_.getExtent()&&nt(s)>=nt(this.sourceProj_.getExtent()),this.sourceWorldWidth_=this.sourceProj_.getExtent()?nt(this.sourceProj_.getExtent()):null,this.targetWorldWidth_=this.targetProj_.getExtent()?nt(this.targetProj_.getExtent()):null;const c=Fi(i),u=Sr(i),d=Ir(i),f=Rr(i),g=this.transformInv_(c),_=this.transformInv_(u),m=this.transformInv_(d),p=this.transformInv_(f),y=yg+(o?Math.max(0,Math.ceil(Math.log2(Co(i)/(o*o*256*256)))):0);if(this.addQuad_(c,u,d,f,g,_,m,p,y),this.wrapsXInSource_){let w=1/0;this.triangles_.forEach(function(x,v,R){w=Math.min(w,x.source[0][0],x.source[1][0],x.source[2][0])}),this.triangles_.forEach(x=>{if(Math.max(x.source[0][0],x.source[1][0],x.source[2][0])-w>this.sourceWorldWidth_/2){const v=[[x.source[0][0],x.source[0][1]],[x.source[1][0],x.source[1][1]],[x.source[2][0],x.source[2][1]]];v[0][0]-w>this.sourceWorldWidth_/2&&(v[0][0]-=this.sourceWorldWidth_),v[1][0]-w>this.sourceWorldWidth_/2&&(v[1][0]-=this.sourceWorldWidth_),v[2][0]-w>this.sourceWorldWidth_/2&&(v[2][0]-=this.sourceWorldWidth_);const R=Math.min(v[0][0],v[1][0],v[2][0]);Math.max(v[0][0],v[1][0],v[2][0])-R<this.sourceWorldWidth_/2&&(x.source=v)}})}l={}}addTriangle_(t,e,i,s,r,o){this.triangles_.push({source:[s,r,o],target:[t,e,i]})}addQuad_(t,e,i,s,r,o,a,l,h){const c=fl([r,o,a,l]),u=this.sourceWorldWidth_?nt(c)/this.sourceWorldWidth_:null,d=this.sourceWorldWidth_,f=this.sourceProj_.canWrapX()&&u>.5&&u<1;let g=!1;if(h>0){if(this.targetProj_.isGlobal()&&this.targetWorldWidth_){const m=fl([t,e,i,s]);g=nt(m)/this.targetWorldWidth_>bl||g}!f&&this.sourceProj_.isGlobal()&&u&&(g=u>bl||g)}if(!g&&this.maxSourceExtent_&&isFinite(c[0])&&isFinite(c[1])&&isFinite(c[2])&&isFinite(c[3])&&!Bt(c,this.maxSourceExtent_))return;let _=0;if(!g&&(!isFinite(r[0])||!isFinite(r[1])||!isFinite(o[0])||!isFinite(o[1])||!isFinite(a[0])||!isFinite(a[1])||!isFinite(l[0])||!isFinite(l[1]))){if(h>0)g=!0;else if(_=(!isFinite(r[0])||!isFinite(r[1])?8:0)+(!isFinite(o[0])||!isFinite(o[1])?4:0)+(!isFinite(a[0])||!isFinite(a[1])?2:0)+(!isFinite(l[0])||!isFinite(l[1])?1:0),_!=1&&_!=2&&_!=4&&_!=8)return}if(h>0){if(!g){const m=[(t[0]+i[0])/2,(t[1]+i[1])/2],p=this.transformInv_(m);let y;f?y=(sn(r[0],d)+sn(a[0],d))/2-sn(p[0],d):y=(r[0]+a[0])/2-p[0];const w=(r[1]+a[1])/2-p[1];g=y*y+w*w>this.errorThresholdSquared_}if(g){if(Math.abs(t[0]-i[0])<=Math.abs(t[1]-i[1])){const m=[(e[0]+i[0])/2,(e[1]+i[1])/2],p=this.transformInv_(m),y=[(s[0]+t[0])/2,(s[1]+t[1])/2],w=this.transformInv_(y);this.addQuad_(t,e,m,y,r,o,p,w,h-1),this.addQuad_(y,m,i,s,w,p,a,l,h-1)}else{const m=[(t[0]+e[0])/2,(t[1]+e[1])/2],p=this.transformInv_(m),y=[(i[0]+s[0])/2,(i[1]+s[1])/2],w=this.transformInv_(y);this.addQuad_(t,m,y,s,r,p,w,l,h-1),this.addQuad_(m,e,i,y,p,o,a,w,h-1)}return}}if(f){if(!this.canWrapXInSource_)return;this.wrapsXInSource_=!0}(_&11)==0&&this.addTriangle_(t,i,s,r,a,l),(_&14)==0&&this.addTriangle_(t,i,e,r,a,o),_&&((_&13)==0&&this.addTriangle_(e,s,t,o,l,r),(_&7)==0&&this.addTriangle_(e,s,i,o,l,a))}calculateSourceExtent(){const t=re();return this.triangles_.forEach(function(e,i,s){const r=e.source;Wn(t,r[0]),Wn(t,r[1]),Wn(t,r[2])}),t}getTriangles(){return this.triangles_}}const xg=.5;class Ic extends _a{constructor(t,e,i,s,r,o,a,l,h,c,u,d){super(r,O.IDLE,d),this.renderEdges_=u!==void 0?u:!1,this.pixelRatio_=a,this.gutter_=l,this.canvas_=null,this.sourceTileGrid_=e,this.targetTileGrid_=s,this.wrappedTileCoord_=o||r,this.sourceTiles_=[],this.sourcesListenerKeys_=null,this.sourceZ_=0,this.clipExtent_=t.canWrapX()?t.getExtent():void 0;const f=s.getTileCoordExtent(this.wrappedTileCoord_),g=this.targetTileGrid_.getExtent();let _=this.sourceTileGrid_.getExtent();const m=g?Mi(f,g):f;if(Co(m)===0){this.state=O.EMPTY;return}const p=t.getExtent();p&&(_?_=Mi(_,p):_=p);const y=s.getResolution(this.wrappedTileCoord_[0]),w=fg(t,i,m,y);if(!isFinite(w)||w<=0){this.state=O.EMPTY;return}const x=c!==void 0?c:xg;if(this.triangulation_=new vg(t,i,m,_,w*x,y),this.triangulation_.getTriangles().length===0){this.state=O.EMPTY;return}this.sourceZ_=e.getZForResolution(w);let v=this.triangulation_.calculateSourceExtent();if(_&&(t.canWrapX()?(v[1]=mt(v[1],_[1],_[3]),v[3]=mt(v[3],_[1],_[3])):v=Mi(v,_)),!Co(v))this.state=O.EMPTY;else{let R=0,S=0;t.canWrapX()&&(R=nt(p),S=Math.floor((v[0]-p[0])/R)),oc(v.slice(),t,!0).forEach(I=>{const b=e.getTileRangeForExtentAndZ(I,this.sourceZ_);for(let L=b.minX;L<=b.maxX;L++)for(let P=b.minY;P<=b.maxY;P++){const D=h(this.sourceZ_,L,P,a);if(D){const M=S*R;this.sourceTiles_.push({tile:D,offset:M})}}++S}),this.sourceTiles_.length===0&&(this.state=O.EMPTY)}}getImage(){return this.canvas_}reproject_(){const t=[];if(this.sourceTiles_.forEach(e=>{var s;const i=e.tile;if(i&&i.getState()==O.LOADED){const r=this.sourceTileGrid_.getTileCoordExtent(i.tileCoord);r[0]+=e.offset,r[2]+=e.offset;const o=(s=this.clipExtent_)==null?void 0:s.slice();o&&(o[0]+=e.offset,o[2]+=e.offset),t.push({extent:r,clipExtent:o,image:i.getImage()})}}),this.sourceTiles_.length=0,t.length===0)this.state=O.ERROR;else{const e=this.wrappedTileCoord_[0],i=this.targetTileGrid_.getTileSize(e),s=typeof i=="number"?i:i[0],r=typeof i=="number"?i:i[1],o=this.targetTileGrid_.getResolution(e),a=this.sourceTileGrid_.getResolution(this.sourceZ_),l=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_);this.canvas_=gg(s,r,this.pixelRatio_,a,this.sourceTileGrid_.getExtent(),o,l,this.triangulation_,t,this.gutter_,this.renderEdges_,this.interpolate),this.state=O.LOADED}this.changed()}load(){if(this.state==O.IDLE){this.state=O.LOADING,this.changed();let t=0;this.sourcesListenerKeys_=[],this.sourceTiles_.forEach(({tile:e})=>{const i=e.getState();if(i==O.IDLE||i==O.LOADING){t++;const s=q(e,j.CHANGE,r=>{const o=e.getState();(o==O.LOADED||o==O.ERROR||o==O.EMPTY)&&(at(s),t--,t===0&&(this.unlistenSources_(),this.reproject_()))});this.sourcesListenerKeys_.push(s)}}),t===0?setTimeout(this.reproject_.bind(this),0):this.sourceTiles_.forEach(function({tile:e},i,s){e.getState()==O.IDLE&&e.load()})}}unlistenSources_(){this.sourcesListenerKeys_.forEach(at),this.sourcesListenerKeys_=null}release(){this.canvas_&&(yr(this.canvas_.getContext("2d")),on.push(this.canvas_),this.canvas_=null),super.release()}}const wg=/\{z\}/g,Eg=/\{x\}/g,Cg=/\{y\}/g,Rg=/\{-y\}/g;function Ig(n,t,e,i,s){return n.replace(wg,t.toString()).replace(Eg,e.toString()).replace(Cg,i.toString()).replace(Rg,function(){if(s===void 0)throw new Error("If the URL template has a {-y} placeholder, the grid extent must be known");return(s-i).toString()})}function Sg(n){const t=[];let e=/\{([a-z])-([a-z])\}/.exec(n);if(e){const i=e[1].charCodeAt(0),s=e[2].charCodeAt(0);let r;for(r=i;r<=s;++r)t.push(n.replace(e[0],String.fromCharCode(r)));return t}if(e=/\{(\d+)-(\d+)\}/.exec(n),e){const i=parseInt(e[2],10);for(let s=parseInt(e[1],10);s<=i;s++)t.push(n.replace(e[0],s.toString()));return t}return t.push(n),t}function Tg(n,t){return function(e,i,s){if(!e)return;let r;const o=e[0];if(t){const a=t.getFullTileRange(o);a&&(r=a.getHeight()-1)}return Ig(n,o,e[1],e[2],r)}}function bg(n,t){const e=n.length,i=new Array(e);for(let s=0;s<e;++s)i[s]=Tg(n[s],t);return Mg(i)}function Mg(n){return n.length===1?n[0]:function(t,e,i){if(!t)return;const s=eg(t),r=sn(s,n.length);return n[r](t,e,i)}}class Sc extends Ae{constructor(t){super(),this.projection=dt(t.projection),this.attributions_=Ml(t.attributions),this.attributionsCollapsible_=t.attributionsCollapsible??!0,this.loading=!1,this.state_=t.state!==void 0?t.state:"ready",this.wrapX_=t.wrapX!==void 0?t.wrapX:!1,this.interpolate_=!!t.interpolate,this.viewResolver=null,this.viewRejector=null;const e=this;this.viewPromise_=new Promise(function(i,s){e.viewResolver=i,e.viewRejector=s})}getAttributions(){return this.attributions_}getAttributionsCollapsible(){return this.attributionsCollapsible_}getProjection(){return this.projection}getResolutions(t){return null}getView(){return this.viewPromise_}getState(){return this.state_}getWrapX(){return this.wrapX_}getInterpolate(){return this.interpolate_}refresh(){this.changed()}setAttributions(t){this.attributions_=Ml(t),this.changed()}setState(t){this.state_=t,this.changed()}}function Ml(n){return n?typeof n=="function"?n:(Array.isArray(n)||(n=[n]),t=>n):null}class Ag extends Sc{constructor(t){super({attributions:t.attributions,attributionsCollapsible:t.attributionsCollapsible,projection:t.projection,state:t.state,wrapX:t.wrapX,interpolate:t.interpolate}),this.on,this.once,this.un,this.tilePixelRatio_=t.tilePixelRatio!==void 0?t.tilePixelRatio:1,this.tileGrid=t.tileGrid!==void 0?t.tileGrid:null;const e=[256,256];this.tileGrid&&Ut(this.tileGrid.getTileSize(this.tileGrid.getMinZoom()),e),this.tmpSize=[0,0],this.key_=t.key||Q(this),this.tileOptions={transition:t.transition,interpolate:t.interpolate},this.zDirection=t.zDirection?t.zDirection:0}getGutterForProjection(t){return 0}getKey(){return this.key_}setKey(t){this.key_!==t&&(this.key_=t,this.changed())}getResolutions(t){const e=t?this.getTileGridForProjection(t):this.tileGrid;return e?e.getResolutions():null}getTile(t,e,i,s,r){return G()}getTileGrid(){return this.tileGrid}getTileGridForProjection(t){return this.tileGrid?this.tileGrid:xc(t)}getTilePixelRatio(t){return this.tilePixelRatio_}getTilePixelSize(t,e,i){const s=this.getTileGridForProjection(i),r=this.getTilePixelRatio(e),o=Ut(s.getTileSize(t),this.tmpSize);return r==1?o:ff(o,r,this.tmpSize)}getTileCoordForTileUrlFunction(t,e){const i=e!==void 0?e:this.getProjection(),s=e!==void 0?this.getTileGridForProjection(i):this.tileGrid||this.getTileGridForProjection(i);return this.getWrapX()&&i.isGlobal()&&(t=rg(s,t,i)),ng(t,s)?t:null}clear(){}refresh(){this.clear(),super.refresh()}}class Lg extends Ve{constructor(t,e){super(t),this.tile=e}}const $r={TILELOADSTART:"tileloadstart",TILELOADEND:"tileloadend",TILELOADERROR:"tileloaderror"};class ma extends Ag{constructor(t){super({attributions:t.attributions,cacheSize:t.cacheSize,projection:t.projection,state:t.state,tileGrid:t.tileGrid,tilePixelRatio:t.tilePixelRatio,wrapX:t.wrapX,transition:t.transition,interpolate:t.interpolate,key:t.key,attributionsCollapsible:t.attributionsCollapsible,zDirection:t.zDirection}),this.generateTileUrlFunction_=this.tileUrlFunction===ma.prototype.tileUrlFunction,this.tileLoadFunction=t.tileLoadFunction,t.tileUrlFunction&&(this.tileUrlFunction=t.tileUrlFunction),this.urls=null,t.urls?this.setUrls(t.urls):t.url&&this.setUrl(t.url),this.tileLoadingKeys_={}}getTileLoadFunction(){return this.tileLoadFunction}getTileUrlFunction(){return Object.getPrototypeOf(this).tileUrlFunction===this.tileUrlFunction?this.tileUrlFunction.bind(this):this.tileUrlFunction}getUrls(){return this.urls}handleTileChange(t){const e=t.target,i=Q(e),s=e.getState();let r;s==O.LOADING?(this.tileLoadingKeys_[i]=!0,r=$r.TILELOADSTART):i in this.tileLoadingKeys_&&(delete this.tileLoadingKeys_[i],r=s==O.ERROR?$r.TILELOADERROR:s==O.LOADED?$r.TILELOADEND:void 0),r!=null&&this.dispatchEvent(new Lg(r,e))}setTileLoadFunction(t){this.tileLoadFunction=t,this.changed()}setTileUrlFunction(t,e){this.tileUrlFunction=t,typeof e<"u"?this.setKey(e):this.changed()}setUrl(t){const e=Sg(t);this.urls=e,this.setUrls(e)}setUrls(t){this.urls=t;const e=t.join(`
`);this.generateTileUrlFunction_?this.setTileUrlFunction(bg(t,this.tileGrid),e):this.setKey(e)}tileUrlFunction(t,e,i){}}class Pg extends ma{constructor(t){super({attributions:t.attributions,cacheSize:t.cacheSize,projection:t.projection,state:t.state,tileGrid:t.tileGrid,tileLoadFunction:t.tileLoadFunction?t.tileLoadFunction:Og,tilePixelRatio:t.tilePixelRatio,tileUrlFunction:t.tileUrlFunction,url:t.url,urls:t.urls,wrapX:t.wrapX,transition:t.transition,interpolate:t.interpolate!==void 0?t.interpolate:!0,key:t.key,attributionsCollapsible:t.attributionsCollapsible,zDirection:t.zDirection}),this.crossOrigin=t.crossOrigin!==void 0?t.crossOrigin:null,this.tileClass=t.tileClass!==void 0?t.tileClass:Cc,this.tileGridForProjection={},this.reprojectionErrorThreshold_=t.reprojectionErrorThreshold,this.renderReprojectionEdges_=!1}getGutterForProjection(t){return this.getProjection()&&t&&!Fs(this.getProjection(),t)?0:this.getGutter()}getGutter(){return 0}getKey(){let t=super.getKey();return this.getInterpolate()||(t+=":disable-interpolation"),t}getTileGridForProjection(t){const e=this.getProjection();if(this.tileGrid&&(!e||Fs(e,t)))return this.tileGrid;const i=Q(t);return i in this.tileGridForProjection||(this.tileGridForProjection[i]=xc(t)),this.tileGridForProjection[i]}createTile_(t,e,i,s,r,o){const a=[t,e,i],l=this.getTileCoordForTileUrlFunction(a,r),h=l?this.tileUrlFunction(l,s,r):void 0,c=new this.tileClass(a,h!==void 0?O.IDLE:O.EMPTY,h!==void 0?h:"",this.crossOrigin,this.tileLoadFunction,this.tileOptions);return c.key=o,c.addEventListener(j.CHANGE,this.handleTileChange.bind(this)),c}getTile(t,e,i,s,r){const o=this.getProjection();if(!o||!r||Fs(o,r))return this.getTileInternal(t,e,i,s,o||r);const a=[t,e,i],l=this.getKey(),h=this.getTileGridForProjection(o),c=this.getTileGridForProjection(r),u=this.getTileCoordForTileUrlFunction(a,r),d=new Ic(o,h,r,c,a,u,this.getTilePixelRatio(s),this.getGutter(),(f,g,_,m)=>this.getTileInternal(f,g,_,m,o),this.reprojectionErrorThreshold_,this.renderReprojectionEdges_,this.tileOptions);return d.key=l,d}getTileInternal(t,e,i,s,r){const o=this.getKey();return this.createTile_(t,e,i,s,r,o)}setRenderReprojectionEdges(t){this.renderReprojectionEdges_!=t&&(this.renderReprojectionEdges_=t,this.changed())}setTileGridForProjection(t,e){const i=dt(t);if(i){const s=Q(i);s in this.tileGridForProjection||(this.tileGridForProjection[s]=e)}}}function Og(n,t){n.getImage().src=t}class Fg extends Pg{constructor(t){t=t||{};const e=t.projection!==void 0?t.projection:"EPSG:3857",i=t.tileGrid!==void 0?t.tileGrid:ag({extent:ga(e),maxResolution:t.maxResolution,maxZoom:t.maxZoom,minZoom:t.minZoom,tileSize:t.tileSize});super({attributions:t.attributions,cacheSize:t.cacheSize,crossOrigin:t.crossOrigin,interpolate:t.interpolate,projection:e,reprojectionErrorThreshold:t.reprojectionErrorThreshold,tileGrid:i,tileLoadFunction:t.tileLoadFunction,tilePixelRatio:t.tilePixelRatio,tileUrlFunction:t.tileUrlFunction,url:t.url,urls:t.urls,wrapX:t.wrapX!==void 0?t.wrapX:!0,transition:t.transition,attributionsCollapsible:t.attributionsCollapsible,zDirection:t.zDirection}),this.gutter_=t.gutter!==void 0?t.gutter:0}getGutter(){return this.gutter_}}const Dg='&#169; <a href="https://www.openstreetmap.org/copyright" target="_blank">OpenStreetMap</a> contributors.';class kg extends Fg{constructor(t){t=t||{};let e;t.attributions!==void 0?e=t.attributions:e=[Dg];const i=t.crossOrigin!==void 0?t.crossOrigin:"anonymous",s=t.url!==void 0?t.url:"https://tile.openstreetmap.org/{z}/{x}/{y}.png";super({attributions:e,attributionsCollapsible:!1,cacheSize:t.cacheSize,crossOrigin:i,interpolate:t.interpolate,maxZoom:t.maxZoom!==void 0?t.maxZoom:19,reprojectionErrorThreshold:t.reprojectionErrorThreshold,tileLoadFunction:t.tileLoadFunction,transition:t.transition,url:s,wrapX:t.wrapX,zDirection:t.zDirection})}}function Mo(n){return n instanceof Image||n instanceof HTMLCanvasElement||n instanceof HTMLVideoElement||n instanceof ImageBitmap?n:null}const Ng=new Error("disposed"),Gg=[256,256];class Al extends _a{constructor(t){const e=O.IDLE;super(t.tileCoord,e,{transition:t.transition,interpolate:t.interpolate}),this.loader_=t.loader,this.data_=null,this.error_=null,this.size_=t.size||null,this.controller_=t.controller||null}getSize(){if(this.size_)return this.size_;const t=Mo(this.data_);return t?[t.width,t.height]:Gg}getData(){return this.data_}getError(){return this.error_}load(){if(this.state!==O.IDLE&&this.state!==O.ERROR)return;this.state=O.LOADING,this.changed();const t=this;this.loader_().then(function(e){t.data_=e,t.state=O.LOADED,t.changed()}).catch(function(e){t.error_=e,t.state=O.ERROR,t.changed()})}disposeInternal(){this.controller_&&(this.controller_.abort(Ng),this.controller_=null),super.disposeInternal()}}class zg{constructor(t){this.highWaterMark=t!==void 0?t:2048,this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null}deleteOldest(){const t=this.pop();t instanceof vr&&t.dispose()}canExpireCache(){return this.highWaterMark>0&&this.getCount()>this.highWaterMark}expireCache(t){for(;this.canExpireCache();)this.deleteOldest()}clear(){for(;this.oldest_;)this.deleteOldest()}containsKey(t){return this.entries_.hasOwnProperty(t)}forEach(t){let e=this.oldest_;for(;e;)t(e.value_,e.key_,this),e=e.newer}get(t,e){const i=this.entries_[t];return $(i!==void 0,"Tried to get a value for a key that does not exist in the cache"),i===this.newest_||(i===this.oldest_?(this.oldest_=this.oldest_.newer,this.oldest_.older=null):(i.newer.older=i.older,i.older.newer=i.newer),i.newer=null,i.older=this.newest_,this.newest_.newer=i,this.newest_=i),i.value_}remove(t){const e=this.entries_[t];return $(e!==void 0,"Tried to get a value for a key that does not exist in the cache"),e===this.newest_?(this.newest_=e.older,this.newest_&&(this.newest_.newer=null)):e===this.oldest_?(this.oldest_=e.newer,this.oldest_&&(this.oldest_.older=null)):(e.newer.older=e.older,e.older.newer=e.newer),delete this.entries_[t],--this.count_,e.value_}getCount(){return this.count_}getKeys(){const t=new Array(this.count_);let e=0,i;for(i=this.newest_;i;i=i.older)t[e++]=i.key_;return t}getValues(){const t=new Array(this.count_);let e=0,i;for(i=this.newest_;i;i=i.older)t[e++]=i.value_;return t}peekLast(){return this.oldest_.value_}peekLastKey(){return this.oldest_.key_}peekFirstKey(){return this.newest_.key_}peek(t){var e;return(e=this.entries_[t])==null?void 0:e.value_}pop(){const t=this.oldest_;return delete this.entries_[t.key_],t.newer&&(t.newer.older=null),this.oldest_=t.newer,this.oldest_||(this.newest_=null),--this.count_,t.value_}replace(t,e){this.get(t),this.entries_[t].value_=e}set(t,e){$(!(t in this.entries_),"Tried to set a value for a key that is used already");const i={key_:t,newer:null,older:this.newest_,value_:e};this.newest_?this.newest_.newer=i:this.oldest_=i,this.newest_=i,this.entries_[t]=i,++this.count_}setSize(t){this.highWaterMark=t}}class Tc extends Ve{constructor(t,e,i,s){super(t),this.inversePixelTransform=e,this.frameState=i,this.context=s}}const ie={PRERENDER:"prerender",POSTRENDER:"postrender",PRECOMPOSE:"precompose",POSTCOMPOSE:"postcompose",RENDERCOMPLETE:"rendercomplete"};class bc{constructor(){Ba(this,"pushMethodArgs_",(...t)=>(this.instructions_[this.zIndex+this.offset_].push(t),this));this.instructions_=[],this.zIndex=0,this.offset_=0,this.context_=new Proxy(js(),{get:(t,e)=>{if(typeof js()[e]=="function")return this.instructions_[this.zIndex+this.offset_]||(this.instructions_[this.zIndex+this.offset_]=[]),this.instructions_[this.zIndex+this.offset_].push(e),this.pushMethodArgs_},set:(t,e,i)=>(this.instructions_[this.zIndex+this.offset_]||(this.instructions_[this.zIndex+this.offset_]=[]),this.instructions_[this.zIndex+this.offset_].push(e,i),!0)})}pushFunction(t){this.instructions_[this.zIndex+this.offset_].push(t)}getContext(){return this.context_}draw(t){this.instructions_.forEach(e=>{for(let i=0,s=e.length;i<s;++i){const r=e[i];if(typeof r=="function"){r(t);continue}const o=e[++i];if(typeof t[r]=="function")t[r](...o);else{if(typeof o=="function"){t[r]=o(t);continue}t[r]=o}}})}clear(){this.instructions_.length=0,this.zIndex=0,this.offset_=0}offset(){this.offset_=this.instructions_.length,this.zIndex=0}}const Xg=5;class Wg extends rs{constructor(t){super(),this.ready=!0,this.boundHandleImageChange_=this.handleImageChange_.bind(this),this.layer_=t,this.staleKeys_=new Array,this.maxStaleKeys=Xg}getStaleKeys(){return this.staleKeys_}prependStaleKey(t){this.staleKeys_.unshift(t),this.staleKeys_.length>this.maxStaleKeys&&(this.staleKeys_.length=this.maxStaleKeys)}getFeatures(t){return G()}getData(t){return null}prepareFrame(t){return G()}renderFrame(t,e){return G()}forEachFeatureAtCoordinate(t,e,i,s,r){}getLayer(){return this.layer_}handleFontsChanged(){}handleImageChange_(t){const e=t.target;(e.getState()===K.LOADED||e.getState()===K.ERROR)&&this.renderIfReadyAndVisible()}loadImage(t){let e=t.getState();return e!=K.LOADED&&e!=K.ERROR&&t.addEventListener(j.CHANGE,this.boundHandleImageChange_),e==K.IDLE&&(t.load(),e=t.getState()),e==K.LOADED}renderIfReadyAndVisible(){const t=this.getLayer();t&&t.getVisible()&&t.getSourceState()==="ready"&&t.changed()}renderDeferred(t){}disposeInternal(){delete this.layer_,super.disposeInternal()}}const Ll=[];let $i=null;function Yg(){$i=It(1,1,void 0,{willReadFrequently:!0})}class Mc extends Wg{constructor(t){super(t),this.container=null,this.renderedResolution,this.tempTransform=de(),this.pixelTransform=de(),this.inversePixelTransform=de(),this.context=null,this.deferredContext_=null,this.containerReused=!1,this.frameState=null}getImageData(t,e,i){$i||Yg(),$i.clearRect(0,0,1,1);let s;try{$i.drawImage(t,e,i,1,1,0,0,1,1),s=$i.getImageData(0,0,1,1).data}catch{return $i=null,null}return s}getBackground(t){let i=this.getLayer().getBackground();return typeof i=="function"&&(i=i(t.viewState.resolution)),i||void 0}useContainer(t,e,i){const s=this.getLayer().getClassName();let r,o;if(t&&t.className===s&&(!i||t&&t.style.backgroundColor&&mi(hn(t.style.backgroundColor),hn(i)))){const a=t.firstElementChild;a instanceof HTMLCanvasElement&&(o=a.getContext("2d"))}if(o&&o.canvas.style.transform===e?(this.container=t,this.context=o,this.containerReused=!0):this.containerReused?(this.container=null,this.context=null,this.containerReused=!1):this.container&&(this.container.style.backgroundColor=null),!this.container){r=document.createElement("div"),r.className=s;let a=r.style;a.position="absolute",a.width="100%",a.height="100%",o=It();const l=o.canvas;r.appendChild(l),a=l.style,a.position="absolute",a.left="0",a.transformOrigin="top left",this.container=r,this.context=o}!this.containerReused&&i&&!this.container.style.backgroundColor&&(this.container.style.backgroundColor=i)}clipUnrotated(t,e,i){const s=Fi(i),r=Sr(i),o=Ir(i),a=Rr(i);Rt(e.coordinateToPixelTransform,s),Rt(e.coordinateToPixelTransform,r),Rt(e.coordinateToPixelTransform,o),Rt(e.coordinateToPixelTransform,a);const l=this.inversePixelTransform;Rt(l,s),Rt(l,r),Rt(l,o),Rt(l,a),t.save(),t.beginPath(),t.moveTo(Math.round(s[0]),Math.round(s[1])),t.lineTo(Math.round(r[0]),Math.round(r[1])),t.lineTo(Math.round(o[0]),Math.round(o[1])),t.lineTo(Math.round(a[0]),Math.round(a[1])),t.clip()}prepareContainer(t,e){const i=t.extent,s=t.viewState.resolution,r=t.viewState.rotation,o=t.pixelRatio,a=Math.round(nt(i)/s*o),l=Math.round(kt(i)/s*o);Ke(this.pixelTransform,t.size[0]/2,t.size[1]/2,1/o,1/o,r,-a/2,-l/2),Rc(this.inversePixelTransform,this.pixelTransform);const h=pg(this.pixelTransform);if(this.useContainer(e,h,this.getBackground(t)),!this.containerReused){const c=this.context.canvas;c.width!=a||c.height!=l?(c.width=a,c.height=l):this.context.clearRect(0,0,a,l),h!==c.style.transform&&(c.style.transform=h)}}dispatchRenderEvent_(t,e,i){const s=this.getLayer();if(s.hasListener(t)){const r=new Tc(t,this.inversePixelTransform,i,e);s.dispatchEvent(r)}}preRender(t,e){this.frameState=e,!e.declutter&&this.dispatchRenderEvent_(ie.PRERENDER,t,e)}postRender(t,e){e.declutter||this.dispatchRenderEvent_(ie.POSTRENDER,t,e)}renderDeferredInternal(t){}getRenderContext(t){return t.declutter&&!this.deferredContext_&&(this.deferredContext_=new bc),t.declutter?this.deferredContext_.getContext():this.context}renderDeferred(t){t.declutter&&(this.dispatchRenderEvent_(ie.PRERENDER,this.context,t),t.declutter&&this.deferredContext_&&(this.deferredContext_.draw(this.context),this.deferredContext_.clear()),this.renderDeferredInternal(t),this.dispatchRenderEvent_(ie.POSTRENDER,this.context,t))}getRenderTransform(t,e,i,s,r,o,a){const l=r/2,h=o/2,c=s/e,u=-c,d=-t[0]+a,f=-t[1];return Ke(this.tempTransform,l,h,c,u,-i,d,f)}disposeInternal(){delete this.frameState,super.disposeInternal()}}function Jr(n,t,e,i){return`${n},${tg(t,e,i)}`}function Qr(n,t,e){if(!(e in n))return n[e]=new Set([t]),!0;const i=n[e],s=i.has(t);return s||i.add(t),!s}function jg(n,t,e){const i=n[e];return i?i.delete(t):!1}function Pl(n,t){const e=n.layerStatesArray[n.layerIndex];e.extent&&(t=Mi(t,ri(e.extent,n.viewState.projection)));const i=e.layer.getRenderSource();if(!i.getWrapX()){const s=i.getTileGridForProjection(n.viewState.projection).getExtent();s&&(t=Mi(t,s))}return t}class Bg extends Mc{constructor(t,e){super(t),e=e||{},this.extentChanged=!0,this.renderComplete=!1,this.renderedExtent_=null,this.renderedPixelRatio,this.renderedProjection=null,this.renderedRevision_,this.renderedTiles=[],this.renderedSourceKey_,this.renderedSourceRevision_,this.tempExtent=re(),this.tempTileRange_=new ua(0,0,0,0),this.tempTileCoord_=qs(0,0,0);const i=e.cacheSize!==void 0?e.cacheSize:512;this.tileCache_=new zg(i),this.maxStaleKeys=i*.5}getTileCache(){return this.tileCache_}getOrCreateTile(t,e,i,s){const r=this.tileCache_,a=this.getLayer().getSource(),l=Jr(a.getKey(),t,e,i);let h;if(r.containsKey(l))h=r.get(l);else{if(h=a.getTile(t,e,i,s.pixelRatio,s.viewState.projection),!h)return null;r.set(l,h)}return h}getTile(t,e,i,s){const r=this.getOrCreateTile(t,e,i,s);return r||null}getData(t){const e=this.frameState;if(!e)return null;const i=this.getLayer(),s=Rt(e.pixelToCoordinateTransform,t.slice()),r=i.getExtent();if(r&&!gn(r,s))return null;const o=e.viewState,a=i.getRenderSource(),l=a.getTileGridForProjection(o.projection),h=a.getTilePixelRatio(e.pixelRatio);for(let c=l.getZForResolution(o.resolution);c>=l.getMinZoom();--c){const u=l.getTileCoordForCoordAndZ(s,c),d=this.getTile(c,u[1],u[2],e);if(!d||d.getState()!==O.LOADED)continue;const f=l.getOrigin(c),g=Ut(l.getTileSize(c)),_=l.getResolution(c);let m;if(d instanceof Cc||d instanceof Ic)m=d.getImage();else if(d instanceof Al){if(m=Mo(d.getData()),!m)continue}else continue;const p=Math.floor(h*((s[0]-f[0])/_-u[1]*g[0])),y=Math.floor(h*((f[1]-s[1])/_-u[2]*g[1])),w=Math.round(h*a.getGutterForProjection(o.projection));return this.getImageData(m,p+w,y+w)}return null}prepareFrame(t){this.renderedProjection?t.viewState.projection!==this.renderedProjection&&(this.tileCache_.clear(),this.renderedProjection=t.viewState.projection):this.renderedProjection=t.viewState.projection;const e=this.getLayer().getSource();if(!e)return!1;const i=e.getRevision();return this.renderedRevision_?this.renderedRevision_!==i&&(this.renderedRevision_=i,this.renderedSourceKey_===e.getKey()&&this.tileCache_.clear()):this.renderedRevision_=i,!0}enqueueTiles(t,e,i,s,r){const o=t.viewState,a=this.getLayer(),l=a.getRenderSource(),h=l.getTileGridForProjection(o.projection),c=Q(l);c in t.wantedTiles||(t.wantedTiles[c]={});const u=t.wantedTiles[c],d=a.getMapInternal(),f=Math.max(i-r,h.getMinZoom(),h.getZForResolution(Math.min(a.getMaxResolution(),d?d.getView().getResolutionForZoom(Math.max(a.getMinZoom(),0)):h.getResolution(0)),l.zDirection)),g=o.rotation,_=g?sc(o.center,o.resolution,g,t.size):void 0;for(let m=i;m>=f;--m){const p=h.getTileRangeForExtentAndZ(e,m,this.tempTileRange_),y=h.getResolution(m);for(let w=p.minX;w<=p.maxX;++w)for(let x=p.minY;x<=p.maxY;++x){if(g&&!h.tileCoordIntersectsViewport([m,w,x],_))continue;const v=this.getTile(m,w,x,t);if(!v||!Qr(s,v,m))continue;const S=v.getKey();if(u[S]=!0,v.getState()===O.IDLE&&!t.tileQueue.isKeyQueued(S)){const C=qs(m,w,x,this.tempTileCoord_);t.tileQueue.enqueue([v,c,h.getTileCoordCenter(C),y])}}}}findStaleTile_(t,e){const i=this.tileCache_,s=t[0],r=t[1],o=t[2],a=this.getStaleKeys();for(let l=0;l<a.length;++l){const h=Jr(a[l],s,r,o);if(i.containsKey(h)){const c=i.peek(h);if(c.getState()===O.LOADED)return c.endTransition(Q(this)),Qr(e,c,s),!0}}return!1}findAltTiles_(t,e,i,s){const r=t.getTileRangeForTileCoordAndZ(e,i,this.tempTileRange_);if(!r)return!1;let o=!0;const a=this.tileCache_,h=this.getLayer().getRenderSource().getKey();for(let c=r.minX;c<=r.maxX;++c)for(let u=r.minY;u<=r.maxY;++u){const d=Jr(h,i,c,u);let f=!1;if(a.containsKey(d)){const g=a.peek(d);g.getState()===O.LOADED&&(Qr(s,g,i),f=!0)}f||(o=!1)}return o}renderFrame(t,e){let i=!0;this.renderComplete=!0;const s=t.layerStatesArray[t.layerIndex],r=t.viewState,o=r.projection,a=r.resolution,l=r.center,h=t.pixelRatio,c=this.getLayer(),u=c.getSource(),d=u.getTileGridForProjection(o),f=d.getZForResolution(a,u.zDirection),g=d.getResolution(f),_=u.getKey();this.renderedSourceKey_?this.renderedSourceKey_!==_&&(this.prependStaleKey(this.renderedSourceKey_),this.renderedSourceKey_=_):this.renderedSourceKey_=_;let m=t.extent;const p=u.getTilePixelRatio(h);this.prepareContainer(t,e);const y=this.context.canvas.width,w=this.context.canvas.height,x=s.extent&&ri(s.extent);x&&(m=Mi(m,ri(s.extent)));const v=g*y/2/p,R=g*w/2/p,S=[l[0]-v,l[1]-R,l[0]+v,l[1]+R],C={};this.renderedTiles.length=0;const I=c.getPreload();if(t.nextExtent){const Y=d.getZForResolution(r.nextResolution,u.zDirection),W=Pl(t,t.nextExtent);this.enqueueTiles(t,W,Y,C,I)}const b=Pl(t,m);if(this.enqueueTiles(t,b,f,C,0),I>0&&setTimeout(()=>{this.enqueueTiles(t,b,f-1,C,I-1)},0),!(f in C))return this.container;const L=Q(this),P=t.time;for(const Y of C[f]){const W=Y.getState();if(W===O.EMPTY)continue;const U=Y.tileCoord;if(W===O.LOADED&&Y.getAlpha(L,P)===1){Y.endTransition(L);continue}if(W!==O.IDLE&&(i=!1),W!==O.ERROR&&(this.renderComplete=!1),this.findStaleTile_(U,C)){jg(C,Y,f),t.animate=!0;continue}if(this.findAltTiles_(d,U,f+1,C))continue;const yt=d.getMinZoom();for(let tt=f-1;tt>=yt&&!this.findAltTiles_(d,U,tt,C);--tt);}const D=g/a*h/p,M=this.getRenderContext(t);Ke(this.tempTransform,y/2,w/2,D,D,0,-y/2,-w/2),s.extent&&this.clipUnrotated(M,t,x),u.getInterpolate()||(M.imageSmoothingEnabled=!1),this.preRender(M,t);const V=Object.keys(C).map(Number);V.sort(Ye);let A;const k=[],X=[];for(let Y=V.length-1;Y>=0;--Y){const W=V[Y],U=u.getTilePixelSize(W,h,o),ft=d.getResolution(W)/g,yt=U[0]*ft*D,tt=U[1]*ft*D,gt=d.getTileCoordForCoordAndZ(Fi(S),W),xt=d.getTileCoordExtent(gt),wt=Rt(this.tempTransform,[p*(xt[0]-S[0])/g,p*(S[3]-xt[3])/g]),et=p*u.getGutterForProjection(o);for(const Z of C[W]){if(Z.getState()!==O.LOADED)continue;const bt=Z.tileCoord,lt=gt[1]-bt[1],ht=Math.round(wt[0]-(lt-1)*yt),Et=gt[2]-bt[2],wn=Math.round(wt[1]-(Et-1)*tt),_e=Math.round(wt[0]-lt*yt),me=Math.round(wt[1]-Et*tt),zi=ht-_e,pi=wn-me,Xi=V.length===1;let En=!1;A=[_e,me,_e+zi,me,_e+zi,me+pi,_e,me+pi];for(let Le=0,yi=k.length;Le<yi;++Le)if(!Xi&&W<X[Le]){const Mt=k[Le];Bt([_e,me,_e+zi,me+pi],[Mt[0],Mt[3],Mt[4],Mt[7]])&&(En||(M.save(),En=!0),M.beginPath(),M.moveTo(A[0],A[1]),M.lineTo(A[2],A[3]),M.lineTo(A[4],A[5]),M.lineTo(A[6],A[7]),M.moveTo(Mt[6],Mt[7]),M.lineTo(Mt[4],Mt[5]),M.lineTo(Mt[2],Mt[3]),M.lineTo(Mt[0],Mt[1]),M.clip())}k.push(A),X.push(W),this.drawTile(Z,t,_e,me,zi,pi,et,Xi),En&&M.restore(),this.renderedTiles.unshift(Z),this.updateUsedTiles(t.usedTiles,u,Z)}}if(this.renderedResolution=g,this.extentChanged=!this.renderedExtent_||!Hn(this.renderedExtent_,S),this.renderedExtent_=S,this.renderedPixelRatio=h,this.postRender(this.context,t),s.extent&&M.restore(),M.imageSmoothingEnabled=!0,this.renderComplete){const Y=(W,U)=>{const T=Q(u),ft=U.wantedTiles[T],yt=ft?Object.keys(ft).length:0;this.updateCacheSize(yt),this.tileCache_.expireCache()};t.postRenderFunctions.push(Y)}return!this.renderComplete&&!i&&(t.animate=!0),this.container}updateCacheSize(t){this.tileCache_.highWaterMark=Math.max(this.tileCache_.highWaterMark,t*2)}drawTile(t,e,i,s,r,o,a,l){let h;if(t instanceof Al){if(h=Mo(t.getData()),!h)throw new Error("Rendering array data is not yet supported")}else h=this.getTileImage(t);if(!h)return;const c=this.getRenderContext(e),u=Q(this),d=e.layerStatesArray[e.layerIndex],f=d.opacity*(l?t.getAlpha(u,e.time):1),g=f!==c.globalAlpha;g&&(c.save(),c.globalAlpha=f),c.drawImage(h,a,a,h.width-2*a,h.height-2*a,i,s,r,o),g&&c.restore(),f!==d.opacity?e.animate=!0:l&&t.endTransition(u)}getImage(){const t=this.context;return t?t.canvas:null}getTileImage(t){return t.getImage()}updateUsedTiles(t,e,i){const s=Q(e);s in t||(t[s]={}),t[s][i.getKey()]=!0}}const Lt={ANIMATING:0,INTERACTING:1},oe={CENTER:"center",RESOLUTION:"resolution",ROTATION:"rotation"};function Ol(n,t,e){return function(i,s,r,o,a){if(!i)return;if(!s&&!t)return i;const l=t?0:r[0]*s,h=t?0:r[1]*s,c=a?a[0]:0,u=a?a[1]:0;let d=n[0]+l/2+c,f=n[2]-l/2+c,g=n[1]+h/2+u,_=n[3]-h/2+u;d>f&&(d=(f+d)/2,f=d),g>_&&(g=(_+g)/2,_=g);let m=mt(i[0],d,f),p=mt(i[1],g,_);if(o&&e&&s){const y=30*s;m+=-y*Math.log(1+Math.max(0,d-i[0])/y)+y*Math.log(1+Math.max(0,i[0]-f)/y),p+=-y*Math.log(1+Math.max(0,g-i[1])/y)+y*Math.log(1+Math.max(0,i[1]-_)/y)}return[m,p]}}function Kg(n){return n}function hi(n,t,e,i,s,r,o){r=r||[],o=o||2;let a=0;for(let l=t;l<e;l+=i){const h=n[l],c=n[l+1];r[a++]=s[0]*h+s[2]*c+s[4],r[a++]=s[1]*h+s[3]*c+s[5];for(let u=2;u<o;u++)r[a++]=n[l+u]}return r&&r.length!=a&&(r.length=a),r}function Ac(n,t,e,i,s,r,o){o=o||[];const a=Math.cos(s),l=Math.sin(s),h=r[0],c=r[1];let u=0;for(let d=t;d<e;d+=i){const f=n[d]-h,g=n[d+1]-c;o[u++]=h+f*a-g*l,o[u++]=c+f*l+g*a;for(let _=d+2;_<d+i;++_)o[u++]=n[_]}return o&&o.length!=u&&(o.length=u),o}function Ug(n,t,e,i,s,r,o,a){a=a||[];const l=o[0],h=o[1];let c=0;for(let u=t;u<e;u+=i){const d=n[u]-l,f=n[u+1]-h;a[c++]=l+s*d,a[c++]=h+r*f;for(let g=u+2;g<u+i;++g)a[c++]=n[g]}return a&&a.length!=c&&(a.length=c),a}function Zg(n,t,e,i,s,r,o){o=o||[];let a=0;for(let l=t;l<e;l+=i){o[a++]=n[l]+s,o[a++]=n[l+1]+r;for(let h=l+2;h<l+i;++h)o[a++]=n[h]}return o&&o.length!=a&&(o.length=a),o}const Fl=de(),Vg=[NaN,NaN];class Lc extends Ae{constructor(){super(),this.extent_=re(),this.extentRevision_=-1,this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=0,this.simplifyTransformedInternal=Vh((t,e,i)=>{if(!i)return this.getSimplifiedGeometry(e);const s=this.clone();return s.applyTransform(i),s.getSimplifiedGeometry(e)})}simplifyTransformed(t,e){return this.simplifyTransformedInternal(this.getRevision(),t,e)}clone(){return G()}closestPointXY(t,e,i,s){return G()}containsXY(t,e){return this.closestPointXY(t,e,Vg,Number.MIN_VALUE)===0}getClosestPoint(t,e){return e=e||[NaN,NaN],this.closestPointXY(t[0],t[1],e,1/0),e}intersectsCoordinate(t){return this.containsXY(t[0],t[1])}computeExtent(t){return G()}getExtent(t){if(this.extentRevision_!=this.getRevision()){const e=this.computeExtent(this.extent_);(isNaN(e[0])||isNaN(e[1]))&&as(e),this.extentRevision_=this.getRevision()}return mf(this.extent_,t)}rotate(t,e){G()}scale(t,e,i){G()}simplify(t){return this.getSimplifiedGeometry(t*t)}getSimplifiedGeometry(t){return G()}getType(){return G()}applyTransform(t){G()}intersectsExtent(t){return G()}translate(t,e){G()}transform(t,e){const i=dt(t),s=i.getUnits()=="tile-pixels"?function(r,o,a){const l=i.getExtent(),h=i.getWorldExtent(),c=kt(h)/kt(l);Ke(Fl,h[0],h[3],c,-c,0,0,0);const u=hi(r,0,r.length,a,Fl,o),d=$n(i,e);return d?d(u,u,a):u}:$n(i,e);return this.applyTransform(s),this}}class Di extends Lc{constructor(){super(),this.layout="XY",this.stride=2,this.flatCoordinates}computeExtent(t){return ea(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t)}getCoordinates(){return G()}getFirstCoordinate(){return this.flatCoordinates.slice(0,this.stride)}getFlatCoordinates(){return this.flatCoordinates}getLastCoordinate(){return this.flatCoordinates.slice(this.flatCoordinates.length-this.stride)}getLayout(){return this.layout}getSimplifiedGeometry(t){if(this.simplifiedGeometryRevision!==this.getRevision()&&(this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),t<0||this.simplifiedGeometryMaxMinSquaredTolerance!==0&&t<=this.simplifiedGeometryMaxMinSquaredTolerance)return this;const e=this.getSimplifiedGeometryInternal(t);return e.getFlatCoordinates().length<this.flatCoordinates.length?e:(this.simplifiedGeometryMaxMinSquaredTolerance=t,this)}getSimplifiedGeometryInternal(t){return this}getStride(){return this.stride}setFlatCoordinates(t,e){this.stride=Dl(t),this.layout=t,this.flatCoordinates=e}setCoordinates(t,e){G()}setLayout(t,e,i){let s;if(t)s=Dl(t);else{for(let r=0;r<i;++r){if(e.length===0){this.layout="XY",this.stride=2;return}e=e[0]}s=e.length,t=ki(s)}this.layout=t,this.stride=s}applyTransform(t){this.flatCoordinates&&(t(this.flatCoordinates,this.flatCoordinates,this.layout.startsWith("XYZ")?3:2,this.stride),this.changed())}rotate(t,e){const i=this.getFlatCoordinates();if(i){const s=this.getStride();Ac(i,0,i.length,s,t,e,i),this.changed()}}scale(t,e,i){e===void 0&&(e=t),i||(i=gi(this.getExtent()));const s=this.getFlatCoordinates();if(s){const r=this.getStride();Ug(s,0,s.length,r,t,e,i,s),this.changed()}}translate(t,e){const i=this.getFlatCoordinates();if(i){const s=this.getStride();Zg(i,0,i.length,s,t,e,i),this.changed()}}}function ki(n){let t;return n==2?t="XY":n==3?t="XYZ":n==4&&(t="XYZM"),t}function Dl(n){let t;return n=="XY"?t=2:n=="XYZ"||n=="XYM"?t=3:n=="XYZM"&&(t=4),t}function Hg(n,t,e){const i=n.getFlatCoordinates();if(!i)return null;const s=n.getStride();return hi(i,0,i.length,s,t,e)}function Pc(n,t,e,i){let s=0;const r=n[e-i],o=n[e-i+1];let a=0,l=0;for(;t<e;t+=i){const h=n[t]-r,c=n[t+1]-o;s+=l*h-a*c,a=h,l=c}return s/2}function Oc(n,t,e,i){let s=0;for(let r=0,o=e.length;r<o;++r){const a=e[r];s+=Pc(n,t,a,i),t=a}return s}function qg(n,t,e,i){let s=0;for(let r=0,o=e.length;r<o;++r){const a=e[r];s+=Oc(n,t,a,i),t=a[a.length-1]}return s}function kl(n,t,e,i,s,r,o){const a=n[t],l=n[t+1],h=n[e]-a,c=n[e+1]-l;let u;if(h===0&&c===0)u=t;else{const d=((s-a)*h+(r-l)*c)/(h*h+c*c);if(d>1)u=e;else if(d>0){for(let f=0;f<i;++f)o[f]=Vt(n[t+f],n[e+f],d);o.length=i;return}else u=t}for(let d=0;d<i;++d)o[d]=n[u+d];o.length=i}function pa(n,t,e,i,s){let r=n[t],o=n[t+1];for(t+=i;t<e;t+=i){const a=n[t],l=n[t+1],h=bi(r,o,a,l);h>s&&(s=h),r=a,o=l}return s}function ya(n,t,e,i,s){for(let r=0,o=e.length;r<o;++r){const a=e[r];s=pa(n,t,a,i,s),t=a}return s}function $g(n,t,e,i,s){for(let r=0,o=e.length;r<o;++r){const a=e[r];s=ya(n,t,a,i,s),t=a[a.length-1]}return s}function va(n,t,e,i,s,r,o,a,l,h,c){if(t==e)return h;let u,d;if(s===0){if(d=bi(o,a,n[t],n[t+1]),d<h){for(u=0;u<i;++u)l[u]=n[t+u];return l.length=i,d}return h}c=c||[NaN,NaN];let f=t+i;for(;f<e;)if(kl(n,f-i,f,i,o,a,c),d=bi(o,a,c[0],c[1]),d<h){for(h=d,u=0;u<i;++u)l[u]=c[u];l.length=i,f+=i}else f+=i*Math.max((Math.sqrt(d)-Math.sqrt(h))/s|0,1);if(r&&(kl(n,e-i,t,i,o,a,c),d=bi(o,a,c[0],c[1]),d<h)){for(h=d,u=0;u<i;++u)l[u]=c[u];l.length=i}return h}function xa(n,t,e,i,s,r,o,a,l,h,c){c=c||[NaN,NaN];for(let u=0,d=e.length;u<d;++u){const f=e[u];h=va(n,t,f,i,s,r,o,a,l,h,c),t=f}return h}function Jg(n,t,e,i,s,r,o,a,l,h,c){c=c||[NaN,NaN];for(let u=0,d=e.length;u<d;++u){const f=e[u];h=xa(n,t,f,i,s,r,o,a,l,h,c),t=f[f.length-1]}return h}function Qg(n,t,e,i){for(let s=0,r=e.length;s<r;++s)n[t++]=e[s];return t}function Lr(n,t,e,i){for(let s=0,r=e.length;s<r;++s){const o=e[s];for(let a=0;a<i;++a)n[t++]=o[a]}return t}function hs(n,t,e,i,s){s=s||[];let r=0;for(let o=0,a=e.length;o<a;++o){const l=Lr(n,t,e[o],i);s[r++]=l,t=l}return s.length=r,s}function Fc(n,t,e,i,s){s=s||[];let r=0;for(let o=0,a=e.length;o<a;++o){const l=hs(n,t,e[o],i,s[r]);l.length===0&&(l[0]=t),s[r++]=l,t=l[l.length-1]}return s.length=r,s}function oi(n,t,e,i,s){s=s!==void 0?s:[];let r=0;for(let o=t;o<e;o+=i)s[r++]=n.slice(o,o+i);return s.length=r,s}function Jn(n,t,e,i,s){s=s!==void 0?s:[];let r=0;for(let o=0,a=e.length;o<a;++o){const l=e[o];s[r++]=oi(n,t,l,i,s[r]),t=l}return s.length=r,s}function Ao(n,t,e,i,s){s=s!==void 0?s:[];let r=0;for(let o=0,a=e.length;o<a;++o){const l=e[o];s[r++]=l.length===1&&l[0]===t?[]:Jn(n,t,l,i,s[r]),t=l[l.length-1]}return s.length=r,s}function Pr(n,t,e,i,s,r,o){const a=(e-t)/i;if(a<3){for(;t<e;t+=i)r[o++]=n[t],r[o++]=n[t+1];return o}const l=new Array(a);l[0]=1,l[a-1]=1;const h=[t,e-i];let c=0;for(;h.length>0;){const u=h.pop(),d=h.pop();let f=0;const g=n[d],_=n[d+1],m=n[u],p=n[u+1];for(let y=d+i;y<u;y+=i){const w=n[y],x=n[y+1],v=Nd(w,x,g,_,m,p);v>f&&(c=y,f=v)}f>s&&(l[(c-t)/i]=1,d+i<c&&h.push(d,c),c+i<u&&h.push(c,u))}for(let u=0;u<a;++u)l[u]&&(r[o++]=n[t+u*i],r[o++]=n[t+u*i+1]);return o}function Dc(n,t,e,i,s,r,o,a){for(let l=0,h=e.length;l<h;++l){const c=e[l];o=Pr(n,t,c,i,s,r,o),a.push(o),t=c}return o}function Ei(n,t){return t*Math.round(n/t)}function t_(n,t,e,i,s,r,o){if(t==e)return o;let a=Ei(n[t],s),l=Ei(n[t+1],s);t+=i,r[o++]=a,r[o++]=l;let h,c;do if(h=Ei(n[t],s),c=Ei(n[t+1],s),t+=i,t==e)return r[o++]=h,r[o++]=c,o;while(h==a&&c==l);for(;t<e;){const u=Ei(n[t],s),d=Ei(n[t+1],s);if(t+=i,u==h&&d==c)continue;const f=h-a,g=c-l,_=u-a,m=d-l;if(f*m==g*_&&(f<0&&_<f||f==_||f>0&&_>f)&&(g<0&&m<g||g==m||g>0&&m>g)){h=u,c=d;continue}r[o++]=h,r[o++]=c,a=h,l=c,h=u,c=d}return r[o++]=h,r[o++]=c,o}function wa(n,t,e,i,s,r,o,a){for(let l=0,h=e.length;l<h;++l){const c=e[l];o=t_(n,t,c,i,s,r,o),a.push(o),t=c}return o}function e_(n,t,e,i,s,r,o,a){for(let l=0,h=e.length;l<h;++l){const c=e[l],u=[];o=wa(n,t,c,i,s,r,o,u),a.push(u),t=c[c.length-1]}return o}class Qn extends Di{constructor(t,e){super(),this.maxDelta_=-1,this.maxDeltaRevision_=-1,e!==void 0&&!Array.isArray(t[0])?this.setFlatCoordinates(e,t):this.setCoordinates(t,e)}clone(){return new Qn(this.flatCoordinates.slice(),this.layout)}closestPointXY(t,e,i,s){return s<Oi(this.getExtent(),t,e)?s:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(pa(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),va(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!0,t,e,i,s))}getArea(){return Pc(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getCoordinates(){return oi(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getSimplifiedGeometryInternal(t){const e=[];return e.length=Pr(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,e,0),new Qn(e,"XY")}getType(){return"LinearRing"}intersectsExtent(t){return!1}setCoordinates(t,e){this.setLayout(e,t,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=Lr(this.flatCoordinates,0,t,this.stride),this.changed()}}class Li extends Di{constructor(t,e){super(),this.setCoordinates(t,e)}clone(){const t=new Li(this.flatCoordinates.slice(),this.layout);return t.applyProperties(this),t}closestPointXY(t,e,i,s){const r=this.flatCoordinates,o=bi(t,e,r[0],r[1]);if(o<s){const a=this.stride;for(let l=0;l<a;++l)i[l]=r[l];return i.length=a,o}return s}getCoordinates(){return this.flatCoordinates.slice()}computeExtent(t){return tc(this.flatCoordinates,t)}getType(){return"Point"}intersectsExtent(t){return ta(t,this.flatCoordinates[0],this.flatCoordinates[1])}setCoordinates(t,e){this.setLayout(e,t,0),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=Qg(this.flatCoordinates,0,t,this.stride),this.changed()}}function Ea(n,t,e,i,s,r,o){let a,l,h,c,u,d,f;const g=s[r+1],_=[];for(let y=0,w=e.length;y<w;++y){const x=e[y];for(c=n[x-i],d=n[x-i+1],a=t;a<x;a+=i)u=n[a],f=n[a+1],(g<=d&&f<=g||d<=g&&g<=f)&&(h=(g-d)/(f-d)*(u-c)+c,_.push(h)),c=u,d=f}let m=NaN,p=-1/0;for(_.sort(Ye),c=_[0],a=1,l=_.length;a<l;++a){u=_[a];const y=Math.abs(u-c);y>p&&(h=(c+u)/2,da(n,t,e,i,h,g)&&(m=h,p=y)),c=u}return isNaN(m)&&(m=s[r]),o?(o.push(m,g,p),o):[m,g,p]}function kc(n,t,e,i,s){let r=[];for(let o=0,a=e.length;o<a;++o){const l=e[o];r=Ea(n,t,l,i,s,2*o,r),t=l[l.length-1]}return r}function i_(n,t,e,i){for(;t<e-i;){for(let s=0;s<i;++s){const r=n[t+s];n[t+s]=n[e-i+s],n[e-i+s]=r}t+=i,e-=i}}function Ca(n,t,e,i){let s=0,r=n[e-i],o=n[e-i+1];for(;t<e;t+=i){const a=n[t],l=n[t+1];s+=(a-r)*(l+o),r=a,o=l}return s===0?void 0:s>0}function Ra(n,t,e,i,s){s=s!==void 0?s:!1;for(let r=0,o=e.length;r<o;++r){const a=e[r],l=Ca(n,t,a,i);if(r===0){if(s&&l||!s&&!l)return!1}else if(s&&!l||!s&&l)return!1;t=a}return!0}function Nc(n,t,e,i,s){for(let r=0,o=e.length;r<o;++r){const a=e[r];if(!Ra(n,t,a,i,s))return!1;a.length&&(t=a[a.length-1])}return!0}function $s(n,t,e,i,s){s=s!==void 0?s:!1;for(let r=0,o=e.length;r<o;++r){const a=e[r],l=Ca(n,t,a,i);(r===0?s&&l||!s&&!l:s&&!l||!s&&l)&&i_(n,t,a,i),t=a}return t}function Lo(n,t,e,i,s){for(let r=0,o=e.length;r<o;++r)t=$s(n,t,e[r],i,s);return t}function n_(n,t){const e=[];let i=0,s=0,r;for(let o=0,a=t.length;o<a;++o){const l=t[o],h=Ca(n,i,l,2);if(r===void 0&&(r=h),h===r)e.push(t.slice(s,o+1));else{if(e.length===0)continue;e[e.length-1].push(t[s])}s=o+1,i=l}return e}class _i extends Di{constructor(t,e,i){super(),this.ends_=[],this.flatInteriorPointRevision_=-1,this.flatInteriorPoint_=null,this.maxDelta_=-1,this.maxDeltaRevision_=-1,this.orientedRevision_=-1,this.orientedFlatCoordinates_=null,e!==void 0&&i?(this.setFlatCoordinates(e,t),this.ends_=i):this.setCoordinates(t,e)}appendLinearRing(t){this.flatCoordinates?Se(this.flatCoordinates,t.getFlatCoordinates()):this.flatCoordinates=t.getFlatCoordinates().slice(),this.ends_.push(this.flatCoordinates.length),this.changed()}clone(){const t=new _i(this.flatCoordinates.slice(),this.layout,this.ends_.slice());return t.applyProperties(this),t}closestPointXY(t,e,i,s){return s<Oi(this.getExtent(),t,e)?s:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(ya(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),xa(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!0,t,e,i,s))}containsXY(t,e){return da(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t,e)}getArea(){return Oc(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride)}getCoordinates(t){let e;return t!==void 0?(e=this.getOrientedFlatCoordinates().slice(),$s(e,0,this.ends_,this.stride,t)):e=this.flatCoordinates,Jn(e,0,this.ends_,this.stride)}getEnds(){return this.ends_}getFlatInteriorPoint(){if(this.flatInteriorPointRevision_!=this.getRevision()){const t=gi(this.getExtent());this.flatInteriorPoint_=Ea(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t,0),this.flatInteriorPointRevision_=this.getRevision()}return this.flatInteriorPoint_}getInteriorPoint(){return new Li(this.getFlatInteriorPoint(),"XYM")}getLinearRingCount(){return this.ends_.length}getLinearRing(t){return t<0||this.ends_.length<=t?null:new Qn(this.flatCoordinates.slice(t===0?0:this.ends_[t-1],this.ends_[t]),this.layout)}getLinearRings(){const t=this.layout,e=this.flatCoordinates,i=this.ends_,s=[];let r=0;for(let o=0,a=i.length;o<a;++o){const l=i[o],h=new Qn(e.slice(r,l),t);s.push(h),r=l}return s}getOrientedFlatCoordinates(){if(this.orientedRevision_!=this.getRevision()){const t=this.flatCoordinates;Ra(t,0,this.ends_,this.stride)?this.orientedFlatCoordinates_=t:(this.orientedFlatCoordinates_=t.slice(),this.orientedFlatCoordinates_.length=$s(this.orientedFlatCoordinates_,0,this.ends_,this.stride)),this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_}getSimplifiedGeometryInternal(t){const e=[],i=[];return e.length=wa(this.flatCoordinates,0,this.ends_,this.stride,Math.sqrt(t),e,0,i),new _i(e,"XY",i)}getType(){return"Polygon"}intersectsExtent(t){return yc(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t)}setCoordinates(t,e){this.setLayout(e,t,2),this.flatCoordinates||(this.flatCoordinates=[]);const i=hs(this.flatCoordinates,0,t,this.stride,this.ends_);this.flatCoordinates.length=i.length===0?0:i[i.length-1],this.changed()}}function Nl(n){if(Tr(n))throw new Error("Cannot create polygon from empty extent");const t=n[0],e=n[1],i=n[2],s=n[3],r=[t,e,t,s,i,s,i,e,t,e];return new _i(r,"XY",[r.length])}function Ia(n,t,e,i){const s=nt(t)/e[0],r=kt(t)/e[1];return i?Math.min(n,Math.max(s,r)):Math.min(n,Math.min(s,r))}function Sa(n,t,e){let i=Math.min(n,t);const s=50;return i*=Math.log(1+s*Math.max(0,n/t-1))/s+1,e&&(i=Math.max(i,e),i/=Math.log(1+s*Math.max(0,e/n-1))/s+1),mt(i,e/2,t*2)}function s_(n,t,e,i){return t=t!==void 0?t:!0,function(s,r,o,a){if(s!==void 0){const l=n[0],h=n[n.length-1],c=e?Ia(l,e,o,i):l;if(a)return t?Sa(s,c,h):mt(s,h,c);const u=Math.min(c,s),d=Math.floor(qo(n,u,r));return n[d]>c&&d<n.length-1?n[d+1]:n[d]}}}function r_(n,t,e,i,s,r){return i=i!==void 0?i:!0,e=e!==void 0?e:0,function(o,a,l,h){if(o!==void 0){const c=s?Ia(t,s,l,r):t;if(h)return i?Sa(o,c,e):mt(o,e,c);const u=1e-9,d=Math.ceil(Math.log(t/c)/Math.log(n)-u),f=-a*(.5-u)+.5,g=Math.min(c,o),_=Math.floor(Math.log(t/g)/Math.log(n)+f),m=Math.max(d,_),p=t/Math.pow(n,m);return mt(p,e,c)}}}function Gl(n,t,e,i,s){return e=e!==void 0?e:!0,function(r,o,a,l){if(r!==void 0){const h=i?Ia(n,i,a,s):n;return!e||!l?mt(r,t,h):Sa(r,h,t)}}}function Ta(n){if(n!==void 0)return 0}function zl(n){if(n!==void 0)return n}function o_(n){const t=2*Math.PI/n;return function(e,i){if(i)return e;if(e!==void 0)return e=Math.floor(e/t+.5)*t,e}}function a_(n){const t=li(5);return function(e,i){return i||e===void 0?e:Math.abs(e)<=t?0:e}}const to=0;class we extends Ae{constructor(t){super(),this.on,this.once,this.un,t=Object.assign({},t),this.hints_=[0,0],this.animations_=[],this.updateAnimationKey_,this.projection_=la(t.projection,"EPSG:3857"),this.viewportSize_=[100,100],this.targetCenter_=null,this.targetResolution_,this.targetRotation_,this.nextCenter_=null,this.nextResolution_,this.nextRotation_,this.cancelAnchor_=void 0,t.projection&&gc(),t.center&&(t.center=Ge(t.center,this.projection_)),t.extent&&(t.extent=ri(t.extent,this.projection_)),this.applyOptions_(t)}applyOptions_(t){const e=Object.assign({},t);for(const a in oe)delete e[a];this.setProperties(e,!0);const i=h_(t);this.maxResolution_=i.maxResolution,this.minResolution_=i.minResolution,this.zoomFactor_=i.zoomFactor,this.resolutions_=t.resolutions,this.padding_=t.padding,this.minZoom_=i.minZoom;const s=l_(t),r=i.constraint,o=c_(t);this.constraints_={center:s,resolution:r,rotation:o},this.setRotation(t.rotation!==void 0?t.rotation:0),this.setCenterInternal(t.center!==void 0?t.center:null),t.resolution!==void 0?this.setResolution(t.resolution):t.zoom!==void 0&&this.setZoom(t.zoom)}get padding(){return this.padding_}set padding(t){let e=this.padding_;this.padding_=t;const i=this.getCenterInternal();if(i){const s=t||[0,0,0,0];e=e||[0,0,0,0];const r=this.getResolution(),o=r/2*(s[3]-e[3]+e[1]-s[1]),a=r/2*(s[0]-e[0]+e[2]-s[2]);this.setCenterInternal([i[0]+o,i[1]-a])}}getUpdatedOptions_(t){const e=this.getProperties();return e.resolution!==void 0?e.resolution=this.getResolution():e.zoom=this.getZoom(),e.center=this.getCenterInternal(),e.rotation=this.getRotation(),Object.assign({},e,t)}animate(t){this.isDef()&&!this.getAnimating()&&this.resolveConstraints(0);const e=new Array(arguments.length);for(let i=0;i<e.length;++i){let s=arguments[i];s.center&&(s=Object.assign({},s),s.center=Ge(s.center,this.getProjection())),s.anchor&&(s=Object.assign({},s),s.anchor=Ge(s.anchor,this.getProjection())),e[i]=s}this.animateInternal.apply(this,e)}animateInternal(t){let e=arguments.length,i;e>1&&typeof arguments[e-1]=="function"&&(i=arguments[e-1],--e);let s=0;for(;s<e&&!this.isDef();++s){const c=arguments[s];c.center&&this.setCenterInternal(c.center),c.zoom!==void 0?this.setZoom(c.zoom):c.resolution&&this.setResolution(c.resolution),c.rotation!==void 0&&this.setRotation(c.rotation)}if(s===e){i&&Es(i,!0);return}let r=Date.now(),o=this.targetCenter_.slice(),a=this.targetResolution_,l=this.targetRotation_;const h=[];for(;s<e;++s){const c=arguments[s],u={start:r,complete:!1,anchor:c.anchor,duration:c.duration!==void 0?c.duration:1e3,easing:c.easing||hg,callback:i};if(c.center&&(u.sourceCenter=o,u.targetCenter=c.center.slice(),o=u.targetCenter),c.zoom!==void 0?(u.sourceResolution=a,u.targetResolution=this.getResolutionForZoom(c.zoom),a=u.targetResolution):c.resolution&&(u.sourceResolution=a,u.targetResolution=c.resolution,a=u.targetResolution),c.rotation!==void 0){u.sourceRotation=l;const d=sn(c.rotation-l+Math.PI,2*Math.PI)-Math.PI;u.targetRotation=l+d,l=u.targetRotation}u_(u)?u.complete=!0:r+=u.duration,h.push(u)}this.animations_.push(h),this.setHint(Lt.ANIMATING,1),this.updateAnimations_()}getAnimating(){return this.hints_[Lt.ANIMATING]>0}getInteracting(){return this.hints_[Lt.INTERACTING]>0}cancelAnimations(){this.setHint(Lt.ANIMATING,-this.hints_[Lt.ANIMATING]);let t;for(let e=0,i=this.animations_.length;e<i;++e){const s=this.animations_[e];if(s[0].callback&&Es(s[0].callback,!1),!t)for(let r=0,o=s.length;r<o;++r){const a=s[r];if(!a.complete){t=a.anchor;break}}}this.animations_.length=0,this.cancelAnchor_=t,this.nextCenter_=null,this.nextResolution_=NaN,this.nextRotation_=NaN}updateAnimations_(){if(this.updateAnimationKey_!==void 0&&(cancelAnimationFrame(this.updateAnimationKey_),this.updateAnimationKey_=void 0),!this.getAnimating())return;const t=Date.now();let e=!1;for(let i=this.animations_.length-1;i>=0;--i){const s=this.animations_[i];let r=!0;for(let o=0,a=s.length;o<a;++o){const l=s[o];if(l.complete)continue;const h=t-l.start;let c=l.duration>0?h/l.duration:1;c>=1?(l.complete=!0,c=1):r=!1;const u=l.easing(c);if(l.sourceCenter){const d=l.sourceCenter[0],f=l.sourceCenter[1],g=l.targetCenter[0],_=l.targetCenter[1];this.nextCenter_=l.targetCenter;const m=d+u*(g-d),p=f+u*(_-f);this.targetCenter_=[m,p]}if(l.sourceResolution&&l.targetResolution){const d=u===1?l.targetResolution:l.sourceResolution+u*(l.targetResolution-l.sourceResolution);if(l.anchor){const f=this.getViewportSize_(this.getRotation()),g=this.constraints_.resolution(d,0,f,!0);this.targetCenter_=this.calculateCenterZoom(g,l.anchor)}this.nextResolution_=l.targetResolution,this.targetResolution_=d,this.applyTargetState_(!0)}if(l.sourceRotation!==void 0&&l.targetRotation!==void 0){const d=u===1?sn(l.targetRotation+Math.PI,2*Math.PI)-Math.PI:l.sourceRotation+u*(l.targetRotation-l.sourceRotation);if(l.anchor){const f=this.constraints_.rotation(d,!0);this.targetCenter_=this.calculateCenterRotate(f,l.anchor)}this.nextRotation_=l.targetRotation,this.targetRotation_=d}if(this.applyTargetState_(!0),e=!0,!l.complete)break}if(r){this.animations_[i]=null,this.setHint(Lt.ANIMATING,-1),this.nextCenter_=null,this.nextResolution_=NaN,this.nextRotation_=NaN;const o=s[0].callback;o&&Es(o,!0)}}this.animations_=this.animations_.filter(Boolean),e&&this.updateAnimationKey_===void 0&&(this.updateAnimationKey_=requestAnimationFrame(this.updateAnimations_.bind(this)))}calculateCenterRotate(t,e){let i;const s=this.getCenterInternal();return s!==void 0&&(i=[s[0]-e[0],s[1]-e[1]],ia(i,t-this.getRotation()),yf(i,e)),i}calculateCenterZoom(t,e){let i;const s=this.getCenterInternal(),r=this.getResolution();if(s!==void 0&&r!==void 0){const o=e[0]-t*(e[0]-s[0])/r,a=e[1]-t*(e[1]-s[1])/r;i=[o,a]}return i}getViewportSize_(t){const e=this.viewportSize_;if(t){const i=e[0],s=e[1];return[Math.abs(i*Math.cos(t))+Math.abs(s*Math.sin(t)),Math.abs(i*Math.sin(t))+Math.abs(s*Math.cos(t))]}return e}setViewportSize(t){this.viewportSize_=Array.isArray(t)?t.slice():[100,100],this.getAnimating()||this.resolveConstraints(0)}getCenter(){const t=this.getCenterInternal();return t&&bo(t,this.getProjection())}getCenterInternal(){return this.get(oe.CENTER)}getConstraints(){return this.constraints_}getConstrainResolution(){return this.get("constrainResolution")}getHints(t){return t!==void 0?(t[0]=this.hints_[0],t[1]=this.hints_[1],t):this.hints_.slice()}calculateExtent(t){const e=this.calculateExtentInternal(t);return _c(e,this.getProjection())}calculateExtentInternal(t){t=t||this.getViewportSizeMinusPadding_();const e=this.getCenterInternal();$(e,"The view center is not defined");const i=this.getResolution();$(i!==void 0,"The view resolution is not defined");const s=this.getRotation();return $(s!==void 0,"The view rotation is not defined"),Ro(e,i,s,t)}getMaxResolution(){return this.maxResolution_}getMinResolution(){return this.minResolution_}getMaxZoom(){return this.getZoomForResolution(this.minResolution_)}setMaxZoom(t){this.applyOptions_(this.getUpdatedOptions_({maxZoom:t}))}getMinZoom(){return this.getZoomForResolution(this.maxResolution_)}setMinZoom(t){this.applyOptions_(this.getUpdatedOptions_({minZoom:t}))}setConstrainResolution(t){this.applyOptions_(this.getUpdatedOptions_({constrainResolution:t}))}getProjection(){return this.projection_}getResolution(){return this.get(oe.RESOLUTION)}getResolutions(){return this.resolutions_}getResolutionForExtent(t,e){return this.getResolutionForExtentInternal(ri(t,this.getProjection()),e)}getResolutionForExtentInternal(t,e){e=e||this.getViewportSizeMinusPadding_();const i=nt(t)/e[0],s=kt(t)/e[1];return Math.max(i,s)}getResolutionForValueFunction(t){t=t||2;const e=this.getConstrainedResolution(this.maxResolution_),i=this.minResolution_,s=Math.log(e/i)/Math.log(t);return function(r){return e/Math.pow(t,r*s)}}getRotation(){return this.get(oe.ROTATION)}getValueForResolutionFunction(t){const e=Math.log(t||2),i=this.getConstrainedResolution(this.maxResolution_),s=this.minResolution_,r=Math.log(i/s)/e;return function(o){return Math.log(i/o)/e/r}}getViewportSizeMinusPadding_(t){let e=this.getViewportSize_(t);const i=this.padding_;return i&&(e=[e[0]-i[1]-i[3],e[1]-i[0]-i[2]]),e}getState(){const t=this.getProjection(),e=this.getResolution(),i=this.getRotation();let s=this.getCenterInternal();const r=this.padding_;if(r){const o=this.getViewportSizeMinusPadding_();s=eo(s,this.getViewportSize_(),[o[0]/2+r[3],o[1]/2+r[0]],e,i)}return{center:s.slice(0),projection:t!==void 0?t:null,resolution:e,nextCenter:this.nextCenter_,nextResolution:this.nextResolution_,nextRotation:this.nextRotation_,rotation:i,zoom:this.getZoom()}}getViewStateAndExtent(){return{viewState:this.getState(),extent:this.calculateExtent()}}getZoom(){let t;const e=this.getResolution();return e!==void 0&&(t=this.getZoomForResolution(e)),t}getZoomForResolution(t){let e=this.minZoom_||0,i,s;if(this.resolutions_){const r=qo(this.resolutions_,t,1);e=r,i=this.resolutions_[r],r==this.resolutions_.length-1?s=2:s=i/this.resolutions_[r+1]}else i=this.maxResolution_,s=this.zoomFactor_;return e+Math.log(i/t)/Math.log(s)}getResolutionForZoom(t){var e;if((e=this.resolutions_)!=null&&e.length){if(this.resolutions_.length===1)return this.resolutions_[0];const i=mt(Math.floor(t),0,this.resolutions_.length-2),s=this.resolutions_[i]/this.resolutions_[i+1];return this.resolutions_[i]/Math.pow(s,mt(t-i,0,1))}return this.maxResolution_/Math.pow(this.zoomFactor_,t-this.minZoom_)}fit(t,e){let i;if($(Array.isArray(t)||typeof t.getSimplifiedGeometry=="function","Invalid extent or geometry provided as `geometry`"),Array.isArray(t)){$(!Tr(t),"Cannot fit empty extent provided as `geometry`");const s=ri(t,this.getProjection());i=Nl(s)}else if(t.getType()==="Circle"){const s=ri(t.getExtent(),this.getProjection());i=Nl(s),i.rotate(this.getRotation(),gi(s))}else i=t;this.fitInternal(i,e)}rotatedExtentForGeometry(t){const e=this.getRotation(),i=Math.cos(e),s=Math.sin(-e),r=t.getFlatCoordinates(),o=t.getStride();let a=1/0,l=1/0,h=-1/0,c=-1/0;for(let u=0,d=r.length;u<d;u+=o){const f=r[u]*i-r[u+1]*s,g=r[u]*s+r[u+1]*i;a=Math.min(a,f),l=Math.min(l,g),h=Math.max(h,f),c=Math.max(c,g)}return[a,l,h,c]}fitInternal(t,e){e=e||{};let i=e.size;i||(i=this.getViewportSizeMinusPadding_());const s=e.padding!==void 0?e.padding:[0,0,0,0],r=e.nearest!==void 0?e.nearest:!1;let o;e.minResolution!==void 0?o=e.minResolution:e.maxZoom!==void 0?o=this.getResolutionForZoom(e.maxZoom):o=0;const a=this.rotatedExtentForGeometry(t);let l=this.getResolutionForExtentInternal(a,[i[0]-s[1]-s[3],i[1]-s[0]-s[2]]);l=isNaN(l)?o:Math.max(l,o),l=this.getConstrainedResolution(l,r?0:1);const h=this.getRotation(),c=Math.sin(h),u=Math.cos(h),d=gi(a);d[0]+=(s[1]-s[3])/2*l,d[1]+=(s[0]-s[2])/2*l;const f=d[0]*u-d[1]*c,g=d[1]*u+d[0]*c,_=this.getConstrainedCenter([f,g],l),m=e.callback?e.callback:cn;e.duration!==void 0?this.animateInternal({resolution:l,center:_,duration:e.duration,easing:e.easing},m):(this.targetResolution_=l,this.targetCenter_=_,this.applyTargetState_(!1,!0),Es(m,!0))}centerOn(t,e,i){this.centerOnInternal(Ge(t,this.getProjection()),e,i)}centerOnInternal(t,e,i){this.setCenterInternal(eo(t,e,i,this.getResolution(),this.getRotation()))}calculateCenterShift(t,e,i,s){let r;const o=this.padding_;if(o&&t){const a=this.getViewportSizeMinusPadding_(-i),l=eo(t,s,[a[0]/2+o[3],a[1]/2+o[0]],e,i);r=[t[0]-l[0],t[1]-l[1]]}return r}isDef(){return!!this.getCenterInternal()&&this.getResolution()!==void 0}adjustCenter(t){const e=bo(this.targetCenter_,this.getProjection());this.setCenter([e[0]+t[0],e[1]+t[1]])}adjustCenterInternal(t){const e=this.targetCenter_;this.setCenterInternal([e[0]+t[0],e[1]+t[1]])}adjustResolution(t,e){e=e&&Ge(e,this.getProjection()),this.adjustResolutionInternal(t,e)}adjustResolutionInternal(t,e){const i=this.getAnimating()||this.getInteracting(),s=this.getViewportSize_(this.getRotation()),r=this.constraints_.resolution(this.targetResolution_*t,0,s,i);e&&(this.targetCenter_=this.calculateCenterZoom(r,e)),this.targetResolution_*=t,this.applyTargetState_()}adjustZoom(t,e){this.adjustResolution(Math.pow(this.zoomFactor_,-t),e)}adjustRotation(t,e){e&&(e=Ge(e,this.getProjection())),this.adjustRotationInternal(t,e)}adjustRotationInternal(t,e){const i=this.getAnimating()||this.getInteracting(),s=this.constraints_.rotation(this.targetRotation_+t,i);e&&(this.targetCenter_=this.calculateCenterRotate(s,e)),this.targetRotation_+=t,this.applyTargetState_()}setCenter(t){this.setCenterInternal(t&&Ge(t,this.getProjection()))}setCenterInternal(t){this.targetCenter_=t,this.applyTargetState_()}setHint(t,e){return this.hints_[t]+=e,this.changed(),this.hints_[t]}setResolution(t){this.targetResolution_=t,this.applyTargetState_()}setRotation(t){this.targetRotation_=t,this.applyTargetState_()}setZoom(t){this.setResolution(this.getResolutionForZoom(t))}applyTargetState_(t,e){const i=this.getAnimating()||this.getInteracting()||e,s=this.constraints_.rotation(this.targetRotation_,i),r=this.getViewportSize_(s),o=this.constraints_.resolution(this.targetResolution_,0,r,i),a=this.constraints_.center(this.targetCenter_,o,r,i,this.calculateCenterShift(this.targetCenter_,o,s,r));this.get(oe.ROTATION)!==s&&this.set(oe.ROTATION,s),this.get(oe.RESOLUTION)!==o&&(this.set(oe.RESOLUTION,o),this.set("zoom",this.getZoom(),!0)),(!a||!this.get(oe.CENTER)||!Zs(this.get(oe.CENTER),a))&&this.set(oe.CENTER,a),this.getAnimating()&&!t&&this.cancelAnimations(),this.cancelAnchor_=void 0}resolveConstraints(t,e,i){t=t!==void 0?t:200;const s=e||0,r=this.constraints_.rotation(this.targetRotation_),o=this.getViewportSize_(r),a=this.constraints_.resolution(this.targetResolution_,s,o),l=this.constraints_.center(this.targetCenter_,a,o,!1,this.calculateCenterShift(this.targetCenter_,a,r,o));if(t===0&&!this.cancelAnchor_){this.targetResolution_=a,this.targetRotation_=r,this.targetCenter_=l,this.applyTargetState_();return}i=i||(t===0?this.cancelAnchor_:void 0),this.cancelAnchor_=void 0,(this.getResolution()!==a||this.getRotation()!==r||!this.getCenterInternal()||!Zs(this.getCenterInternal(),l))&&(this.getAnimating()&&this.cancelAnimations(),this.animateInternal({rotation:r,center:l,resolution:a,duration:t,easing:xn,anchor:i}))}beginInteraction(){this.resolveConstraints(0),this.setHint(Lt.INTERACTING,1)}endInteraction(t,e,i){i=i&&Ge(i,this.getProjection()),this.endInteractionInternal(t,e,i)}endInteractionInternal(t,e,i){this.getInteracting()&&(this.setHint(Lt.INTERACTING,-1),this.resolveConstraints(t,e,i))}getConstrainedCenter(t,e){const i=this.getViewportSize_(this.getRotation());return this.constraints_.center(t,e||this.getResolution(),i)}getConstrainedZoom(t,e){const i=this.getResolutionForZoom(t);return this.getZoomForResolution(this.getConstrainedResolution(i,e))}getConstrainedResolution(t,e){e=e||0;const i=this.getViewportSize_(this.getRotation());return this.constraints_.resolution(t,e,i)}}function Es(n,t){setTimeout(function(){n(t)},0)}function l_(n){if(n.extent!==void 0){const e=n.smoothExtentConstraint!==void 0?n.smoothExtentConstraint:!0;return Ol(n.extent,n.constrainOnlyCenter,e)}const t=la(n.projection,"EPSG:3857");if(n.multiWorld!==!0&&t.isGlobal()){const e=t.getExtent().slice();return e[0]=-1/0,e[2]=1/0,Ol(e,!1,!1)}return Kg}function h_(n){let t,e,i,o=n.minZoom!==void 0?n.minZoom:to,a=n.maxZoom!==void 0?n.maxZoom:28;const l=n.zoomFactor!==void 0?n.zoomFactor:2,h=n.multiWorld!==void 0?n.multiWorld:!1,c=n.smoothResolutionConstraint!==void 0?n.smoothResolutionConstraint:!0,u=n.showFullExtent!==void 0?n.showFullExtent:!1,d=la(n.projection,"EPSG:3857"),f=d.getExtent();let g=n.constrainOnlyCenter,_=n.extent;if(!h&&!_&&d.isGlobal()&&(g=!1,_=f),n.resolutions!==void 0){const m=n.resolutions;e=m[o],i=m[a]!==void 0?m[a]:m[m.length-1],n.constrainResolution?t=s_(m,c,!g&&_,u):t=Gl(e,i,c,!g&&_,u)}else{const p=(f?Math.max(nt(f),kt(f)):360*na.degrees/d.getMetersPerUnit())/fa/Math.pow(2,to),y=p/Math.pow(2,28-to);e=n.maxResolution,e!==void 0?o=0:e=p/Math.pow(l,o),i=n.minResolution,i===void 0&&(n.maxZoom!==void 0?n.maxResolution!==void 0?i=e/Math.pow(l,a):i=p/Math.pow(l,a):i=y),a=o+Math.floor(Math.log(e/i)/Math.log(l)),i=e/Math.pow(l,a-o),n.constrainResolution?t=r_(l,e,i,c,!g&&_,u):t=Gl(e,i,c,!g&&_,u)}return{constraint:t,maxResolution:e,minResolution:i,minZoom:o,zoomFactor:l}}function c_(n){if(n.enableRotation!==void 0?n.enableRotation:!0){const e=n.constrainRotation;return e===void 0||e===!0?a_():e===!1?zl:typeof e=="number"?o_(e):zl}return Ta}function u_(n){return!(n.sourceCenter&&n.targetCenter&&!Zs(n.sourceCenter,n.targetCenter)||n.sourceResolution!==n.targetResolution||n.sourceRotation!==n.targetRotation)}function eo(n,t,e,i,s){const r=Math.cos(-s);let o=Math.sin(-s),a=n[0]*r-n[1]*o,l=n[1]*r+n[0]*o;a+=(t[0]/2-e[0])*i,l+=(e[1]-t[1]/2)*i,o=-o;const h=a*r-l*o,c=l*r+a*o;return[h,c]}const it={OPACITY:"opacity",VISIBLE:"visible",EXTENT:"extent",Z_INDEX:"zIndex",MAX_RESOLUTION:"maxResolution",MIN_RESOLUTION:"minResolution",MAX_ZOOM:"maxZoom",MIN_ZOOM:"minZoom",SOURCE:"source",MAP:"map"};class Gc extends Ae{constructor(t){super(),this.on,this.once,this.un,this.background_=t.background;const e=Object.assign({},t);typeof t.properties=="object"&&(delete e.properties,Object.assign(e,t.properties)),e[it.OPACITY]=t.opacity!==void 0?t.opacity:1,$(typeof e[it.OPACITY]=="number","Layer opacity must be a number"),e[it.VISIBLE]=t.visible!==void 0?t.visible:!0,e[it.Z_INDEX]=t.zIndex,e[it.MAX_RESOLUTION]=t.maxResolution!==void 0?t.maxResolution:1/0,e[it.MIN_RESOLUTION]=t.minResolution!==void 0?t.minResolution:0,e[it.MIN_ZOOM]=t.minZoom!==void 0?t.minZoom:-1/0,e[it.MAX_ZOOM]=t.maxZoom!==void 0?t.maxZoom:1/0,this.className_=e.className!==void 0?e.className:"ol-layer",delete e.className,this.setProperties(e),this.state_=null}getBackground(){return this.background_}getClassName(){return this.className_}getLayerState(t){const e=this.state_||{layer:this,managed:t===void 0?!0:t},i=this.getZIndex();return e.opacity=mt(Math.round(this.getOpacity()*100)/100,0,1),e.visible=this.getVisible(),e.extent=this.getExtent(),e.zIndex=i===void 0&&!e.managed?1/0:i,e.maxResolution=this.getMaxResolution(),e.minResolution=Math.max(this.getMinResolution(),0),e.minZoom=this.getMinZoom(),e.maxZoom=this.getMaxZoom(),this.state_=e,e}getLayersArray(t){return G()}getLayerStatesArray(t){return G()}getExtent(){return this.get(it.EXTENT)}getMaxResolution(){return this.get(it.MAX_RESOLUTION)}getMinResolution(){return this.get(it.MIN_RESOLUTION)}getMinZoom(){return this.get(it.MIN_ZOOM)}getMaxZoom(){return this.get(it.MAX_ZOOM)}getOpacity(){return this.get(it.OPACITY)}getSourceState(){return G()}getVisible(){return this.get(it.VISIBLE)}getZIndex(){return this.get(it.Z_INDEX)}setBackground(t){this.background_=t,this.changed()}setExtent(t){this.set(it.EXTENT,t)}setMaxResolution(t){this.set(it.MAX_RESOLUTION,t)}setMinResolution(t){this.set(it.MIN_RESOLUTION,t)}setMaxZoom(t){this.set(it.MAX_ZOOM,t)}setMinZoom(t){this.set(it.MIN_ZOOM,t)}setOpacity(t){$(typeof t=="number","Layer opacity must be a number"),this.set(it.OPACITY,t)}setVisible(t){this.set(it.VISIBLE,t)}setZIndex(t){this.set(it.Z_INDEX,t)}disposeInternal(){this.state_&&(this.state_.layer=null,this.state_=null),super.disposeInternal()}}class Or extends Gc{constructor(t){const e=Object.assign({},t);delete e.source,super(e),this.on,this.once,this.un,this.mapPrecomposeKey_=null,this.mapRenderKey_=null,this.sourceChangeKey_=null,this.renderer_=null,this.sourceReady_=!1,this.rendered=!1,t.render&&(this.render=t.render),t.map&&this.setMap(t.map),this.addChangeListener(it.SOURCE,this.handleSourcePropertyChange_);const i=t.source?t.source:null;this.setSource(i)}getLayersArray(t){return t=t||[],t.push(this),t}getLayerStatesArray(t){return t=t||[],t.push(this.getLayerState()),t}getSource(){return this.get(it.SOURCE)||null}getRenderSource(){return this.getSource()}getSourceState(){const t=this.getSource();return t?t.getState():"undefined"}handleSourceChange_(){this.changed(),!(this.sourceReady_||this.getSource().getState()!=="ready")&&(this.sourceReady_=!0,this.dispatchEvent("sourceready"))}handleSourcePropertyChange_(){this.sourceChangeKey_&&(at(this.sourceChangeKey_),this.sourceChangeKey_=null),this.sourceReady_=!1;const t=this.getSource();t&&(this.sourceChangeKey_=q(t,j.CHANGE,this.handleSourceChange_,this),t.getState()==="ready"&&(this.sourceReady_=!0,setTimeout(()=>{this.dispatchEvent("sourceready")},0)),this.clearRenderer()),this.changed()}getFeatures(t){return this.renderer_?this.renderer_.getFeatures(t):Promise.resolve([])}getData(t){return!this.renderer_||!this.rendered?null:this.renderer_.getData(t)}isVisible(t){let e;const i=this.getMapInternal();!t&&i&&(t=i.getView()),t instanceof we?e={viewState:t.getState(),extent:t.calculateExtent()}:e=t,!e.layerStatesArray&&i&&(e.layerStatesArray=i.getLayerGroup().getLayerStatesArray());let s;if(e.layerStatesArray){if(s=e.layerStatesArray.find(o=>o.layer===this),!s)return!1}else s=this.getLayerState();const r=this.getExtent();return ba(s,e.viewState)&&(!r||Bt(r,e.extent))}getAttributions(t){var r;if(!this.isVisible(t))return[];const e=(r=this.getSource())==null?void 0:r.getAttributions();if(!e)return[];const i=t instanceof we?t.getViewStateAndExtent():t;let s=e(i);return Array.isArray(s)||(s=[s]),s}render(t,e){const i=this.getRenderer();return i.prepareFrame(t)?(this.rendered=!0,i.renderFrame(t,e)):null}unrender(){this.rendered=!1}getDeclutter(){}renderDeclutter(t,e){}renderDeferred(t){const e=this.getRenderer();e&&e.renderDeferred(t)}setMapInternal(t){t||this.unrender(),this.set(it.MAP,t)}getMapInternal(){return this.get(it.MAP)}setMap(t){this.mapPrecomposeKey_&&(at(this.mapPrecomposeKey_),this.mapPrecomposeKey_=null),t||this.changed(),this.mapRenderKey_&&(at(this.mapRenderKey_),this.mapRenderKey_=null),t&&(this.mapPrecomposeKey_=q(t,ie.PRECOMPOSE,this.handlePrecompose_,this),this.mapRenderKey_=q(this,j.CHANGE,t.render,t),this.changed())}handlePrecompose_(t){const e=t.frameState.layerStatesArray,i=this.getLayerState(!1);$(!e.some(s=>s.layer===i.layer),"A layer can only be added to the map once. Use either `layer.setMap()` or `map.addLayer()`, not both."),e.push(i)}setSource(t){this.set(it.SOURCE,t)}getRenderer(){return this.renderer_||(this.renderer_=this.createRenderer()),this.renderer_}hasRenderer(){return!!this.renderer_}createRenderer(){return null}clearRenderer(){this.renderer_&&(this.renderer_.dispose(),delete this.renderer_)}disposeInternal(){this.clearRenderer(),this.setSource(null),super.disposeInternal()}}function ba(n,t){if(!n.visible)return!1;const e=t.resolution;if(e<n.minResolution||e>=n.maxResolution)return!1;const i=t.zoom;return i>n.minZoom&&i<=n.maxZoom}const Cs={PRELOAD:"preload",USE_INTERIM_TILES_ON_ERROR:"useInterimTilesOnError"};class d_ extends Or{constructor(t){t=t||{};const e=Object.assign({},t),i=t.cacheSize;delete t.cacheSize,delete e.preload,delete e.useInterimTilesOnError,super(e),this.on,this.once,this.un,this.cacheSize_=i,this.setPreload(t.preload!==void 0?t.preload:0),this.setUseInterimTilesOnError(t.useInterimTilesOnError!==void 0?t.useInterimTilesOnError:!0)}getCacheSize(){return this.cacheSize_}getPreload(){return this.get(Cs.PRELOAD)}setPreload(t){this.set(Cs.PRELOAD,t)}getUseInterimTilesOnError(){return this.get(Cs.USE_INTERIM_TILES_ON_ERROR)}setUseInterimTilesOnError(t){this.set(Cs.USE_INTERIM_TILES_ON_ERROR,t)}getData(t){return super.getData(t)}}class f_ extends d_{constructor(t){super(t)}createRenderer(){return new Bg(this,{cacheSize:this.getCacheSize()})}}const Yt={ADD:"add",REMOVE:"remove"},Xl={LENGTH:"length"};class Rs extends Ve{constructor(t,e,i){super(t),this.element=e,this.index=i}}class Re extends Ae{constructor(t,e){if(super(),this.on,this.once,this.un,e=e||{},this.unique_=!!e.unique,this.array_=t||[],this.unique_)for(let i=0,s=this.array_.length;i<s;++i)this.assertUnique_(this.array_[i],i);this.updateLength_()}clear(){for(;this.getLength()>0;)this.pop()}extend(t){for(let e=0,i=t.length;e<i;++e)this.push(t[e]);return this}forEach(t){const e=this.array_;for(let i=0,s=e.length;i<s;++i)t(e[i],i,e)}getArray(){return this.array_}item(t){return this.array_[t]}getLength(){return this.get(Xl.LENGTH)}insertAt(t,e){if(t<0||t>this.getLength())throw new Error("Index out of bounds: "+t);this.unique_&&this.assertUnique_(e),this.array_.splice(t,0,e),this.updateLength_(),this.dispatchEvent(new Rs(Yt.ADD,e,t))}pop(){return this.removeAt(this.getLength()-1)}push(t){this.unique_&&this.assertUnique_(t);const e=this.getLength();return this.insertAt(e,t),this.getLength()}remove(t){const e=this.array_;for(let i=0,s=e.length;i<s;++i)if(e[i]===t)return this.removeAt(i)}removeAt(t){if(t<0||t>=this.getLength())return;const e=this.array_[t];return this.array_.splice(t,1),this.updateLength_(),this.dispatchEvent(new Rs(Yt.REMOVE,e,t)),e}setAt(t,e){const i=this.getLength();if(t>=i){this.insertAt(t,e);return}if(t<0)throw new Error("Index out of bounds: "+t);this.unique_&&this.assertUnique_(e,t);const s=this.array_[t];this.array_[t]=e,this.dispatchEvent(new Rs(Yt.REMOVE,s,t)),this.dispatchEvent(new Rs(Yt.ADD,e,t))}updateLength_(){this.set(Xl.LENGTH,this.array_.length)}assertUnique_(t,e){for(let i=0,s=this.array_.length;i<s;++i)if(this.array_[i]===t&&i!==e)throw new Error("Duplicate item added to a unique collection")}}class Ji extends Ve{constructor(t,e,i){super(t),this.map=e,this.frameState=i!==void 0?i:null}}class ei extends Ji{constructor(t,e,i,s,r,o){super(t,e,r),this.originalEvent=i,this.pixel_=null,this.coordinate_=null,this.dragging=s!==void 0?s:!1,this.activePointers=o}get pixel(){return this.pixel_||(this.pixel_=this.map.getEventPixel(this.originalEvent)),this.pixel_}set pixel(t){this.pixel_=t}get coordinate(){return this.coordinate_||(this.coordinate_=this.map.getCoordinateFromPixel(this.pixel)),this.coordinate_}set coordinate(t){this.coordinate_=t}preventDefault(){super.preventDefault(),"preventDefault"in this.originalEvent&&this.originalEvent.preventDefault()}stopPropagation(){super.stopPropagation(),"stopPropagation"in this.originalEvent&&this.originalEvent.stopPropagation()}}const ut={SINGLECLICK:"singleclick",CLICK:j.CLICK,DBLCLICK:j.DBLCLICK,POINTERDRAG:"pointerdrag",POINTERMOVE:"pointermove",POINTERDOWN:"pointerdown",POINTERUP:"pointerup",POINTEROVER:"pointerover",POINTEROUT:"pointerout",POINTERENTER:"pointerenter",POINTERLEAVE:"pointerleave",POINTERCANCEL:"pointercancel"},Po={POINTERMOVE:"pointermove",POINTERDOWN:"pointerdown"};class g_ extends wr{constructor(t,e){super(t),this.map_=t,this.clickTimeoutId_,this.emulateClicks_=!1,this.dragging_=!1,this.dragListenerKeys_=[],this.moveTolerance_=e===void 0?1:e,this.down_=null;const i=this.map_.getViewport();this.activePointers_=[],this.trackedTouches_={},this.element_=i,this.pointerdownListenerKey_=q(i,Po.POINTERDOWN,this.handlePointerDown_,this),this.originalPointerMoveEvent_,this.relayedListenerKey_=q(i,Po.POINTERMOVE,this.relayMoveEvent_,this),this.boundHandleTouchMove_=this.handleTouchMove_.bind(this),this.element_.addEventListener(j.TOUCHMOVE,this.boundHandleTouchMove_,Zh?{passive:!1}:!1)}emulateClick_(t){let e=new ei(ut.CLICK,this.map_,t);this.dispatchEvent(e),this.clickTimeoutId_!==void 0?(clearTimeout(this.clickTimeoutId_),this.clickTimeoutId_=void 0,e=new ei(ut.DBLCLICK,this.map_,t),this.dispatchEvent(e)):this.clickTimeoutId_=setTimeout(()=>{this.clickTimeoutId_=void 0;const i=new ei(ut.SINGLECLICK,this.map_,t);this.dispatchEvent(i)},250)}updateActivePointers_(t){const e=t,i=e.pointerId;if(e.type==ut.POINTERUP||e.type==ut.POINTERCANCEL){delete this.trackedTouches_[i];for(const s in this.trackedTouches_)if(this.trackedTouches_[s].target!==e.target){delete this.trackedTouches_[s];break}}else(e.type==ut.POINTERDOWN||e.type==ut.POINTERMOVE)&&(this.trackedTouches_[i]=e);this.activePointers_=Object.values(this.trackedTouches_)}handlePointerUp_(t){this.updateActivePointers_(t);const e=new ei(ut.POINTERUP,this.map_,t,void 0,void 0,this.activePointers_);this.dispatchEvent(e),this.emulateClicks_&&!e.defaultPrevented&&!this.dragging_&&this.isMouseActionButton_(t)&&this.emulateClick_(this.down_),this.activePointers_.length===0&&(this.dragListenerKeys_.forEach(at),this.dragListenerKeys_.length=0,this.dragging_=!1,this.down_=null)}isMouseActionButton_(t){return t.button===0}handlePointerDown_(t){this.emulateClicks_=this.activePointers_.length===0,this.updateActivePointers_(t);const e=new ei(ut.POINTERDOWN,this.map_,t,void 0,void 0,this.activePointers_);if(this.dispatchEvent(e),this.down_=new PointerEvent(t.type,t),Object.defineProperty(this.down_,"target",{writable:!1,value:t.target}),this.dragListenerKeys_.length===0){const i=this.map_.getOwnerDocument();this.dragListenerKeys_.push(q(i,ut.POINTERMOVE,this.handlePointerMove_,this),q(i,ut.POINTERUP,this.handlePointerUp_,this),q(this.element_,ut.POINTERCANCEL,this.handlePointerUp_,this)),this.element_.getRootNode&&this.element_.getRootNode()!==i&&this.dragListenerKeys_.push(q(this.element_.getRootNode(),ut.POINTERUP,this.handlePointerUp_,this))}}handlePointerMove_(t){if(this.isMoving_(t)){this.updateActivePointers_(t),this.dragging_=!0;const e=new ei(ut.POINTERDRAG,this.map_,t,this.dragging_,void 0,this.activePointers_);this.dispatchEvent(e)}}relayMoveEvent_(t){this.originalPointerMoveEvent_=t;const e=!!(this.down_&&this.isMoving_(t));this.dispatchEvent(new ei(ut.POINTERMOVE,this.map_,t,e))}handleTouchMove_(t){const e=this.originalPointerMoveEvent_;(!e||e.defaultPrevented)&&(typeof t.cancelable!="boolean"||t.cancelable===!0)&&t.preventDefault()}isMoving_(t){return this.dragging_||Math.abs(t.clientX-this.down_.clientX)>this.moveTolerance_||Math.abs(t.clientY-this.down_.clientY)>this.moveTolerance_}disposeInternal(){this.relayedListenerKey_&&(at(this.relayedListenerKey_),this.relayedListenerKey_=null),this.element_.removeEventListener(j.TOUCHMOVE,this.boundHandleTouchMove_),this.pointerdownListenerKey_&&(at(this.pointerdownListenerKey_),this.pointerdownListenerKey_=null),this.dragListenerKeys_.forEach(at),this.dragListenerKeys_.length=0,this.element_=null,super.disposeInternal()}}const ii={POSTRENDER:"postrender",MOVESTART:"movestart",MOVEEND:"moveend",LOADSTART:"loadstart",LOADEND:"loadend"},At={LAYERGROUP:"layergroup",SIZE:"size",TARGET:"target",VIEW:"view"},Js=1/0;class __{constructor(t,e){this.priorityFunction_=t,this.keyFunction_=e,this.elements_=[],this.priorities_=[],this.queuedElements_={}}clear(){this.elements_.length=0,this.priorities_.length=0,ss(this.queuedElements_)}dequeue(){const t=this.elements_,e=this.priorities_,i=t[0];t.length==1?(t.length=0,e.length=0):(t[0]=t.pop(),e[0]=e.pop(),this.siftUp_(0));const s=this.keyFunction_(i);return delete this.queuedElements_[s],i}enqueue(t){$(!(this.keyFunction_(t)in this.queuedElements_),"Tried to enqueue an `element` that was already added to the queue");const e=this.priorityFunction_(t);return e!=Js?(this.elements_.push(t),this.priorities_.push(e),this.queuedElements_[this.keyFunction_(t)]=!0,this.siftDown_(0,this.elements_.length-1),!0):!1}getCount(){return this.elements_.length}getLeftChildIndex_(t){return t*2+1}getRightChildIndex_(t){return t*2+2}getParentIndex_(t){return t-1>>1}heapify_(){let t;for(t=(this.elements_.length>>1)-1;t>=0;t--)this.siftUp_(t)}isEmpty(){return this.elements_.length===0}isKeyQueued(t){return t in this.queuedElements_}isQueued(t){return this.isKeyQueued(this.keyFunction_(t))}siftUp_(t){const e=this.elements_,i=this.priorities_,s=e.length,r=e[t],o=i[t],a=t;for(;t<s>>1;){const l=this.getLeftChildIndex_(t),h=this.getRightChildIndex_(t),c=h<s&&i[h]<i[l]?h:l;e[t]=e[c],i[t]=i[c],t=c}e[t]=r,i[t]=o,this.siftDown_(a,t)}siftDown_(t,e){const i=this.elements_,s=this.priorities_,r=i[e],o=s[e];for(;e>t;){const a=this.getParentIndex_(e);if(s[a]>o)i[e]=i[a],s[e]=s[a],e=a;else break}i[e]=r,s[e]=o}reprioritize(){const t=this.priorityFunction_,e=this.elements_,i=this.priorities_;let s=0;const r=e.length;let o,a,l;for(a=0;a<r;++a)o=e[a],l=t(o),l==Js?delete this.queuedElements_[this.keyFunction_(o)]:(i[s]=l,e[s++]=o);e.length=s,i.length=s,this.heapify_()}}class m_ extends __{constructor(t,e){super(i=>t.apply(null,i),i=>i[0].getKey()),this.boundHandleTileChange_=this.handleTileChange.bind(this),this.tileChangeCallback_=e,this.tilesLoading_=0,this.tilesLoadingKeys_={}}enqueue(t){const e=super.enqueue(t);return e&&t[0].addEventListener(j.CHANGE,this.boundHandleTileChange_),e}getTilesLoading(){return this.tilesLoading_}handleTileChange(t){const e=t.target,i=e.getState();if(i===O.LOADED||i===O.ERROR||i===O.EMPTY){i!==O.ERROR&&e.removeEventListener(j.CHANGE,this.boundHandleTileChange_);const s=e.getKey();s in this.tilesLoadingKeys_&&(delete this.tilesLoadingKeys_[s],--this.tilesLoading_),this.tileChangeCallback_()}}loadMoreTiles(t,e){let i=0;for(;this.tilesLoading_<t&&i<e&&this.getCount()>0;){const s=this.dequeue()[0],r=s.getKey();s.getState()===O.IDLE&&!(r in this.tilesLoadingKeys_)&&(this.tilesLoadingKeys_[r]=!0,++this.tilesLoading_,++i,s.load())}}}function p_(n,t,e,i,s){if(!n||!(e in n.wantedTiles)||!n.wantedTiles[e][t.getKey()])return Js;const r=n.viewState.center,o=i[0]-r[0],a=i[1]-r[1];return 65536*Math.log(s)+Math.sqrt(o*o+a*a)/s}class Ma extends Ae{constructor(t){super();const e=t.element;e&&!t.target&&!e.style.pointerEvents&&(e.style.pointerEvents="auto"),this.element=e||null,this.target_=null,this.map_=null,this.listenerKeys=[],t.render&&(this.render=t.render),t.target&&this.setTarget(t.target)}disposeInternal(){var t;(t=this.element)==null||t.remove(),super.disposeInternal()}getMap(){return this.map_}setMap(t){var e;this.map_&&((e=this.element)==null||e.remove());for(let i=0,s=this.listenerKeys.length;i<s;++i)at(this.listenerKeys[i]);if(this.listenerKeys.length=0,this.map_=t,t){const i=this.target_??t.getOverlayContainerStopEvent();this.element&&i.appendChild(this.element),this.render!==cn&&this.listenerKeys.push(q(t,ii.POSTRENDER,this.render,this)),t.render()}}render(t){}setTarget(t){this.target_=typeof t=="string"?document.getElementById(t):t}}class y_ extends Ma{constructor(t){t=t||{},super({element:document.createElement("div"),render:t.render,target:t.target}),this.ulElement_=document.createElement("ul"),this.collapsed_=t.collapsed!==void 0?t.collapsed:!0,this.userCollapsed_=this.collapsed_,this.overrideCollapsible_=t.collapsible!==void 0,this.collapsible_=t.collapsible!==void 0?t.collapsible:!0,this.collapsible_||(this.collapsed_=!1),this.attributions_=t.attributions;const e=t.className!==void 0?t.className:"ol-attribution",i=t.tipLabel!==void 0?t.tipLabel:"Attributions",s=t.expandClassName!==void 0?t.expandClassName:e+"-expand",r=t.collapseLabel!==void 0?t.collapseLabel:"›",o=t.collapseClassName!==void 0?t.collapseClassName:e+"-collapse";typeof r=="string"?(this.collapseLabel_=document.createElement("span"),this.collapseLabel_.textContent=r,this.collapseLabel_.className=o):this.collapseLabel_=r;const a=t.label!==void 0?t.label:"i";typeof a=="string"?(this.label_=document.createElement("span"),this.label_.textContent=a,this.label_.className=s):this.label_=a;const l=this.collapsible_&&!this.collapsed_?this.collapseLabel_:this.label_;this.toggleButton_=document.createElement("button"),this.toggleButton_.setAttribute("type","button"),this.toggleButton_.setAttribute("aria-expanded",String(!this.collapsed_)),this.toggleButton_.title=i,this.toggleButton_.appendChild(l),this.toggleButton_.addEventListener(j.CLICK,this.handleClick_.bind(this),!1);const h=e+" "+Er+" "+Jo+(this.collapsed_&&this.collapsible_?" "+hl:"")+(this.collapsible_?"":" ol-uncollapsible"),c=this.element;c.className=h,c.appendChild(this.toggleButton_),c.appendChild(this.ulElement_),this.renderedAttributions_=[],this.renderedVisible_=!0}collectSourceAttributions_(t){const e=this.getMap().getAllLayers(),i=new Set(e.flatMap(s=>s.getAttributions(t)));if(this.attributions_!==void 0&&(Array.isArray(this.attributions_)?this.attributions_.forEach(s=>i.add(s)):i.add(this.attributions_)),!this.overrideCollapsible_){const s=!e.some(r=>{var o;return((o=r.getSource())==null?void 0:o.getAttributionsCollapsible())===!1});this.setCollapsible(s)}return Array.from(i)}async updateElement_(t){if(!t){this.renderedVisible_&&(this.element.style.display="none",this.renderedVisible_=!1);return}const e=await Promise.all(this.collectSourceAttributions_(t).map(s=>Jd(()=>s))),i=e.length>0;if(this.renderedVisible_!=i&&(this.element.style.display=i?"":"none",this.renderedVisible_=i),!mi(e,this.renderedAttributions_)){Ud(this.ulElement_);for(let s=0,r=e.length;s<r;++s){const o=document.createElement("li");o.innerHTML=e[s],this.ulElement_.appendChild(o)}this.renderedAttributions_=e}}handleClick_(t){t.preventDefault(),this.handleToggle_(),this.userCollapsed_=this.collapsed_}handleToggle_(){this.element.classList.toggle(hl),this.collapsed_?al(this.collapseLabel_,this.label_):al(this.label_,this.collapseLabel_),this.collapsed_=!this.collapsed_,this.toggleButton_.setAttribute("aria-expanded",String(!this.collapsed_))}getCollapsible(){return this.collapsible_}setCollapsible(t){this.collapsible_!==t&&(this.collapsible_=t,this.element.classList.toggle("ol-uncollapsible"),this.userCollapsed_&&this.handleToggle_())}setCollapsed(t){this.userCollapsed_=t,!(!this.collapsible_||this.collapsed_===t)&&this.handleToggle_()}getCollapsed(){return this.collapsed_}render(t){this.updateElement_(t.frameState)}}class v_ extends Ma{constructor(t){t=t||{},super({element:document.createElement("div"),render:t.render,target:t.target});const e=t.className!==void 0?t.className:"ol-rotate",i=t.label!==void 0?t.label:"⇧",s=t.compassClassName!==void 0?t.compassClassName:"ol-compass";this.label_=null,typeof i=="string"?(this.label_=document.createElement("span"),this.label_.className=s,this.label_.textContent=i):(this.label_=i,this.label_.classList.add(s));const r=t.tipLabel?t.tipLabel:"Reset rotation",o=document.createElement("button");o.className=e+"-reset",o.setAttribute("type","button"),o.title=r,o.appendChild(this.label_),o.addEventListener(j.CLICK,this.handleClick_.bind(this),!1);const a=e+" "+Er+" "+Jo,l=this.element;l.className=a,l.appendChild(o),this.callResetNorth_=t.resetNorth?t.resetNorth:void 0,this.duration_=t.duration!==void 0?t.duration:250,this.autoHide_=t.autoHide!==void 0?t.autoHide:!0,this.rotation_=void 0,this.autoHide_&&this.element.classList.add(xs)}handleClick_(t){t.preventDefault(),this.callResetNorth_!==void 0?this.callResetNorth_():this.resetNorth_()}resetNorth_(){const e=this.getMap().getView();if(!e)return;const i=e.getRotation();i!==void 0&&(this.duration_>0&&i%(2*Math.PI)!==0?e.animate({rotation:0,duration:this.duration_,easing:xn}):e.setRotation(0))}render(t){const e=t.frameState;if(!e)return;const i=e.viewState.rotation;if(i!=this.rotation_){const s="rotate("+i+"rad)";if(this.autoHide_){const r=this.element.classList.contains(xs);!r&&i===0?this.element.classList.add(xs):r&&i!==0&&this.element.classList.remove(xs)}this.label_.style.transform=s}this.rotation_=i}}class x_ extends Ma{constructor(t){t=t||{},super({element:document.createElement("div"),target:t.target});const e=t.className!==void 0?t.className:"ol-zoom",i=t.delta!==void 0?t.delta:1,s=t.zoomInClassName!==void 0?t.zoomInClassName:e+"-in",r=t.zoomOutClassName!==void 0?t.zoomOutClassName:e+"-out",o=t.zoomInLabel!==void 0?t.zoomInLabel:"+",a=t.zoomOutLabel!==void 0?t.zoomOutLabel:"–",l=t.zoomInTipLabel!==void 0?t.zoomInTipLabel:"Zoom in",h=t.zoomOutTipLabel!==void 0?t.zoomOutTipLabel:"Zoom out",c=document.createElement("button");c.className=s,c.setAttribute("type","button"),c.title=l,c.appendChild(typeof o=="string"?document.createTextNode(o):o),c.addEventListener(j.CLICK,this.handleClick_.bind(this,i),!1);const u=document.createElement("button");u.className=r,u.setAttribute("type","button"),u.title=h,u.appendChild(typeof a=="string"?document.createTextNode(a):a),u.addEventListener(j.CLICK,this.handleClick_.bind(this,-i),!1);const d=e+" "+Er+" "+Jo,f=this.element;f.className=d,f.appendChild(c),f.appendChild(u),this.duration_=t.duration!==void 0?t.duration:250}handleClick_(t,e){e.preventDefault(),this.zoomByDelta_(t)}zoomByDelta_(t){const i=this.getMap().getView();if(!i)return;const s=i.getZoom();if(s!==void 0){const r=i.getConstrainedZoom(s+t);this.duration_>0?(i.getAnimating()&&i.cancelAnimations(),i.animate({zoom:r,duration:this.duration_,easing:xn})):i.setZoom(r)}}}function w_(n){n=n||{};const t=new Re;return(n.zoom!==void 0?n.zoom:!0)&&t.push(new x_(n.zoomOptions)),(n.rotate!==void 0?n.rotate:!0)&&t.push(new v_(n.rotateOptions)),(n.attribution!==void 0?n.attribution:!0)&&t.push(new y_(n.attributionOptions)),t}class E_{constructor(t,e,i){this.decay_=t,this.minVelocity_=e,this.delay_=i,this.points_=[],this.angle_=0,this.initialVelocity_=0}begin(){this.points_.length=0,this.angle_=0,this.initialVelocity_=0}update(t,e){this.points_.push(t,e,Date.now())}end(){if(this.points_.length<6)return!1;const t=Date.now()-this.delay_,e=this.points_.length-3;if(this.points_[e+2]<t)return!1;let i=e-3;for(;i>0&&this.points_[i+2]>t;)i-=3;const s=this.points_[e+2]-this.points_[i+2];if(s<1e3/60)return!1;const r=this.points_[e]-this.points_[i],o=this.points_[e+1]-this.points_[i+1];return this.angle_=Math.atan2(o,r),this.initialVelocity_=Math.sqrt(r*r+o*o)/s,this.initialVelocity_>this.minVelocity_}getDistance(){return(this.minVelocity_-this.initialVelocity_)/this.decay_}getAngle(){return this.angle_}}const Wl={ACTIVE:"active"};class cs extends Ae{constructor(t){super(),this.on,this.once,this.un,t&&t.handleEvent&&(this.handleEvent=t.handleEvent),this.map_=null,this.setActive(!0)}getActive(){return this.get(Wl.ACTIVE)}getMap(){return this.map_}handleEvent(t){return!0}setActive(t){this.set(Wl.ACTIVE,t)}setMap(t){this.map_=t}}function C_(n,t,e){const i=n.getCenterInternal();if(i){const s=[i[0]+t[0],i[1]+t[1]];n.animateInternal({duration:e!==void 0?e:250,easing:cg,center:n.getConstrainedCenter(s)})}}function Aa(n,t,e,i){const s=n.getZoom();if(s===void 0)return;const r=n.getConstrainedZoom(s+t),o=n.getResolutionForZoom(r);n.getAnimating()&&n.cancelAnimations(),n.animate({resolution:o,anchor:e,duration:i!==void 0?i:250,easing:xn})}class R_ extends cs{constructor(t){super(),t=t||{},this.delta_=t.delta?t.delta:1,this.duration_=t.duration!==void 0?t.duration:250}handleEvent(t){let e=!1;if(t.type==ut.DBLCLICK){const i=t.originalEvent,s=t.map,r=t.coordinate,o=i.shiftKey?-this.delta_:this.delta_,a=s.getView();Aa(a,o,r,this.duration_),i.preventDefault(),e=!0}return!e}}function Oo(n){const t=arguments;return function(e){let i=!0;for(let s=0,r=t.length;s<r&&(i=i&&t[s](e),!!i);++s);return i}}const I_=function(n){const t=n.originalEvent;return t.altKey&&!(t.metaKey||t.ctrlKey)&&t.shiftKey},S_=function(n){const t=n.map.getTargetElement(),e=t.getRootNode(),i=n.map.getOwnerDocument().activeElement;return e instanceof ShadowRoot?e.host.contains(i):t.contains(i)},zc=function(n){const t=n.map.getTargetElement(),e=t.getRootNode();return(e instanceof ShadowRoot?e.host:t).hasAttribute("tabindex")?S_(n):!0},T_=Bn,Xc=function(n){const t=n.originalEvent;return t.button==0&&!(Kd&&jh&&t.ctrlKey)},Wc=function(n){const t=n.originalEvent;return!t.altKey&&!(t.metaKey||t.ctrlKey)&&!t.shiftKey},b_=function(n){const t=n.originalEvent;return jh?t.metaKey:t.ctrlKey},M_=function(n){const t=n.originalEvent;return!t.altKey&&!(t.metaKey||t.ctrlKey)&&t.shiftKey},Yc=function(n){const t=n.originalEvent,e=t.target.tagName;return e!=="INPUT"&&e!=="SELECT"&&e!=="TEXTAREA"&&!t.target.isContentEditable},io=function(n){const t=n.originalEvent;return $(t!==void 0,"mapBrowserEvent must originate from a pointer event"),t.pointerType=="mouse"},A_=function(n){const t=n.originalEvent;return $(t!==void 0,"mapBrowserEvent must originate from a pointer event"),t.isPrimary&&t.button===0};class us extends cs{constructor(t){t=t||{},super(t),t.handleDownEvent&&(this.handleDownEvent=t.handleDownEvent),t.handleDragEvent&&(this.handleDragEvent=t.handleDragEvent),t.handleMoveEvent&&(this.handleMoveEvent=t.handleMoveEvent),t.handleUpEvent&&(this.handleUpEvent=t.handleUpEvent),t.stopDown&&(this.stopDown=t.stopDown),this.handlingDownUpSequence=!1,this.targetPointers=[]}getPointerCount(){return this.targetPointers.length}handleDownEvent(t){return!1}handleDragEvent(t){}handleEvent(t){if(!t.originalEvent)return!0;let e=!1;if(this.updateTrackedPointers_(t),this.handlingDownUpSequence){if(t.type==ut.POINTERDRAG)this.handleDragEvent(t),t.originalEvent.preventDefault();else if(t.type==ut.POINTERUP){const i=this.handleUpEvent(t);this.handlingDownUpSequence=i&&this.targetPointers.length>0}}else if(t.type==ut.POINTERDOWN){const i=this.handleDownEvent(t);this.handlingDownUpSequence=i,e=this.stopDown(i)}else t.type==ut.POINTERMOVE&&this.handleMoveEvent(t);return!e}handleMoveEvent(t){}handleUpEvent(t){return!1}stopDown(t){return t}updateTrackedPointers_(t){t.activePointers&&(this.targetPointers=t.activePointers)}}function La(n){const t=n.length;let e=0,i=0;for(let s=0;s<t;s++)e+=n[s].clientX,i+=n[s].clientY;return{clientX:e/t,clientY:i/t}}class L_ extends us{constructor(t){super({stopDown:xr}),t=t||{},this.kinetic_=t.kinetic,this.lastCentroid=null,this.lastPointersCount_,this.panning_=!1;const e=t.condition?t.condition:Oo(Wc,A_);this.condition_=t.onFocusOnly?Oo(zc,e):e,this.noKinetic_=!1}handleDragEvent(t){const e=t.map;this.panning_||(this.panning_=!0,e.getView().beginInteraction());const i=this.targetPointers,s=e.getEventPixel(La(i));if(i.length==this.lastPointersCount_){if(this.kinetic_&&this.kinetic_.update(s[0],s[1]),this.lastCentroid){const r=[this.lastCentroid[0]-s[0],s[1]-this.lastCentroid[1]],a=t.map.getView();vf(r,a.getResolution()),ia(r,a.getRotation()),a.adjustCenterInternal(r)}}else this.kinetic_&&this.kinetic_.begin();this.lastCentroid=s,this.lastPointersCount_=i.length,t.originalEvent.preventDefault()}handleUpEvent(t){const e=t.map,i=e.getView();if(this.targetPointers.length===0){if(!this.noKinetic_&&this.kinetic_&&this.kinetic_.end()){const s=this.kinetic_.getDistance(),r=this.kinetic_.getAngle(),o=i.getCenterInternal(),a=e.getPixelFromCoordinateInternal(o),l=e.getCoordinateFromPixelInternal([a[0]-s*Math.cos(r),a[1]-s*Math.sin(r)]);i.animateInternal({center:i.getConstrainedCenter(l),duration:500,easing:xn})}return this.panning_&&(this.panning_=!1,i.endInteraction()),!1}return this.kinetic_&&this.kinetic_.begin(),this.lastCentroid=null,!0}handleDownEvent(t){if(this.targetPointers.length>0&&this.condition_(t)){const i=t.map.getView();return this.lastCentroid=null,i.getAnimating()&&i.cancelAnimations(),this.kinetic_&&this.kinetic_.begin(),this.noKinetic_=this.targetPointers.length>1,!0}return!1}}class P_ extends us{constructor(t){t=t||{},super({stopDown:xr}),this.condition_=t.condition?t.condition:I_,this.lastAngle_=void 0,this.duration_=t.duration!==void 0?t.duration:250}handleDragEvent(t){if(!io(t))return;const e=t.map,i=e.getView();if(i.getConstraints().rotation===Ta)return;const s=e.getSize(),r=t.pixel,o=Math.atan2(s[1]/2-r[1],r[0]-s[0]/2);if(this.lastAngle_!==void 0){const a=o-this.lastAngle_;i.adjustRotationInternal(-a)}this.lastAngle_=o}handleUpEvent(t){return io(t)?(t.map.getView().endInteraction(this.duration_),!1):!0}handleDownEvent(t){return io(t)&&Xc(t)&&this.condition_(t)?(t.map.getView().beginInteraction(),this.lastAngle_=void 0,!0):!1}}class O_ extends vr{constructor(t){super(),this.geometry_=null,this.element_=document.createElement("div"),this.element_.style.position="absolute",this.element_.style.pointerEvents="auto",this.element_.className="ol-box "+t,this.map_=null,this.startPixel_=null,this.endPixel_=null}disposeInternal(){this.setMap(null)}render_(){const t=this.startPixel_,e=this.endPixel_,i="px",s=this.element_.style;s.left=Math.min(t[0],e[0])+i,s.top=Math.min(t[1],e[1])+i,s.width=Math.abs(e[0]-t[0])+i,s.height=Math.abs(e[1]-t[1])+i}setMap(t){if(this.map_){this.map_.getOverlayContainer().removeChild(this.element_);const e=this.element_.style;e.left="inherit",e.top="inherit",e.width="inherit",e.height="inherit"}this.map_=t,this.map_&&this.map_.getOverlayContainer().appendChild(this.element_)}setPixels(t,e){this.startPixel_=t,this.endPixel_=e,this.createOrUpdateGeometry(),this.render_()}createOrUpdateGeometry(){if(!this.map_)return;const t=this.startPixel_,e=this.endPixel_,s=[t,[t[0],e[1]],e,[e[0],t[1]]].map(this.map_.getCoordinateFromPixelInternal,this.map_);s[4]=s[0].slice(),this.geometry_?this.geometry_.setCoordinates([s]):this.geometry_=new _i([s])}getGeometry(){return this.geometry_}}const Ki={BOXSTART:"boxstart",BOXDRAG:"boxdrag",BOXEND:"boxend",BOXCANCEL:"boxcancel"};class An extends Ve{constructor(t,e,i){super(t),this.coordinate=e,this.mapBrowserEvent=i}}class F_ extends us{constructor(t){super(),this.on,this.once,this.un,t=t??{},this.box_=new O_(t.className||"ol-dragbox"),this.minArea_=t.minArea??64,t.onBoxEnd&&(this.onBoxEnd=t.onBoxEnd),this.startPixel_=null,this.condition_=t.condition??Xc,this.boxEndCondition_=t.boxEndCondition??this.defaultBoxEndCondition}defaultBoxEndCondition(t,e,i){const s=i[0]-e[0],r=i[1]-e[1];return s*s+r*r>=this.minArea_}getGeometry(){return this.box_.getGeometry()}handleDragEvent(t){this.startPixel_&&(this.box_.setPixels(this.startPixel_,t.pixel),this.dispatchEvent(new An(Ki.BOXDRAG,t.coordinate,t)))}handleUpEvent(t){if(!this.startPixel_)return!1;const e=this.boxEndCondition_(t,this.startPixel_,t.pixel);return e&&this.onBoxEnd(t),this.dispatchEvent(new An(e?Ki.BOXEND:Ki.BOXCANCEL,t.coordinate,t)),this.box_.setMap(null),this.startPixel_=null,!1}handleDownEvent(t){return this.condition_(t)?(this.startPixel_=t.pixel,this.box_.setMap(t.map),this.box_.setPixels(this.startPixel_,this.startPixel_),this.dispatchEvent(new An(Ki.BOXSTART,t.coordinate,t)),!0):!1}onBoxEnd(t){}setActive(t){t||(this.box_.setMap(null),this.startPixel_&&(this.dispatchEvent(new An(Ki.BOXCANCEL,this.startPixel_,null)),this.startPixel_=null)),super.setActive(t)}setMap(t){this.getMap()&&(this.box_.setMap(null),this.startPixel_&&(this.dispatchEvent(new An(Ki.BOXCANCEL,this.startPixel_,null)),this.startPixel_=null)),super.setMap(t)}}class D_ extends F_{constructor(t){t=t||{};const e=t.condition?t.condition:M_;super({condition:e,className:t.className||"ol-dragzoom",minArea:t.minArea}),this.duration_=t.duration!==void 0?t.duration:200,this.out_=t.out!==void 0?t.out:!1}onBoxEnd(t){const i=this.getMap().getView();let s=this.getGeometry();if(this.out_){const r=i.rotatedExtentForGeometry(s),o=i.getResolutionForExtentInternal(r),a=i.getResolution()/o;s=s.clone(),s.scale(a*a)}i.fitInternal(s,{duration:this.duration_,easing:xn})}}const wi={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",DOWN:"ArrowDown"};class k_ extends cs{constructor(t){super(),t=t||{},this.defaultCondition_=function(e){return Wc(e)&&Yc(e)},this.condition_=t.condition!==void 0?t.condition:this.defaultCondition_,this.duration_=t.duration!==void 0?t.duration:100,this.pixelDelta_=t.pixelDelta!==void 0?t.pixelDelta:128}handleEvent(t){let e=!1;if(t.type==j.KEYDOWN){const i=t.originalEvent,s=i.key;if(this.condition_(t)&&(s==wi.DOWN||s==wi.LEFT||s==wi.RIGHT||s==wi.UP)){const o=t.map.getView(),a=o.getResolution()*this.pixelDelta_;let l=0,h=0;s==wi.DOWN?h=-a:s==wi.LEFT?l=-a:s==wi.RIGHT?l=a:h=a;const c=[l,h];ia(c,o.getRotation()),C_(o,c,this.duration_),i.preventDefault(),e=!0}}return!e}}class N_ extends cs{constructor(t){super(),t=t||{},this.condition_=t.condition?t.condition:function(e){return!b_(e)&&Yc(e)},this.delta_=t.delta?t.delta:1,this.duration_=t.duration!==void 0?t.duration:100}handleEvent(t){let e=!1;if(t.type==j.KEYDOWN||t.type==j.KEYPRESS){const i=t.originalEvent,s=i.key;if(this.condition_(t)&&(s==="+"||s==="-")){const r=t.map,o=s==="+"?this.delta_:-this.delta_,a=r.getView();Aa(a,o,void 0,this.duration_),i.preventDefault(),e=!0}}return!e}}class G_ extends cs{constructor(t){t=t||{},super(t),this.totalDelta_=0,this.lastDelta_=0,this.maxDelta_=t.maxDelta!==void 0?t.maxDelta:1,this.duration_=t.duration!==void 0?t.duration:250,this.timeout_=t.timeout!==void 0?t.timeout:80,this.useAnchor_=t.useAnchor!==void 0?t.useAnchor:!0,this.constrainResolution_=t.constrainResolution!==void 0?t.constrainResolution:!1;const e=t.condition?t.condition:T_;this.condition_=t.onFocusOnly?Oo(zc,e):e,this.lastAnchor_=null,this.startTime_=void 0,this.timeoutId_,this.mode_=void 0,this.trackpadEventGap_=400,this.trackpadTimeoutId_,this.deltaPerZoom_=300}endInteraction_(){this.trackpadTimeoutId_=void 0;const t=this.getMap();if(!t)return;t.getView().endInteraction(void 0,this.lastDelta_?this.lastDelta_>0?1:-1:0,this.lastAnchor_?t.getCoordinateFromPixel(this.lastAnchor_):null)}handleEvent(t){if(!this.condition_(t)||t.type!==j.WHEEL)return!0;const i=t.map,s=t.originalEvent;s.preventDefault(),this.useAnchor_&&(this.lastAnchor_=t.pixel);let r;if(t.type==j.WHEEL&&(r=s.deltaY,jd&&s.deltaMode===WheelEvent.DOM_DELTA_PIXEL&&(r/=Bh),s.deltaMode===WheelEvent.DOM_DELTA_LINE&&(r*=40)),r===0)return!1;this.lastDelta_=r;const o=Date.now();this.startTime_===void 0&&(this.startTime_=o),(!this.mode_||o-this.startTime_>this.trackpadEventGap_)&&(this.mode_=Math.abs(r)<4?"trackpad":"wheel");const a=i.getView();if(this.mode_==="trackpad"&&!(a.getConstrainResolution()||this.constrainResolution_))return this.trackpadTimeoutId_?clearTimeout(this.trackpadTimeoutId_):(a.getAnimating()&&a.cancelAnimations(),a.beginInteraction()),this.trackpadTimeoutId_=setTimeout(this.endInteraction_.bind(this),this.timeout_),a.adjustZoom(-r/this.deltaPerZoom_,this.lastAnchor_?i.getCoordinateFromPixel(this.lastAnchor_):null),this.startTime_=o,!1;this.totalDelta_+=r;const l=Math.max(this.timeout_-(o-this.startTime_),0);return clearTimeout(this.timeoutId_),this.timeoutId_=setTimeout(this.handleWheelZoom_.bind(this,i),l),!1}handleWheelZoom_(t){const e=t.getView();e.getAnimating()&&e.cancelAnimations();let i=-mt(this.totalDelta_,-this.maxDelta_*this.deltaPerZoom_,this.maxDelta_*this.deltaPerZoom_)/this.deltaPerZoom_;(e.getConstrainResolution()||this.constrainResolution_)&&(i=i?i>0?1:-1:0),Aa(e,i,this.lastAnchor_?t.getCoordinateFromPixel(this.lastAnchor_):null,this.duration_),this.mode_=void 0,this.totalDelta_=0,this.lastAnchor_=null,this.startTime_=void 0,this.timeoutId_=void 0}setMouseAnchor(t){this.useAnchor_=t,t||(this.lastAnchor_=null)}}class z_ extends us{constructor(t){t=t||{};const e=t;e.stopDown||(e.stopDown=xr),super(e),this.anchor_=null,this.lastAngle_=void 0,this.rotating_=!1,this.rotationDelta_=0,this.threshold_=t.threshold!==void 0?t.threshold:.3,this.duration_=t.duration!==void 0?t.duration:250}handleDragEvent(t){let e=0;const i=this.targetPointers[0],s=this.targetPointers[1],r=Math.atan2(s.clientY-i.clientY,s.clientX-i.clientX);if(this.lastAngle_!==void 0){const l=r-this.lastAngle_;this.rotationDelta_+=l,!this.rotating_&&Math.abs(this.rotationDelta_)>this.threshold_&&(this.rotating_=!0),e=l}this.lastAngle_=r;const o=t.map,a=o.getView();a.getConstraints().rotation!==Ta&&(this.anchor_=o.getCoordinateFromPixelInternal(o.getEventPixel(La(this.targetPointers))),this.rotating_&&(o.render(),a.adjustRotationInternal(e,this.anchor_)))}handleUpEvent(t){return this.targetPointers.length<2?(t.map.getView().endInteraction(this.duration_),!1):!0}handleDownEvent(t){if(this.targetPointers.length>=2){const e=t.map;return this.anchor_=null,this.lastAngle_=void 0,this.rotating_=!1,this.rotationDelta_=0,this.handlingDownUpSequence||e.getView().beginInteraction(),!0}return!1}}class X_ extends us{constructor(t){t=t||{};const e=t;e.stopDown||(e.stopDown=xr),super(e),this.anchor_=null,this.duration_=t.duration!==void 0?t.duration:400,this.lastDistance_=void 0,this.lastScaleDelta_=1}handleDragEvent(t){let e=1;const i=this.targetPointers[0],s=this.targetPointers[1],r=i.clientX-s.clientX,o=i.clientY-s.clientY,a=Math.sqrt(r*r+o*o);this.lastDistance_!==void 0&&(e=this.lastDistance_/a),this.lastDistance_=a;const l=t.map,h=l.getView();e!=1&&(this.lastScaleDelta_=e),this.anchor_=l.getCoordinateFromPixelInternal(l.getEventPixel(La(this.targetPointers))),l.render(),h.adjustResolutionInternal(e,this.anchor_)}handleUpEvent(t){if(this.targetPointers.length<2){const i=t.map.getView(),s=this.lastScaleDelta_>1?1:-1;return i.endInteraction(this.duration_,s),!1}return!0}handleDownEvent(t){if(this.targetPointers.length>=2){const e=t.map;return this.anchor_=null,this.lastDistance_=void 0,this.lastScaleDelta_=1,this.handlingDownUpSequence||e.getView().beginInteraction(),!0}return!1}}function W_(n){n=n||{};const t=new Re,e=new E_(-.005,.05,100);return(n.altShiftDragRotate!==void 0?n.altShiftDragRotate:!0)&&t.push(new P_),(n.doubleClickZoom!==void 0?n.doubleClickZoom:!0)&&t.push(new R_({delta:n.zoomDelta,duration:n.zoomDuration})),(n.dragPan!==void 0?n.dragPan:!0)&&t.push(new L_({onFocusOnly:n.onFocusOnly,kinetic:e})),(n.pinchRotate!==void 0?n.pinchRotate:!0)&&t.push(new z_),(n.pinchZoom!==void 0?n.pinchZoom:!0)&&t.push(new X_({duration:n.zoomDuration})),(n.keyboard!==void 0?n.keyboard:!0)&&(t.push(new k_),t.push(new N_({delta:n.zoomDelta,duration:n.zoomDuration}))),(n.mouseWheelZoom!==void 0?n.mouseWheelZoom:!0)&&t.push(new G_({onFocusOnly:n.onFocusOnly,duration:n.zoomDuration})),(n.shiftDragZoom!==void 0?n.shiftDragZoom:!0)&&t.push(new D_({duration:n.zoomDuration})),t}class ni extends Ve{constructor(t,e){super(t),this.layer=e}}const no={LAYERS:"layers"};class Ni extends Gc{constructor(t){t=t||{};const e=Object.assign({},t);delete e.layers;let i=t.layers;super(e),this.on,this.once,this.un,this.layersListenerKeys_=[],this.listenerKeys_={},this.addChangeListener(no.LAYERS,this.handleLayersChanged_),i?Array.isArray(i)?i=new Re(i.slice(),{unique:!0}):$(typeof i.getArray=="function","Expected `layers` to be an array or a `Collection`"):i=new Re(void 0,{unique:!0}),this.setLayers(i)}handleLayerChange_(){this.changed()}handleLayersChanged_(){this.layersListenerKeys_.forEach(at),this.layersListenerKeys_.length=0;const t=this.getLayers();this.layersListenerKeys_.push(q(t,Yt.ADD,this.handleLayersAdd_,this),q(t,Yt.REMOVE,this.handleLayersRemove_,this));for(const i in this.listenerKeys_)this.listenerKeys_[i].forEach(at);ss(this.listenerKeys_);const e=t.getArray();for(let i=0,s=e.length;i<s;i++){const r=e[i];this.registerLayerListeners_(r),this.dispatchEvent(new ni("addlayer",r))}this.changed()}registerLayerListeners_(t){const e=[q(t,un.PROPERTYCHANGE,this.handleLayerChange_,this),q(t,j.CHANGE,this.handleLayerChange_,this)];t instanceof Ni&&e.push(q(t,"addlayer",this.handleLayerGroupAdd_,this),q(t,"removelayer",this.handleLayerGroupRemove_,this)),this.listenerKeys_[Q(t)]=e}handleLayerGroupAdd_(t){this.dispatchEvent(new ni("addlayer",t.layer))}handleLayerGroupRemove_(t){this.dispatchEvent(new ni("removelayer",t.layer))}handleLayersAdd_(t){const e=t.element;this.registerLayerListeners_(e),this.dispatchEvent(new ni("addlayer",e)),this.changed()}handleLayersRemove_(t){const e=t.element,i=Q(e);this.listenerKeys_[i].forEach(at),delete this.listenerKeys_[i],this.dispatchEvent(new ni("removelayer",e)),this.changed()}getLayers(){return this.get(no.LAYERS)}setLayers(t){const e=this.getLayers();if(e){const i=e.getArray();for(let s=0,r=i.length;s<r;++s)this.dispatchEvent(new ni("removelayer",i[s]))}this.set(no.LAYERS,t)}getLayersArray(t){return t=t!==void 0?t:[],this.getLayers().forEach(function(e){e.getLayersArray(t)}),t}getLayerStatesArray(t){const e=t!==void 0?t:[],i=e.length;this.getLayers().forEach(function(o){o.getLayerStatesArray(e)});const s=this.getLayerState();let r=s.zIndex;!t&&s.zIndex===void 0&&(r=0);for(let o=i,a=e.length;o<a;o++){const l=e[o];l.opacity*=s.opacity,l.visible=l.visible&&s.visible,l.maxResolution=Math.min(l.maxResolution,s.maxResolution),l.minResolution=Math.max(l.minResolution,s.minResolution),l.minZoom=Math.max(l.minZoom,s.minZoom),l.maxZoom=Math.min(l.maxZoom,s.maxZoom),s.extent!==void 0&&(l.extent!==void 0?l.extent=Mi(l.extent,s.extent):l.extent=s.extent),l.zIndex===void 0&&(l.zIndex=r)}return e}getSourceState(){return"ready"}}function jc(n,t,e=0,i=n.length-1,s=Y_){for(;i>e;){if(i-e>600){const l=i-e+1,h=t-e+1,c=Math.log(l),u=.5*Math.exp(2*c/3),d=.5*Math.sqrt(c*u*(l-u)/l)*(h-l/2<0?-1:1),f=Math.max(e,Math.floor(t-h*u/l+d)),g=Math.min(i,Math.floor(t+(l-h)*u/l+d));jc(n,t,f,g,s)}const r=n[t];let o=e,a=i;for(Ln(n,e,t),s(n[i],r)>0&&Ln(n,e,i);o<a;){for(Ln(n,o,a),o++,a--;s(n[o],r)<0;)o++;for(;s(n[a],r)>0;)a--}s(n[e],r)===0?Ln(n,e,a):(a++,Ln(n,a,i)),a<=t&&(e=a+1),t<=a&&(i=a-1)}}function Ln(n,t,e){const i=n[t];n[t]=n[e],n[e]=i}function Y_(n,t){return n<t?-1:n>t?1:0}let Bc=class{constructor(t=9){this._maxEntries=Math.max(4,t),this._minEntries=Math.max(2,Math.ceil(this._maxEntries*.4)),this.clear()}all(){return this._all(this.data,[])}search(t){let e=this.data;const i=[];if(!Ss(t,e))return i;const s=this.toBBox,r=[];for(;e;){for(let o=0;o<e.children.length;o++){const a=e.children[o],l=e.leaf?s(a):a;Ss(t,l)&&(e.leaf?i.push(a):ro(t,l)?this._all(a,i):r.push(a))}e=r.pop()}return i}collides(t){let e=this.data;if(!Ss(t,e))return!1;const i=[];for(;e;){for(let s=0;s<e.children.length;s++){const r=e.children[s],o=e.leaf?this.toBBox(r):r;if(Ss(t,o)){if(e.leaf||ro(t,o))return!0;i.push(r)}}e=i.pop()}return!1}load(t){if(!(t&&t.length))return this;if(t.length<this._minEntries){for(let i=0;i<t.length;i++)this.insert(t[i]);return this}let e=this._build(t.slice(),0,t.length-1,0);if(!this.data.children.length)this.data=e;else if(this.data.height===e.height)this._splitRoot(this.data,e);else{if(this.data.height<e.height){const i=this.data;this.data=e,e=i}this._insert(e,this.data.height-e.height-1,!0)}return this}insert(t){return t&&this._insert(t,this.data.height-1),this}clear(){return this.data=Qi([]),this}remove(t,e){if(!t)return this;let i=this.data;const s=this.toBBox(t),r=[],o=[];let a,l,h;for(;i||r.length;){if(i||(i=r.pop(),l=r[r.length-1],a=o.pop(),h=!0),i.leaf){const c=j_(t,i.children,e);if(c!==-1)return i.children.splice(c,1),r.push(i),this._condense(r),this}!h&&!i.leaf&&ro(i,s)?(r.push(i),o.push(a),a=0,l=i,i=i.children[0]):l?(a++,i=l.children[a],h=!1):i=null}return this}toBBox(t){return t}compareMinX(t,e){return t.minX-e.minX}compareMinY(t,e){return t.minY-e.minY}toJSON(){return this.data}fromJSON(t){return this.data=t,this}_all(t,e){const i=[];for(;t;)t.leaf?e.push(...t.children):i.push(...t.children),t=i.pop();return e}_build(t,e,i,s){const r=i-e+1;let o=this._maxEntries,a;if(r<=o)return a=Qi(t.slice(e,i+1)),Ui(a,this.toBBox),a;s||(s=Math.ceil(Math.log(r)/Math.log(o)),o=Math.ceil(r/Math.pow(o,s-1))),a=Qi([]),a.leaf=!1,a.height=s;const l=Math.ceil(r/o),h=l*Math.ceil(Math.sqrt(o));Yl(t,e,i,h,this.compareMinX);for(let c=e;c<=i;c+=h){const u=Math.min(c+h-1,i);Yl(t,c,u,l,this.compareMinY);for(let d=c;d<=u;d+=l){const f=Math.min(d+l-1,u);a.children.push(this._build(t,d,f,s-1))}}return Ui(a,this.toBBox),a}_chooseSubtree(t,e,i,s){for(;s.push(e),!(e.leaf||s.length-1===i);){let r=1/0,o=1/0,a;for(let l=0;l<e.children.length;l++){const h=e.children[l],c=so(h),u=U_(t,h)-c;u<o?(o=u,r=c<r?c:r,a=h):u===o&&c<r&&(r=c,a=h)}e=a||e.children[0]}return e}_insert(t,e,i){const s=i?t:this.toBBox(t),r=[],o=this._chooseSubtree(s,this.data,e,r);for(o.children.push(t),Dn(o,s);e>=0&&r[e].children.length>this._maxEntries;)this._split(r,e),e--;this._adjustParentBBoxes(s,r,e)}_split(t,e){const i=t[e],s=i.children.length,r=this._minEntries;this._chooseSplitAxis(i,r,s);const o=this._chooseSplitIndex(i,r,s),a=Qi(i.children.splice(o,i.children.length-o));a.height=i.height,a.leaf=i.leaf,Ui(i,this.toBBox),Ui(a,this.toBBox),e?t[e-1].children.push(a):this._splitRoot(i,a)}_splitRoot(t,e){this.data=Qi([t,e]),this.data.height=t.height+1,this.data.leaf=!1,Ui(this.data,this.toBBox)}_chooseSplitIndex(t,e,i){let s,r=1/0,o=1/0;for(let a=e;a<=i-e;a++){const l=Fn(t,0,a,this.toBBox),h=Fn(t,a,i,this.toBBox),c=Z_(l,h),u=so(l)+so(h);c<r?(r=c,s=a,o=u<o?u:o):c===r&&u<o&&(o=u,s=a)}return s||i-e}_chooseSplitAxis(t,e,i){const s=t.leaf?this.compareMinX:B_,r=t.leaf?this.compareMinY:K_,o=this._allDistMargin(t,e,i,s),a=this._allDistMargin(t,e,i,r);o<a&&t.children.sort(s)}_allDistMargin(t,e,i,s){t.children.sort(s);const r=this.toBBox,o=Fn(t,0,e,r),a=Fn(t,i-e,i,r);let l=Is(o)+Is(a);for(let h=e;h<i-e;h++){const c=t.children[h];Dn(o,t.leaf?r(c):c),l+=Is(o)}for(let h=i-e-1;h>=e;h--){const c=t.children[h];Dn(a,t.leaf?r(c):c),l+=Is(a)}return l}_adjustParentBBoxes(t,e,i){for(let s=i;s>=0;s--)Dn(e[s],t)}_condense(t){for(let e=t.length-1,i;e>=0;e--)t[e].children.length===0?e>0?(i=t[e-1].children,i.splice(i.indexOf(t[e]),1)):this.clear():Ui(t[e],this.toBBox)}};function j_(n,t,e){if(!e)return t.indexOf(n);for(let i=0;i<t.length;i++)if(e(n,t[i]))return i;return-1}function Ui(n,t){Fn(n,0,n.children.length,t,n)}function Fn(n,t,e,i,s){s||(s=Qi(null)),s.minX=1/0,s.minY=1/0,s.maxX=-1/0,s.maxY=-1/0;for(let r=t;r<e;r++){const o=n.children[r];Dn(s,n.leaf?i(o):o)}return s}function Dn(n,t){return n.minX=Math.min(n.minX,t.minX),n.minY=Math.min(n.minY,t.minY),n.maxX=Math.max(n.maxX,t.maxX),n.maxY=Math.max(n.maxY,t.maxY),n}function B_(n,t){return n.minX-t.minX}function K_(n,t){return n.minY-t.minY}function so(n){return(n.maxX-n.minX)*(n.maxY-n.minY)}function Is(n){return n.maxX-n.minX+(n.maxY-n.minY)}function U_(n,t){return(Math.max(t.maxX,n.maxX)-Math.min(t.minX,n.minX))*(Math.max(t.maxY,n.maxY)-Math.min(t.minY,n.minY))}function Z_(n,t){const e=Math.max(n.minX,t.minX),i=Math.max(n.minY,t.minY),s=Math.min(n.maxX,t.maxX),r=Math.min(n.maxY,t.maxY);return Math.max(0,s-e)*Math.max(0,r-i)}function ro(n,t){return n.minX<=t.minX&&n.minY<=t.minY&&t.maxX<=n.maxX&&t.maxY<=n.maxY}function Ss(n,t){return t.minX<=n.maxX&&t.minY<=n.maxY&&t.maxX>=n.minX&&t.maxY>=n.minY}function Qi(n){return{children:n,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function Yl(n,t,e,i,s){const r=[t,e];for(;r.length;){if(e=r.pop(),t=r.pop(),e-t<=i)continue;const o=t+Math.ceil((e-t)/i/2)*i;jc(n,o,t,e,s),r.push(t,o,o,e)}}let Gi=0;const Dt=1<<Gi++,H=1<<Gi++,jt=1<<Gi++,he=1<<Gi++,Pi=1<<Gi++,kn=1<<Gi++,Ts=Math.pow(2,Gi)-1,Pa={[Dt]:"boolean",[H]:"number",[jt]:"string",[he]:"color",[Pi]:"number[]",[kn]:"size"},V_=Object.keys(Pa).map(Number).sort(Ye);function H_(n){return n in Pa}function Nn(n){const t=[];for(const e of V_)Gn(n,e)&&t.push(Pa[e]);return t.length===0?"untyped":t.length<3?t.join(" or "):t.slice(0,-1).join(", ")+", or "+t[t.length-1]}function Gn(n,t){return(n&t)===t}function $e(n,t){return n===t}class vt{constructor(t,e){if(!H_(t))throw new Error(`literal expressions must have a specific type, got ${Nn(t)}`);this.type=t,this.value=e}}class q_{constructor(t,e,...i){this.type=t,this.operator=e,this.args=i}}function Kc(){return{variables:new Set,properties:new Set,featureId:!1,geometryType:!1,mapState:!1}}function Tt(n,t,e){switch(typeof n){case"boolean":{if($e(t,jt))return new vt(jt,n?"true":"false");if(!Gn(t,Dt))throw new Error(`got a boolean, but expected ${Nn(t)}`);return new vt(Dt,n)}case"number":{if($e(t,kn))return new vt(kn,Ut(n));if($e(t,Dt))return new vt(Dt,!!n);if($e(t,jt))return new vt(jt,n.toString());if(!Gn(t,H))throw new Error(`got a number, but expected ${Nn(t)}`);return new vt(H,n)}case"string":{if($e(t,he))return new vt(he,Vo(n));if($e(t,Dt))return new vt(Dt,!!n);if(!Gn(t,jt))throw new Error(`got a string, but expected ${Nn(t)}`);return new vt(jt,n)}}if(!Array.isArray(n))throw new Error("expression must be an array or a primitive value");if(n.length===0)throw new Error("empty expression");if(typeof n[0]=="string")return am(n,t,e);for(const i of n)if(typeof i!="number")throw new Error("expected an array of numbers");if($e(t,kn)){if(n.length!==2)throw new Error(`expected an array of two values for a size, got ${n.length}`);return new vt(kn,n)}if($e(t,he)){if(n.length===3)return new vt(he,[...n,1]);if(n.length===4)return new vt(he,n);throw new Error(`expected an array of 3 or 4 values for a color, got ${n.length}`)}if(!Gn(t,Pi))throw new Error(`got an array of numbers, but expected ${Nn(t)}`);return new vt(Pi,n)}const E={Get:"get",Var:"var",Concat:"concat",GeometryType:"geometry-type",LineMetric:"line-metric",Any:"any",All:"all",Not:"!",Resolution:"resolution",Zoom:"zoom",Time:"time",Equal:"==",NotEqual:"!=",GreaterThan:">",GreaterThanOrEqualTo:">=",LessThan:"<",LessThanOrEqualTo:"<=",Multiply:"*",Divide:"/",Add:"+",Subtract:"-",Clamp:"clamp",Mod:"%",Pow:"^",Abs:"abs",Floor:"floor",Ceil:"ceil",Round:"round",Sin:"sin",Cos:"cos",Atan:"atan",Sqrt:"sqrt",Match:"match",Between:"between",Interpolate:"interpolate",Coalesce:"coalesce",Case:"case",In:"in",Number:"number",String:"string",Array:"array",Color:"color",Id:"id",Band:"band",Palette:"palette",ToString:"to-string",Has:"has"},$_={[E.Get]:N(B(1,1/0),jl),[E.Var]:N(B(1,1),J_),[E.Has]:N(B(1,1/0),jl),[E.Id]:N(Q_,Zi),[E.Concat]:N(B(2,1/0),J(jt)),[E.GeometryType]:N(tm,Zi),[E.LineMetric]:N(Zi),[E.Resolution]:N(oo,Zi),[E.Zoom]:N(oo,Zi),[E.Time]:N(oo,Zi),[E.Any]:N(B(2,1/0),J(Dt)),[E.All]:N(B(2,1/0),J(Dt)),[E.Not]:N(B(1,1),J(Dt)),[E.Equal]:N(B(2,2),J(Ts)),[E.NotEqual]:N(B(2,2),J(Ts)),[E.GreaterThan]:N(B(2,2),J(H)),[E.GreaterThanOrEqualTo]:N(B(2,2),J(H)),[E.LessThan]:N(B(2,2),J(H)),[E.LessThanOrEqualTo]:N(B(2,2),J(H)),[E.Multiply]:N(B(2,1/0),Bl),[E.Coalesce]:N(B(2,1/0),Bl),[E.Divide]:N(B(2,2),J(H)),[E.Add]:N(B(2,1/0),J(H)),[E.Subtract]:N(B(2,2),J(H)),[E.Clamp]:N(B(3,3),J(H)),[E.Mod]:N(B(2,2),J(H)),[E.Pow]:N(B(2,2),J(H)),[E.Abs]:N(B(1,1),J(H)),[E.Floor]:N(B(1,1),J(H)),[E.Ceil]:N(B(1,1),J(H)),[E.Round]:N(B(1,1),J(H)),[E.Sin]:N(B(1,1),J(H)),[E.Cos]:N(B(1,1),J(H)),[E.Atan]:N(B(1,2),J(H)),[E.Sqrt]:N(B(1,1),J(H)),[E.Match]:N(B(4,1/0),Kl,im),[E.Between]:N(B(3,3),J(H)),[E.Interpolate]:N(B(6,1/0),Kl,nm),[E.Case]:N(B(3,1/0),em,sm),[E.In]:N(B(2,2),rm),[E.Number]:N(B(1,1/0),J(Ts)),[E.String]:N(B(1,1/0),J(Ts)),[E.Array]:N(B(1,1/0),J(H)),[E.Color]:N(B(1,4),J(H)),[E.Band]:N(B(1,3),J(H)),[E.Palette]:N(B(2,2),om),[E.ToString]:N(B(1,1),J(Dt|H|jt|he))};function jl(n,t,e){const i=n.length-1,s=new Array(i);for(let r=0;r<i;++r){const o=n[r+1];switch(typeof o){case"number":{s[r]=new vt(H,o);break}case"string":{s[r]=new vt(jt,o);break}default:throw new Error(`expected a string key or numeric array index for a get operation, got ${o}`)}r===0&&e.properties.add(String(o))}return s}function J_(n,t,e){const i=n[1];if(typeof i!="string")throw new Error("expected a string argument for var operation");return e.variables.add(i),[new vt(jt,i)]}function Q_(n,t,e){e.featureId=!0}function tm(n,t,e){e.geometryType=!0}function oo(n,t,e){e.mapState=!0}function Zi(n,t,e){const i=n[0];if(n.length!==1)throw new Error(`expected no arguments for ${i} operation`);return[]}function B(n,t){return function(e,i,s){const r=e[0],o=e.length-1;if(n===t){if(o!==n){const a=n===1?"":"s";throw new Error(`expected ${n} argument${a} for ${r}, got ${o}`)}}else if(o<n||o>t){const a=t===1/0?`${n} or more`:`${n} to ${t}`;throw new Error(`expected ${a} arguments for ${r}, got ${o}`)}}}function Bl(n,t,e){const i=n.length-1,s=new Array(i);for(let r=0;r<i;++r){const o=Tt(n[r+1],t,e);s[r]=o}return s}function J(n){return function(t,e,i){const s=t.length-1,r=new Array(s);for(let o=0;o<s;++o){const a=Tt(t[o+1],n,i);r[o]=a}return r}}function em(n,t,e){const i=n[0],s=n.length-1;if(s%2===0)throw new Error(`expected an odd number of arguments for ${i}, got ${s} instead`)}function Kl(n,t,e){const i=n[0],s=n.length-1;if(s%2===1)throw new Error(`expected an even number of arguments for operation ${i}, got ${s} instead`)}function im(n,t,e){const i=n.length-1,s=jt|H|Dt,r=Tt(n[1],s,e),o=Tt(n[n.length-1],t,e),a=new Array(i-2);for(let l=0;l<i-2;l+=2){try{const h=Tt(n[l+2],r.type,e);a[l]=h}catch(h){throw new Error(`failed to parse argument ${l+1} of match expression: ${h.message}`)}try{const h=Tt(n[l+3],o.type,e);a[l+1]=h}catch(h){throw new Error(`failed to parse argument ${l+2} of match expression: ${h.message}`)}}return[r,...a,o]}function nm(n,t,e){const i=n[1];let s;switch(i[0]){case"linear":s=1;break;case"exponential":const l=i[1];if(typeof l!="number"||l<=0)throw new Error(`expected a number base for exponential interpolation, got ${JSON.stringify(l)} instead`);s=l;break;default:throw new Error(`invalid interpolation type: ${JSON.stringify(i)}`)}const r=new vt(H,s);let o;try{o=Tt(n[2],H,e)}catch(l){throw new Error(`failed to parse argument 1 in interpolate expression: ${l.message}`)}const a=new Array(n.length-3);for(let l=0;l<a.length;l+=2){try{const h=Tt(n[l+3],H,e);a[l]=h}catch(h){throw new Error(`failed to parse argument ${l+2} for interpolate expression: ${h.message}`)}try{const h=Tt(n[l+4],t,e);a[l+1]=h}catch(h){throw new Error(`failed to parse argument ${l+3} for interpolate expression: ${h.message}`)}}return[r,o,...a]}function sm(n,t,e){const i=Tt(n[n.length-1],t,e),s=new Array(n.length-1);for(let r=0;r<s.length-1;r+=2){try{const o=Tt(n[r+1],Dt,e);s[r]=o}catch(o){throw new Error(`failed to parse argument ${r} of case expression: ${o.message}`)}try{const o=Tt(n[r+2],i.type,e);s[r+1]=o}catch(o){throw new Error(`failed to parse argument ${r+1} of case expression: ${o.message}`)}}return s[s.length-1]=i,s}function rm(n,t,e){let i=n[2];if(!Array.isArray(i))throw new Error('the second argument for the "in" operator must be an array');let s;if(typeof i[0]=="string"){if(i[0]!=="literal")throw new Error('for the "in" operator, a string array should be wrapped in a "literal" operator to disambiguate from expressions');if(!Array.isArray(i[1]))throw new Error('failed to parse "in" expression: the literal operator must be followed by an array');i=i[1],s=jt}else s=H;const r=new Array(i.length);for(let a=0;a<r.length;a++)try{const l=Tt(i[a],s,e);r[a]=l}catch(l){throw new Error(`failed to parse haystack item ${a} for "in" expression: ${l.message}`)}return[Tt(n[1],s,e),...r]}function om(n,t,e){let i;try{i=Tt(n[1],H,e)}catch(o){throw new Error(`failed to parse first argument in palette expression: ${o.message}`)}const s=n[2];if(!Array.isArray(s))throw new Error("the second argument of palette must be an array");const r=new Array(s.length);for(let o=0;o<r.length;o++){let a;try{a=Tt(s[o],he,e)}catch(l){throw new Error(`failed to parse color at index ${o} in palette expression: ${l.message}`)}if(!(a instanceof vt))throw new Error(`the palette color at index ${o} must be a literal value`);r[o]=a}return[i,...r]}function N(...n){return function(t,e,i){const s=t[0];let r;for(let o=0;o<n.length;o++){const a=n[o](t,e,i);if(o==n.length-1){if(!a)throw new Error("expected last argument validator to return the parsed args");r=a}}return new q_(e,s,...r)}}function am(n,t,e){const i=n[0],s=$_[i];if(!s)throw new Error(`unknown operator: ${i}`);return s(n,t,e)}function Uc(n){if(!n)return"";const t=n.getType();switch(t){case"Point":case"LineString":case"Polygon":return t;case"MultiPoint":case"MultiLineString":case"MultiPolygon":return t.substring(5);case"Circle":return"Polygon";case"GeometryCollection":return Uc(n.getGeometries()[0]);default:return""}}function Zc(){return{variables:{},properties:{},resolution:NaN,featureId:null,geometryType:""}}function He(n,t,e){const i=Tt(n,t,e);return ge(i)}function ge(n,t){if(n instanceof vt){if(n.type===he&&typeof n.value=="string"){const i=Vo(n.value);return function(){return i}}return function(){return n.value}}const e=n.operator;switch(e){case E.Number:case E.String:case E.Coalesce:return lm(n);case E.Get:case E.Var:case E.Has:return hm(n);case E.Id:return i=>i.featureId;case E.GeometryType:return i=>i.geometryType;case E.Concat:{const i=n.args.map(s=>ge(s));return s=>"".concat(...i.map(r=>r(s).toString()))}case E.Resolution:return i=>i.resolution;case E.Any:case E.All:case E.Between:case E.In:case E.Not:return um(n);case E.Equal:case E.NotEqual:case E.LessThan:case E.LessThanOrEqualTo:case E.GreaterThan:case E.GreaterThanOrEqualTo:return cm(n);case E.Multiply:case E.Divide:case E.Add:case E.Subtract:case E.Clamp:case E.Mod:case E.Pow:case E.Abs:case E.Floor:case E.Ceil:case E.Round:case E.Sin:case E.Cos:case E.Atan:case E.Sqrt:return dm(n);case E.Case:return fm(n);case E.Match:return gm(n);case E.Interpolate:return _m(n);case E.ToString:return mm(n);default:throw new Error(`Unsupported operator ${e}`)}}function lm(n,t){const e=n.operator,i=n.args.length,s=new Array(i);for(let r=0;r<i;++r)s[r]=ge(n.args[r]);switch(e){case E.Coalesce:return r=>{for(let o=0;o<i;++o){const a=s[o](r);if(typeof a<"u"&&a!==null)return a}throw new Error("Expected one of the values to be non-null")};case E.Number:case E.String:return r=>{for(let o=0;o<i;++o){const a=s[o](r);if(typeof a===e)return a}throw new Error(`Expected one of the values to be a ${e}`)};default:throw new Error(`Unsupported assertion operator ${e}`)}}function hm(n,t){const i=n.args[0].value;switch(n.operator){case E.Get:return s=>{const r=n.args;let o=s.properties[i];for(let a=1,l=r.length;a<l;++a){const c=r[a].value;o=o[c]}return o};case E.Var:return s=>s.variables[i];case E.Has:return s=>{const r=n.args;if(!(i in s.properties))return!1;let o=s.properties[i];for(let a=1,l=r.length;a<l;++a){const c=r[a].value;if(!o||!Object.hasOwn(o,c))return!1;o=o[c]}return!0};default:throw new Error(`Unsupported accessor operator ${n.operator}`)}}function cm(n,t){const e=n.operator,i=ge(n.args[0]),s=ge(n.args[1]);switch(e){case E.Equal:return r=>i(r)===s(r);case E.NotEqual:return r=>i(r)!==s(r);case E.LessThan:return r=>i(r)<s(r);case E.LessThanOrEqualTo:return r=>i(r)<=s(r);case E.GreaterThan:return r=>i(r)>s(r);case E.GreaterThanOrEqualTo:return r=>i(r)>=s(r);default:throw new Error(`Unsupported comparison operator ${e}`)}}function um(n,t){const e=n.operator,i=n.args.length,s=new Array(i);for(let r=0;r<i;++r)s[r]=ge(n.args[r]);switch(e){case E.Any:return r=>{for(let o=0;o<i;++o)if(s[o](r))return!0;return!1};case E.All:return r=>{for(let o=0;o<i;++o)if(!s[o](r))return!1;return!0};case E.Between:return r=>{const o=s[0](r),a=s[1](r),l=s[2](r);return o>=a&&o<=l};case E.In:return r=>{const o=s[0](r);for(let a=1;a<i;++a)if(o===s[a](r))return!0;return!1};case E.Not:return r=>!s[0](r);default:throw new Error(`Unsupported logical operator ${e}`)}}function dm(n,t){const e=n.operator,i=n.args.length,s=new Array(i);for(let r=0;r<i;++r)s[r]=ge(n.args[r]);switch(e){case E.Multiply:return r=>{let o=1;for(let a=0;a<i;++a)o*=s[a](r);return o};case E.Divide:return r=>s[0](r)/s[1](r);case E.Add:return r=>{let o=0;for(let a=0;a<i;++a)o+=s[a](r);return o};case E.Subtract:return r=>s[0](r)-s[1](r);case E.Clamp:return r=>{const o=s[0](r),a=s[1](r);if(o<a)return a;const l=s[2](r);return o>l?l:o};case E.Mod:return r=>s[0](r)%s[1](r);case E.Pow:return r=>Math.pow(s[0](r),s[1](r));case E.Abs:return r=>Math.abs(s[0](r));case E.Floor:return r=>Math.floor(s[0](r));case E.Ceil:return r=>Math.ceil(s[0](r));case E.Round:return r=>Math.round(s[0](r));case E.Sin:return r=>Math.sin(s[0](r));case E.Cos:return r=>Math.cos(s[0](r));case E.Atan:return i===2?r=>Math.atan2(s[0](r),s[1](r)):r=>Math.atan(s[0](r));case E.Sqrt:return r=>Math.sqrt(s[0](r));default:throw new Error(`Unsupported numeric operator ${e}`)}}function fm(n,t){const e=n.args.length,i=new Array(e);for(let s=0;s<e;++s)i[s]=ge(n.args[s]);return s=>{for(let r=0;r<e-1;r+=2)if(i[r](s))return i[r+1](s);return i[e-1](s)}}function gm(n,t){const e=n.args.length,i=new Array(e);for(let s=0;s<e;++s)i[s]=ge(n.args[s]);return s=>{const r=i[0](s);for(let o=1;o<e;o+=2)if(r===i[o](s))return i[o+1](s);return i[e-1](s)}}function _m(n,t){const e=n.args.length,i=new Array(e);for(let s=0;s<e;++s)i[s]=ge(n.args[s]);return s=>{const r=i[0](s),o=i[1](s);let a,l;for(let h=2;h<e;h+=2){const c=i[h](s);let u=i[h+1](s);const d=Array.isArray(u);if(d&&(u=Wd(u)),c>=o)return h===2?u:d?pm(r,o,a,l,c,u):zn(r,o,a,l,c,u);a=c,l=u}return l}}function mm(n,t){const e=n.operator,i=n.args.length,s=new Array(i);for(let r=0;r<i;++r)s[r]=ge(n.args[r]);switch(e){case E.ToString:return r=>{const o=s[0](r);return n.args[0].type===he?Ho(o):o.toString()};default:throw new Error(`Unsupported convert operator ${e}`)}}function zn(n,t,e,i,s,r){const o=s-e;if(o===0)return i;const a=t-e,l=n===1?a/o:(Math.pow(n,a)-1)/(Math.pow(n,o)-1);return i+l*(r-i)}function pm(n,t,e,i,s,r){if(s-e===0)return i;const a=ol(i),l=ol(r);let h=l[2]-a[2];h>180?h-=360:h<-180&&(h+=360);const c=[zn(n,t,e,a[0],s,l[0]),zn(n,t,e,a[1],s,l[1]),a[2]+zn(n,t,e,0,s,h),zn(n,t,e,i[3],s,r[3])];return Yh(Yd(c))}class Fr extends os{constructor(t){t=t||{radius:5},super({points:1/0,fill:t.fill,radius:t.radius,stroke:t.stroke,scale:t.scale!==void 0?t.scale:1,rotation:t.rotation!==void 0?t.rotation:0,rotateWithView:t.rotateWithView!==void 0?t.rotateWithView:!1,displacement:t.displacement!==void 0?t.displacement:[0,0],declutterMode:t.declutterMode})}clone(){const t=this.getScale(),e=new Fr({fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,radius:this.getRadius(),scale:Array.isArray(t)?t.slice():t,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()});return e.setOpacity(this.getOpacity()),e}setRadius(t){this.radius=t,this.render()}}class ci{constructor(t){t=t||{},this.patternImage_=null,this.color_=null,t.color!==void 0&&this.setColor(t.color)}clone(){const t=this.getColor();return new ci({color:Array.isArray(t)?t.slice():t||void 0})}getColor(){return this.color_}setColor(t){if(t!==null&&typeof t=="object"&&"src"in t){const e=$o(null,t.src,"anonymous",void 0,t.offset?null:t.color?t.color:null,!(t.offset&&t.size));e.ready().then(()=>{this.patternImage_=null}),e.getImageState()===K.IDLE&&e.load(),e.getImageState()===K.LOADING&&(this.patternImage_=e)}this.color_=t}getKey(){const t=this.getColor();return t?t instanceof CanvasPattern||t instanceof CanvasGradient?Q(t):typeof t=="object"&&"src"in t?t.src+":"+t.offset:hn(t).toString():""}loading(){return!!this.patternImage_}ready(){return this.patternImage_?this.patternImage_.ready():Promise.resolve()}}function Ul(n,t,e,i){return e!==void 0&&i!==void 0?[e/n,i/t]:e!==void 0?e/n:i!==void 0?i/t:1}class ds extends Cr{constructor(t){t=t||{};const e=t.opacity!==void 0?t.opacity:1,i=t.rotation!==void 0?t.rotation:0,s=t.scale!==void 0?t.scale:1,r=t.rotateWithView!==void 0?t.rotateWithView:!1;super({opacity:e,rotation:i,scale:s,displacement:t.displacement!==void 0?t.displacement:[0,0],rotateWithView:r,declutterMode:t.declutterMode}),this.anchor_=t.anchor!==void 0?t.anchor:[.5,.5],this.normalizedAnchor_=null,this.anchorOrigin_=t.anchorOrigin!==void 0?t.anchorOrigin:"top-left",this.anchorXUnits_=t.anchorXUnits!==void 0?t.anchorXUnits:"fraction",this.anchorYUnits_=t.anchorYUnits!==void 0?t.anchorYUnits:"fraction",this.crossOrigin_=t.crossOrigin!==void 0?t.crossOrigin:null;const o=t.img!==void 0?t.img:null;let a=t.src;$(!(a!==void 0&&o),"`image` and `src` cannot be provided at the same time"),(a===void 0||a.length===0)&&o&&(a=o.src||Q(o)),$(a!==void 0&&a.length>0,"A defined and non-empty `src` or `image` must be provided"),$(!((t.width!==void 0||t.height!==void 0)&&t.scale!==void 0),"`width` or `height` cannot be provided together with `scale`");let l;if(t.src!==void 0?l=K.IDLE:o!==void 0&&("complete"in o?o.complete?l=o.src?K.LOADED:K.IDLE:l=K.LOADING:l=K.LOADED),this.color_=t.color!==void 0?hn(t.color):null,this.iconImage_=$o(o,a,this.crossOrigin_,l,this.color_),this.offset_=t.offset!==void 0?t.offset:[0,0],this.offsetOrigin_=t.offsetOrigin!==void 0?t.offsetOrigin:"top-left",this.origin_=null,this.size_=t.size!==void 0?t.size:null,this.initialOptions_,t.width!==void 0||t.height!==void 0){let h,c;if(t.size)[h,c]=t.size;else{const u=this.getImage(1);if(u.width&&u.height)h=u.width,c=u.height;else if(u instanceof HTMLImageElement){this.initialOptions_=t;const d=()=>{if(this.unlistenImageChange(d),!this.initialOptions_)return;const f=this.iconImage_.getSize();this.setScale(Ul(f[0],f[1],t.width,t.height))};this.listenImageChange(d);return}}h!==void 0&&this.setScale(Ul(h,c,t.width,t.height))}}clone(){let t,e,i;return this.initialOptions_?(e=this.initialOptions_.width,i=this.initialOptions_.height):(t=this.getScale(),t=Array.isArray(t)?t.slice():t),new ds({anchor:this.anchor_.slice(),anchorOrigin:this.anchorOrigin_,anchorXUnits:this.anchorXUnits_,anchorYUnits:this.anchorYUnits_,color:this.color_&&this.color_.slice?this.color_.slice():this.color_||void 0,crossOrigin:this.crossOrigin_,offset:this.offset_.slice(),offsetOrigin:this.offsetOrigin_,opacity:this.getOpacity(),rotateWithView:this.getRotateWithView(),rotation:this.getRotation(),scale:t,width:e,height:i,size:this.size_!==null?this.size_.slice():void 0,src:this.getSrc(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()})}getAnchor(){let t=this.normalizedAnchor_;if(!t){t=this.anchor_;const s=this.getSize();if(this.anchorXUnits_=="fraction"||this.anchorYUnits_=="fraction"){if(!s)return null;t=this.anchor_.slice(),this.anchorXUnits_=="fraction"&&(t[0]*=s[0]),this.anchorYUnits_=="fraction"&&(t[1]*=s[1])}if(this.anchorOrigin_!="top-left"){if(!s)return null;t===this.anchor_&&(t=this.anchor_.slice()),(this.anchorOrigin_=="top-right"||this.anchorOrigin_=="bottom-right")&&(t[0]=-t[0]+s[0]),(this.anchorOrigin_=="bottom-left"||this.anchorOrigin_=="bottom-right")&&(t[1]=-t[1]+s[1])}this.normalizedAnchor_=t}const e=this.getDisplacement(),i=this.getScaleArray();return[t[0]-e[0]/i[0],t[1]+e[1]/i[1]]}setAnchor(t){this.anchor_=t,this.normalizedAnchor_=null}getColor(){return this.color_}getImage(t){return this.iconImage_.getImage(t)}getPixelRatio(t){return this.iconImage_.getPixelRatio(t)}getImageSize(){return this.iconImage_.getSize()}getImageState(){return this.iconImage_.getImageState()}getHitDetectionImage(){return this.iconImage_.getHitDetectionImage()}getOrigin(){if(this.origin_)return this.origin_;let t=this.offset_;if(this.offsetOrigin_!="top-left"){const e=this.getSize(),i=this.iconImage_.getSize();if(!e||!i)return null;t=t.slice(),(this.offsetOrigin_=="top-right"||this.offsetOrigin_=="bottom-right")&&(t[0]=i[0]-e[0]-t[0]),(this.offsetOrigin_=="bottom-left"||this.offsetOrigin_=="bottom-right")&&(t[1]=i[1]-e[1]-t[1])}return this.origin_=t,this.origin_}getSrc(){return this.iconImage_.getSrc()}getSize(){return this.size_?this.size_:this.iconImage_.getSize()}getWidth(){const t=this.getScaleArray();if(this.size_)return this.size_[0]*t[0];if(this.iconImage_.getImageState()==K.LOADED)return this.iconImage_.getSize()[0]*t[0]}getHeight(){const t=this.getScaleArray();if(this.size_)return this.size_[1]*t[1];if(this.iconImage_.getImageState()==K.LOADED)return this.iconImage_.getSize()[1]*t[1]}setScale(t){delete this.initialOptions_,super.setScale(t)}listenImageChange(t){this.iconImage_.addEventListener(j.CHANGE,t)}load(){this.iconImage_.load()}unlistenImageChange(t){this.iconImage_.removeEventListener(j.CHANGE,t)}ready(){return this.iconImage_.ready()}}class mn{constructor(t){t=t||{},this.color_=t.color!==void 0?t.color:null,this.lineCap_=t.lineCap,this.lineDash_=t.lineDash!==void 0?t.lineDash:null,this.lineDashOffset_=t.lineDashOffset,this.lineJoin_=t.lineJoin,this.miterLimit_=t.miterLimit,this.width_=t.width}clone(){const t=this.getColor();return new mn({color:Array.isArray(t)?t.slice():t||void 0,lineCap:this.getLineCap(),lineDash:this.getLineDash()?this.getLineDash().slice():void 0,lineDashOffset:this.getLineDashOffset(),lineJoin:this.getLineJoin(),miterLimit:this.getMiterLimit(),width:this.getWidth()})}getColor(){return this.color_}getLineCap(){return this.lineCap_}getLineDash(){return this.lineDash_}getLineDashOffset(){return this.lineDashOffset_}getLineJoin(){return this.lineJoin_}getMiterLimit(){return this.miterLimit_}getWidth(){return this.width_}setColor(t){this.color_=t}setLineCap(t){this.lineCap_=t}setLineDash(t){this.lineDash_=t}setLineDashOffset(t){this.lineDashOffset_=t}setLineJoin(t){this.lineJoin_=t}setMiterLimit(t){this.miterLimit_=t}setWidth(t){this.width_=t}}class ue{constructor(t){t=t||{},this.geometry_=null,this.geometryFunction_=Zl,t.geometry!==void 0&&this.setGeometry(t.geometry),this.fill_=t.fill!==void 0?t.fill:null,this.image_=t.image!==void 0?t.image:null,this.renderer_=t.renderer!==void 0?t.renderer:null,this.hitDetectionRenderer_=t.hitDetectionRenderer!==void 0?t.hitDetectionRenderer:null,this.stroke_=t.stroke!==void 0?t.stroke:null,this.text_=t.text!==void 0?t.text:null,this.zIndex_=t.zIndex}clone(){let t=this.getGeometry();return t&&typeof t=="object"&&(t=t.clone()),new ue({geometry:t??void 0,fill:this.getFill()?this.getFill().clone():void 0,image:this.getImage()?this.getImage().clone():void 0,renderer:this.getRenderer()??void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,text:this.getText()?this.getText().clone():void 0,zIndex:this.getZIndex()})}getRenderer(){return this.renderer_}setRenderer(t){this.renderer_=t}setHitDetectionRenderer(t){this.hitDetectionRenderer_=t}getHitDetectionRenderer(){return this.hitDetectionRenderer_}getGeometry(){return this.geometry_}getGeometryFunction(){return this.geometryFunction_}getFill(){return this.fill_}setFill(t){this.fill_=t}getImage(){return this.image_}setImage(t){this.image_=t}getStroke(){return this.stroke_}setStroke(t){this.stroke_=t}getText(){return this.text_}setText(t){this.text_=t}getZIndex(){return this.zIndex_}setGeometry(t){typeof t=="function"?this.geometryFunction_=t:typeof t=="string"?this.geometryFunction_=function(e){return e.get(t)}:t?t!==void 0&&(this.geometryFunction_=function(){return t}):this.geometryFunction_=Zl,this.geometry_=t}setZIndex(t){this.zIndex_=t}}function ym(n){let t;if(typeof n=="function")t=n;else{let e;Array.isArray(n)?e=n:($(typeof n.getZIndex=="function","Expected an `Style` or an array of `Style`"),e=[n]),t=function(){return e}}return t}let ao=null;function Vc(n,t){if(!ao){const e=new ci({color:"rgba(255,255,255,0.4)"}),i=new mn({color:"#3399CC",width:1.25});ao=[new ue({image:new Fr({fill:e,stroke:i,radius:5}),fill:e,stroke:i})]}return ao}function Zl(n){return n.getGeometry()}const vm="#333";let Hc=class qc{constructor(t){t=t||{},this.font_=t.font,this.rotation_=t.rotation,this.rotateWithView_=t.rotateWithView,this.keepUpright_=t.keepUpright,this.scale_=t.scale,this.scaleArray_=Ut(t.scale!==void 0?t.scale:1),this.text_=t.text,this.textAlign_=t.textAlign,this.justify_=t.justify,this.repeat_=t.repeat,this.textBaseline_=t.textBaseline,this.fill_=t.fill!==void 0?t.fill:new ci({color:vm}),this.maxAngle_=t.maxAngle!==void 0?t.maxAngle:Math.PI/4,this.placement_=t.placement!==void 0?t.placement:"point",this.overflow_=!!t.overflow,this.stroke_=t.stroke!==void 0?t.stroke:null,this.offsetX_=t.offsetX!==void 0?t.offsetX:0,this.offsetY_=t.offsetY!==void 0?t.offsetY:0,this.backgroundFill_=t.backgroundFill?t.backgroundFill:null,this.backgroundStroke_=t.backgroundStroke?t.backgroundStroke:null,this.padding_=t.padding===void 0?null:t.padding,this.declutterMode_=t.declutterMode}clone(){const t=this.getScale();return new qc({font:this.getFont(),placement:this.getPlacement(),repeat:this.getRepeat(),maxAngle:this.getMaxAngle(),overflow:this.getOverflow(),rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),keepUpright:this.getKeepUpright(),scale:Array.isArray(t)?t.slice():t,text:this.getText(),textAlign:this.getTextAlign(),justify:this.getJustify(),textBaseline:this.getTextBaseline(),fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,offsetX:this.getOffsetX(),offsetY:this.getOffsetY(),backgroundFill:this.getBackgroundFill()?this.getBackgroundFill().clone():void 0,backgroundStroke:this.getBackgroundStroke()?this.getBackgroundStroke().clone():void 0,padding:this.getPadding()||void 0,declutterMode:this.getDeclutterMode()})}getOverflow(){return this.overflow_}getFont(){return this.font_}getMaxAngle(){return this.maxAngle_}getPlacement(){return this.placement_}getRepeat(){return this.repeat_}getOffsetX(){return this.offsetX_}getOffsetY(){return this.offsetY_}getFill(){return this.fill_}getRotateWithView(){return this.rotateWithView_}getKeepUpright(){return this.keepUpright_}getRotation(){return this.rotation_}getScale(){return this.scale_}getScaleArray(){return this.scaleArray_}getStroke(){return this.stroke_}getText(){return this.text_}getTextAlign(){return this.textAlign_}getJustify(){return this.justify_}getTextBaseline(){return this.textBaseline_}getBackgroundFill(){return this.backgroundFill_}getBackgroundStroke(){return this.backgroundStroke_}getPadding(){return this.padding_}getDeclutterMode(){return this.declutterMode_}setOverflow(t){this.overflow_=t}setFont(t){this.font_=t}setMaxAngle(t){this.maxAngle_=t}setOffsetX(t){this.offsetX_=t}setOffsetY(t){this.offsetY_=t}setPlacement(t){this.placement_=t}setRepeat(t){this.repeat_=t}setRotateWithView(t){this.rotateWithView_=t}setKeepUpright(t){this.keepUpright_=t}setFill(t){this.fill_=t}setRotation(t){this.rotation_=t}setScale(t){this.scale_=t,this.scaleArray_=Ut(t!==void 0?t:1)}setStroke(t){this.stroke_=t}setText(t){this.text_=t}setTextAlign(t){this.textAlign_=t}setJustify(t){this.justify_=t}setTextBaseline(t){this.textBaseline_=t}setBackgroundFill(t){this.backgroundFill_=t}setBackgroundStroke(t){this.backgroundStroke_=t}setPadding(t){this.padding_=t}};function xm(n){return!0}function wm(n){const t=Kc(),e=Em(n,t),i=Zc();return function(s,r){if(i.properties=s.getPropertiesInternal(),i.resolution=r,t.featureId){const o=s.getId();o!==void 0?i.featureId=o:i.featureId=null}return t.geometryType&&(i.geometryType=Uc(s.getGeometry())),e(i)}}function Vl(n){const t=Kc(),e=n.length,i=new Array(e);for(let o=0;o<e;++o)i[o]=Fo(n[o],t);const s=Zc(),r=new Array(e);return function(o,a){if(s.properties=o.getPropertiesInternal(),s.resolution=a,t.featureId){const h=o.getId();h!==void 0?s.featureId=h:s.featureId=null}let l=0;for(let h=0;h<e;++h){const c=i[h](s);c&&(r[l]=c,l+=1)}return r.length=l,r}}function Em(n,t){const e=n.length,i=new Array(e);for(let s=0;s<e;++s){const r=n[s],o="filter"in r?He(r.filter,Dt,t):xm;let a;if(Array.isArray(r.style)){const l=r.style.length;a=new Array(l);for(let h=0;h<l;++h)a[h]=Fo(r.style[h],t)}else a=[Fo(r.style,t)];i[s]={filter:o,styles:a}}return function(s){const r=[];let o=!1;for(let a=0;a<e;++a){const l=i[a].filter;if(l(s)&&!(n[a].else&&o)){o=!0;for(const h of i[a].styles){const c=h(s);c&&r.push(c)}}}return r}}function Fo(n,t){const e=ts(n,"",t),i=es(n,"",t),s=Cm(n,t),r=Rm(n,t),o=Kt(n,"z-index",t);if(!e&&!i&&!s&&!r&&!Ai(n))throw new Error("No fill, stroke, point, or text symbolizer properties in style: "+JSON.stringify(n));const a=new ue;return function(l){let h=!0;if(e){const c=e(l);c&&(h=!1),a.setFill(c)}if(i){const c=i(l);c&&(h=!1),a.setStroke(c)}if(s){const c=s(l);c&&(h=!1),a.setText(c)}if(r){const c=r(l);c&&(h=!1),a.setImage(c)}return o&&a.setZIndex(o(l)),h?null:a}}function ts(n,t,e){let i;if(t+"fill-pattern-src"in n)i=bm(n,t+"fill-",e);else{if(n[t+"fill-color"]==="none")return r=>null;i=Oa(n,t+"fill-color",e)}if(!i)return null;const s=new ci;return function(r){const o=i(r);return o===Zo?null:(s.setColor(o),s)}}function es(n,t,e){const i=Kt(n,t+"stroke-width",e),s=Oa(n,t+"stroke-color",e);if(!i&&!s)return null;const r=Xe(n,t+"stroke-line-cap",e),o=Xe(n,t+"stroke-line-join",e),a=$c(n,t+"stroke-line-dash",e),l=Kt(n,t+"stroke-line-dash-offset",e),h=Kt(n,t+"stroke-miter-limit",e),c=new mn;return function(u){if(s){const d=s(u);if(d===Zo)return null;c.setColor(d)}if(i&&c.setWidth(i(u)),r){const d=r(u);if(d!=="butt"&&d!=="round"&&d!=="square")throw new Error("Expected butt, round, or square line cap");c.setLineCap(d)}if(o){const d=o(u);if(d!=="bevel"&&d!=="round"&&d!=="miter")throw new Error("Expected bevel, round, or miter line join");c.setLineJoin(d)}return a&&c.setLineDash(a(u)),l&&c.setLineDashOffset(l(u)),h&&c.setMiterLimit(h(u)),c}}function Cm(n,t){const e="text-",i=Xe(n,e+"value",t);if(!i)return null;const s=ts(n,e,t),r=ts(n,e+"background-",t),o=es(n,e,t),a=es(n,e+"background-",t),l=Xe(n,e+"font",t),h=Kt(n,e+"max-angle",t),c=Kt(n,e+"offset-x",t),u=Kt(n,e+"offset-y",t),d=an(n,e+"overflow",t),f=Xe(n,e+"placement",t),g=Kt(n,e+"repeat",t),_=Dr(n,e+"scale",t),m=an(n,e+"rotate-with-view",t),p=Kt(n,e+"rotation",t),y=Xe(n,e+"align",t),w=Xe(n,e+"justify",t),x=Xe(n,e+"baseline",t),v=an(n,e+"keep-upright",t),R=$c(n,e+"padding",t),S=kr(n,e+"declutter-mode"),C=new Hc({declutterMode:S});return function(I){if(C.setText(i(I)),s&&C.setFill(s(I)),r&&C.setBackgroundFill(r(I)),o&&C.setStroke(o(I)),a&&C.setBackgroundStroke(a(I)),l&&C.setFont(l(I)),h&&C.setMaxAngle(h(I)),c&&C.setOffsetX(c(I)),u&&C.setOffsetY(u(I)),d&&C.setOverflow(d(I)),f){const b=f(I);if(b!=="point"&&b!=="line")throw new Error("Expected point or line for text-placement");C.setPlacement(b)}if(g&&C.setRepeat(g(I)),_&&C.setScale(_(I)),m&&C.setRotateWithView(m(I)),p&&C.setRotation(p(I)),y){const b=y(I);if(b!=="left"&&b!=="center"&&b!=="right"&&b!=="end"&&b!=="start")throw new Error("Expected left, right, center, start, or end for text-align");C.setTextAlign(b)}if(w){const b=w(I);if(b!=="left"&&b!=="right"&&b!=="center")throw new Error("Expected left, right, or center for text-justify");C.setJustify(b)}if(x){const b=x(I);if(b!=="bottom"&&b!=="top"&&b!=="middle"&&b!=="alphabetic"&&b!=="hanging")throw new Error("Expected bottom, top, middle, alphabetic, or hanging for text-baseline");C.setTextBaseline(b)}return R&&C.setPadding(R(I)),v&&C.setKeepUpright(v(I)),C}}function Rm(n,t){return"icon-src"in n?Im(n,t):"shape-points"in n?Sm(n,t):"circle-radius"in n?Tm(n,t):null}function Im(n,t){const e="icon-",i=e+"src",s=Jc(n[i],i),r=Qs(n,e+"anchor",t),o=Dr(n,e+"scale",t),a=Kt(n,e+"opacity",t),l=Qs(n,e+"displacement",t),h=Kt(n,e+"rotation",t),c=an(n,e+"rotate-with-view",t),u=ql(n,e+"anchor-origin"),d=$l(n,e+"anchor-x-units"),f=$l(n,e+"anchor-y-units"),g=Pm(n,e+"color"),_=Am(n,e+"cross-origin"),m=Lm(n,e+"offset"),p=ql(n,e+"offset-origin"),y=tr(n,e+"width"),w=tr(n,e+"height"),x=Mm(n,e+"size"),v=kr(n,e+"declutter-mode"),R=new ds({src:s,anchorOrigin:u,anchorXUnits:d,anchorYUnits:f,color:g,crossOrigin:_,offset:m,offsetOrigin:p,height:w,width:y,size:x,declutterMode:v});return function(S){return a&&R.setOpacity(a(S)),l&&R.setDisplacement(l(S)),h&&R.setRotation(h(S)),c&&R.setRotateWithView(c(S)),o&&R.setScale(o(S)),r&&R.setAnchor(r(S)),R}}function Sm(n,t){const e="shape-",i=e+"points",s=e+"radius",r=Do(n[i],i),o=Do(n[s],s),a=ts(n,e,t),l=es(n,e,t),h=Dr(n,e+"scale",t),c=Qs(n,e+"displacement",t),u=Kt(n,e+"rotation",t),d=an(n,e+"rotate-with-view",t),f=tr(n,e+"radius2"),g=tr(n,e+"angle"),_=kr(n,e+"declutter-mode"),m=new os({points:r,radius:o,radius2:f,angle:g,declutterMode:_});return function(p){return a&&m.setFill(a(p)),l&&m.setStroke(l(p)),c&&m.setDisplacement(c(p)),u&&m.setRotation(u(p)),d&&m.setRotateWithView(d(p)),h&&m.setScale(h(p)),m}}function Tm(n,t){const e="circle-",i=ts(n,e,t),s=es(n,e,t),r=Kt(n,e+"radius",t),o=Dr(n,e+"scale",t),a=Qs(n,e+"displacement",t),l=Kt(n,e+"rotation",t),h=an(n,e+"rotate-with-view",t),c=kr(n,e+"declutter-mode"),u=new Fr({radius:5,declutterMode:c});return function(d){return r&&u.setRadius(r(d)),i&&u.setFill(i(d)),s&&u.setStroke(s(d)),a&&u.setDisplacement(a(d)),l&&u.setRotation(l(d)),h&&u.setRotateWithView(h(d)),o&&u.setScale(o(d)),u}}function Kt(n,t,e){if(!(t in n))return;const i=He(n[t],H,e);return function(s){return Do(i(s),t)}}function Xe(n,t,e){if(!(t in n))return null;const i=He(n[t],jt,e);return function(s){return Jc(i(s),t)}}function bm(n,t,e){const i=Xe(n,t+"pattern-src",e),s=Hl(n,t+"pattern-offset",e),r=Hl(n,t+"pattern-size",e),o=Oa(n,t+"color",e);return function(a){return{src:i(a),offset:s&&s(a),size:r&&r(a),color:o&&o(a)}}}function an(n,t,e){if(!(t in n))return null;const i=He(n[t],Dt,e);return function(s){const r=i(s);if(typeof r!="boolean")throw new Error(`Expected a boolean for ${t}`);return r}}function Oa(n,t,e){if(!(t in n))return null;const i=He(n[t],he,e);return function(s){return Qc(i(s),t)}}function $c(n,t,e){if(!(t in n))return null;const i=He(n[t],Pi,e);return function(s){return fs(i(s),t)}}function Qs(n,t,e){if(!(t in n))return null;const i=He(n[t],Pi,e);return function(s){const r=fs(i(s),t);if(r.length!==2)throw new Error(`Expected two numbers for ${t}`);return r}}function Hl(n,t,e){if(!(t in n))return null;const i=He(n[t],Pi,e);return function(s){return tu(i(s),t)}}function Dr(n,t,e){if(!(t in n))return null;const i=He(n[t],Pi|H,e);return function(s){return Om(i(s),t)}}function tr(n,t){const e=n[t];if(e!==void 0){if(typeof e!="number")throw new Error(`Expected a number for ${t}`);return e}}function Mm(n,t){const e=n[t];if(e!==void 0){if(typeof e=="number")return Ut(e);if(!Array.isArray(e))throw new Error(`Expected a number or size array for ${t}`);if(e.length!==2||typeof e[0]!="number"||typeof e[1]!="number")throw new Error(`Expected a number or size array for ${t}`);return e}}function Am(n,t){const e=n[t];if(e!==void 0){if(typeof e!="string")throw new Error(`Expected a string for ${t}`);return e}}function ql(n,t){const e=n[t];if(e!==void 0){if(e!=="bottom-left"&&e!=="bottom-right"&&e!=="top-left"&&e!=="top-right")throw new Error(`Expected bottom-left, bottom-right, top-left, or top-right for ${t}`);return e}}function $l(n,t){const e=n[t];if(e!==void 0){if(e!=="pixels"&&e!=="fraction")throw new Error(`Expected pixels or fraction for ${t}`);return e}}function Lm(n,t){const e=n[t];if(e!==void 0)return fs(e,t)}function kr(n,t){const e=n[t];if(e!==void 0){if(typeof e!="string")throw new Error(`Expected a string for ${t}`);if(e!=="declutter"&&e!=="obstacle"&&e!=="none")throw new Error(`Expected declutter, obstacle, or none for ${t}`);return e}}function Pm(n,t){const e=n[t];if(e!==void 0)return Qc(e,t)}function fs(n,t){if(!Array.isArray(n))throw new Error(`Expected an array for ${t}`);const e=n.length;for(let i=0;i<e;++i)if(typeof n[i]!="number")throw new Error(`Expected an array of numbers for ${t}`);return n}function Jc(n,t){if(typeof n!="string")throw new Error(`Expected a string for ${t}`);return n}function Do(n,t){if(typeof n!="number")throw new Error(`Expected a number for ${t}`);return n}function Qc(n,t){if(typeof n=="string")return n;const e=fs(n,t),i=e.length;if(i<3||i>4)throw new Error(`Expected a color with 3 or 4 values for ${t}`);return e}function tu(n,t){const e=fs(n,t);if(e.length!==2)throw new Error(`Expected an array of two numbers for ${t}`);return e}function Om(n,t){return typeof n=="number"?n:tu(n,t)}const Jl={RENDER_ORDER:"renderOrder"};class eu extends Or{constructor(t){t=t||{};const e=Object.assign({},t);delete e.style,delete e.renderBuffer,delete e.updateWhileAnimating,delete e.updateWhileInteracting,super(e),this.declutter_=t.declutter?String(t.declutter):void 0,this.renderBuffer_=t.renderBuffer!==void 0?t.renderBuffer:100,this.style_=null,this.styleFunction_=void 0,this.setStyle(t.style),this.updateWhileAnimating_=t.updateWhileAnimating!==void 0?t.updateWhileAnimating:!1,this.updateWhileInteracting_=t.updateWhileInteracting!==void 0?t.updateWhileInteracting:!1}getDeclutter(){return this.declutter_}getFeatures(t){return super.getFeatures(t)}getRenderBuffer(){return this.renderBuffer_}getRenderOrder(){return this.get(Jl.RENDER_ORDER)}getStyle(){return this.style_}getStyleFunction(){return this.styleFunction_}getUpdateWhileAnimating(){return this.updateWhileAnimating_}getUpdateWhileInteracting(){return this.updateWhileInteracting_}renderDeclutter(t,e){const i=this.getDeclutter();i in t.declutter||(t.declutter[i]=new Bc(9)),this.getRenderer().renderDeclutter(t,e)}setRenderOrder(t){this.set(Jl.RENDER_ORDER,t)}setStyle(t){this.style_=t===void 0?Vc:t;const e=Fm(t);this.styleFunction_=t===null?void 0:ym(e),this.changed()}setDeclutter(t){this.declutter_=t?String(t):void 0,this.changed()}}function Fm(n){if(n===void 0)return Vc;if(!n)return null;if(typeof n=="function"||n instanceof ue)return n;if(!Array.isArray(n))return Vl([n]);if(n.length===0)return[];const t=n.length,e=n[0];if(e instanceof ue){const s=new Array(t);for(let r=0;r<t;++r){const o=n[r];if(!(o instanceof ue))throw new Error("Expected a list of style instances");s[r]=o}return s}if("style"in e){const s=new Array(t);for(let r=0;r<t;++r){const o=n[r];if(!("style"in o))throw new Error("Expected a list of rules with a style property");s[r]=o}return wm(s)}return Vl(n)}class Dm extends vr{constructor(t){super(),this.map_=t}dispatchRenderEvent(t,e){G()}calculateMatrices2D(t){const e=t.viewState,i=t.coordinateToPixelTransform,s=t.pixelToCoordinateTransform;Ke(i,t.size[0]/2,t.size[1]/2,1/e.resolution,-1/e.resolution,-e.rotation,-e.center[0],-e.center[1]),Rc(s,i)}forEachFeatureAtCoordinate(t,e,i,s,r,o,a,l){let h;const c=e.viewState;function u(x,v,R,S){return r.call(o,v,x?R:null,S)}const d=c.projection,f=lc(t.slice(),d),g=[[0,0]];if(d.canWrapX()&&s){const x=d.getExtent(),v=nt(x);g.push([-v,0],[v,0])}const _=e.layerStatesArray,m=_.length,p=[],y=[];for(let x=0;x<g.length;x++)for(let v=m-1;v>=0;--v){const R=_[v],S=R.layer;if(S.hasRenderer()&&ba(R,c)&&a.call(l,S)){const C=S.getRenderer(),I=S.getSource();if(C&&I){const b=I.getWrapX()?f:t,L=u.bind(null,R.managed);y[0]=b[0]+g[x][0],y[1]=b[1]+g[x][1],h=C.forEachFeatureAtCoordinate(y,e,i,L,p)}if(h)return h}}if(p.length===0)return;const w=1/p.length;return p.forEach((x,v)=>x.distanceSq+=v*w),p.sort((x,v)=>x.distanceSq-v.distanceSq),p.some(x=>h=x.callback(x.feature,x.layer,x.geometry)),h}hasFeatureAtCoordinate(t,e,i,s,r,o){return this.forEachFeatureAtCoordinate(t,e,i,s,Bn,this,r,o)!==void 0}getMap(){return this.map_}renderFrame(t){G()}scheduleExpireIconCache(t){ee.canExpireCache()&&t.postRenderFunctions.push(km)}}function km(n,t){ee.expire()}class Nm extends Dm{constructor(t){super(t),this.fontChangeListenerKey_=q(Ne,un.PROPERTYCHANGE,t.redrawText,t),this.element_=document.createElement("div");const e=this.element_.style;e.position="absolute",e.width="100%",e.height="100%",e.zIndex="0",this.element_.className=Er+" ol-layers";const i=t.getViewport();i.insertBefore(this.element_,i.firstChild||null),this.children_=[],this.renderedVisible_=!0}dispatchRenderEvent(t,e){const i=this.getMap();if(i.hasListener(t)){const s=new Tc(t,void 0,e);i.dispatchEvent(s)}}disposeInternal(){at(this.fontChangeListenerKey_),this.element_.remove(),super.disposeInternal()}renderFrame(t){if(!t){this.renderedVisible_&&(this.element_.style.display="none",this.renderedVisible_=!1);return}this.calculateMatrices2D(t),this.dispatchRenderEvent(ie.PRECOMPOSE,t);const e=t.layerStatesArray.sort((a,l)=>a.zIndex-l.zIndex);e.some(a=>a.layer instanceof eu&&a.layer.getDeclutter())&&(t.declutter={});const s=t.viewState;this.children_.length=0;const r=[];let o=null;for(let a=0,l=e.length;a<l;++a){const h=e[a];t.layerIndex=a;const c=h.layer,u=c.getSourceState();if(!ba(h,s)||u!="ready"&&u!="undefined"){c.unrender();continue}const d=c.render(t,o);d&&(d!==o&&(this.children_.push(d),o=d),r.push(h))}this.declutter(t,r),Zd(this.element_,this.children_),this.dispatchRenderEvent(ie.POSTCOMPOSE,t),this.renderedVisible_||(this.element_.style.display="",this.renderedVisible_=!0),this.scheduleExpireIconCache(t)}declutter(t,e){if(t.declutter){for(let i=e.length-1;i>=0;--i){const s=e[i],r=s.layer;r.getDeclutter()&&r.renderDeclutter(t,s)}e.forEach(i=>i.layer.renderDeferred(t))}}}function iu(n){if(n instanceof Or){n.setMapInternal(null);return}n instanceof Ni&&n.getLayers().forEach(iu)}function nu(n,t){if(n instanceof Or){n.setMapInternal(t);return}if(n instanceof Ni){const e=n.getLayers().getArray();for(let i=0,s=e.length;i<s;++i)nu(e[i],t)}}let Gm=class extends Ae{constructor(t){super(),t=t||{},this.on,this.once,this.un;const e=zm(t);this.renderComplete_=!1,this.loaded_=!0,this.boundHandleBrowserEvent_=this.handleBrowserEvent.bind(this),this.maxTilesLoading_=t.maxTilesLoading!==void 0?t.maxTilesLoading:16,this.pixelRatio_=t.pixelRatio!==void 0?t.pixelRatio:Bh,this.postRenderTimeoutHandle_,this.animationDelayKey_,this.animationDelay_=this.animationDelay_.bind(this),this.coordinateToPixelTransform_=de(),this.pixelToCoordinateTransform_=de(),this.frameIndex_=0,this.frameState_=null,this.previousExtent_=null,this.viewPropertyListenerKey_=null,this.viewChangeListenerKey_=null,this.layerGroupPropertyListenerKeys_=null,this.viewport_=document.createElement("div"),this.viewport_.className="ol-viewport"+("ontouchstart"in window?" ol-touch":""),this.viewport_.style.position="relative",this.viewport_.style.overflow="hidden",this.viewport_.style.width="100%",this.viewport_.style.height="100%",this.overlayContainer_=document.createElement("div"),this.overlayContainer_.style.position="absolute",this.overlayContainer_.style.zIndex="0",this.overlayContainer_.style.width="100%",this.overlayContainer_.style.height="100%",this.overlayContainer_.style.pointerEvents="none",this.overlayContainer_.className="ol-overlaycontainer",this.viewport_.appendChild(this.overlayContainer_),this.overlayContainerStopEvent_=document.createElement("div"),this.overlayContainerStopEvent_.style.position="absolute",this.overlayContainerStopEvent_.style.zIndex="0",this.overlayContainerStopEvent_.style.width="100%",this.overlayContainerStopEvent_.style.height="100%",this.overlayContainerStopEvent_.style.pointerEvents="none",this.overlayContainerStopEvent_.className="ol-overlaycontainer-stopevent",this.viewport_.appendChild(this.overlayContainerStopEvent_),this.mapBrowserEventHandler_=null,this.moveTolerance_=t.moveTolerance,this.keyboardEventTarget_=e.keyboardEventTarget,this.targetChangeHandlerKeys_=null,this.targetElement_=null,this.resizeObserver_=new ResizeObserver(()=>this.updateSize()),this.controls=e.controls||w_(),this.interactions=e.interactions||W_({onFocusOnly:!0}),this.overlays_=e.overlays,this.overlayIdIndex_={},this.renderer_=null,this.postRenderFunctions_=[],this.tileQueue_=new m_(this.getTilePriority.bind(this),this.handleTileChange_.bind(this)),this.addChangeListener(At.LAYERGROUP,this.handleLayerGroupChanged_),this.addChangeListener(At.VIEW,this.handleViewChanged_),this.addChangeListener(At.SIZE,this.handleSizeChanged_),this.addChangeListener(At.TARGET,this.handleTargetChanged_),this.setProperties(e.values);const i=this;t.view&&!(t.view instanceof we)&&t.view.then(function(s){i.setView(new we(s))}),this.controls.addEventListener(Yt.ADD,s=>{s.element.setMap(this)}),this.controls.addEventListener(Yt.REMOVE,s=>{s.element.setMap(null)}),this.interactions.addEventListener(Yt.ADD,s=>{s.element.setMap(this)}),this.interactions.addEventListener(Yt.REMOVE,s=>{s.element.setMap(null)}),this.overlays_.addEventListener(Yt.ADD,s=>{this.addOverlayInternal_(s.element)}),this.overlays_.addEventListener(Yt.REMOVE,s=>{const r=s.element.getId();r!==void 0&&delete this.overlayIdIndex_[r.toString()],s.element.setMap(null)}),this.controls.forEach(s=>{s.setMap(this)}),this.interactions.forEach(s=>{s.setMap(this)}),this.overlays_.forEach(this.addOverlayInternal_.bind(this))}addControl(t){this.getControls().push(t)}addInteraction(t){this.getInteractions().push(t)}addLayer(t){this.getLayerGroup().getLayers().push(t)}handleLayerAdd_(t){nu(t.layer,this)}addOverlay(t){this.getOverlays().push(t)}addOverlayInternal_(t){const e=t.getId();e!==void 0&&(this.overlayIdIndex_[e.toString()]=t),t.setMap(this)}disposeInternal(){this.controls.clear(),this.interactions.clear(),this.overlays_.clear(),this.resizeObserver_.disconnect(),this.setTarget(null),super.disposeInternal()}forEachFeatureAtPixel(t,e,i){if(!this.frameState_||!this.renderer_)return;const s=this.getCoordinateFromPixelInternal(t);i=i!==void 0?i:{};const r=i.hitTolerance!==void 0?i.hitTolerance:0,o=i.layerFilter!==void 0?i.layerFilter:Bn,a=i.checkWrapped!==!1;return this.renderer_.forEachFeatureAtCoordinate(s,this.frameState_,r,a,e,null,o,null)}getFeaturesAtPixel(t,e){const i=[];return this.forEachFeatureAtPixel(t,function(s){i.push(s)},e),i}getAllLayers(){const t=[];function e(i){i.forEach(function(s){s instanceof Ni?e(s.getLayers()):t.push(s)})}return e(this.getLayers()),t}hasFeatureAtPixel(t,e){if(!this.frameState_||!this.renderer_)return!1;const i=this.getCoordinateFromPixelInternal(t);e=e!==void 0?e:{};const s=e.layerFilter!==void 0?e.layerFilter:Bn,r=e.hitTolerance!==void 0?e.hitTolerance:0,o=e.checkWrapped!==!1;return this.renderer_.hasFeatureAtCoordinate(i,this.frameState_,r,o,s,null)}getEventCoordinate(t){return this.getCoordinateFromPixel(this.getEventPixel(t))}getEventCoordinateInternal(t){return this.getCoordinateFromPixelInternal(this.getEventPixel(t))}getEventPixel(t){const i=this.viewport_.getBoundingClientRect(),s=this.getSize(),r=i.width/s[0],o=i.height/s[1],a="changedTouches"in t?t.changedTouches[0]:t;return[(a.clientX-i.left)/r,(a.clientY-i.top)/o]}getTarget(){return this.get(At.TARGET)}getTargetElement(){return this.targetElement_}getCoordinateFromPixel(t){return bo(this.getCoordinateFromPixelInternal(t),this.getView().getProjection())}getCoordinateFromPixelInternal(t){const e=this.frameState_;return e?Rt(e.pixelToCoordinateTransform,t.slice()):null}getControls(){return this.controls}getOverlays(){return this.overlays_}getOverlayById(t){const e=this.overlayIdIndex_[t.toString()];return e!==void 0?e:null}getInteractions(){return this.interactions}getLayerGroup(){return this.get(At.LAYERGROUP)}setLayers(t){const e=this.getLayerGroup();if(t instanceof Re){e.setLayers(t);return}const i=e.getLayers();i.clear(),i.extend(t)}getLayers(){return this.getLayerGroup().getLayers()}getLoadingOrNotReady(){const t=this.getLayerGroup().getLayerStatesArray();for(let e=0,i=t.length;e<i;++e){const s=t[e];if(!s.visible)continue;const r=s.layer.getRenderer();if(r&&!r.ready)return!0;const o=s.layer.getSource();if(o&&o.loading)return!0}return!1}getPixelFromCoordinate(t){const e=Ge(t,this.getView().getProjection());return this.getPixelFromCoordinateInternal(e)}getPixelFromCoordinateInternal(t){const e=this.frameState_;return e?Rt(e.coordinateToPixelTransform,t.slice(0,2)):null}getRenderer(){return this.renderer_}getSize(){return this.get(At.SIZE)}getView(){return this.get(At.VIEW)}getViewport(){return this.viewport_}getOverlayContainer(){return this.overlayContainer_}getOverlayContainerStopEvent(){return this.overlayContainerStopEvent_}getOwnerDocument(){const t=this.getTargetElement();return t?t.ownerDocument:document}getTilePriority(t,e,i,s){return p_(this.frameState_,t,e,i,s)}handleBrowserEvent(t,e){e=e||t.type;const i=new ei(e,this,t);this.handleMapBrowserEvent(i)}handleMapBrowserEvent(t){if(!this.frameState_)return;const e=t.originalEvent,i=e.type;if(i===Po.POINTERDOWN||i===j.WHEEL||i===j.KEYDOWN){const s=this.getOwnerDocument(),r=this.viewport_.getRootNode?this.viewport_.getRootNode():s,o=e.target,a=r instanceof ShadowRoot?r.host===o?r.host.ownerDocument:r:r===s?s.documentElement:r;if(this.overlayContainerStopEvent_.contains(o)||!a.contains(o))return}if(t.frameState=this.frameState_,this.dispatchEvent(t)!==!1){const s=this.getInteractions().getArray().slice();for(let r=s.length-1;r>=0;r--){const o=s[r];if(o.getMap()!==this||!o.getActive()||!this.getTargetElement())continue;if(!o.handleEvent(t)||t.propagationStopped)break}}}handlePostRender(){const t=this.frameState_,e=this.tileQueue_;if(!e.isEmpty()){let s=this.maxTilesLoading_,r=s;if(t){const o=t.viewHints;if(o[Lt.ANIMATING]||o[Lt.INTERACTING]){const a=Date.now()-t.time>8;s=a?0:8,r=a?0:2}}e.getTilesLoading()<s&&(e.reprioritize(),e.loadMoreTiles(s,r))}t&&this.renderer_&&!t.animate&&(this.renderComplete_?(this.hasListener(ie.RENDERCOMPLETE)&&this.renderer_.dispatchRenderEvent(ie.RENDERCOMPLETE,t),this.loaded_===!1&&(this.loaded_=!0,this.dispatchEvent(new Ji(ii.LOADEND,this,t)))):this.loaded_===!0&&(this.loaded_=!1,this.dispatchEvent(new Ji(ii.LOADSTART,this,t))));const i=this.postRenderFunctions_;if(t)for(let s=0,r=i.length;s<r;++s)i[s](this,t);i.length=0}handleSizeChanged_(){this.getView()&&!this.getView().getAnimating()&&this.getView().resolveConstraints(0),this.render()}handleTargetChanged_(){if(this.mapBrowserEventHandler_){for(let i=0,s=this.targetChangeHandlerKeys_.length;i<s;++i)at(this.targetChangeHandlerKeys_[i]);this.targetChangeHandlerKeys_=null,this.viewport_.removeEventListener(j.CONTEXTMENU,this.boundHandleBrowserEvent_),this.viewport_.removeEventListener(j.WHEEL,this.boundHandleBrowserEvent_),this.mapBrowserEventHandler_.dispose(),this.mapBrowserEventHandler_=null,this.viewport_.remove()}if(this.targetElement_){this.resizeObserver_.unobserve(this.targetElement_);const i=this.targetElement_.getRootNode();i instanceof ShadowRoot&&this.resizeObserver_.unobserve(i.host),this.setSize(void 0)}const t=this.getTarget(),e=typeof t=="string"?document.getElementById(t):t;if(this.targetElement_=e,!e)this.renderer_&&(clearTimeout(this.postRenderTimeoutHandle_),this.postRenderTimeoutHandle_=void 0,this.postRenderFunctions_.length=0,this.renderer_.dispose(),this.renderer_=null),this.animationDelayKey_&&(cancelAnimationFrame(this.animationDelayKey_),this.animationDelayKey_=void 0);else{e.appendChild(this.viewport_),this.renderer_||(this.renderer_=new Nm(this)),this.mapBrowserEventHandler_=new g_(this,this.moveTolerance_);for(const r in ut)this.mapBrowserEventHandler_.addEventListener(ut[r],this.handleMapBrowserEvent.bind(this));this.viewport_.addEventListener(j.CONTEXTMENU,this.boundHandleBrowserEvent_,!1),this.viewport_.addEventListener(j.WHEEL,this.boundHandleBrowserEvent_,Zh?{passive:!1}:!1);let i;if(this.keyboardEventTarget_)i=this.keyboardEventTarget_;else{const r=e.getRootNode();i=r instanceof ShadowRoot?r.host:e}this.targetChangeHandlerKeys_=[q(i,j.KEYDOWN,this.handleBrowserEvent,this),q(i,j.KEYPRESS,this.handleBrowserEvent,this)];const s=e.getRootNode();s instanceof ShadowRoot&&this.resizeObserver_.observe(s.host),this.resizeObserver_.observe(e)}this.updateSize()}handleTileChange_(){this.render()}handleViewPropertyChanged_(){this.render()}handleViewChanged_(){this.viewPropertyListenerKey_&&(at(this.viewPropertyListenerKey_),this.viewPropertyListenerKey_=null),this.viewChangeListenerKey_&&(at(this.viewChangeListenerKey_),this.viewChangeListenerKey_=null);const t=this.getView();t&&(this.updateViewportSize_(this.getSize()),this.viewPropertyListenerKey_=q(t,un.PROPERTYCHANGE,this.handleViewPropertyChanged_,this),this.viewChangeListenerKey_=q(t,j.CHANGE,this.handleViewPropertyChanged_,this),t.resolveConstraints(0)),this.render()}handleLayerGroupChanged_(){this.layerGroupPropertyListenerKeys_&&(this.layerGroupPropertyListenerKeys_.forEach(at),this.layerGroupPropertyListenerKeys_=null);const t=this.getLayerGroup();t&&(this.handleLayerAdd_(new ni("addlayer",t)),this.layerGroupPropertyListenerKeys_=[q(t,un.PROPERTYCHANGE,this.render,this),q(t,j.CHANGE,this.render,this),q(t,"addlayer",this.handleLayerAdd_,this),q(t,"removelayer",this.handleLayerRemove_,this)]),this.render()}isRendered(){return!!this.frameState_}animationDelay_(){this.animationDelayKey_=void 0,this.renderFrame_(Date.now())}renderSync(){this.animationDelayKey_&&cancelAnimationFrame(this.animationDelayKey_),this.animationDelay_()}redrawText(){const t=this.getLayerGroup().getLayerStatesArray();for(let e=0,i=t.length;e<i;++e){const s=t[e].layer;s.hasRenderer()&&s.getRenderer().handleFontsChanged()}}render(){this.renderer_&&this.animationDelayKey_===void 0&&(this.animationDelayKey_=requestAnimationFrame(this.animationDelay_))}removeControl(t){return this.getControls().remove(t)}removeInteraction(t){return this.getInteractions().remove(t)}removeLayer(t){return this.getLayerGroup().getLayers().remove(t)}handleLayerRemove_(t){iu(t.layer)}removeOverlay(t){return this.getOverlays().remove(t)}renderFrame_(t){const e=this.getSize(),i=this.getView(),s=this.frameState_;let r=null;if(e!==void 0&&dl(e)&&i&&i.isDef()){const o=i.getHints(this.frameState_?this.frameState_.viewHints:void 0),a=i.getState();if(r={animate:!1,coordinateToPixelTransform:this.coordinateToPixelTransform_,declutter:null,extent:Ro(a.center,a.resolution,a.rotation,e),index:this.frameIndex_++,layerIndex:0,layerStatesArray:this.getLayerGroup().getLayerStatesArray(),pixelRatio:this.pixelRatio_,pixelToCoordinateTransform:this.pixelToCoordinateTransform_,postRenderFunctions:[],size:e,tileQueue:this.tileQueue_,time:t,usedTiles:{},viewState:a,viewHints:o,wantedTiles:{},mapId:Q(this),renderTargets:{}},a.nextCenter&&a.nextResolution){const l=isNaN(a.nextRotation)?a.rotation:a.nextRotation;r.nextExtent=Ro(a.nextCenter,a.nextResolution,l,e)}}this.frameState_=r,this.renderer_.renderFrame(r),r&&(r.animate&&this.render(),Array.prototype.push.apply(this.postRenderFunctions_,r.postRenderFunctions),s&&(!this.previousExtent_||!Tr(this.previousExtent_)&&!Hn(r.extent,this.previousExtent_))&&(this.dispatchEvent(new Ji(ii.MOVESTART,this,s)),this.previousExtent_=as(this.previousExtent_)),this.previousExtent_&&!r.viewHints[Lt.ANIMATING]&&!r.viewHints[Lt.INTERACTING]&&!Hn(r.extent,this.previousExtent_)&&(this.dispatchEvent(new Ji(ii.MOVEEND,this,r)),Qh(r.extent,this.previousExtent_))),this.dispatchEvent(new Ji(ii.POSTRENDER,this,r)),this.renderComplete_=(this.hasListener(ii.LOADSTART)||this.hasListener(ii.LOADEND)||this.hasListener(ie.RENDERCOMPLETE))&&!this.tileQueue_.getTilesLoading()&&!this.tileQueue_.getCount()&&!this.getLoadingOrNotReady(),this.postRenderTimeoutHandle_||(this.postRenderTimeoutHandle_=setTimeout(()=>{this.postRenderTimeoutHandle_=void 0,this.handlePostRender()},0))}setLayerGroup(t){const e=this.getLayerGroup();e&&this.handleLayerRemove_(new ni("removelayer",e)),this.set(At.LAYERGROUP,t)}setSize(t){this.set(At.SIZE,t)}setTarget(t){this.set(At.TARGET,t)}setView(t){if(!t||t instanceof we){this.set(At.VIEW,t);return}this.set(At.VIEW,new we);const e=this;t.then(function(i){e.setView(new we(i))})}updateSize(){const t=this.getTargetElement();let e;if(t){const s=getComputedStyle(t),r=t.offsetWidth-parseFloat(s.borderLeftWidth)-parseFloat(s.paddingLeft)-parseFloat(s.paddingRight)-parseFloat(s.borderRightWidth),o=t.offsetHeight-parseFloat(s.borderTopWidth)-parseFloat(s.paddingTop)-parseFloat(s.paddingBottom)-parseFloat(s.borderBottomWidth);!isNaN(r)&&!isNaN(o)&&(e=[Math.max(0,r),Math.max(0,o)],!dl(e)&&(t.offsetWidth||t.offsetHeight||t.getClientRects().length)&&ac("No map visible because the map container's width or height are 0."))}const i=this.getSize();e&&(!i||!mi(e,i))&&(this.setSize(e),this.updateViewportSize_(e))}updateViewportSize_(t){const e=this.getView();e&&e.setViewportSize(t)}};function zm(n){let t=null;n.keyboardEventTarget!==void 0&&(t=typeof n.keyboardEventTarget=="string"?document.getElementById(n.keyboardEventTarget):n.keyboardEventTarget);const e={},i=n.layers&&typeof n.layers.getLayers=="function"?n.layers:new Ni({layers:n.layers});e[At.LAYERGROUP]=i,e[At.TARGET]=n.target,e[At.VIEW]=n.view instanceof we?n.view:new we;let s;n.controls!==void 0&&(Array.isArray(n.controls)?s=new Re(n.controls.slice()):($(typeof n.controls.getArray=="function","Expected `controls` to be an array or an `ol/Collection.js`"),s=n.controls));let r;n.interactions!==void 0&&(Array.isArray(n.interactions)?r=new Re(n.interactions.slice()):($(typeof n.interactions.getArray=="function","Expected `interactions` to be an array or an `ol/Collection.js`"),r=n.interactions));let o;return n.overlays!==void 0?Array.isArray(n.overlays)?o=new Re(n.overlays.slice()):($(typeof n.overlays.getArray=="function","Expected `overlays` to be an array or an `ol/Collection.js`"),o=n.overlays):o=new Re,{controls:s,interactions:r,keyboardEventTarget:t,overlays:o,values:e}}class su{drawCustom(t,e,i,s,r){}drawGeometry(t){}setStyle(t){}drawCircle(t,e,i){}drawFeature(t,e,i){}drawGeometryCollection(t,e,i){}drawLineString(t,e,i){}drawMultiLineString(t,e,i){}drawMultiPoint(t,e,i){}drawMultiPolygon(t,e,i){}drawPoint(t,e,i){}drawPolygon(t,e,i){}drawText(t,e,i){}setFillStrokeStyle(t,e){}setImageStyle(t,e){}setTextStyle(t,e){}}const F={BEGIN_GEOMETRY:0,BEGIN_PATH:1,CIRCLE:2,CLOSE_PATH:3,CUSTOM:4,DRAW_CHARS:5,DRAW_IMAGE:6,END_GEOMETRY:7,FILL:8,MOVE_TO_LINE_TO:9,SET_FILL_STYLE:10,SET_STROKE_STYLE:11,STROKE:12},bs=[F.FILL],ai=[F.STROKE],Si=[F.BEGIN_PATH],Ql=[F.CLOSE_PATH];class gs extends su{constructor(t,e,i,s){super(),this.tolerance=t,this.maxExtent=e,this.pixelRatio=s,this.maxLineWidth=0,this.resolution=i,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_=null,this.bufferedMaxExtent_=null,this.instructions=[],this.coordinates=[],this.tmpCoordinate_=[],this.hitDetectionInstructions=[],this.state={}}applyPixelRatio(t){const e=this.pixelRatio;return e==1?t:t.map(function(i){return i*e})}appendFlatPointCoordinates(t,e){const i=this.getBufferedMaxExtent(),s=this.tmpCoordinate_,r=this.coordinates;let o=r.length;for(let a=0,l=t.length;a<l;a+=e)s[0]=t[a],s[1]=t[a+1],gn(i,s)&&(r[o++]=s[0],r[o++]=s[1]);return o}appendFlatLineCoordinates(t,e,i,s,r,o){const a=this.coordinates;let l=a.length;const h=this.getBufferedMaxExtent();o&&(e+=s);let c=t[e],u=t[e+1];const d=this.tmpCoordinate_;let f=!0,g,_,m;for(g=e+s;g<i;g+=s)d[0]=t[g],d[1]=t[g+1],m=Eo(h,d),m!==_?(f&&(a[l++]=c,a[l++]=u,f=!1),a[l++]=d[0],a[l++]=d[1]):m===Ct.INTERSECTING?(a[l++]=d[0],a[l++]=d[1],f=!1):f=!0,c=d[0],u=d[1],_=m;return(r&&f||g===e+s)&&(a[l++]=c,a[l++]=u),l}drawCustomCoordinates_(t,e,i,s,r){for(let o=0,a=i.length;o<a;++o){const l=i[o],h=this.appendFlatLineCoordinates(t,e,l,s,!1,!1);r.push(h),e=l}return e}drawCustom(t,e,i,s,r){this.beginGeometry(t,e,r);const o=t.getType(),a=t.getStride(),l=this.coordinates.length;let h,c,u,d,f;switch(o){case"MultiPolygon":h=t.getOrientedFlatCoordinates(),d=[];const g=t.getEndss();f=0;for(let _=0,m=g.length;_<m;++_){const p=[];f=this.drawCustomCoordinates_(h,f,g[_],a,p),d.push(p)}this.instructions.push([F.CUSTOM,l,d,t,i,Ao,r]),this.hitDetectionInstructions.push([F.CUSTOM,l,d,t,s||i,Ao,r]);break;case"Polygon":case"MultiLineString":u=[],h=o=="Polygon"?t.getOrientedFlatCoordinates():t.getFlatCoordinates(),f=this.drawCustomCoordinates_(h,0,t.getEnds(),a,u),this.instructions.push([F.CUSTOM,l,u,t,i,Jn,r]),this.hitDetectionInstructions.push([F.CUSTOM,l,u,t,s||i,Jn,r]);break;case"LineString":case"Circle":h=t.getFlatCoordinates(),c=this.appendFlatLineCoordinates(h,0,h.length,a,!1,!1),this.instructions.push([F.CUSTOM,l,c,t,i,oi,r]),this.hitDetectionInstructions.push([F.CUSTOM,l,c,t,s||i,oi,r]);break;case"MultiPoint":h=t.getFlatCoordinates(),c=this.appendFlatPointCoordinates(h,a),c>l&&(this.instructions.push([F.CUSTOM,l,c,t,i,oi,r]),this.hitDetectionInstructions.push([F.CUSTOM,l,c,t,s||i,oi,r]));break;case"Point":h=t.getFlatCoordinates(),this.coordinates.push(h[0],h[1]),c=this.coordinates.length,this.instructions.push([F.CUSTOM,l,c,t,i,void 0,r]),this.hitDetectionInstructions.push([F.CUSTOM,l,c,t,s||i,void 0,r]);break}this.endGeometry(e)}beginGeometry(t,e,i){this.beginGeometryInstruction1_=[F.BEGIN_GEOMETRY,e,0,t,i],this.instructions.push(this.beginGeometryInstruction1_),this.beginGeometryInstruction2_=[F.BEGIN_GEOMETRY,e,0,t,i],this.hitDetectionInstructions.push(this.beginGeometryInstruction2_)}finish(){return{instructions:this.instructions,hitDetectionInstructions:this.hitDetectionInstructions,coordinates:this.coordinates}}reverseHitDetectionInstructions(){const t=this.hitDetectionInstructions;t.reverse();let e;const i=t.length;let s,r,o=-1;for(e=0;e<i;++e)s=t[e],r=s[0],r==F.END_GEOMETRY?o=e:r==F.BEGIN_GEOMETRY&&(s[2]=e,qd(this.hitDetectionInstructions,o,e),o=-1)}fillStyleToState(t,e={}){if(t){const i=t.getColor();e.fillPatternScale=i&&typeof i=="object"&&"src"in i?this.pixelRatio:1,e.fillStyle=Ce(i||Wt)}else e.fillStyle=void 0;return e}strokeStyleToState(t,e={}){if(t){const i=t.getColor();e.strokeStyle=Ce(i||Un);const s=t.getLineCap();e.lineCap=s!==void 0?s:dn;const r=t.getLineDash();e.lineDash=r?r.slice():je;const o=t.getLineDashOffset();e.lineDashOffset=o||Be;const a=t.getLineJoin();e.lineJoin=a!==void 0?a:fn;const l=t.getWidth();e.lineWidth=l!==void 0?l:Vn;const h=t.getMiterLimit();e.miterLimit=h!==void 0?h:Kn,e.lineWidth>this.maxLineWidth&&(this.maxLineWidth=e.lineWidth,this.bufferedMaxExtent_=null)}else e.strokeStyle=void 0,e.lineCap=void 0,e.lineDash=null,e.lineDashOffset=void 0,e.lineJoin=void 0,e.lineWidth=void 0,e.miterLimit=void 0;return e}setFillStrokeStyle(t,e){const i=this.state;this.fillStyleToState(t,i),this.strokeStyleToState(e,i)}createFill(t){const e=t.fillStyle,i=[F.SET_FILL_STYLE,e];return typeof e!="string"&&i.push(t.fillPatternScale),i}applyStroke(t){this.instructions.push(this.createStroke(t))}createStroke(t){return[F.SET_STROKE_STYLE,t.strokeStyle,t.lineWidth*this.pixelRatio,t.lineCap,t.lineJoin,t.miterLimit,t.lineDash?this.applyPixelRatio(t.lineDash):null,t.lineDashOffset*this.pixelRatio]}updateFillStyle(t,e){const i=t.fillStyle;(typeof i!="string"||t.currentFillStyle!=i)&&(i!==void 0&&this.instructions.push(e.call(this,t)),t.currentFillStyle=i)}updateStrokeStyle(t,e){const i=t.strokeStyle,s=t.lineCap,r=t.lineDash,o=t.lineDashOffset,a=t.lineJoin,l=t.lineWidth,h=t.miterLimit;(t.currentStrokeStyle!=i||t.currentLineCap!=s||r!=t.currentLineDash&&!mi(t.currentLineDash,r)||t.currentLineDashOffset!=o||t.currentLineJoin!=a||t.currentLineWidth!=l||t.currentMiterLimit!=h)&&(i!==void 0&&e.call(this,t),t.currentStrokeStyle=i,t.currentLineCap=s,t.currentLineDash=r,t.currentLineDashOffset=o,t.currentLineJoin=a,t.currentLineWidth=l,t.currentMiterLimit=h)}endGeometry(t){this.beginGeometryInstruction1_[2]=this.instructions.length,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_[2]=this.hitDetectionInstructions.length,this.beginGeometryInstruction2_=null;const e=[F.END_GEOMETRY,t];this.instructions.push(e),this.hitDetectionInstructions.push(e)}getBufferedMaxExtent(){if(!this.bufferedMaxExtent_&&(this.bufferedMaxExtent_=Qh(this.maxExtent),this.maxLineWidth>0)){const t=this.resolution*(this.maxLineWidth+1)/2;Qo(this.bufferedMaxExtent_,t,this.bufferedMaxExtent_)}return this.bufferedMaxExtent_}}class Xm extends gs{constructor(t,e,i,s){super(t,e,i,s),this.hitDetectionImage_=null,this.image_=null,this.imagePixelRatio_=void 0,this.anchorX_=void 0,this.anchorY_=void 0,this.height_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.scale_=void 0,this.width_=void 0,this.declutterMode_=void 0,this.declutterImageWithText_=void 0}drawPoint(t,e,i){if(!this.image_||this.maxExtent&&!gn(this.maxExtent,t.getFlatCoordinates()))return;this.beginGeometry(t,e,i);const s=t.getFlatCoordinates(),r=t.getStride(),o=this.coordinates.length,a=this.appendFlatPointCoordinates(s,r);this.instructions.push([F.DRAW_IMAGE,o,a,this.image_,this.anchorX_*this.imagePixelRatio_,this.anchorY_*this.imagePixelRatio_,Math.ceil(this.height_*this.imagePixelRatio_),this.opacity_,this.originX_*this.imagePixelRatio_,this.originY_*this.imagePixelRatio_,this.rotateWithView_,this.rotation_,[this.scale_[0]*this.pixelRatio/this.imagePixelRatio_,this.scale_[1]*this.pixelRatio/this.imagePixelRatio_],Math.ceil(this.width_*this.imagePixelRatio_),this.declutterMode_,this.declutterImageWithText_]),this.hitDetectionInstructions.push([F.DRAW_IMAGE,o,a,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.height_,1,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_,this.declutterMode_,this.declutterImageWithText_]),this.endGeometry(e)}drawMultiPoint(t,e,i){if(!this.image_)return;this.beginGeometry(t,e,i);const s=t.getFlatCoordinates(),r=[];for(let l=0,h=s.length;l<h;l+=t.getStride())(!this.maxExtent||gn(this.maxExtent,s.slice(l,l+2)))&&r.push(s[l],s[l+1]);const o=this.coordinates.length,a=this.appendFlatPointCoordinates(r,2);this.instructions.push([F.DRAW_IMAGE,o,a,this.image_,this.anchorX_*this.imagePixelRatio_,this.anchorY_*this.imagePixelRatio_,Math.ceil(this.height_*this.imagePixelRatio_),this.opacity_,this.originX_*this.imagePixelRatio_,this.originY_*this.imagePixelRatio_,this.rotateWithView_,this.rotation_,[this.scale_[0]*this.pixelRatio/this.imagePixelRatio_,this.scale_[1]*this.pixelRatio/this.imagePixelRatio_],Math.ceil(this.width_*this.imagePixelRatio_),this.declutterMode_,this.declutterImageWithText_]),this.hitDetectionInstructions.push([F.DRAW_IMAGE,o,a,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.height_,1,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_,this.declutterMode_,this.declutterImageWithText_]),this.endGeometry(e)}finish(){return this.reverseHitDetectionInstructions(),this.anchorX_=void 0,this.anchorY_=void 0,this.hitDetectionImage_=null,this.image_=null,this.imagePixelRatio_=void 0,this.height_=void 0,this.scale_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.width_=void 0,super.finish()}setImageStyle(t,e){const i=t.getAnchor(),s=t.getSize(),r=t.getOrigin();this.imagePixelRatio_=t.getPixelRatio(this.pixelRatio),this.anchorX_=i[0],this.anchorY_=i[1],this.hitDetectionImage_=t.getHitDetectionImage(),this.image_=t.getImage(this.pixelRatio),this.height_=s[1],this.opacity_=t.getOpacity(),this.originX_=r[0],this.originY_=r[1],this.rotateWithView_=t.getRotateWithView(),this.rotation_=t.getRotation(),this.scale_=t.getScaleArray(),this.width_=s[0],this.declutterMode_=t.getDeclutterMode(),this.declutterImageWithText_=e}}class Wm extends gs{constructor(t,e,i,s){super(t,e,i,s)}drawFlatCoordinates_(t,e,i,s){const r=this.coordinates.length,o=this.appendFlatLineCoordinates(t,e,i,s,!1,!1),a=[F.MOVE_TO_LINE_TO,r,o];return this.instructions.push(a),this.hitDetectionInstructions.push(a),i}drawLineString(t,e,i){const s=this.state,r=s.strokeStyle,o=s.lineWidth;if(r===void 0||o===void 0)return;this.updateStrokeStyle(s,this.applyStroke),this.beginGeometry(t,e,i),this.hitDetectionInstructions.push([F.SET_STROKE_STYLE,s.strokeStyle,s.lineWidth,s.lineCap,s.lineJoin,s.miterLimit,je,Be],Si);const a=t.getFlatCoordinates(),l=t.getStride();this.drawFlatCoordinates_(a,0,a.length,l),this.hitDetectionInstructions.push(ai),this.endGeometry(e)}drawMultiLineString(t,e,i){const s=this.state,r=s.strokeStyle,o=s.lineWidth;if(r===void 0||o===void 0)return;this.updateStrokeStyle(s,this.applyStroke),this.beginGeometry(t,e,i),this.hitDetectionInstructions.push([F.SET_STROKE_STYLE,s.strokeStyle,s.lineWidth,s.lineCap,s.lineJoin,s.miterLimit,je,Be],Si);const a=t.getEnds(),l=t.getFlatCoordinates(),h=t.getStride();let c=0;for(let u=0,d=a.length;u<d;++u)c=this.drawFlatCoordinates_(l,c,a[u],h);this.hitDetectionInstructions.push(ai),this.endGeometry(e)}finish(){const t=this.state;return t.lastStroke!=null&&t.lastStroke!=this.coordinates.length&&this.instructions.push(ai),this.reverseHitDetectionInstructions(),this.state=null,super.finish()}applyStroke(t){t.lastStroke!=null&&t.lastStroke!=this.coordinates.length&&(this.instructions.push(ai),t.lastStroke=this.coordinates.length),t.lastStroke=0,super.applyStroke(t),this.instructions.push(Si)}}class th extends gs{constructor(t,e,i,s){super(t,e,i,s)}drawFlatCoordinatess_(t,e,i,s){const r=this.state,o=r.fillStyle!==void 0,a=r.strokeStyle!==void 0,l=i.length;this.instructions.push(Si),this.hitDetectionInstructions.push(Si);for(let h=0;h<l;++h){const c=i[h],u=this.coordinates.length,d=this.appendFlatLineCoordinates(t,e,c,s,!0,!a),f=[F.MOVE_TO_LINE_TO,u,d];this.instructions.push(f),this.hitDetectionInstructions.push(f),a&&(this.instructions.push(Ql),this.hitDetectionInstructions.push(Ql)),e=c}return o&&(this.instructions.push(bs),this.hitDetectionInstructions.push(bs)),a&&(this.instructions.push(ai),this.hitDetectionInstructions.push(ai)),e}drawCircle(t,e,i){const s=this.state,r=s.fillStyle,o=s.strokeStyle;if(r===void 0&&o===void 0)return;this.setFillStrokeStyles_(),this.beginGeometry(t,e,i),s.fillStyle!==void 0&&this.hitDetectionInstructions.push([F.SET_FILL_STYLE,Wt]),s.strokeStyle!==void 0&&this.hitDetectionInstructions.push([F.SET_STROKE_STYLE,s.strokeStyle,s.lineWidth,s.lineCap,s.lineJoin,s.miterLimit,je,Be]);const a=t.getFlatCoordinates(),l=t.getStride(),h=this.coordinates.length;this.appendFlatLineCoordinates(a,0,a.length,l,!1,!1);const c=[F.CIRCLE,h];this.instructions.push(Si,c),this.hitDetectionInstructions.push(Si,c),s.fillStyle!==void 0&&(this.instructions.push(bs),this.hitDetectionInstructions.push(bs)),s.strokeStyle!==void 0&&(this.instructions.push(ai),this.hitDetectionInstructions.push(ai)),this.endGeometry(e)}drawPolygon(t,e,i){const s=this.state,r=s.fillStyle,o=s.strokeStyle;if(r===void 0&&o===void 0)return;this.setFillStrokeStyles_(),this.beginGeometry(t,e,i),s.fillStyle!==void 0&&this.hitDetectionInstructions.push([F.SET_FILL_STYLE,Wt]),s.strokeStyle!==void 0&&this.hitDetectionInstructions.push([F.SET_STROKE_STYLE,s.strokeStyle,s.lineWidth,s.lineCap,s.lineJoin,s.miterLimit,je,Be]);const a=t.getEnds(),l=t.getOrientedFlatCoordinates(),h=t.getStride();this.drawFlatCoordinatess_(l,0,a,h),this.endGeometry(e)}drawMultiPolygon(t,e,i){const s=this.state,r=s.fillStyle,o=s.strokeStyle;if(r===void 0&&o===void 0)return;this.setFillStrokeStyles_(),this.beginGeometry(t,e,i),s.fillStyle!==void 0&&this.hitDetectionInstructions.push([F.SET_FILL_STYLE,Wt]),s.strokeStyle!==void 0&&this.hitDetectionInstructions.push([F.SET_STROKE_STYLE,s.strokeStyle,s.lineWidth,s.lineCap,s.lineJoin,s.miterLimit,je,Be]);const a=t.getEndss(),l=t.getOrientedFlatCoordinates(),h=t.getStride();let c=0;for(let u=0,d=a.length;u<d;++u)c=this.drawFlatCoordinatess_(l,c,a[u],h);this.endGeometry(e)}finish(){this.reverseHitDetectionInstructions(),this.state=null;const t=this.tolerance;if(t!==0){const e=this.coordinates;for(let i=0,s=e.length;i<s;++i)e[i]=Ei(e[i],t)}return super.finish()}setFillStrokeStyles_(){const t=this.state;t.fillStyle!==void 0&&this.updateFillStyle(t,this.createFill),t.strokeStyle!==void 0&&this.updateStrokeStyle(t,this.applyStroke)}}function Ym(n,t,e,i,s){const r=[];let o=e,a=0,l=t.slice(e,2);for(;a<n&&o+s<i;){const[h,c]=l.slice(-2),u=t[o+s],d=t[o+s+1],f=Math.sqrt((u-h)*(u-h)+(d-c)*(d-c));if(a+=f,a>=n){const g=(n-a+f)/f,_=Vt(h,u,g),m=Vt(c,d,g);l.push(_,m),r.push(l),l=[_,m],a==n&&(o+=s),a=0}else if(a<n)l.push(t[o+s],t[o+s+1]),o+=s;else{const g=f-a,_=Vt(h,u,g/f),m=Vt(c,d,g/f);l.push(_,m),r.push(l),l=[_,m],a=0,o+=s}}return a>0&&r.push(l),r}function jm(n,t,e,i,s){let r=e,o=e,a=0,l=0,h=e,c,u,d,f,g,_,m,p,y,w;for(u=e;u<i;u+=s){const x=t[u],v=t[u+1];g!==void 0&&(y=x-g,w=v-_,f=Math.sqrt(y*y+w*w),m!==void 0&&(l+=d,c=Math.acos((m*y+p*w)/(d*f)),c>n&&(l>a&&(a=l,r=h,o=u),l=0,h=u-s)),d=f,m=y,p=w),g=x,_=v}return l+=f,l>a?[h,u]:[r,o]}const er={left:0,center:.5,right:1,top:0,middle:.5,hanging:.2,alphabetic:.8,ideographic:.8,bottom:1};class Bm extends gs{constructor(t,e,i,s){super(t,e,i,s),this.labels_=null,this.text_="",this.textOffsetX_=0,this.textOffsetY_=0,this.textRotateWithView_=void 0,this.textKeepUpright_=void 0,this.textRotation_=0,this.textFillState_=null,this.fillStates={},this.fillStates[Wt]={fillStyle:Wt},this.textStrokeState_=null,this.strokeStates={},this.textState_={},this.textStates={},this.textKey_="",this.fillKey_="",this.strokeKey_="",this.declutterMode_=void 0,this.declutterImageWithText_=void 0}finish(){const t=super.finish();return t.textStates=this.textStates,t.fillStates=this.fillStates,t.strokeStates=this.strokeStates,t}drawText(t,e,i){const s=this.textFillState_,r=this.textStrokeState_,o=this.textState_;if(this.text_===""||!o||!s&&!r)return;const a=this.coordinates;let l=a.length;const h=t.getType();let c=null,u=t.getStride();if(o.placement==="line"&&(h=="LineString"||h=="MultiLineString"||h=="Polygon"||h=="MultiPolygon")){if(!Bt(this.maxExtent,t.getExtent()))return;let d;if(c=t.getFlatCoordinates(),h=="LineString")d=[c.length];else if(h=="MultiLineString")d=t.getEnds();else if(h=="Polygon")d=t.getEnds().slice(0,1);else if(h=="MultiPolygon"){const m=t.getEndss();d=[];for(let p=0,y=m.length;p<y;++p)d.push(m[p][0])}this.beginGeometry(t,e,i);const f=o.repeat,g=f?void 0:o.textAlign;let _=0;for(let m=0,p=d.length;m<p;++m){let y;f?y=Ym(f*this.resolution,c,_,d[m],u):y=[c.slice(_,d[m])];for(let w=0,x=y.length;w<x;++w){const v=y[w];let R=0,S=v.length;if(g==null){const I=jm(o.maxAngle,v,0,v.length,2);R=I[0],S=I[1]}for(let I=R;I<S;I+=u)a.push(v[I],v[I+1]);const C=a.length;_=d[m],this.drawChars_(l,C),l=C}}this.endGeometry(e)}else{let d=o.overflow?null:[];switch(h){case"Point":case"MultiPoint":c=t.getFlatCoordinates();break;case"LineString":c=t.getFlatMidpoint();break;case"Circle":c=t.getCenter();break;case"MultiLineString":c=t.getFlatMidpoints(),u=2;break;case"Polygon":c=t.getFlatInteriorPoint(),o.overflow||d.push(c[2]/this.resolution),u=3;break;case"MultiPolygon":const x=t.getFlatInteriorPoints();c=[];for(let v=0,R=x.length;v<R;v+=3)o.overflow||d.push(x[v+2]/this.resolution),c.push(x[v],x[v+1]);if(c.length===0)return;u=2;break}const f=this.appendFlatPointCoordinates(c,u);if(f===l)return;if(d&&(f-l)/2!==c.length/u){let x=l/2;d=d.filter((v,R)=>{const S=a[(x+R)*2]===c[R*u]&&a[(x+R)*2+1]===c[R*u+1];return S||--x,S})}this.saveTextStates_();const g=o.backgroundFill?this.createFill(this.fillStyleToState(o.backgroundFill)):null,_=o.backgroundStroke?this.createStroke(this.strokeStyleToState(o.backgroundStroke)):null;this.beginGeometry(t,e,i);let m=o.padding;if(m!=Ci&&(o.scale[0]<0||o.scale[1]<0)){let x=o.padding[0],v=o.padding[1],R=o.padding[2],S=o.padding[3];o.scale[0]<0&&(v=-v,S=-S),o.scale[1]<0&&(x=-x,R=-R),m=[x,v,R,S]}const p=this.pixelRatio;this.instructions.push([F.DRAW_IMAGE,l,f,null,NaN,NaN,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,[1,1],NaN,this.declutterMode_,this.declutterImageWithText_,m==Ci?Ci:m.map(function(x){return x*p}),g,_,this.text_,this.textKey_,this.strokeKey_,this.fillKey_,this.textOffsetX_,this.textOffsetY_,d]);const y=1/p,w=g?g.slice(0):null;w&&(w[1]=Wt),this.hitDetectionInstructions.push([F.DRAW_IMAGE,l,f,null,NaN,NaN,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,[y,y],NaN,this.declutterMode_,this.declutterImageWithText_,m,w,_,this.text_,this.textKey_,this.strokeKey_,this.fillKey_?Wt:this.fillKey_,this.textOffsetX_,this.textOffsetY_,d]),this.endGeometry(e)}}saveTextStates_(){const t=this.textStrokeState_,e=this.textState_,i=this.textFillState_,s=this.strokeKey_;t&&(s in this.strokeStates||(this.strokeStates[s]={strokeStyle:t.strokeStyle,lineCap:t.lineCap,lineDashOffset:t.lineDashOffset,lineWidth:t.lineWidth,lineJoin:t.lineJoin,miterLimit:t.miterLimit,lineDash:t.lineDash}));const r=this.textKey_;r in this.textStates||(this.textStates[r]={font:e.font,textAlign:e.textAlign||Zn,justify:e.justify,textBaseline:e.textBaseline||Ks,scale:e.scale});const o=this.fillKey_;i&&(o in this.fillStates||(this.fillStates[o]={fillStyle:i.fillStyle}))}drawChars_(t,e){const i=this.textStrokeState_,s=this.textState_,r=this.strokeKey_,o=this.textKey_,a=this.fillKey_;this.saveTextStates_();const l=this.pixelRatio,h=er[s.textBaseline],c=this.textOffsetY_*l,u=this.text_,d=i?i.lineWidth*Math.abs(s.scale[0])/2:0;this.instructions.push([F.DRAW_CHARS,t,e,h,s.overflow,a,s.maxAngle,l,c,r,d*l,u,o,1,this.declutterMode_,this.textKeepUpright_]),this.hitDetectionInstructions.push([F.DRAW_CHARS,t,e,h,s.overflow,a&&Wt,s.maxAngle,l,c,r,d*l,u,o,1/l,this.declutterMode_,this.textKeepUpright_])}setTextStyle(t,e){let i,s,r;if(!t)this.text_="";else{const o=t.getFill();o?(s=this.textFillState_,s||(s={},this.textFillState_=s),s.fillStyle=Ce(o.getColor()||Wt)):(s=null,this.textFillState_=s);const a=t.getStroke();if(!a)r=null,this.textStrokeState_=r;else{r=this.textStrokeState_,r||(r={},this.textStrokeState_=r);const _=a.getLineDash(),m=a.getLineDashOffset(),p=a.getWidth(),y=a.getMiterLimit();r.lineCap=a.getLineCap()||dn,r.lineDash=_?_.slice():je,r.lineDashOffset=m===void 0?Be:m,r.lineJoin=a.getLineJoin()||fn,r.lineWidth=p===void 0?Vn:p,r.miterLimit=y===void 0?Kn:y,r.strokeStyle=Ce(a.getColor()||Un)}i=this.textState_;const l=t.getFont()||$h;lf(l);const h=t.getScaleArray();i.overflow=t.getOverflow(),i.font=l,i.maxAngle=t.getMaxAngle(),i.placement=t.getPlacement(),i.textAlign=t.getTextAlign(),i.repeat=t.getRepeat(),i.justify=t.getJustify(),i.textBaseline=t.getTextBaseline()||Ks,i.backgroundFill=t.getBackgroundFill(),i.backgroundStroke=t.getBackgroundStroke(),i.padding=t.getPadding()||Ci,i.scale=h===void 0?[1,1]:h;const c=t.getOffsetX(),u=t.getOffsetY(),d=t.getRotateWithView(),f=t.getKeepUpright(),g=t.getRotation();this.text_=t.getText()||"",this.textOffsetX_=c===void 0?0:c,this.textOffsetY_=u===void 0?0:u,this.textRotateWithView_=d===void 0?!1:d,this.textKeepUpright_=f===void 0?!0:f,this.textRotation_=g===void 0?0:g,this.strokeKey_=r?(typeof r.strokeStyle=="string"?r.strokeStyle:Q(r.strokeStyle))+r.lineCap+r.lineDashOffset+"|"+r.lineWidth+r.lineJoin+r.miterLimit+"["+r.lineDash.join()+"]":"",this.textKey_=i.font+i.scale+(i.textAlign||"?")+(i.repeat||"?")+(i.justify||"?")+(i.textBaseline||"?"),this.fillKey_=s&&s.fillStyle?typeof s.fillStyle=="string"?s.fillStyle:"|"+Q(s.fillStyle):""}this.declutterMode_=t.getDeclutterMode(),this.declutterImageWithText_=e}}const Km={Circle:th,Default:gs,Image:Xm,LineString:Wm,Polygon:th,Text:Bm};class Um{constructor(t,e,i,s){this.tolerance_=t,this.maxExtent_=e,this.pixelRatio_=s,this.resolution_=i,this.buildersByZIndex_={}}finish(){const t={};for(const e in this.buildersByZIndex_){t[e]=t[e]||{};const i=this.buildersByZIndex_[e];for(const s in i){const r=i[s].finish();t[e][s]=r}}return t}getBuilder(t,e){const i=t!==void 0?t.toString():"0";let s=this.buildersByZIndex_[i];s===void 0&&(s={},this.buildersByZIndex_[i]=s);let r=s[e];if(r===void 0){const o=Km[e];r=new o(this.tolerance_,this.maxExtent_,this.resolution_,this.pixelRatio_),s[e]=r}return r}}function ru(n,t,e,i){let s=n[t],r=n[t+1],o=0;for(let a=t+i;a<e;a+=i){const l=n[a],h=n[a+1];o+=Math.sqrt((l-s)*(l-s)+(h-r)*(h-r)),s=l,r=h}return o}function Zm(n,t,e,i,s,r,o,a,l,h,c,u,d=!0){let f=n[t],g=n[t+1],_=0,m=0,p=0,y=0;function w(){_=f,m=g,t+=i,f=n[t],g=n[t+1],y+=p,p=Math.sqrt((f-_)*(f-_)+(g-m)*(g-m))}do w();while(t<e-i&&y+p<r);let x=p===0?0:(r-y)/p;const v=Vt(_,f,x),R=Vt(m,g,x),S=t-i,C=y,I=r+a*l(h,s,c);for(;t<e-i&&y+p<I;)w();x=p===0?0:(I-y)/p;const b=Vt(_,f,x),L=Vt(m,g,x);let P=!1;if(d)if(u){const k=[v,R,b,L];Ac(k,0,4,2,u,k,k),P=k[0]>k[2]}else P=v>b;const D=Math.PI,M=[],V=S+i===t;t=S,p=0,y=C,f=n[t],g=n[t+1];let A;if(V){w(),A=Math.atan2(g-m,f-_),P&&(A+=A>0?-D:D);const k=(b+v)/2,X=(L+R)/2;return M[0]=[k,X,(I-r)/2,A,s],M}s=s.replace(/\n/g," ");for(let k=0,X=s.length;k<X;){w();let Y=Math.atan2(g-m,f-_);if(P&&(Y+=Y>0?-D:D),A!==void 0){let tt=Y-A;if(tt+=tt>D?-2*D:tt<-D?2*D:0,Math.abs(tt)>o)return null}A=Y;const W=k;let U=0;for(;k<X;++k){const tt=P?X-k-1:k,gt=a*l(h,s[tt],c);if(t+i<e&&y+p<r+U+gt/2)break;U+=gt}if(k===W)continue;const T=P?s.substring(X-W,X-k):s.substring(W,k);x=p===0?0:(r+U/2-y)/p;const ft=Vt(_,f,x),yt=Vt(m,g,x);M.push([ft,yt,U/2,Y,T]),r+=U}return M}const Vi=re(),Je=[],De=[],ke=[],Qe=[];function eh(n){return n[3].declutterBox}const ih=new RegExp("[֑-ࣿיִ-﷿ﹰ-ﻼࠀ-࿿-]");function lo(n,t){return t==="start"?t=ih.test(n)?"right":"left":t==="end"&&(t=ih.test(n)?"left":"right"),er[t]}function Vm(n,t,e){return e>0&&n.push(`
`,""),n.push(t,""),n}class Hm{constructor(t,e,i,s,r){this.overlaps=i,this.pixelRatio=e,this.resolution=t,this.alignAndScaleFill_,this.instructions=s.instructions,this.coordinates=s.coordinates,this.coordinateCache_={},this.renderedTransform_=de(),this.hitDetectionInstructions=s.hitDetectionInstructions,this.pixelCoordinates_=null,this.viewRotation_=0,this.fillStates=s.fillStates||{},this.strokeStates=s.strokeStates||{},this.textStates=s.textStates||{},this.widths_={},this.labels_={},this.zIndexContext_=r?new bc:null}getZIndexContext(){return this.zIndexContext_}createLabel(t,e,i,s){const r=t+e+i+s;if(this.labels_[r])return this.labels_[r];const o=s?this.strokeStates[s]:null,a=i?this.fillStates[i]:null,l=this.textStates[e],h=this.pixelRatio,c=[l.scale[0]*h,l.scale[1]*h],u=l.justify?er[l.justify]:lo(Array.isArray(t)?t[0]:t,l.textAlign||Zn),d=s&&o.lineWidth?o.lineWidth:0,f=Array.isArray(t)?t:String(t).split(`
`).reduce(Vm,[]),{width:g,height:_,widths:m,heights:p,lineWidths:y}=cf(l,f),w=g+d,x=[],v=(w+2)*c[0],R=(_+d)*c[1],S={width:v<0?Math.floor(v):Math.ceil(v),height:R<0?Math.floor(R):Math.ceil(R),contextInstructions:x};(c[0]!=1||c[1]!=1)&&x.push("scale",c),s&&(x.push("strokeStyle",o.strokeStyle),x.push("lineWidth",d),x.push("lineCap",o.lineCap),x.push("lineJoin",o.lineJoin),x.push("miterLimit",o.miterLimit),x.push("setLineDash",[o.lineDash]),x.push("lineDashOffset",o.lineDashOffset)),i&&x.push("fillStyle",a.fillStyle),x.push("textBaseline","middle"),x.push("textAlign","center");const C=.5-u;let I=u*w+C*d;const b=[],L=[];let P=0,D=0,M=0,V=0,A;for(let k=0,X=f.length;k<X;k+=2){const Y=f[k];if(Y===`
`){D+=P,P=0,I=u*w+C*d,++V;continue}const W=f[k+1]||l.font;W!==A&&(s&&b.push("font",W),i&&L.push("font",W),A=W),P=Math.max(P,p[M]);const U=[Y,I+C*m[M]+u*(m[M]-y[V]),.5*(d+P)+D];I+=m[M],s&&b.push("strokeText",U),i&&L.push("fillText",U),++M}return Array.prototype.push.apply(x,b),Array.prototype.push.apply(x,L),this.labels_[r]=S,S}replayTextBackground_(t,e,i,s,r,o,a){t.beginPath(),t.moveTo.apply(t,e),t.lineTo.apply(t,i),t.lineTo.apply(t,s),t.lineTo.apply(t,r),t.lineTo.apply(t,e),o&&(this.alignAndScaleFill_=o[2],t.fillStyle=o[1],this.fill_(t)),a&&(this.setStrokeStyle_(t,a),t.stroke())}calculateImageOrLabelDimensions_(t,e,i,s,r,o,a,l,h,c,u,d,f,g,_,m){a*=d[0],l*=d[1];let p=i-a,y=s-l;const w=r+h>t?t-h:r,x=o+c>e?e-c:o,v=g[3]+w*d[0]+g[1],R=g[0]+x*d[1]+g[2],S=p-g[3],C=y-g[0];(_||u!==0)&&(Je[0]=S,Qe[0]=S,Je[1]=C,De[1]=C,De[0]=S+v,ke[0]=De[0],ke[1]=C+R,Qe[1]=ke[1]);let I;return u!==0?(I=Ke(de(),i,s,1,1,u,-i,-s),Rt(I,Je),Rt(I,De),Rt(I,ke),Rt(I,Qe),fi(Math.min(Je[0],De[0],ke[0],Qe[0]),Math.min(Je[1],De[1],ke[1],Qe[1]),Math.max(Je[0],De[0],ke[0],Qe[0]),Math.max(Je[1],De[1],ke[1],Qe[1]),Vi)):fi(Math.min(S,S+v),Math.min(C,C+R),Math.max(S,S+v),Math.max(C,C+R),Vi),f&&(p=Math.round(p),y=Math.round(y)),{drawImageX:p,drawImageY:y,drawImageW:w,drawImageH:x,originX:h,originY:c,declutterBox:{minX:Vi[0],minY:Vi[1],maxX:Vi[2],maxY:Vi[3],value:m},canvasTransform:I,scale:d}}replayImageOrLabel_(t,e,i,s,r,o,a){const l=!!(o||a),h=s.declutterBox,c=a?a[2]*s.scale[0]/2:0;return h.minX-c<=e[0]&&h.maxX+c>=0&&h.minY-c<=e[1]&&h.maxY+c>=0&&(l&&this.replayTextBackground_(t,Je,De,ke,Qe,o,a),uf(t,s.canvasTransform,r,i,s.originX,s.originY,s.drawImageW,s.drawImageH,s.drawImageX,s.drawImageY,s.scale)),!0}fill_(t){const e=this.alignAndScaleFill_;if(e){const i=Rt(this.renderedTransform_,[0,0]),s=512*this.pixelRatio;t.save(),t.translate(i[0]%s,i[1]%s),e!==1&&t.scale(e,e),t.rotate(this.viewRotation_)}t.fill(),e&&t.restore()}setStrokeStyle_(t,e){t.strokeStyle=e[1],t.lineWidth=e[2],t.lineCap=e[3],t.lineJoin=e[4],t.miterLimit=e[5],t.lineDashOffset=e[7],t.setLineDash(e[6])}drawLabelWithPointPlacement_(t,e,i,s){const r=this.textStates[e],o=this.createLabel(t,e,s,i),a=this.strokeStates[i],l=this.pixelRatio,h=lo(Array.isArray(t)?t[0]:t,r.textAlign||Zn),c=er[r.textBaseline||Ks],u=a&&a.lineWidth?a.lineWidth:0,d=o.width/l-2*r.scale[0],f=h*d+2*(.5-h)*u,g=c*o.height/l+2*(.5-c)*u;return{label:o,anchorX:f,anchorY:g}}execute_(t,e,i,s,r,o,a,l){const h=this.zIndexContext_;let c;this.pixelCoordinates_&&mi(i,this.renderedTransform_)?c=this.pixelCoordinates_:(this.pixelCoordinates_||(this.pixelCoordinates_=[]),c=hi(this.coordinates,0,this.coordinates.length,2,i,this.pixelCoordinates_),_g(this.renderedTransform_,i));let u=0;const d=s.length;let f=0,g,_,m,p,y,w,x,v,R,S,C,I,b,L=0,P=0;const D=this.coordinateCache_,M=this.viewRotation_,V=Math.round(Math.atan2(-i[1],i[0])*1e12)/1e12,A={context:t,pixelRatio:this.pixelRatio,resolution:this.resolution,rotation:M},k=this.instructions!=s||this.overlaps?0:200;let X,Y,W,U;for(;u<d;){const T=s[u];switch(T[0]){case F.BEGIN_GEOMETRY:X=T[1],U=T[3],X.getGeometry()?a!==void 0&&!Bt(a,U.getExtent())?u=T[2]+1:++u:u=T[2],h&&(h.zIndex=T[4]);break;case F.BEGIN_PATH:L>k&&(this.fill_(t),L=0),P>k&&(t.stroke(),P=0),!L&&!P&&(t.beginPath(),y=NaN,w=NaN),++u;break;case F.CIRCLE:f=T[1];const yt=c[f],tt=c[f+1],gt=c[f+2],xt=c[f+3],wt=gt-yt,et=xt-tt,Z=Math.sqrt(wt*wt+et*et);t.moveTo(yt+Z,tt),t.arc(yt,tt,Z,0,2*Math.PI,!0),++u;break;case F.CLOSE_PATH:t.closePath(),++u;break;case F.CUSTOM:f=T[1],g=T[2];const bt=T[3],lt=T[4],ht=T[5];A.geometry=bt,A.feature=X,u in D||(D[u]=[]);const Et=D[u];ht?ht(c,f,g,2,Et):(Et[0]=c[f],Et[1]=c[f+1],Et.length=2),h&&(h.zIndex=T[6]),lt(Et,A),++u;break;case F.DRAW_IMAGE:f=T[1],g=T[2],R=T[3],_=T[4],m=T[5];let wn=T[6];const _e=T[7],me=T[8],zi=T[9],pi=T[10];let Xi=T[11];const En=T[12];let Le=T[13];p=T[14]||"declutter";const yi=T[15];if(!R&&T.length>=20){S=T[19],C=T[20],I=T[21],b=T[22];const qt=this.drawLabelWithPointPlacement_(S,C,I,b);R=qt.label,T[3]=R;const vi=T[23];_=(qt.anchorX-vi)*this.pixelRatio,T[4]=_;const $t=T[24];m=(qt.anchorY-$t)*this.pixelRatio,T[5]=m,wn=R.height,T[6]=wn,Le=R.width,T[13]=Le}let Mt;T.length>25&&(Mt=T[25]);let zr,_s,ms;T.length>17?(zr=T[16],_s=T[17],ms=T[18]):(zr=Ci,_s=null,ms=null),pi&&V?Xi+=M:!pi&&!V&&(Xi-=M);let du=0;for(;f<g;f+=2){if(Mt&&Mt[du++]<Le/this.pixelRatio)continue;const qt=this.calculateImageOrLabelDimensions_(R.width,R.height,c[f],c[f+1],Le,wn,_,m,me,zi,Xi,En,r,zr,!!_s||!!ms,X),vi=[t,e,R,qt,_e,_s,ms];if(l){let $t,pe,Jt;if(yi){const ct=g-f;if(!yi[ct]){yi[ct]={args:vi,declutterMode:p};continue}const Ot=yi[ct];$t=Ot.args,pe=Ot.declutterMode,delete yi[ct],Jt=eh($t)}let Pe,Oe;if($t&&(pe!=="declutter"||!l.collides(Jt))&&(Pe=!0),(p!=="declutter"||!l.collides(qt.declutterBox))&&(Oe=!0),pe==="declutter"&&p==="declutter"){const ct=Pe&&Oe;Pe=ct,Oe=ct}Pe&&(pe!=="none"&&l.insert(Jt),this.replayImageOrLabel_.apply(this,$t)),Oe&&(p!=="none"&&l.insert(qt.declutterBox),this.replayImageOrLabel_.apply(this,vi))}else this.replayImageOrLabel_.apply(this,vi)}++u;break;case F.DRAW_CHARS:const Na=T[1],Ga=T[2],Xr=T[3],fu=T[4];b=T[5];const gu=T[6],za=T[7],Xa=T[8];I=T[9];const Wr=T[10];S=T[11],C=T[12];const Wa=[T[13],T[13]];p=T[14]||"declutter";const _u=T[15],Yr=this.textStates[C],Cn=Yr.font,Rn=[Yr.scale[0]*za,Yr.scale[1]*za];let In;Cn in this.widths_?In=this.widths_[Cn]:(In={},this.widths_[Cn]=In);const Ya=ru(c,Na,Ga,2),ja=Math.abs(Rn[0])*ul(Cn,S,In);if(fu||ja<=Ya){const qt=this.textStates[C].textAlign,vi=(Ya-ja)*lo(S,qt),$t=Zm(c,Na,Ga,2,S,vi,gu,Math.abs(Rn[0]),ul,Cn,In,V?0:this.viewRotation_,_u);t:if($t){const pe=[];let Jt,Pe,Oe,ct,Ot;if(I)for(Jt=0,Pe=$t.length;Jt<Pe;++Jt){Ot=$t[Jt],Oe=Ot[4],ct=this.createLabel(Oe,C,"",I),_=Ot[2]+(Rn[0]<0?-Wr:Wr),m=Xr*ct.height+(.5-Xr)*2*Wr*Rn[1]/Rn[0]-Xa;const Fe=this.calculateImageOrLabelDimensions_(ct.width,ct.height,Ot[0],Ot[1],ct.width,ct.height,_,m,0,0,Ot[3],Wa,!1,Ci,!1,X);if(l&&p==="declutter"&&l.collides(Fe.declutterBox))break t;pe.push([t,e,ct,Fe,1,null,null])}if(b)for(Jt=0,Pe=$t.length;Jt<Pe;++Jt){Ot=$t[Jt],Oe=Ot[4],ct=this.createLabel(Oe,C,b,""),_=Ot[2],m=Xr*ct.height-Xa;const Fe=this.calculateImageOrLabelDimensions_(ct.width,ct.height,Ot[0],Ot[1],ct.width,ct.height,_,m,0,0,Ot[3],Wa,!1,Ci,!1,X);if(l&&p==="declutter"&&l.collides(Fe.declutterBox))break t;pe.push([t,e,ct,Fe,1,null,null])}l&&p!=="none"&&l.load(pe.map(eh));for(let Fe=0,mu=pe.length;Fe<mu;++Fe)this.replayImageOrLabel_.apply(this,pe[Fe])}}++u;break;case F.END_GEOMETRY:if(o!==void 0){X=T[1];const qt=o(X,U,p);if(qt)return qt}++u;break;case F.FILL:k?L++:this.fill_(t),++u;break;case F.MOVE_TO_LINE_TO:for(f=T[1],g=T[2],Y=c[f],W=c[f+1],t.moveTo(Y,W),y=Y+.5|0,w=W+.5|0,f+=2;f<g;f+=2)Y=c[f],W=c[f+1],x=Y+.5|0,v=W+.5|0,(f==g-2||x!==y||v!==w)&&(t.lineTo(Y,W),y=x,w=v);++u;break;case F.SET_FILL_STYLE:this.alignAndScaleFill_=T[2],L&&(this.fill_(t),L=0,P&&(t.stroke(),P=0)),t.fillStyle=T[1],++u;break;case F.SET_STROKE_STYLE:P&&(t.stroke(),P=0),this.setStrokeStyle_(t,T),++u;break;case F.STROKE:k?P++:t.stroke(),++u;break;default:++u;break}}L&&this.fill_(t),P&&t.stroke()}execute(t,e,i,s,r,o){this.viewRotation_=s,this.execute_(t,e,i,this.instructions,r,void 0,void 0,o)}executeHitDetection(t,e,i,s,r){return this.viewRotation_=i,this.execute_(t,[t.canvas.width,t.canvas.height],e,this.hitDetectionInstructions,!0,s,r)}}const en=["Polygon","Circle","LineString","Image","Text","Default"],ou=["Image","Text"],qm=en.filter(n=>!ou.includes(n));class $m{constructor(t,e,i,s,r,o,a){this.maxExtent_=t,this.overlaps_=s,this.pixelRatio_=i,this.resolution_=e,this.renderBuffer_=o,this.executorsByZIndex_={},this.hitDetectionContext_=null,this.hitDetectionTransform_=de(),this.renderedContext_=null,this.deferredZIndexContexts_={},this.createExecutors_(r,a)}clip(t,e){const i=this.getClipCoords(e);t.beginPath(),t.moveTo(i[0],i[1]),t.lineTo(i[2],i[3]),t.lineTo(i[4],i[5]),t.lineTo(i[6],i[7]),t.clip()}createExecutors_(t,e){for(const i in t){let s=this.executorsByZIndex_[i];s===void 0&&(s={},this.executorsByZIndex_[i]=s);const r=t[i];for(const o in r){const a=r[o];s[o]=new Hm(this.resolution_,this.pixelRatio_,this.overlaps_,a,e)}}}hasExecutors(t){for(const e in this.executorsByZIndex_){const i=this.executorsByZIndex_[e];for(let s=0,r=t.length;s<r;++s)if(t[s]in i)return!0}return!1}forEachFeatureAtCoordinate(t,e,i,s,r,o){s=Math.round(s);const a=s*2+1,l=Ke(this.hitDetectionTransform_,s+.5,s+.5,1/e,-1/e,-i,-t[0],-t[1]),h=!this.hitDetectionContext_;h&&(this.hitDetectionContext_=It(a,a,void 0,{willReadFrequently:!0}));const c=this.hitDetectionContext_;c.canvas.width!==a||c.canvas.height!==a?(c.canvas.width=a,c.canvas.height=a):h||c.clearRect(0,0,a,a);let u;this.renderBuffer_!==void 0&&(u=re(),Wn(u,t),Qo(u,e*(this.renderBuffer_+s),u));const d=Jm(s);let f;function g(v,R,S){const C=c.getImageData(0,0,a,a).data;for(let I=0,b=d.length;I<b;I++)if(C[d[I]]>0){if(!o||S==="none"||f!=="Image"&&f!=="Text"||o.includes(v)){const L=(d[I]-3)/4,P=s-L%a,D=s-(L/a|0),M=r(v,R,P*P+D*D);if(M)return M}c.clearRect(0,0,a,a);break}}const _=Object.keys(this.executorsByZIndex_).map(Number);_.sort(Ye);let m,p,y,w,x;for(m=_.length-1;m>=0;--m){const v=_[m].toString();for(y=this.executorsByZIndex_[v],p=en.length-1;p>=0;--p)if(f=en[p],w=y[f],w!==void 0&&(x=w.executeHitDetection(c,l,i,g,u),x))return x}}getClipCoords(t){const e=this.maxExtent_;if(!e)return null;const i=e[0],s=e[1],r=e[2],o=e[3],a=[i,s,i,o,r,o,r,s];return hi(a,0,8,2,t,a),a}isEmpty(){return Ai(this.executorsByZIndex_)}execute(t,e,i,s,r,o,a){const l=Object.keys(this.executorsByZIndex_).map(Number);l.sort(a?Hd:Ye),o=o||en;const h=en.length;for(let c=0,u=l.length;c<u;++c){const d=l[c].toString(),f=this.executorsByZIndex_[d];for(let g=0,_=o.length;g<_;++g){const m=o[g],p=f[m];if(p!==void 0){const y=a===null?void 0:p.getZIndexContext(),w=y?y.getContext():t,x=this.maxExtent_&&m!=="Image"&&m!=="Text";if(x&&(w.save(),this.clip(w,i)),!y||m==="Text"||m==="Image"?p.execute(w,e,i,s,r,a):y.pushFunction(v=>p.execute(v,e,i,s,r,a)),x&&w.restore(),y){y.offset();const v=l[c]*h+g;this.deferredZIndexContexts_[v]||(this.deferredZIndexContexts_[v]=[]),this.deferredZIndexContexts_[v].push(y)}}}}this.renderedContext_=t}getDeferredZIndexContexts(){return this.deferredZIndexContexts_}getRenderedContext(){return this.renderedContext_}renderDeferred(){const t=this.deferredZIndexContexts_,e=Object.keys(t).map(Number).sort(Ye);for(let i=0,s=e.length;i<s;++i)t[e[i]].forEach(r=>{r.draw(this.renderedContext_),r.clear()}),t[e[i]].length=0}}const ho={};function Jm(n){if(ho[n]!==void 0)return ho[n];const t=n*2+1,e=n*n,i=new Array(e+1);for(let r=0;r<=n;++r)for(let o=0;o<=n;++o){const a=r*r+o*o;if(a>e)break;let l=i[a];l||(l=[],i[a]=l),l.push(((n+r)*t+(n+o))*4+3),r>0&&l.push(((n-r)*t+(n+o))*4+3),o>0&&(l.push(((n+r)*t+(n-o))*4+3),r>0&&l.push(((n-r)*t+(n-o))*4+3))}const s=[];for(let r=0,o=i.length;r<o;++r)i[r]&&s.push(...i[r]);return ho[n]=s,s}class Qm extends su{constructor(t,e,i,s,r,o,a){super(),this.context_=t,this.pixelRatio_=e,this.extent_=i,this.transform_=s,this.transformRotation_=s?Uo(Math.atan2(s[1],s[0]),10):0,this.viewRotation_=r,this.squaredTolerance_=o,this.userTransform_=a,this.contextFillState_=null,this.contextStrokeState_=null,this.contextTextState_=null,this.fillState_=null,this.strokeState_=null,this.image_=null,this.imageAnchorX_=0,this.imageAnchorY_=0,this.imageHeight_=0,this.imageOpacity_=0,this.imageOriginX_=0,this.imageOriginY_=0,this.imageRotateWithView_=!1,this.imageRotation_=0,this.imageScale_=[0,0],this.imageWidth_=0,this.text_="",this.textOffsetX_=0,this.textOffsetY_=0,this.textRotateWithView_=!1,this.textRotation_=0,this.textScale_=[0,0],this.textFillState_=null,this.textStrokeState_=null,this.textState_=null,this.pixelCoordinates_=[],this.tmpLocalTransform_=de()}drawImages_(t,e,i,s){if(!this.image_)return;const r=hi(t,e,i,s,this.transform_,this.pixelCoordinates_),o=this.context_,a=this.tmpLocalTransform_,l=o.globalAlpha;this.imageOpacity_!=1&&(o.globalAlpha=l*this.imageOpacity_);let h=this.imageRotation_;this.transformRotation_===0&&(h-=this.viewRotation_),this.imageRotateWithView_&&(h+=this.viewRotation_);for(let c=0,u=r.length;c<u;c+=2){const d=r[c]-this.imageAnchorX_,f=r[c+1]-this.imageAnchorY_;if(h!==0||this.imageScale_[0]!=1||this.imageScale_[1]!=1){const g=d+this.imageAnchorX_,_=f+this.imageAnchorY_;Ke(a,g,_,1,1,h,-g,-_),o.save(),o.transform.apply(o,a),o.translate(g,_),o.scale(this.imageScale_[0],this.imageScale_[1]),o.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,-this.imageAnchorX_,-this.imageAnchorY_,this.imageWidth_,this.imageHeight_),o.restore()}else o.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,d,f,this.imageWidth_,this.imageHeight_)}this.imageOpacity_!=1&&(o.globalAlpha=l)}drawText_(t,e,i,s){if(!this.textState_||this.text_==="")return;this.textFillState_&&this.setContextFillState_(this.textFillState_),this.textStrokeState_&&this.setContextStrokeState_(this.textStrokeState_),this.setContextTextState_(this.textState_);const r=hi(t,e,i,s,this.transform_,this.pixelCoordinates_),o=this.context_;let a=this.textRotation_;for(this.transformRotation_===0&&(a-=this.viewRotation_),this.textRotateWithView_&&(a+=this.viewRotation_);e<i;e+=s){const l=r[e]+this.textOffsetX_,h=r[e+1]+this.textOffsetY_;a!==0||this.textScale_[0]!=1||this.textScale_[1]!=1?(o.save(),o.translate(l-this.textOffsetX_,h-this.textOffsetY_),o.rotate(a),o.translate(this.textOffsetX_,this.textOffsetY_),o.scale(this.textScale_[0],this.textScale_[1]),this.textStrokeState_&&o.strokeText(this.text_,0,0),this.textFillState_&&o.fillText(this.text_,0,0),o.restore()):(this.textStrokeState_&&o.strokeText(this.text_,l,h),this.textFillState_&&o.fillText(this.text_,l,h))}}moveToLineTo_(t,e,i,s,r){const o=this.context_,a=hi(t,e,i,s,this.transform_,this.pixelCoordinates_);o.moveTo(a[0],a[1]);let l=a.length;r&&(l-=2);for(let h=2;h<l;h+=2)o.lineTo(a[h],a[h+1]);return r&&o.closePath(),i}drawRings_(t,e,i,s){for(let r=0,o=i.length;r<o;++r)e=this.moveToLineTo_(t,e,i[r],s,!0);return e}drawCircle(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!Bt(this.extent_,t.getExtent())){if(this.fillState_||this.strokeState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const e=Hg(t,this.transform_,this.pixelCoordinates_),i=e[2]-e[0],s=e[3]-e[1],r=Math.sqrt(i*i+s*s),o=this.context_;o.beginPath(),o.arc(e[0],e[1],r,0,2*Math.PI),this.fillState_&&o.fill(),this.strokeState_&&o.stroke()}this.text_!==""&&this.drawText_(t.getCenter(),0,2,2)}}setStyle(t){this.setFillStrokeStyle(t.getFill(),t.getStroke()),this.setImageStyle(t.getImage()),this.setTextStyle(t.getText())}setTransform(t){this.transform_=t}drawGeometry(t){switch(t.getType()){case"Point":this.drawPoint(t);break;case"LineString":this.drawLineString(t);break;case"Polygon":this.drawPolygon(t);break;case"MultiPoint":this.drawMultiPoint(t);break;case"MultiLineString":this.drawMultiLineString(t);break;case"MultiPolygon":this.drawMultiPolygon(t);break;case"GeometryCollection":this.drawGeometryCollection(t);break;case"Circle":this.drawCircle(t);break}}drawFeature(t,e){const i=e.getGeometryFunction()(t);i&&(this.setStyle(e),this.drawGeometry(i))}drawGeometryCollection(t){const e=t.getGeometriesArray();for(let i=0,s=e.length;i<s;++i)this.drawGeometry(e[i])}drawPoint(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const e=t.getFlatCoordinates(),i=t.getStride();this.image_&&this.drawImages_(e,0,e.length,i),this.text_!==""&&this.drawText_(e,0,e.length,i)}drawMultiPoint(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const e=t.getFlatCoordinates(),i=t.getStride();this.image_&&this.drawImages_(e,0,e.length,i),this.text_!==""&&this.drawText_(e,0,e.length,i)}drawLineString(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!Bt(this.extent_,t.getExtent())){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);const e=this.context_,i=t.getFlatCoordinates();e.beginPath(),this.moveToLineTo_(i,0,i.length,t.getStride(),!1),e.stroke()}if(this.text_!==""){const e=t.getFlatMidpoint();this.drawText_(e,0,2,2)}}}drawMultiLineString(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const e=t.getExtent();if(Bt(this.extent_,e)){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);const i=this.context_,s=t.getFlatCoordinates();let r=0;const o=t.getEnds(),a=t.getStride();i.beginPath();for(let l=0,h=o.length;l<h;++l)r=this.moveToLineTo_(s,r,o[l],a,!1);i.stroke()}if(this.text_!==""){const i=t.getFlatMidpoints();this.drawText_(i,0,i.length,2)}}}drawPolygon(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!Bt(this.extent_,t.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const e=this.context_;e.beginPath(),this.drawRings_(t.getOrientedFlatCoordinates(),0,t.getEnds(),t.getStride()),this.fillState_&&e.fill(),this.strokeState_&&e.stroke()}if(this.text_!==""){const e=t.getFlatInteriorPoint();this.drawText_(e,0,2,2)}}}drawMultiPolygon(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!Bt(this.extent_,t.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const e=this.context_,i=t.getOrientedFlatCoordinates();let s=0;const r=t.getEndss(),o=t.getStride();e.beginPath();for(let a=0,l=r.length;a<l;++a){const h=r[a];s=this.drawRings_(i,s,h,o)}this.fillState_&&e.fill(),this.strokeState_&&e.stroke()}if(this.text_!==""){const e=t.getFlatInteriorPoints();this.drawText_(e,0,e.length,2)}}}setContextFillState_(t){const e=this.context_,i=this.contextFillState_;i?i.fillStyle!=t.fillStyle&&(i.fillStyle=t.fillStyle,e.fillStyle=t.fillStyle):(e.fillStyle=t.fillStyle,this.contextFillState_={fillStyle:t.fillStyle})}setContextStrokeState_(t){const e=this.context_,i=this.contextStrokeState_;i?(i.lineCap!=t.lineCap&&(i.lineCap=t.lineCap,e.lineCap=t.lineCap),mi(i.lineDash,t.lineDash)||e.setLineDash(i.lineDash=t.lineDash),i.lineDashOffset!=t.lineDashOffset&&(i.lineDashOffset=t.lineDashOffset,e.lineDashOffset=t.lineDashOffset),i.lineJoin!=t.lineJoin&&(i.lineJoin=t.lineJoin,e.lineJoin=t.lineJoin),i.lineWidth!=t.lineWidth&&(i.lineWidth=t.lineWidth,e.lineWidth=t.lineWidth),i.miterLimit!=t.miterLimit&&(i.miterLimit=t.miterLimit,e.miterLimit=t.miterLimit),i.strokeStyle!=t.strokeStyle&&(i.strokeStyle=t.strokeStyle,e.strokeStyle=t.strokeStyle)):(e.lineCap=t.lineCap,e.setLineDash(t.lineDash),e.lineDashOffset=t.lineDashOffset,e.lineJoin=t.lineJoin,e.lineWidth=t.lineWidth,e.miterLimit=t.miterLimit,e.strokeStyle=t.strokeStyle,this.contextStrokeState_={lineCap:t.lineCap,lineDash:t.lineDash,lineDashOffset:t.lineDashOffset,lineJoin:t.lineJoin,lineWidth:t.lineWidth,miterLimit:t.miterLimit,strokeStyle:t.strokeStyle})}setContextTextState_(t){const e=this.context_,i=this.contextTextState_,s=t.textAlign?t.textAlign:Zn;i?(i.font!=t.font&&(i.font=t.font,e.font=t.font),i.textAlign!=s&&(i.textAlign=s,e.textAlign=s),i.textBaseline!=t.textBaseline&&(i.textBaseline=t.textBaseline,e.textBaseline=t.textBaseline)):(e.font=t.font,e.textAlign=s,e.textBaseline=t.textBaseline,this.contextTextState_={font:t.font,textAlign:s,textBaseline:t.textBaseline})}setFillStrokeStyle(t,e){if(!t)this.fillState_=null;else{const i=t.getColor();this.fillState_={fillStyle:Ce(i||Wt)}}if(!e)this.strokeState_=null;else{const i=e.getColor(),s=e.getLineCap(),r=e.getLineDash(),o=e.getLineDashOffset(),a=e.getLineJoin(),l=e.getWidth(),h=e.getMiterLimit(),c=r||je;this.strokeState_={lineCap:s!==void 0?s:dn,lineDash:this.pixelRatio_===1?c:c.map(u=>u*this.pixelRatio_),lineDashOffset:(o||Be)*this.pixelRatio_,lineJoin:a!==void 0?a:fn,lineWidth:(l!==void 0?l:Vn)*this.pixelRatio_,miterLimit:h!==void 0?h:Kn,strokeStyle:Ce(i||Un)}}}setImageStyle(t){let e;if(!t||!(e=t.getSize())){this.image_=null;return}const i=t.getPixelRatio(this.pixelRatio_),s=t.getAnchor(),r=t.getOrigin();this.image_=t.getImage(this.pixelRatio_),this.imageAnchorX_=s[0]*i,this.imageAnchorY_=s[1]*i,this.imageHeight_=e[1]*i,this.imageOpacity_=t.getOpacity(),this.imageOriginX_=r[0],this.imageOriginY_=r[1],this.imageRotateWithView_=t.getRotateWithView(),this.imageRotation_=t.getRotation();const o=t.getScaleArray();this.imageScale_=[o[0]*this.pixelRatio_/i,o[1]*this.pixelRatio_/i],this.imageWidth_=e[0]*i}setTextStyle(t){if(!t)this.text_="";else{const e=t.getFill();if(!e)this.textFillState_=null;else{const f=e.getColor();this.textFillState_={fillStyle:Ce(f||Wt)}}const i=t.getStroke();if(!i)this.textStrokeState_=null;else{const f=i.getColor(),g=i.getLineCap(),_=i.getLineDash(),m=i.getLineDashOffset(),p=i.getLineJoin(),y=i.getWidth(),w=i.getMiterLimit();this.textStrokeState_={lineCap:g!==void 0?g:dn,lineDash:_||je,lineDashOffset:m||Be,lineJoin:p!==void 0?p:fn,lineWidth:y!==void 0?y:Vn,miterLimit:w!==void 0?w:Kn,strokeStyle:Ce(f||Un)}}const s=t.getFont(),r=t.getOffsetX(),o=t.getOffsetY(),a=t.getRotateWithView(),l=t.getRotation(),h=t.getScaleArray(),c=t.getText(),u=t.getTextAlign(),d=t.getTextBaseline();this.textState_={font:s!==void 0?s:$h,textAlign:u!==void 0?u:Zn,textBaseline:d!==void 0?d:Ks},this.text_=c!==void 0?Array.isArray(c)?c.reduce((f,g,_)=>f+=_%2?" ":g,""):c:"",this.textOffsetX_=r!==void 0?this.pixelRatio_*r:0,this.textOffsetY_=o!==void 0?this.pixelRatio_*o:0,this.textRotateWithView_=a!==void 0?a:!1,this.textRotation_=l!==void 0?l:0,this.textScale_=[this.pixelRatio_*h[0],this.pixelRatio_*h[1]]}}}const Ee=.5;function tp(n,t,e,i,s,r,o,a,l){const h=s,c=n[0]*Ee,u=n[1]*Ee,d=It(c,u);d.imageSmoothingEnabled=!1;const f=d.canvas,g=new Qm(d,Ee,s,null,o,a,null),_=e.length,m=Math.floor((256*256*256-1)/_),p={};for(let w=1;w<=_;++w){const x=e[w-1],v=x.getStyleFunction()||i;if(!v)continue;let R=v(x,r);if(!R)continue;Array.isArray(R)||(R=[R]);const C=(w*m).toString(16).padStart(7,"#00000");for(let I=0,b=R.length;I<b;++I){const L=R[I],P=L.getGeometryFunction()(x);if(!P||!Bt(h,P.getExtent()))continue;const D=L.clone(),M=D.getFill();M&&M.setColor(C);const V=D.getStroke();V&&(V.setColor(C),V.setLineDash(null)),D.setText(void 0);const A=L.getImage();if(A){const W=A.getImageSize();if(!W)continue;const U=It(W[0],W[1],void 0,{alpha:!1}),T=U.canvas;U.fillStyle=C,U.fillRect(0,0,T.width,T.height),D.setImage(new ds({img:T,anchor:A.getAnchor(),anchorXUnits:"pixels",anchorYUnits:"pixels",offset:A.getOrigin(),opacity:1,size:A.getSize(),scale:A.getScale(),rotation:A.getRotation(),rotateWithView:A.getRotateWithView()}))}const k=D.getZIndex()||0;let X=p[k];X||(X={},p[k]=X,X.Polygon=[],X.Circle=[],X.LineString=[],X.Point=[]);const Y=P.getType();if(Y==="GeometryCollection"){const W=P.getGeometriesArrayRecursive();for(let U=0,T=W.length;U<T;++U){const ft=W[U];X[ft.getType().replace("Multi","")].push(ft,D)}}else X[Y.replace("Multi","")].push(P,D)}}const y=Object.keys(p).map(Number).sort(Ye);for(let w=0,x=y.length;w<x;++w){const v=p[y[w]];for(const R in v){const S=v[R];for(let C=0,I=S.length;C<I;C+=2){g.setStyle(S[C+1]);for(let b=0,L=t.length;b<L;++b)g.setTransform(t[b]),g.drawGeometry(S[C])}}}return d.getImageData(0,0,f.width,f.height)}function ep(n,t,e){const i=[];if(e){const s=Math.floor(Math.round(n[0])*Ee),r=Math.floor(Math.round(n[1])*Ee),o=(mt(s,0,e.width-1)+mt(r,0,e.height-1)*e.width)*4,a=e.data[o],l=e.data[o+1],c=e.data[o+2]+256*(l+256*a),u=Math.floor((256*256*256-1)/t.length);c&&c%u===0&&i.push(t[c/u-1])}return i}const ip=.5,au={Point:cp,LineString:ap,Polygon:dp,MultiPoint:up,MultiLineString:lp,MultiPolygon:hp,GeometryCollection:op,Circle:sp};function np(n,t){return parseInt(Q(n),10)-parseInt(Q(t),10)}function nh(n,t){const e=lu(n,t);return e*e}function lu(n,t){return ip*n/t}function sp(n,t,e,i,s){const r=e.getFill(),o=e.getStroke();if(r||o){const l=n.getBuilder(e.getZIndex(),"Circle");l.setFillStrokeStyle(r,o),l.drawCircle(t,i,s)}const a=e.getText();if(a&&a.getText()){const l=n.getBuilder(e.getZIndex(),"Text");l.setTextStyle(a),l.drawText(t,i)}}function sh(n,t,e,i,s,r,o,a){const l=[],h=e.getImage();if(h){let d=!0;const f=h.getImageState();f==K.LOADED||f==K.ERROR?d=!1:f==K.IDLE&&h.load(),d&&l.push(h.ready())}const c=e.getFill();c&&c.loading()&&l.push(c.ready());const u=l.length>0;return u&&Promise.all(l).then(()=>s(null)),rp(n,t,e,i,r,o,a),u}function rp(n,t,e,i,s,r,o){const a=e.getGeometryFunction()(t);if(!a)return;const l=a.simplifyTransformed(i,s);if(e.getRenderer())hu(n,l,e,t,o);else{const c=au[l.getType()];c(n,l,e,t,o,r)}}function hu(n,t,e,i,s){if(t.getType()=="GeometryCollection"){const o=t.getGeometries();for(let a=0,l=o.length;a<l;++a)hu(n,o[a],e,i,s);return}n.getBuilder(e.getZIndex(),"Default").drawCustom(t,i,e.getRenderer(),e.getHitDetectionRenderer(),s)}function op(n,t,e,i,s,r){const o=t.getGeometriesArray();let a,l;for(a=0,l=o.length;a<l;++a){const h=au[o[a].getType()];h(n,o[a],e,i,s,r)}}function ap(n,t,e,i,s){const r=e.getStroke();if(r){const a=n.getBuilder(e.getZIndex(),"LineString");a.setFillStrokeStyle(null,r),a.drawLineString(t,i,s)}const o=e.getText();if(o&&o.getText()){const a=n.getBuilder(e.getZIndex(),"Text");a.setTextStyle(o),a.drawText(t,i,s)}}function lp(n,t,e,i,s){const r=e.getStroke();if(r){const a=n.getBuilder(e.getZIndex(),"LineString");a.setFillStrokeStyle(null,r),a.drawMultiLineString(t,i,s)}const o=e.getText();if(o&&o.getText()){const a=n.getBuilder(e.getZIndex(),"Text");a.setTextStyle(o),a.drawText(t,i,s)}}function hp(n,t,e,i,s){const r=e.getFill(),o=e.getStroke();if(o||r){const l=n.getBuilder(e.getZIndex(),"Polygon");l.setFillStrokeStyle(r,o),l.drawMultiPolygon(t,i,s)}const a=e.getText();if(a&&a.getText()){const l=n.getBuilder(e.getZIndex(),"Text");l.setTextStyle(a),l.drawText(t,i,s)}}function cp(n,t,e,i,s,r){const o=e.getImage(),a=e.getText(),l=a&&a.getText(),h=r&&o&&l?{}:void 0;if(o){if(o.getImageState()!=K.LOADED)return;const c=n.getBuilder(e.getZIndex(),"Image");c.setImageStyle(o,h),c.drawPoint(t,i,s)}if(l){const c=n.getBuilder(e.getZIndex(),"Text");c.setTextStyle(a,h),c.drawText(t,i,s)}}function up(n,t,e,i,s,r){const o=e.getImage(),a=o&&o.getOpacity()!==0,l=e.getText(),h=l&&l.getText(),c=r&&a&&h?{}:void 0;if(a){if(o.getImageState()!=K.LOADED)return;const u=n.getBuilder(e.getZIndex(),"Image");u.setImageStyle(o,c),u.drawMultiPoint(t,i,s)}if(h){const u=n.getBuilder(e.getZIndex(),"Text");u.setTextStyle(l,c),u.drawText(t,i,s)}}function dp(n,t,e,i,s){const r=e.getFill(),o=e.getStroke();if(r||o){const l=n.getBuilder(e.getZIndex(),"Polygon");l.setFillStrokeStyle(r,o),l.drawPolygon(t,i,s)}const a=e.getText();if(a&&a.getText()){const l=n.getBuilder(e.getZIndex(),"Text");l.setTextStyle(a),l.drawText(t,i,s)}}class fp extends Mc{constructor(t){super(t),this.boundHandleStyleImageChange_=this.handleStyleImageChange_.bind(this),this.animatingOrInteracting_,this.hitDetectionImageData_=null,this.clipped_=!1,this.renderedFeatures_=null,this.renderedRevision_=-1,this.renderedResolution_=NaN,this.renderedExtent_=re(),this.wrappedRenderedExtent_=re(),this.renderedRotation_,this.renderedCenter_=null,this.renderedProjection_=null,this.renderedPixelRatio_=1,this.renderedRenderOrder_=null,this.renderedFrameDeclutter_,this.replayGroup_=null,this.replayGroupChanged=!0,this.clipping=!0,this.targetContext_=null,this.opacity_=1}renderWorlds(t,e,i){const s=e.extent,r=e.viewState,o=r.center,a=r.resolution,l=r.projection,h=r.rotation,c=l.getExtent(),u=this.getLayer().getSource(),d=this.getLayer().getDeclutter(),f=e.pixelRatio,g=e.viewHints,_=!(g[Lt.ANIMATING]||g[Lt.INTERACTING]),m=this.context,p=Math.round(nt(s)/a*f),y=Math.round(kt(s)/a*f),w=u.getWrapX()&&l.canWrapX(),x=w?nt(c):null,v=w?Math.ceil((s[2]-c[2])/x)+1:1;let R=w?Math.floor((s[0]-c[0])/x):0;do{let S=this.getRenderTransform(o,a,0,f,p,y,R*x);e.declutter&&(S=S.slice(0)),t.execute(m,[m.canvas.width,m.canvas.height],S,h,_,i===void 0?en:i?ou:qm,i?d&&e.declutter[d]:void 0)}while(++R<v)}setDrawContext_(){this.opacity_!==1&&(this.targetContext_=this.context,this.context=It(this.context.canvas.width,this.context.canvas.height,Ll))}resetDrawContext_(){if(this.opacity_!==1){const t=this.targetContext_.globalAlpha;this.targetContext_.globalAlpha=this.opacity_,this.targetContext_.drawImage(this.context.canvas,0,0),this.targetContext_.globalAlpha=t,yr(this.context),Ll.push(this.context.canvas),this.context=this.targetContext_,this.targetContext_=null}}renderDeclutter(t){!this.replayGroup_||!this.getLayer().getDeclutter()||this.renderWorlds(this.replayGroup_,t,!0)}renderDeferredInternal(t){this.replayGroup_&&(this.replayGroup_.renderDeferred(),this.clipped_&&this.context.restore(),this.resetDrawContext_())}renderFrame(t,e){const i=t.layerStatesArray[t.layerIndex];this.opacity_=i.opacity;const s=t.viewState;this.prepareContainer(t,e);const r=this.context,o=this.replayGroup_;let a=o&&!o.isEmpty();if(!a&&!(this.getLayer().hasListener(ie.PRERENDER)||this.getLayer().hasListener(ie.POSTRENDER)))return null;if(this.setDrawContext_(),this.preRender(r,t),s.projection,this.clipped_=!1,a&&i.extent&&this.clipping){const l=ri(i.extent);a=Bt(l,t.extent),this.clipped_=a&&!On(l,t.extent),this.clipped_&&this.clipUnrotated(r,t,l)}return a&&this.renderWorlds(o,t,this.getLayer().getDeclutter()?!1:void 0),!t.declutter&&this.clipped_&&r.restore(),this.postRender(r,t),this.renderedRotation_!==s.rotation&&(this.renderedRotation_=s.rotation,this.hitDetectionImageData_=null),t.declutter||this.resetDrawContext_(),this.container}getFeatures(t){return new Promise(e=>{if(this.frameState&&!this.hitDetectionImageData_&&!this.animatingOrInteracting_){const i=this.frameState.size.slice(),s=this.renderedCenter_,r=this.renderedResolution_,o=this.renderedRotation_,a=this.renderedProjection_,l=this.wrappedRenderedExtent_,h=this.getLayer(),c=[],u=i[0]*Ee,d=i[1]*Ee;c.push(this.getRenderTransform(s,r,o,Ee,u,d,0).slice());const f=h.getSource(),g=a.getExtent();if(f.getWrapX()&&a.canWrapX()&&!On(g,l)){let _=l[0];const m=nt(g);let p=0,y;for(;_<g[0];)--p,y=m*p,c.push(this.getRenderTransform(s,r,o,Ee,u,d,y).slice()),_+=m;for(p=0,_=l[2];_>g[2];)++p,y=m*p,c.push(this.getRenderTransform(s,r,o,Ee,u,d,y).slice()),_-=m}this.hitDetectionImageData_=tp(i,c,this.renderedFeatures_,h.getStyleFunction(),l,r,o,nh(r,this.renderedPixelRatio_))}e(ep(t,this.renderedFeatures_,this.hitDetectionImageData_))})}forEachFeatureAtCoordinate(t,e,i,s,r){var d,f;if(!this.replayGroup_)return;const o=e.viewState.resolution,a=e.viewState.rotation,l=this.getLayer(),h={},c=function(g,_,m){const p=Q(g),y=h[p];if(y){if(y!==!0&&m<y.distanceSq){if(m===0)return h[p]=!0,r.splice(r.lastIndexOf(y),1),s(g,l,_);y.geometry=_,y.distanceSq=m}}else{if(m===0)return h[p]=!0,s(g,l,_);r.push(h[p]={feature:g,layer:l,geometry:_,distanceSq:m,callback:s})}},u=this.getLayer().getDeclutter();return this.replayGroup_.forEachFeatureAtCoordinate(t,o,a,i,c,u?(f=(d=e.declutter)==null?void 0:d[u])==null?void 0:f.all().map(g=>g.value):null)}handleFontsChanged(){const t=this.getLayer();t.getVisible()&&this.replayGroup_&&t.changed()}handleStyleImageChange_(t){this.renderIfReadyAndVisible()}prepareFrame(t){const e=this.getLayer(),i=e.getSource();if(!i)return!1;const s=t.viewHints[Lt.ANIMATING],r=t.viewHints[Lt.INTERACTING],o=e.getUpdateWhileAnimating(),a=e.getUpdateWhileInteracting();if(this.ready&&!o&&s||!a&&r)return this.animatingOrInteracting_=!0,!0;this.animatingOrInteracting_=!1;const l=t.extent,h=t.viewState,c=h.projection,u=h.resolution,d=t.pixelRatio,f=e.getRevision(),g=e.getRenderBuffer();let _=e.getRenderOrder();_===void 0&&(_=np);const m=h.center.slice(),p=Qo(l,g*u),y=p.slice(),w=[p.slice()],x=c.getExtent();if(i.getWrapX()&&c.canWrapX()&&!On(x,t.extent)){const M=nt(x),V=Math.max(nt(p)/2,M);p[0]=x[0]-V,p[2]=x[2]+V,lc(m,c);const A=rc(w[0],c);A[0]<x[0]&&A[2]<x[2]?w.push([A[0]+M,A[1],A[2]+M,A[3]]):A[0]>x[0]&&A[2]>x[2]&&w.push([A[0]-M,A[1],A[2]-M,A[3]])}if(this.ready&&this.renderedResolution_==u&&this.renderedRevision_==f&&this.renderedRenderOrder_==_&&this.renderedFrameDeclutter_===!!t.declutter&&On(this.wrappedRenderedExtent_,p))return mi(this.renderedExtent_,y)||(this.hitDetectionImageData_=null,this.renderedExtent_=y),this.renderedCenter_=m,this.replayGroupChanged=!1,!0;this.replayGroup_=null;const v=new Um(lu(u,d),p,u,d);let R;for(let M=0,V=w.length;M<V;++M)i.loadFeatures(w[M],u,c);const S=nh(u,d);let C=!0;const I=(M,V)=>{let A;const k=M.getStyleFunction()||e.getStyleFunction();if(k&&(A=k(M,u)),A){const X=this.renderFeature(M,S,A,v,R,this.getLayer().getDeclutter(),V);C=C&&!X}},b=_c(p),L=i.getFeaturesInExtent(b);_&&L.sort(_);for(let M=0,V=L.length;M<V;++M)I(L[M],M);this.renderedFeatures_=L,this.ready=C;const P=v.finish(),D=new $m(p,u,d,i.getOverlaps(),P,e.getRenderBuffer(),!!t.declutter);return this.renderedResolution_=u,this.renderedRevision_=f,this.renderedRenderOrder_=_,this.renderedFrameDeclutter_=!!t.declutter,this.renderedExtent_=y,this.wrappedRenderedExtent_=p,this.renderedCenter_=m,this.renderedProjection_=c,this.renderedPixelRatio_=d,this.replayGroup_=D,this.hitDetectionImageData_=null,this.replayGroupChanged=!0,!0}renderFeature(t,e,i,s,r,o,a){if(!i)return!1;let l=!1;if(Array.isArray(i))for(let h=0,c=i.length;h<c;++h)l=sh(s,t,i[h],e,this.boundHandleStyleImageChange_,r,o,a)||l;else l=sh(s,t,i,e,this.boundHandleStyleImageChange_,r,o,a);return l}}class gp extends eu{constructor(t){super(t)}createRenderer(){return new fp(this)}}let _p=!1;function mp(n,t,e,i,s,r,o){const a=new XMLHttpRequest;a.open("GET",typeof n=="function"?n(e,i,s):n,!0),t.getType()=="arraybuffer"&&(a.responseType="arraybuffer"),a.withCredentials=_p,a.onload=function(l){if(!a.status||a.status>=200&&a.status<300){const h=t.getType();try{let c;h=="text"||h=="json"?c=a.responseText:h=="xml"?c=a.responseXML||a.responseText:h=="arraybuffer"&&(c=a.response),c?r(t.readFeatures(c,{extent:e,featureProjection:s}),t.readProjection(c)):o()}catch{o()}}else o()},a.onerror=o,a.send()}function rh(n,t){return function(e,i,s,r,o){mp(n,t,e,i,s,(a,l)=>{this.addFeatures(a),r!==void 0&&r(a)},o||cn)}}function pp(n,t){return[[-1/0,-1/0,1/0,1/0]]}class Nr extends Ae{constructor(t){if(super(),this.on,this.once,this.un,this.id_=void 0,this.geometryName_="geometry",this.style_=null,this.styleFunction_=void 0,this.geometryChangeKey_=null,this.addChangeListener(this.geometryName_,this.handleGeometryChanged_),t)if(typeof t.getSimplifiedGeometry=="function"){const e=t;this.setGeometry(e)}else{const e=t;this.setProperties(e)}}clone(){const t=new Nr(this.hasProperties()?this.getProperties():null);t.setGeometryName(this.getGeometryName());const e=this.getGeometry();e&&t.setGeometry(e.clone());const i=this.getStyle();return i&&t.setStyle(i),t}getGeometry(){return this.get(this.geometryName_)}getId(){return this.id_}getGeometryName(){return this.geometryName_}getStyle(){return this.style_}getStyleFunction(){return this.styleFunction_}handleGeometryChange_(){this.changed()}handleGeometryChanged_(){this.geometryChangeKey_&&(at(this.geometryChangeKey_),this.geometryChangeKey_=null);const t=this.getGeometry();t&&(this.geometryChangeKey_=q(t,j.CHANGE,this.handleGeometryChange_,this)),this.changed()}setGeometry(t){this.set(this.geometryName_,t)}setStyle(t){this.style_=t,this.styleFunction_=t?yp(t):void 0,this.changed()}setId(t){this.id_=t,this.changed()}setGeometryName(t){this.removeChangeListener(this.geometryName_,this.handleGeometryChanged_),this.geometryName_=t,this.addChangeListener(this.geometryName_,this.handleGeometryChanged_),this.handleGeometryChanged_()}}function yp(n){if(typeof n=="function")return n;let t;return Array.isArray(n)?t=n:($(typeof n.getZIndex=="function","Expected an `ol/style/Style` or an array of `ol/style/Style.js`"),t=[n]),function(){return t}}function cu(n,t,e,i){const s=[];let r=re();for(let o=0,a=e.length;o<a;++o){const l=e[o];r=ea(n,t,l[0],i),s.push((r[0]+r[2])/2,(r[1]+r[3])/2),t=l[l.length-1]}return s}function ir(n,t,e,i,s,r,o){let a,l;const h=(e-t)/i;if(h===1)a=t;else if(h===2)a=t,l=s;else if(h!==0){let c=n[t],u=n[t+1],d=0;const f=[0];for(let m=t+i;m<e;m+=i){const p=n[m],y=n[m+1];d+=Math.sqrt((p-c)*(p-c)+(y-u)*(y-u)),f.push(d),c=p,u=y}const g=s*d,_=Vd(f,g);_<0?(l=(g-f[-_-2])/(f[-_-1]-f[-_-2]),a=t+(-_-2)*i):a=t+_*i}o=o>1?o:2,r=r||new Array(o);for(let c=0;c<o;++c)r[c]=a===void 0?NaN:l===void 0?n[a+c]:Vt(n[a+c],n[a+i+c],l);return r}function ko(n,t,e,i,s,r){if(e==t)return null;let o;if(s<n[t+i-1])return r?(o=n.slice(t,t+i),o[i-1]=s,o):null;if(n[e-1]<s)return r?(o=n.slice(e-i,e),o[i-1]=s,o):null;if(s==n[t+i-1])return n.slice(t,t+i);let a=t/i,l=e/i;for(;a<l;){const d=a+l>>1;s<n[(d+1)*i-1]?l=d:a=d+1}const h=n[a*i-1];if(s==h)return n.slice((a-1)*i,(a-1)*i+i);const c=n[(a+1)*i-1],u=(s-h)/(c-h);o=[];for(let d=0;d<i-1;++d)o.push(Vt(n[(a-1)*i+d],n[a*i+d],u));return o.push(s),o}function vp(n,t,e,i,s,r,o){if(o)return ko(n,t,e[e.length-1],i,s,r);let a;if(s<n[i-1])return r?(a=n.slice(0,i),a[i-1]=s,a):null;if(n[n.length-1]<s)return r?(a=n.slice(n.length-i),a[i-1]=s,a):null;for(let l=0,h=e.length;l<h;++l){const c=e[l];if(t!=c){if(s<n[t+i-1])return null;if(s<=n[c-1])return ko(n,t,c,i,s,!1);t=c}}return null}class nr extends Lc{constructor(t){super(),this.geometries_=t,this.changeEventsKeys_=[],this.listenGeometriesChange_()}unlistenGeometriesChange_(){this.changeEventsKeys_.forEach(at),this.changeEventsKeys_.length=0}listenGeometriesChange_(){const t=this.geometries_;for(let e=0,i=t.length;e<i;++e)this.changeEventsKeys_.push(q(t[e],j.CHANGE,this.changed,this))}clone(){const t=new nr(co(this.geometries_));return t.applyProperties(this),t}closestPointXY(t,e,i,s){if(s<Oi(this.getExtent(),t,e))return s;const r=this.geometries_;for(let o=0,a=r.length;o<a;++o)s=r[o].closestPointXY(t,e,i,s);return s}containsXY(t,e){const i=this.geometries_;for(let s=0,r=i.length;s<r;++s)if(i[s].containsXY(t,e))return!0;return!1}computeExtent(t){as(t);const e=this.geometries_;for(let i=0,s=e.length;i<s;++i)ec(t,e[i].getExtent());return t}getGeometries(){return co(this.geometries_)}getGeometriesArray(){return this.geometries_}getGeometriesArrayRecursive(){let t=[];const e=this.geometries_;for(let i=0,s=e.length;i<s;++i)e[i].getType()===this.getType()?t=t.concat(e[i].getGeometriesArrayRecursive()):t.push(e[i]);return t}getSimplifiedGeometry(t){if(this.simplifiedGeometryRevision!==this.getRevision()&&(this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),t<0||this.simplifiedGeometryMaxMinSquaredTolerance!==0&&t<this.simplifiedGeometryMaxMinSquaredTolerance)return this;const e=[],i=this.geometries_;let s=!1;for(let r=0,o=i.length;r<o;++r){const a=i[r],l=a.getSimplifiedGeometry(t);e.push(l),l!==a&&(s=!0)}return s?new nr(e):(this.simplifiedGeometryMaxMinSquaredTolerance=t,this)}getType(){return"GeometryCollection"}intersectsExtent(t){const e=this.geometries_;for(let i=0,s=e.length;i<s;++i)if(e[i].intersectsExtent(t))return!0;return!1}isEmpty(){return this.geometries_.length===0}rotate(t,e){const i=this.geometries_;for(let s=0,r=i.length;s<r;++s)i[s].rotate(t,e);this.changed()}scale(t,e,i){i||(i=gi(this.getExtent()));const s=this.geometries_;for(let r=0,o=s.length;r<o;++r)s[r].scale(t,e,i);this.changed()}setGeometries(t){this.setGeometriesArray(co(t))}setGeometriesArray(t){this.unlistenGeometriesChange_(),this.geometries_=t,this.listenGeometriesChange_(),this.changed()}applyTransform(t){const e=this.geometries_;for(let i=0,s=e.length;i<s;++i)e[i].applyTransform(t);this.changed()}translate(t,e){const i=this.geometries_;for(let s=0,r=i.length;s<r;++s)i[s].translate(t,e);this.changed()}disposeInternal(){this.unlistenGeometriesChange_(),super.disposeInternal()}}function co(n){return n.map(t=>t.clone())}class pn extends Di{constructor(t,e){super(),this.flatMidpoint_=null,this.flatMidpointRevision_=-1,this.maxDelta_=-1,this.maxDeltaRevision_=-1,e!==void 0&&!Array.isArray(t[0])?this.setFlatCoordinates(e,t):this.setCoordinates(t,e)}appendCoordinate(t){Se(this.flatCoordinates,t),this.changed()}clone(){const t=new pn(this.flatCoordinates.slice(),this.layout);return t.applyProperties(this),t}closestPointXY(t,e,i,s){return s<Oi(this.getExtent(),t,e)?s:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(pa(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),va(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!1,t,e,i,s))}forEachSegment(t){return mc(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t)}getCoordinateAtM(t,e){return this.layout!="XYM"&&this.layout!="XYZM"?null:(e=e!==void 0?e:!1,ko(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,e))}getCoordinates(){return oi(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getCoordinateAt(t,e){return ir(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,e,this.stride)}getLength(){return ru(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getFlatMidpoint(){return this.flatMidpointRevision_!=this.getRevision()&&(this.flatMidpoint_=this.getCoordinateAt(.5,this.flatMidpoint_??void 0),this.flatMidpointRevision_=this.getRevision()),this.flatMidpoint_}getSimplifiedGeometryInternal(t){const e=[];return e.length=Pr(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,e,0),new pn(e,"XY")}getType(){return"LineString"}intersectsExtent(t){return Ar(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,this.getExtent())}setCoordinates(t,e){this.setLayout(e,t,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=Lr(this.flatCoordinates,0,t,this.stride),this.changed()}}class sr extends Di{constructor(t,e,i){if(super(),this.ends_=[],this.maxDelta_=-1,this.maxDeltaRevision_=-1,Array.isArray(t[0]))this.setCoordinates(t,e);else if(e!==void 0&&i)this.setFlatCoordinates(e,t),this.ends_=i;else{const s=t,r=[],o=[];for(let l=0,h=s.length;l<h;++l){const c=s[l];Se(r,c.getFlatCoordinates()),o.push(r.length)}const a=s.length===0?this.getLayout():s[0].getLayout();this.setFlatCoordinates(a,r),this.ends_=o}}appendLineString(t){Se(this.flatCoordinates,t.getFlatCoordinates().slice()),this.ends_.push(this.flatCoordinates.length),this.changed()}clone(){const t=new sr(this.flatCoordinates.slice(),this.layout,this.ends_.slice());return t.applyProperties(this),t}closestPointXY(t,e,i,s){return s<Oi(this.getExtent(),t,e)?s:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(ya(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),xa(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!1,t,e,i,s))}getCoordinateAtM(t,e,i){return this.layout!="XYM"&&this.layout!="XYZM"||this.flatCoordinates.length===0?null:(e=e!==void 0?e:!1,i=i!==void 0?i:!1,vp(this.flatCoordinates,0,this.ends_,this.stride,t,e,i))}getCoordinates(){return Jn(this.flatCoordinates,0,this.ends_,this.stride)}getEnds(){return this.ends_}getLineString(t){return t<0||this.ends_.length<=t?null:new pn(this.flatCoordinates.slice(t===0?0:this.ends_[t-1],this.ends_[t]),this.layout)}getLineStrings(){const t=this.flatCoordinates,e=this.ends_,i=this.layout,s=[];let r=0;for(let o=0,a=e.length;o<a;++o){const l=e[o],h=new pn(t.slice(r,l),i);s.push(h),r=l}return s}getFlatMidpoints(){const t=[],e=this.flatCoordinates;let i=0;const s=this.ends_,r=this.stride;for(let o=0,a=s.length;o<a;++o){const l=s[o],h=ir(e,i,l,r,.5);Se(t,h),i=l}return t}getSimplifiedGeometryInternal(t){const e=[],i=[];return e.length=Dc(this.flatCoordinates,0,this.ends_,this.stride,t,e,0,i),new sr(e,"XY",i)}getType(){return"MultiLineString"}intersectsExtent(t){return Jf(this.flatCoordinates,0,this.ends_,this.stride,t)}setCoordinates(t,e){this.setLayout(e,t,2),this.flatCoordinates||(this.flatCoordinates=[]);const i=hs(this.flatCoordinates,0,t,this.stride,this.ends_);this.flatCoordinates.length=i.length===0?0:i[i.length-1],this.changed()}}class Gr extends Di{constructor(t,e){super(),e&&!Array.isArray(t[0])?this.setFlatCoordinates(e,t):this.setCoordinates(t,e)}appendPoint(t){Se(this.flatCoordinates,t.getFlatCoordinates()),this.changed()}clone(){const t=new Gr(this.flatCoordinates.slice(),this.layout);return t.applyProperties(this),t}closestPointXY(t,e,i,s){if(s<Oi(this.getExtent(),t,e))return s;const r=this.flatCoordinates,o=this.stride;for(let a=0,l=r.length;a<l;a+=o){const h=bi(t,e,r[a],r[a+1]);if(h<s){s=h;for(let c=0;c<o;++c)i[c]=r[a+c];i.length=o}}return s}getCoordinates(){return oi(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getPoint(t){const e=this.flatCoordinates.length/this.stride;return t<0||e<=t?null:new Li(this.flatCoordinates.slice(t*this.stride,(t+1)*this.stride),this.layout)}getPoints(){const t=this.flatCoordinates,e=this.layout,i=this.stride,s=[];for(let r=0,o=t.length;r<o;r+=i){const a=new Li(t.slice(r,r+i),e);s.push(a)}return s}getType(){return"MultiPoint"}intersectsExtent(t){const e=this.flatCoordinates,i=this.stride;for(let s=0,r=e.length;s<r;s+=i){const o=e[s],a=e[s+1];if(ta(t,o,a))return!0}return!1}setCoordinates(t,e){this.setLayout(e,t,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=Lr(this.flatCoordinates,0,t,this.stride),this.changed()}}class rr extends Di{constructor(t,e,i){if(super(),this.endss_=[],this.flatInteriorPointsRevision_=-1,this.flatInteriorPoints_=null,this.maxDelta_=-1,this.maxDeltaRevision_=-1,this.orientedRevision_=-1,this.orientedFlatCoordinates_=null,!i&&!Array.isArray(t[0])){const s=t,r=[],o=[];for(let a=0,l=s.length;a<l;++a){const h=s[a],c=r.length,u=h.getEnds();for(let d=0,f=u.length;d<f;++d)u[d]+=c;Se(r,h.getFlatCoordinates()),o.push(u)}e=s.length===0?this.getLayout():s[0].getLayout(),t=r,i=o}e!==void 0&&i?(this.setFlatCoordinates(e,t),this.endss_=i):this.setCoordinates(t,e)}appendPolygon(t){let e;if(!this.flatCoordinates)this.flatCoordinates=t.getFlatCoordinates().slice(),e=t.getEnds().slice(),this.endss_.push();else{const i=this.flatCoordinates.length;Se(this.flatCoordinates,t.getFlatCoordinates()),e=t.getEnds().slice();for(let s=0,r=e.length;s<r;++s)e[s]+=i}this.endss_.push(e),this.changed()}clone(){const t=this.endss_.length,e=new Array(t);for(let s=0;s<t;++s)e[s]=this.endss_[s].slice();const i=new rr(this.flatCoordinates.slice(),this.layout,e);return i.applyProperties(this),i}closestPointXY(t,e,i,s){return s<Oi(this.getExtent(),t,e)?s:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt($g(this.flatCoordinates,0,this.endss_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),Jg(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,this.maxDelta_,!0,t,e,i,s))}containsXY(t,e){return $f(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,t,e)}getArea(){return qg(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride)}getCoordinates(t){let e;return t!==void 0?(e=this.getOrientedFlatCoordinates().slice(),Lo(e,0,this.endss_,this.stride,t)):e=this.flatCoordinates,Ao(e,0,this.endss_,this.stride)}getEndss(){return this.endss_}getFlatInteriorPoints(){if(this.flatInteriorPointsRevision_!=this.getRevision()){const t=cu(this.flatCoordinates,0,this.endss_,this.stride);this.flatInteriorPoints_=kc(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,t),this.flatInteriorPointsRevision_=this.getRevision()}return this.flatInteriorPoints_}getInteriorPoints(){return new Gr(this.getFlatInteriorPoints().slice(),"XYM")}getOrientedFlatCoordinates(){if(this.orientedRevision_!=this.getRevision()){const t=this.flatCoordinates;Nc(t,0,this.endss_,this.stride)?this.orientedFlatCoordinates_=t:(this.orientedFlatCoordinates_=t.slice(),this.orientedFlatCoordinates_.length=Lo(this.orientedFlatCoordinates_,0,this.endss_,this.stride)),this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_}getSimplifiedGeometryInternal(t){const e=[],i=[];return e.length=e_(this.flatCoordinates,0,this.endss_,this.stride,Math.sqrt(t),e,0,i),new rr(e,"XY",i)}getPolygon(t){if(t<0||this.endss_.length<=t)return null;let e;if(t===0)e=0;else{const r=this.endss_[t-1];e=r[r.length-1]}const i=this.endss_[t].slice(),s=i[i.length-1];if(e!==0)for(let r=0,o=i.length;r<o;++r)i[r]-=e;return new _i(this.flatCoordinates.slice(e,s),this.layout,i)}getPolygons(){const t=this.layout,e=this.flatCoordinates,i=this.endss_,s=[];let r=0;for(let o=0,a=i.length;o<a;++o){const l=i[o].slice(),h=l[l.length-1];if(r!==0)for(let u=0,d=l.length;u<d;++u)l[u]-=r;const c=new _i(e.slice(r,h),t,l);s.push(c),r=h}return s}getType(){return"MultiPolygon"}intersectsExtent(t){return Qf(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,t)}setCoordinates(t,e){this.setLayout(e,t,3),this.flatCoordinates||(this.flatCoordinates=[]);const i=Fc(this.flatCoordinates,0,t,this.stride,this.endss_);if(i.length===0)this.flatCoordinates.length=0;else{const s=i[i.length-1];this.flatCoordinates.length=s.length===0?0:s[s.length-1]}this.changed()}}const oh=de();class Ht{constructor(t,e,i,s,r,o){this.styleFunction,this.extent_,this.id_=o,this.type_=t,this.flatCoordinates_=e,this.flatInteriorPoints_=null,this.flatMidpoints_=null,this.ends_=i||null,this.properties_=r,this.squaredTolerance_,this.stride_=s,this.simplifiedGeometry_}get(t){return this.properties_[t]}getExtent(){return this.extent_||(this.extent_=this.type_==="Point"?tc(this.flatCoordinates_):ea(this.flatCoordinates_,0,this.flatCoordinates_.length,2)),this.extent_}getFlatInteriorPoint(){if(!this.flatInteriorPoints_){const t=gi(this.getExtent());this.flatInteriorPoints_=Ea(this.flatCoordinates_,0,this.ends_,2,t,0)}return this.flatInteriorPoints_}getFlatInteriorPoints(){if(!this.flatInteriorPoints_){const t=n_(this.flatCoordinates_,this.ends_),e=cu(this.flatCoordinates_,0,t,2);this.flatInteriorPoints_=kc(this.flatCoordinates_,0,t,2,e)}return this.flatInteriorPoints_}getFlatMidpoint(){return this.flatMidpoints_||(this.flatMidpoints_=ir(this.flatCoordinates_,0,this.flatCoordinates_.length,2,.5)),this.flatMidpoints_}getFlatMidpoints(){if(!this.flatMidpoints_){this.flatMidpoints_=[];const t=this.flatCoordinates_;let e=0;const i=this.ends_;for(let s=0,r=i.length;s<r;++s){const o=i[s],a=ir(t,e,o,2,.5);Se(this.flatMidpoints_,a),e=o}}return this.flatMidpoints_}getId(){return this.id_}getOrientedFlatCoordinates(){return this.flatCoordinates_}getGeometry(){return this}getSimplifiedGeometry(t){return this}simplifyTransformed(t,e){return this}getProperties(){return this.properties_}getPropertiesInternal(){return this.properties_}getStride(){return this.stride_}getStyleFunction(){return this.styleFunction}getType(){return this.type_}transform(t){t=dt(t);const e=t.getExtent(),i=t.getWorldExtent();if(e&&i){const s=kt(i)/kt(e);Ke(oh,i[0],i[3],s,-s,0,0,0),hi(this.flatCoordinates_,0,this.flatCoordinates_.length,2,oh,this.flatCoordinates_)}}applyTransform(t){t(this.flatCoordinates_,this.flatCoordinates_,this.stride_)}clone(){var t;return new Ht(this.type_,this.flatCoordinates_.slice(),(t=this.ends_)==null?void 0:t.slice(),this.stride_,Object.assign({},this.properties_),this.id_)}getEnds(){return this.ends_}enableSimplifyTransformed(){return this.simplifyTransformed=Vh((t,e)=>{if(t===this.squaredTolerance_)return this.simplifiedGeometry_;this.simplifiedGeometry_=this.clone(),e&&this.simplifiedGeometry_.applyTransform(e);const i=this.simplifiedGeometry_.getFlatCoordinates();let s;switch(this.type_){case"LineString":i.length=Pr(i,0,this.simplifiedGeometry_.flatCoordinates_.length,this.simplifiedGeometry_.stride_,t,i,0),s=[i.length];break;case"MultiLineString":s=[],i.length=Dc(i,0,this.simplifiedGeometry_.ends_,this.simplifiedGeometry_.stride_,t,i,0,s);break;case"Polygon":s=[],i.length=wa(i,0,this.simplifiedGeometry_.ends_,this.simplifiedGeometry_.stride_,Math.sqrt(t),i,0,s);break}return s&&(this.simplifiedGeometry_=new Ht(this.type_,i,s,2,this.properties_,this.id_)),this.squaredTolerance_=t,this.simplifiedGeometry_}),this}}Ht.prototype.getFlatCoordinates=Ht.prototype.getOrientedFlatCoordinates;class ah{constructor(t){this.rbush_=new Bc(t),this.items_={}}insert(t,e){const i={minX:t[0],minY:t[1],maxX:t[2],maxY:t[3],value:e};this.rbush_.insert(i),this.items_[Q(e)]=i}load(t,e){const i=new Array(e.length);for(let s=0,r=e.length;s<r;s++){const o=t[s],a=e[s],l={minX:o[0],minY:o[1],maxX:o[2],maxY:o[3],value:a};i[s]=l,this.items_[Q(a)]=l}this.rbush_.load(i)}remove(t){const e=Q(t),i=this.items_[e];return delete this.items_[e],this.rbush_.remove(i)!==null}update(t,e){const i=this.items_[Q(e)],s=[i.minX,i.minY,i.maxX,i.maxY];Hn(s,t)||(this.remove(e),this.insert(t,e))}getAll(){return this.rbush_.all().map(function(e){return e.value})}getInExtent(t){const e={minX:t[0],minY:t[1],maxX:t[2],maxY:t[3]};return this.rbush_.search(e).map(function(s){return s.value})}forEach(t){return this.forEach_(this.getAll(),t)}forEachInExtent(t,e){return this.forEach_(this.getInExtent(t),e)}forEach_(t,e){let i;for(let s=0,r=t.length;s<r;s++)if(i=e(t[s]),i)return i;return i}isEmpty(){return Ai(this.items_)}clear(){this.rbush_.clear(),this.items_={}}getExtent(t){const e=this.rbush_.toJSON();return fi(e.minX,e.minY,e.maxX,e.maxY,t)}concat(t){this.rbush_.load(t.rbush_.all());for(const e in t.items_)this.items_[e]=t.items_[e]}}const Qt={ADDFEATURE:"addfeature",CHANGEFEATURE:"changefeature",CLEAR:"clear",REMOVEFEATURE:"removefeature",FEATURESLOADSTART:"featuresloadstart",FEATURESLOADEND:"featuresloadend",FEATURESLOADERROR:"featuresloaderror"};class ti extends Ve{constructor(t,e,i){super(t),this.feature=e,this.features=i}}class xp extends Sc{constructor(t){t=t||{},super({attributions:t.attributions,interpolate:!0,projection:void 0,state:"ready",wrapX:t.wrapX!==void 0?t.wrapX:!0}),this.on,this.once,this.un,this.loader_=cn,this.format_=t.format||null,this.overlaps_=t.overlaps===void 0?!0:t.overlaps,this.url_=t.url,t.loader!==void 0?this.loader_=t.loader:this.url_!==void 0&&($(this.format_,"`format` must be set when `url` is set"),this.loader_=rh(this.url_,this.format_)),this.strategy_=t.strategy!==void 0?t.strategy:pp;const e=t.useSpatialIndex!==void 0?t.useSpatialIndex:!0;this.featuresRtree_=e?new ah:null,this.loadedExtentsRtree_=new ah,this.loadingExtentsCount_=0,this.nullGeometryFeatures_={},this.idIndex_={},this.uidIndex_={},this.featureChangeKeys_={},this.featuresCollection_=null;let i,s;Array.isArray(t.features)?s=t.features:t.features&&(i=t.features,s=i.getArray()),!e&&i===void 0&&(i=new Re(s)),s!==void 0&&this.addFeaturesInternal(s),i!==void 0&&this.bindFeaturesCollection_(i)}addFeature(t){this.addFeatureInternal(t),this.changed()}addFeatureInternal(t){const e=Q(t);if(!this.addToIndex_(e,t)){this.featuresCollection_&&this.featuresCollection_.remove(t);return}this.setupChangeEvents_(e,t);const i=t.getGeometry();if(i){const s=i.getExtent();this.featuresRtree_&&this.featuresRtree_.insert(s,t)}else this.nullGeometryFeatures_[e]=t;this.dispatchEvent(new ti(Qt.ADDFEATURE,t))}setupChangeEvents_(t,e){e instanceof Ht||(this.featureChangeKeys_[t]=[q(e,j.CHANGE,this.handleFeatureChange_,this),q(e,un.PROPERTYCHANGE,this.handleFeatureChange_,this)])}addToIndex_(t,e){let i=!0;if(e.getId()!==void 0){const s=String(e.getId());if(!(s in this.idIndex_))this.idIndex_[s]=e;else if(e instanceof Ht){const r=this.idIndex_[s];r instanceof Ht?Array.isArray(r)?r.push(e):this.idIndex_[s]=[r,e]:i=!1}else i=!1}return i&&($(!(t in this.uidIndex_),"The passed `feature` was already added to the source"),this.uidIndex_[t]=e),i}addFeatures(t){this.addFeaturesInternal(t),this.changed()}addFeaturesInternal(t){const e=[],i=[],s=[];for(let r=0,o=t.length;r<o;r++){const a=t[r],l=Q(a);this.addToIndex_(l,a)&&i.push(a)}for(let r=0,o=i.length;r<o;r++){const a=i[r],l=Q(a);this.setupChangeEvents_(l,a);const h=a.getGeometry();if(h){const c=h.getExtent();e.push(c),s.push(a)}else this.nullGeometryFeatures_[l]=a}if(this.featuresRtree_&&this.featuresRtree_.load(e,s),this.hasListener(Qt.ADDFEATURE))for(let r=0,o=i.length;r<o;r++)this.dispatchEvent(new ti(Qt.ADDFEATURE,i[r]))}bindFeaturesCollection_(t){let e=!1;this.addEventListener(Qt.ADDFEATURE,function(i){e||(e=!0,t.push(i.feature),e=!1)}),this.addEventListener(Qt.REMOVEFEATURE,function(i){e||(e=!0,t.remove(i.feature),e=!1)}),t.addEventListener(Yt.ADD,i=>{e||(e=!0,this.addFeature(i.element),e=!1)}),t.addEventListener(Yt.REMOVE,i=>{e||(e=!0,this.removeFeature(i.element),e=!1)}),this.featuresCollection_=t}clear(t){if(t){for(const i in this.featureChangeKeys_)this.featureChangeKeys_[i].forEach(at);this.featuresCollection_||(this.featureChangeKeys_={},this.idIndex_={},this.uidIndex_={})}else if(this.featuresRtree_){this.featuresRtree_.forEach(i=>{this.removeFeatureInternal(i)});for(const i in this.nullGeometryFeatures_)this.removeFeatureInternal(this.nullGeometryFeatures_[i])}this.featuresCollection_&&this.featuresCollection_.clear(),this.featuresRtree_&&this.featuresRtree_.clear(),this.nullGeometryFeatures_={};const e=new ti(Qt.CLEAR);this.dispatchEvent(e),this.changed()}forEachFeature(t){if(this.featuresRtree_)return this.featuresRtree_.forEach(t);this.featuresCollection_&&this.featuresCollection_.forEach(t)}forEachFeatureAtCoordinateDirect(t,e){const i=[t[0],t[1],t[0],t[1]];return this.forEachFeatureInExtent(i,function(s){const r=s.getGeometry();if(r instanceof Ht||r.intersectsCoordinate(t))return e(s)})}forEachFeatureInExtent(t,e){if(this.featuresRtree_)return this.featuresRtree_.forEachInExtent(t,e);this.featuresCollection_&&this.featuresCollection_.forEach(e)}forEachFeatureIntersectingExtent(t,e){return this.forEachFeatureInExtent(t,function(i){const s=i.getGeometry();if(s instanceof Ht||s.intersectsExtent(t)){const r=e(i);if(r)return r}})}getFeaturesCollection(){return this.featuresCollection_}getFeatures(){let t;return this.featuresCollection_?t=this.featuresCollection_.getArray().slice(0):this.featuresRtree_&&(t=this.featuresRtree_.getAll(),Ai(this.nullGeometryFeatures_)||Se(t,Object.values(this.nullGeometryFeatures_))),t}getFeaturesAtCoordinate(t){const e=[];return this.forEachFeatureAtCoordinateDirect(t,function(i){e.push(i)}),e}getFeaturesInExtent(t,e){if(this.featuresRtree_){if(!(e&&e.canWrapX()&&this.getWrapX()))return this.featuresRtree_.getInExtent(t);const s=oc(t,e);return[].concat(...s.map(r=>this.featuresRtree_.getInExtent(r)))}return this.featuresCollection_?this.featuresCollection_.getArray().slice(0):[]}getClosestFeatureToCoordinate(t,e){const i=t[0],s=t[1];let r=null;const o=[NaN,NaN];let a=1/0;const l=[-1/0,-1/0,1/0,1/0];return e=e||Bn,this.featuresRtree_.forEachInExtent(l,function(h){if(e(h)){const c=h.getGeometry(),u=a;if(a=c instanceof Ht?0:c.closestPointXY(i,s,o,a),a<u){r=h;const d=Math.sqrt(a);l[0]=i-d,l[1]=s-d,l[2]=i+d,l[3]=s+d}}}),r}getExtent(t){return this.featuresRtree_.getExtent(t)}getFeatureById(t){const e=this.idIndex_[t.toString()];return e!==void 0?e:null}getFeatureByUid(t){const e=this.uidIndex_[t];return e!==void 0?e:null}getFormat(){return this.format_}getOverlaps(){return this.overlaps_}getUrl(){return this.url_}handleFeatureChange_(t){const e=t.target,i=Q(e),s=e.getGeometry();if(!s)i in this.nullGeometryFeatures_||(this.featuresRtree_&&this.featuresRtree_.remove(e),this.nullGeometryFeatures_[i]=e);else{const o=s.getExtent();i in this.nullGeometryFeatures_?(delete this.nullGeometryFeatures_[i],this.featuresRtree_&&this.featuresRtree_.insert(o,e)):this.featuresRtree_&&this.featuresRtree_.update(o,e)}const r=e.getId();if(r!==void 0){const o=r.toString();this.idIndex_[o]!==e&&(this.removeFromIdIndex_(e),this.idIndex_[o]=e)}else this.removeFromIdIndex_(e),this.uidIndex_[i]=e;this.changed(),this.dispatchEvent(new ti(Qt.CHANGEFEATURE,e))}hasFeature(t){const e=t.getId();return e!==void 0?e in this.idIndex_:Q(t)in this.uidIndex_}isEmpty(){return this.featuresRtree_?this.featuresRtree_.isEmpty()&&Ai(this.nullGeometryFeatures_):this.featuresCollection_?this.featuresCollection_.getLength()===0:!0}loadFeatures(t,e,i){const s=this.loadedExtentsRtree_,r=this.strategy_(t,e,i);for(let o=0,a=r.length;o<a;++o){const l=r[o];s.forEachInExtent(l,function(c){return On(c.extent,l)})||(++this.loadingExtentsCount_,this.dispatchEvent(new ti(Qt.FEATURESLOADSTART)),this.loader_.call(this,l,e,i,c=>{--this.loadingExtentsCount_,this.dispatchEvent(new ti(Qt.FEATURESLOADEND,void 0,c))},()=>{--this.loadingExtentsCount_,this.dispatchEvent(new ti(Qt.FEATURESLOADERROR))}),s.insert(l,{extent:l.slice()}))}this.loading=this.loader_.length<4?!1:this.loadingExtentsCount_>0}refresh(){this.clear(!0),this.loadedExtentsRtree_.clear(),super.refresh()}removeLoadedExtent(t){const e=this.loadedExtentsRtree_,i=e.forEachInExtent(t,function(s){if(Hn(s.extent,t))return s});i&&e.remove(i)}removeFeatures(t){let e=!1;for(let i=0,s=t.length;i<s;++i)e=this.removeFeatureInternal(t[i])||e;e&&this.changed()}removeFeature(t){if(!t)return;this.removeFeatureInternal(t)&&this.changed()}removeFeatureInternal(t){const e=Q(t);if(!(e in this.uidIndex_))return!1;e in this.nullGeometryFeatures_?delete this.nullGeometryFeatures_[e]:this.featuresRtree_&&this.featuresRtree_.remove(t);const i=this.featureChangeKeys_[e];i==null||i.forEach(at),delete this.featureChangeKeys_[e];const s=t.getId();if(s!==void 0){const r=s.toString(),o=this.idIndex_[r];o===t?delete this.idIndex_[r]:Array.isArray(o)&&(o.splice(o.indexOf(t),1),o.length===1&&(this.idIndex_[r]=o[0]))}return delete this.uidIndex_[e],this.hasListener(Qt.REMOVEFEATURE)&&this.dispatchEvent(new ti(Qt.REMOVEFEATURE,t)),!0}removeFromIdIndex_(t){for(const e in this.idIndex_)if(this.idIndex_[e]===t){delete this.idIndex_[e];break}}setLoader(t){this.loader_=t}setUrl(t){$(this.format_,"`format` must be set when `url` is set"),this.url_=t,this.setLoader(rh(t,this.format_))}setOverlaps(t){this.overlaps_=t,this.changed()}}class wp{constructor(){this.dataProjection=void 0,this.defaultFeatureProjection=void 0,this.featureClass=Nr,this.supportedMediaTypes=null}getReadOptions(t,e){if(e){let i=e.dataProjection?dt(e.dataProjection):this.readProjection(t);e.extent&&i&&i.getUnits()==="tile-pixels"&&(i=dt(i),i.setWorldExtent(e.extent)),e={dataProjection:i,featureProjection:e.featureProjection}}return this.adaptOptions(e)}adaptOptions(t){return Object.assign({dataProjection:this.dataProjection,featureProjection:this.defaultFeatureProjection,featureClass:this.featureClass},t)}getType(){return G()}readFeature(t,e){return G()}readFeatures(t,e){return G()}readGeometry(t,e){return G()}readProjection(t){return G()}writeFeature(t,e){return G()}writeFeatures(t,e){return G()}writeGeometry(t,e){return G()}}function Fa(n,t,e){const i=e?dt(e.featureProjection):null,s=e?dt(e.dataProjection):null;let r=n;if(i&&s&&!Fs(i,s)){t&&(r=n.clone());const o=t?i:s,a=t?s:i;o.getUnits()==="tile-pixels"?r.transform(o,a):r.applyTransform($n(o,a))}if(t&&e&&e.decimals!==void 0){const o=Math.pow(10,e.decimals),a=function(l){for(let h=0,c=l.length;h<c;++h)l[h]=Math.round(l[h]*o)/o;return l};r===n&&(r=n.clone()),r.applyTransform(a)}return r}const Ep={Point:Li,LineString:pn,Polygon:_i,MultiPoint:Gr,MultiLineString:sr,MultiPolygon:rr};function Cp(n,t,e){return Array.isArray(t[0])?(Nc(n,0,t,e)||(n=n.slice(),Lo(n,0,t,e)),n):(Ra(n,0,t,e)||(n=n.slice(),$s(n,0,t,e)),n)}function uu(n,t){var r;const e=n.geometry;if(!e)return[];if(Array.isArray(e))return e.map(o=>uu({...n,geometry:o})).flat();const i=e.type==="MultiPolygon"?"Polygon":e.type;if(i==="GeometryCollection"||i==="Circle")throw new Error("Unsupported geometry type: "+i);const s=e.layout.length;return Fa(new Ht(i,i==="Polygon"?Cp(e.flatCoordinates,e.ends,s):e.flatCoordinates,(r=e.ends)==null?void 0:r.flat(),s,n.properties||{},n.id).enableSimplifyTransformed(),!1,t)}function Da(n,t){if(!n)return null;if(Array.isArray(n)){const i=n.map(s=>Da(s,t));return new nr(i)}const e=Ep[n.type];return Fa(new e(n.flatCoordinates,n.layout||"XY",n.ends),!1,t)}class Rp extends wp{constructor(){super()}getType(){return"json"}readFeature(t,e){return this.readFeatureFromObject(Ms(t),this.getReadOptions(t,e))}readFeatures(t,e){return this.readFeaturesFromObject(Ms(t),this.getReadOptions(t,e))}readFeatureFromObject(t,e){return G()}readFeaturesFromObject(t,e){return G()}readGeometry(t,e){return this.readGeometryFromObject(Ms(t),this.getReadOptions(t,e))}readGeometryFromObject(t,e){return G()}readProjection(t){return this.readProjectionFromObject(Ms(t))}readProjectionFromObject(t){return G()}writeFeature(t,e){return JSON.stringify(this.writeFeatureObject(t,e))}writeFeatureObject(t,e){return G()}writeFeatures(t,e){return JSON.stringify(this.writeFeaturesObject(t,e))}writeFeaturesObject(t,e){return G()}writeGeometry(t,e){return JSON.stringify(this.writeGeometryObject(t,e))}writeGeometryObject(t,e){return G()}}function Ms(n){if(typeof n=="string"){const t=JSON.parse(n);return t||null}return n!==null?n:null}class Ip extends Rp{constructor(t){t=t||{},super(),this.dataProjection=dt(t.dataProjection?t.dataProjection:"EPSG:4326"),t.featureProjection&&(this.defaultFeatureProjection=dt(t.featureProjection)),t.featureClass&&(this.featureClass=t.featureClass),this.geometryName_=t.geometryName,this.extractGeometryName_=t.extractGeometryName,this.supportedMediaTypes=["application/geo+json","application/vnd.geo+json"]}readFeatureFromObject(t,e){let i=null;t.type==="Feature"?i=t:i={type:"Feature",geometry:t,properties:null};const s=ka(i.geometry);if(this.featureClass===Ht)return uu({geometry:s,id:i.id,properties:i.properties},e);const r=new Nr;return this.geometryName_?r.setGeometryName(this.geometryName_):this.extractGeometryName_&&i.geometry_name&&r.setGeometryName(i.geometry_name),r.setGeometry(Da(s,e)),"id"in i&&r.setId(i.id),i.properties&&r.setProperties(i.properties,!0),r}readFeaturesFromObject(t,e){const i=t;let s=null;if(i.type==="FeatureCollection"){const r=t;s=[];const o=r.features;for(let a=0,l=o.length;a<l;++a){const h=this.readFeatureFromObject(o[a],e);h&&s.push(h)}}else s=[this.readFeatureFromObject(t,e)];return s.flat()}readGeometryFromObject(t,e){return Sp(t,e)}readProjectionFromObject(t){const e=t.crs;let i;if(e)if(e.type=="name")i=dt(e.properties.name);else if(e.type==="EPSG")i=dt("EPSG:"+e.properties.code);else throw new Error("Unknown SRS type");else i=this.dataProjection;return i}writeFeatureObject(t,e){e=this.adaptOptions(e);const i={type:"Feature",geometry:null,properties:null},s=t.getId();if(s!==void 0&&(i.id=s),!t.hasProperties())return i;const r=t.getProperties(),o=t.getGeometry();return o&&(i.geometry=No(o,e),delete r[t.getGeometryName()]),Ai(r)||(i.properties=r),i}writeFeaturesObject(t,e){e=this.adaptOptions(e);const i=[];for(let s=0,r=t.length;s<r;++s)i.push(this.writeFeatureObject(t[s],e));return{type:"FeatureCollection",features:i}}writeGeometryObject(t,e){return No(t,this.adaptOptions(e))}}function ka(n,t){if(!n)return null;let e;switch(n.type){case"Point":{e=bp(n);break}case"LineString":{e=Mp(n);break}case"Polygon":{e=Op(n);break}case"MultiPoint":{e=Lp(n);break}case"MultiLineString":{e=Ap(n);break}case"MultiPolygon":{e=Pp(n);break}case"GeometryCollection":{e=Tp(n);break}default:throw new Error("Unsupported GeoJSON type: "+n.type)}return e}function Sp(n,t){const e=ka(n);return Da(e,t)}function Tp(n,t){return n.geometries.map(function(i){return ka(i)})}function bp(n){const t=n.coordinates;return{type:"Point",flatCoordinates:t,layout:ki(t.length)}}function Mp(n){var i;const t=n.coordinates,e=t.flat();return{type:"LineString",flatCoordinates:e,ends:[e.length],layout:ki(((i=t[0])==null?void 0:i.length)||2)}}function Ap(n){var r,o;const t=n.coordinates,e=((o=(r=t[0])==null?void 0:r[0])==null?void 0:o.length)||2,i=[],s=hs(i,0,t,e);return{type:"MultiLineString",flatCoordinates:i,ends:s,layout:ki(e)}}function Lp(n){var e;const t=n.coordinates;return{type:"MultiPoint",flatCoordinates:t.flat(),layout:ki(((e=t[0])==null?void 0:e.length)||2)}}function Pp(n){var r,o;const t=n.coordinates,e=[],i=((o=(r=t[0])==null?void 0:r[0])==null?void 0:o[0].length)||2,s=Fc(e,0,t,i);return{type:"MultiPolygon",flatCoordinates:e,ends:s,layout:ki(i)}}function Op(n){var r,o;const t=n.coordinates,e=[],i=(o=(r=t[0])==null?void 0:r[0])==null?void 0:o.length,s=hs(e,0,t,i);return{type:"Polygon",flatCoordinates:e,ends:s,layout:ki(i)}}function No(n,t){n=Fa(n,!0,t);const e=n.getType();let i;switch(e){case"Point":{i=zp(n);break}case"LineString":{i=Dp(n);break}case"Polygon":{i=Xp(n,t);break}case"MultiPoint":{i=Np(n);break}case"MultiLineString":{i=kp(n);break}case"MultiPolygon":{i=Gp(n,t);break}case"GeometryCollection":{i=Fp(n,t);break}case"Circle":{i={type:"GeometryCollection",geometries:[]};break}default:throw new Error("Unsupported geometry type: "+e)}return i}function Fp(n,t){return t=Object.assign({},t),delete t.featureProjection,{type:"GeometryCollection",geometries:n.getGeometriesArray().map(function(i){return No(i,t)})}}function Dp(n,t){return{type:"LineString",coordinates:n.getCoordinates()}}function kp(n,t){return{type:"MultiLineString",coordinates:n.getCoordinates()}}function Np(n,t){return{type:"MultiPoint",coordinates:n.getCoordinates()}}function Gp(n,t){let e;return t&&(e=t.rightHanded),{type:"MultiPolygon",coordinates:n.getCoordinates(e)}}function zp(n,t){return{type:"Point",coordinates:n.getCoordinates()}}function Xp(n,t){let e;return t&&(e=t.rightHanded),{type:"Polygon",coordinates:n.getCoordinates(e)}}const ae=Hi({currentIndex:0}),Ti=JSON.parse(`[{"icon":"icons/dove.png","garden":"Peace Garden","highlight":"Dominos; keeping the peace, safety security in the neighborhood","description":"The Peace Garden was founded in 2004 by Elaine Senechal, a Greater Egleston Community High School teachers, her students, and other community groups to create a community gathering space to foster peace in place of violence. The Garden has seen incredible changes over the past 20 years, including, most recently, the transfer of the land to the City of Boston and a community redesign process. In the midst of change, our neighbors enjoy the shady trees, daffodils, art and seating areas.","lat":42.314559,"long":-71.09973,"address":"3129 Washington St, Jamaica Plain, MA 02130","contact":"eglestonpeacegarden@gmail.com","socials":"https://www.facebook.com/groups/205069536653616","unlocked":"Yes","interview_vids":"https://vimeo.com/1103316632","photos":"https://gardensofegleston.org/explore-the-gardens/peace-garden-2/","archivaldocs":"https://www.facebook.com/photo/?fbid=10225093618835197&set=gm.1307370106423548&idorvanity=205069536653616","transcripts":"URL","thumbnail":"thumbs/peace.jpg","photo_credit":"Andrea Patiño Contreras","alt_text":"A park space  with daffodils at the corner of Washington and School Streets in Egleston Sq. There are children running and adults talking near some trees. There is a handpainted sign that says \\"Siguenos..Follow us @eglestonsquarepeacegarden\\" that also has a group of faces."},{"icon":"icons/ankh.png","garden":"NUBIA's Dixwell Garden","highlight":"Growing food on an urban lot for donation and farmers' market","description":"Nubian United Benevolent International Association (NUBIA) is a nonprofit urban sustainable development founded in 2008 to reduce food insecurity and promote connection with the agragrian cultures of the Nile Valley. Founder and Executive Director Sayed Muhamed-Nour grows vegetables on several lots in Boston, including two in Egleston Square. The gardens produce tons of fresh produce, including culturally significant crops, for donation to area food pantries and for sale at the Boston Medical Center farmers' market.","lat":42.314647,"long":-71.097804,"address":"15 Dixwell Street, Roxbury, MA 02119","contact":"Sayed Mohamed-Nour or Beth Beagan at bbeagan20@gmail.com","socials":"https://www.nubianet.net/seed-yield/our-gardens/","unlocked":"No","interview_vids":"https://vimeo.com/1103318958","photos":"https://gardensofegleston.org/explore-the-gardens/nubias-gardens/","archivaldocs":"","transcripts":"","thumbnail":"thumbs/dixwell.jpg","photo_credit":"Andrea Patiño Contreras","alt_text":"Two men, one older and one younger, are holding a tray of pepper seedlings in a garden standing on landscape fabric that has pepper seedlings evenly planted in rows. There is a light blue small house behind them."},{"icon":"icons/palm.png","garden":"NUBIA's Dimock Garden","highlight":"Growing food on an urban lot for donation and farmers' market","description":"Nubian United Benevolent International Association (NUBIA) is a nonprofit urban sustainable development founded in 2008 to reduce food insecurity and promote connection with the agragrian cultures of the Nile Valley. Founder and Executive Director Sayed Muhamed-Nour grows vegetables on several lots in Boston, including two in Egleston Square. The gardens produce tons of fresh produce, including culturally significant crops, for donation to area food pantries and for sale at the Boston Medical Center farmers' market.","lat":42.318143,"long":-71.09716,"address":"35-37 Notre Dame St, Roxbury, MA 02119","contact":"","socials":"www.nubianet.net","unlocked":"No","interview_vids":"","photos":"https://gardensofegleston.org/explore-the-gardens/nubias-gardens/","archivaldocs":"","transcripts":"","thumbnail":"thumbs/dimock.jpg","photo_credit":"Cora Roelofs","alt_text":"An older man waters newly planted seedlings with a hose in a fenced garden with a large tree behind him."},{"icon":"icons/sunflower.png","garden":"Friends of Egleston Square Library\\nFood Forest and Gardens","highlight":"Edible path, library with gardening books, outdoor seating, raised beds for community use","description":"Since 2014, the Friends of the Egleston Square Branch Library have been building an inclusive resilent community through the library landscape. Until the library is demolished and rebuilt in the coming years, you can visit a food forest with mature fruit trees and shrubs, raised beds for flowers and vegetables, an insectiary meadow, and seating areas surrounded by annual and perennial herbs and flowers. The Friends and the Library host annual seed and seedling distributions and many other urban growing events. In addition to the diverse permaculture landscape, you will also find a beautiful seed exchange cabinet with a planted green roof by local artist Carolyn Lewenberg.","lat":42.314229,"long":-71.095555,"address":"2044 Columbus Ave, Roxbury, MA 02119","contact":"","socials":"https://www.facebook.com/friendsofegleston","unlocked":"Yes","interview_vids":"https://vimeo.com/1103502878?share=copy","photos":"https://gardensofegleston.org/explore-the-gardens/friends-of-egleston-square-library-food-forest-and-gardens/","archivaldocs":"","transcripts":"","thumbnail":"thumbs/friends.webp","photo_credit":"Cora Roelofs","alt_text":"Sunflower against a sunset with an apartment building behind it."},{"icon":"icons/currant.jpg","garden":"Chilcott & Granada Community Garden","highlight":"Garden plots, lawn, flower beds","description":"This community garden managed by neighbors under the auspices of The Trustees features 13 plots including two raised beds, a large lawn, perennial flower beds, currant bushes, shrubs and trees. The garden connects two dead-end streets -  Chilcott Place and Granada Garden -  via a landscaped stairway and garden path.","lat":42.312883,"long":-71.098684,"address":"23 Granada Park, Jamaica Plain, MA 02130","contact":"granadagarden20@gmail.com","socials":"","unlocked":"No","interview_vids":"","photos":"https://gardensofegleston.org/explore-the-gardens/chilcott-granada-community-garden/","archivaldocs":"","transcripts":"","thumbnail":"thumbs/chilcott.jpg","photo_credit":"Andrea Patiño Contreras","alt_text":"A woman wearing a garland of paper roses is dancing in front of a flowering tree. The flowers are white."},{"icon":"icons/apple.svg","garden":"Egleston Community Orchard","highlight":"Food forest and neighbor hangout","description":"Egleston Community Orchard (ECO) began as a neighbor-led effort in 2010 for sustainable urban agriculture and community green space in Jamaica Plain. Today, ECO is a hub for community events, permaculture workshops, and collaborative harvests. It hosts a permaculture landscape of diverse perennial fruit trees, shrubs, and herbacious plants. ECO is one of the Boston Food Forest Coalition's landtrust sites.","lat":42.314266,"long":-71.101556,"address":"195 Boylston St, Jamaica Plain, MA 02130","contact":"","socials":"https://www.bostonfoodforest.org/egleston-page","unlocked":"Yes","interview_vids":"https://vimeo.com/1103313867","photos":"https://gardensofegleston.org/explore-the-gardens/egleston-community-orchard/","archivaldocs":"","transcripts":"","thumbnail":"thumbs/orchard.jpg","photo_credit":"Andrea Patiño Contreras","alt_text":"A woman wearing a green shirt is painting a sign that says Raspberries. In her hand is a paper plate with different color paints."},{"icon":"icons/raindrop.svg","garden":"Hernandez School Rain Garden","highlight":"Green infrastructure, educational","description":"Rafael Hernández Dual Language K-8 School's rain garden is a \\"green infrastructure\\" garden to manage stormwater runoff and nurture a unique mini-landscape of 22 species of native shrubs and perennials (all labeled). The garden is a learning hub for understanding ecological cycles in connection with the built environment.","lat":42.314306,"long":-71.097875,"address":"22 Dixwell St, Jamaica Plain, MA 02130","contact":"","socials":"https://carolynl.net/2025/01/15/hernandez-rain-garden-restoration-and-signage/","unlocked":"No","interview_vids":"","photos":"https://gardensofegleston.org/explore-the-gardens/hernandez-school-rain-garden/","archivaldocs":"https://storymaps.arcgis.com/stories/f49c01fbc5bb4bdc8a5e3180b1d3e93e","transcripts":"","thumbnail":"thumbs/hernandez.png","photo_credit":"Carolyn Lewenberg","alt_text":"A garden with a wooden fence that has an opening and behind it are plants. On the fence is a raindrop sign that describes the rain garden."},{"icon":"icons/barbershop.svg","garden":"Robert G. Lawson Park","highlight":"Hub for Community events, history","description":"Egleston neighbors have joined together for years to maintain and improve this little park featuring native plantings, artistic seating, a tiny library, and cherry trees. Informally known as \\"Stonehenge\\" due to the arrangement of split granite boulders in the center, the park is set to undergo a major overhaul in 2026. In 2019, the park was re-named in honor of the legacy of Robert G. Lawson, an Egleston community and business leader.","lat":42.315875,"long":-71.098518,"address":"3 Atherton St, Roxbury, MA 02119","contact":"","socials":"https://www.facebook.com/groups/327394124613892/user/100064349185916","unlocked":"Yes","interview_vids":"","photos":"https://gardensofegleston.org/explore-the-gardens/robert-g-lawson-park/","archivaldocs":"https://www.boston.gov/sites/default/files/file/2025/01/2025-01-27_BPRD%20Lawson%20public%20meeting%202-Presentation.pdf","transcripts":"","thumbnail":"thumbs/lawson.jpg","photo_credit":"Egleston Sq Main Street","alt_text":"A park space with a woman reading into a microphone from an open book in front of an audience that is seated."},{"icon":"icons/flower.svg","garden":"Franklin Park Guerilla Garden","highlight":"Regeneration, native perennials","description":"Over the years, neighbors have created an Understory Garden in the park by removing invasive plants like Japanese Knotweed and by planting shade-tolerant native plants. These new plants have begun to naturalize in spite of setbacks like being mowed down or having winter salt and sand shoveled from the sidewalk onto the frozen surface of the resting flora.","lat":42.310214,"long":-71.097694,"address":"492 Walnut Ave Jamaica Plain 02130 (but inside the park wall)","contact":"","socials":"","unlocked":"Yes","interview_vids":"","photos":"https://gardensofegleston.org/explore-the-gardens/franklin-park-guerrilla-garden/","archivaldocs":"","transcripts":"","thumbnail":"thumbs/franklin.jpg","photo_credit":"Kevin Batt","alt_text":"Red and white leaves on plants climbing over large stones at the entrance to Franklin Park"},{"icon":"icons/stairs.svg","garden":"Golden Staircase/Park Lane","highlight":"Surprise garden at the top of a secret staircase","description":"Neighbors created and maintain this pocket garden at the top of the staircase connecting Olmstead Street to Park Lane, a dead end street -- or should we say a \\"live end street.\\"","lat":42.311161,"long":-71.099866,"address":"99 Park Lane","contact":"","socials":"","unlocked":"Yes","interview_vids":"","photos":"https://gardensofegleston.org/explore-the-gardens/golden-staircase-park-lane/","archivaldocs":"","transcripts":"","thumbnail":"thumbs/stairs.jpg","photo_credit":"Andrea Patiño Contreras","alt_text":"A rock garden with green plants and yellow flowers in front of a chain link fence"},{"icon":"icons/school.svg","garden":"Mendell School Garden","highlight":"School garden","description":"Two raised beds in front and a kindergarten garden in back","lat":42.316779,"long":-71.101339,"address":"164 School St, Boston, MA 02119","contact":"","socials":"","unlocked":"Partly","interview_vids":"","photos":"","archivaldocs":"","transcripts":"","thumbnail":"thumbs/mendell.jpg","photo_credit":"Boston Schoolyard Initiative","alt_text":"A school yard with small raised beds and a stone path and wooden posts"},{"icon":"icons/speedboat.svg","garden":"Jeffry's Garden","highlight":"","description":"Jeffrey's family has been living on Iffley Road for over fifty years. When he was a kid, Jeffrey and his father started the slow work of remediating the soil in their front and back yards. They began planting tomatoes, then planted rose bushes, peach trees, and berries. Now, their garden is home to several different kinds of fruit trees, berries, vegetables, and bees! Jeffrey loves to share his harvests with his neighbors, and encourages his community to believe that they can grow their own food anywhere, regardless of how experienced they are or the amount of space they have.","lat":42.31281726,"long":-71.10005189,"address":"23 Iffly Road","contact":"","socials":"","unlocked":"No","interview_vids":"https://vimeo.com/1103317710?share=copy","photos":"https://gardensofegleston.org/explore-the-gardens/jeffreys-garden/","archivaldocs":"","transcripts":"","thumbnail":"thumbs/jeffry.jpg","photo_credit":"Andrea Patiño Contreras","alt_text":"A man with sunglasses holds out his fist full of garden soil near a green plant and a support structure"},{"icon":"icons/tomato.svg","garden":"Doris' Garden","highlight":"Home garden on an alley","description":"Doris has been planting vegetables for years, since she moved to her place about 14 years ago. In the front of her house she has planted flowers, including roses and daisies in honor of her grandmother Margarita –– the name for daisies in Spanish. In the back of her house she has planted vegetables including green beans (which are typical of the cuisine of her native Puerto Rico), onions and potatoes, all of which she shares with her community.","lat":42.31394444,"long":-71.09863632,"address":"64 School St","contact":"","socials":"","unlocked":"No","interview_vids":"","photos":"https://gardensofegleston.org/explore-the-gardens/doris-garden/","archivaldocs":"","transcripts":"","thumbnail":"thumbs/doris.jpg","photo_credit":"Andrea Patiño Contreras","alt_text":"An open hand holds a pink flower bud near daisies"},{"icon":"icons/can.png","garden":"Dimock Pre-School Garden","highlight":"Garden for Dimock's Early Education program","description":"The children of the Dimock Center's Head Start program enjoy the garden almost everyday with the little ones exploring plants and digging for worms in the special beds reserved for play. The garden also includes several raised beds which produce food for the preschool families. As Carol says, we all get to get our hands in the dirt and discover a millions things.","lat":42.318139,"long":-71.097244,"address":"35-37 Notre Dame St, Roxbury, MA 02119","contact":"","socials":"","unlocked":"No","interview_vids":"","photos":"https://gardensofegleston.org/explore-the-gardens/dimock-pre-school-garden/","archivaldocs":"","transcripts":"","thumbnail":"thumbs/dimock-pre.jpg","photo_credit":"Cora Roelofs","alt_text":"Raised beds with seedlings and a blue, yellow and red sculpture on a fence."}]`);function Wp(n){const t=n-1;return t*t*t+1}function lh(n,{delay:t=0,duration:e=400,easing:i=Wp,axis:s="y"}={}){const r=getComputedStyle(n),o=+r.opacity,a=s==="y"?"height":"width",l=parseFloat(r[a]),h=s==="y"?["top","bottom"]:["left","right"],c=h.map(p=>`${p[0].toUpperCase()}${p.slice(1)}`),u=parseFloat(r[`padding${c[0]}`]),d=parseFloat(r[`padding${c[1]}`]),f=parseFloat(r[`margin${c[0]}`]),g=parseFloat(r[`margin${c[1]}`]),_=parseFloat(r[`border${c[0]}Width`]),m=parseFloat(r[`border${c[1]}Width`]);return{delay:t,duration:e,easing:i,css:p=>`overflow: hidden;opacity: ${Math.min(p*20,1)*o};${a}: ${p*l}px;padding-${h[0]}: ${p*u}px;padding-${h[1]}: ${p*d}px;margin-${h[0]}: ${p*f}px;margin-${h[1]}: ${p*g}px;border-${h[0]}-width: ${p*_}px;border-${h[1]}-width: ${p*m}px;min-${a}: 0`}}var Yp=Gh('<svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg>'),jp=Gh('<svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>'),Bp=St('<button class="rounded-full p-2 bg-blue-200 border-2 border-blue-800 hover:bg-pink-400 transition-colors cursor-pointer"><!></button>');function As(n,t){let e=bd(t,"direction",3,"left");var i=Bp();i.__click=function(...a){var l;(l=t.onclick)==null||l.apply(this,a)};var s=z(i);{var r=a=>{var l=Yp();_t(a,l)},o=a=>{var l=jp();_t(a,l)};te(s,a=>{e()==="left"?a(r):a(o,!1)})}_t(n,i)}Nh(["click"]);var Kp=St('<a target="_blank" class="w-8 hover:bg-blue-700 text-xs bg-blue-500 text-white px-2 py-1 rounded-md font-semibold flex gap-1"><!></a>'),Up=St('<a target="_blank" class="w-8 hover:bg-pink-700 text-xs bg-pink-500 text-white px-2 py-1 rounded-md font-semibold flex gap-1"><!></a>'),Zp=St('<a target="_blank" class="bg-gray-200 rounded-lg text-xs mr-2 p-2 max-h-8 w-8 flex hover:bg-gray-300"><!></a>'),Vp=St('<a target="_blank" class="bg-gray-200 rounded-lg text-xs mr-2 p-2 max-h-8 w-8 flex hover:bg-gray-300"><!></a>'),Hp=St('<a target="_blank" class="bg-gray-200 rounded-lg text-xs mr-2 p-2 max-h-8 w-8 flex hover:bg-gray-300"><!></a>'),qp=St('<div class="sticky top-0 z-20 bg-gray-100 drop-shadow-md px-4 py-2 flex justify-between items-center"><div class="flex flex-row items-center justify-center gap-2"><div class="hidden lg:contents bg-gray-200 rounded-lg text-xs p-2 max-h-8 w-10 m-4"><i class="mr-4"> </i></div> <div class="hidden md:contents text-sm font-semibold w-sm"><h2> </h2></div></div> <div class="justify-center items-center flex flex-row gap-2"><div class="mx-auto flex"><div class="mr-2 pointer-events-auto"><!></div> <div class="ml-2 mr-4 pointer-events-auto"><!></div></div> <!> <!> <!> <!> <!></div></div>'),$p=St('<a target="_blank" class="w-8 max-h-6 lg:w-28 hover:bg-blue-700 text-xs bg-blue-500 text-white px-2 py-1 rounded-md font-semibold flex gap-1"><p class="hidden lg:block">Learn More</p> <!></a>'),Jp=St('<a target="_blank" class="w-8 max-h-6 lg:w-24 hover:bg-pink-700 text-xs bg-pink-500 text-white px-2 py-1 rounded-md font-semibold flex gap-1"><p class="hidden lg:block">Contact</p> <!></a>'),Qp=St('<a target="_blank" class="bg-gray-200 rounded-lg text-xs mr-2 p-2 max-h-8 w-8 lg:w-24 flex hover:bg-gray-300"><!> <p class="mx-1 hidden lg:block">Archives</p></a>'),t0=St('<a target="_blank" class="bg-gray-200 rounded-lg text-xs mr-2 p-2 max-h-8 w-8 lg:w-24 flex hover:bg-gray-300"><!> <p class="mx-1 hidden lg:block">Images</p></a>'),e0=St('<a target="_blank" class="bg-gray-200 rounded-lg text-xs mr-2 p-2 max-h-8 w-8 lg:w-24 flex hover:bg-gray-300"><!> <p class="mx-1 hidden lg:block">Videos</p></a>'),i0=St('<div class="text-center"><h1 class="justify-center text-lg md:text-2xl lg:text-2xl font-bold my-2"> </h1> <div class="justify-center flex flex-row md:flex-row sm:flex-row gap-2 items-center"><div class="mr-2 pointer-events-auto"><!></div> <!> <!> <div class="ml-2 pointer-events-auto"><!></div></div> <div class="justify-center flex flex-row md:flex-row sm:flex-row my-4 gap-2"><i class="bg-gray-200 rounded-lg text-xs mr-2 p-2 max-h-8 w-10 md:w-10 lg:w-10"> </i> <!> <!> <!></div> <hr class="h-px my-4 bg-gray-200 border-0 dark:bg-gray-700"></div>'),n0=St('<div class="bg-gray-100 rounded-lg border-4 border-gray-200 shadow-lg max-h-[30vh] overflow-y-scroll"><!> <div><div class="lg:w-3/4 align-text-top"><a target="blank"><img class="float-right ml-4 mb-2 w-[250px] rounded-md"></a> <p> </p> <p class="italic items-center justify-left gap-2 text-sm text-gray-500 mt-4">Photo caption with a <a target="blank" class="text-blue-900 underline hover:text-blue-600 transition-colors">link to a source</a></p></div></div></div>');function s0(n,t){ur(t,!0);let e=_h(!1);function i(S){xe(e,S.target.scrollTop>0)}function s(){ae.currentIndex=ae.currentIndex===0?Ti.length-1:ae.currentIndex-1}function r(){ae.currentIndex=ae.currentIndex===Ti.length-1?0:ae.currentIndex+1}let o='<svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" /></svg>',a='<svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" /></svg>',l='<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 2 24 24" stroke="currentColor"><path d="M4 19V6.2C4 5.0799 4 4.51984 4.21799 4.09202C4.40973 3.71569 4.71569 3.40973 5.09202 3.21799C5.51984 3 6.0799 3 7.2 3H16.8C17.9201 3 18.4802 3 18.908 3.21799C19.2843 3.40973 19.5903 3.71569 19.782 4.09202C20 4.51984 20 5.0799 20 6.2V17H6C4.89543 17 4 17.8954 4 19ZM4 19C4 20.1046 4.89543 21 6 21H20M9 7H15M9 11H15M19 17V21" stroke="#000" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>',h='<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 -2 24 24" stroke="currentColor"><path fill-rule="evenodd" clip-rule="evenodd" d="M1 1H15V15H1V1ZM6 9L8 11L13 6V13H3V12L6 9ZM6.5 7C7.32843 7 8 6.32843 8 5.5C8 4.67157 7.32843 4 6.5 4C5.67157 4 5 4.67157 5 5.5C5 6.32843 5.67157 7 6.5 7Z" fill="#000"/></svg>',c='<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 -2 24 24" stroke="currentColor"><path fill-rule="evenodd" clip-rule="evenodd" d="M16 2H0V14H16V2ZM6.5 5V11H7.5L11 8L7.5 5H6.5Z" fill="#000"/></svg>';var u=n0(),d=z(u);{var f=S=>{var C=qp(),I=z(C),b=z(I),L=z(b),P=z(L),D=rt(b,2),M=z(D),V=z(M),A=rt(I,2),k=z(A),X=z(k),Y=z(X);As(Y,{direction:"left",onclick:s});var W=rt(X,2),U=z(W);As(U,{direction:"right",onclick:r});var T=rt(k,2);{var ft=lt=>{var ht=Kp(),Et=z(ht);ye(Et,()=>o),Xt(()=>Gt(ht,"href",t.garden.socials)),_t(lt,ht)};te(T,lt=>{t.garden.socials&&lt(ft)})}var yt=rt(T,2);{var tt=lt=>{var ht=Up(),Et=z(ht);ye(Et,()=>a),Xt(()=>Gt(ht,"href",t.garden.contact)),_t(lt,ht)};te(yt,lt=>{t.garden.contact&&lt(tt)})}var gt=rt(yt,2);{var xt=lt=>{var ht=Zp(),Et=z(ht);ye(Et,()=>l),Xt(()=>Gt(ht,"href",t.garden.archivaldocs)),_t(lt,ht)};te(gt,lt=>{t.garden.archivaldocs&&lt(xt)})}var wt=rt(gt,2);{var et=lt=>{var ht=Vp(),Et=z(ht);ye(Et,()=>h),Xt(()=>Gt(ht,"href",t.garden.photos)),_t(lt,ht)};te(wt,lt=>{t.garden.photos&&lt(et)})}var Z=rt(wt,2);{var bt=lt=>{var ht=Hp(),Et=z(ht);ye(Et,()=>c),Xt(()=>Gt(ht,"href",t.garden.interview_vids)),_t(lt,ht)};te(Z,lt=>{t.garden.interview_vids&&lt(bt)})}Xt(()=>{Tn(P,`${ae.currentIndex+1}/${Ti.length??""}`),Tn(V,t.garden.garden)}),tl(1,C,()=>lh,()=>({y:-10})),_t(S,C)},g=S=>{var C=i0(),I=z(C),b=z(I),L=rt(I,2),P=z(L),D=z(P);As(D,{direction:"left",onclick:s});var M=rt(P,2);{var V=et=>{var Z=$p(),bt=rt(z(Z),2);ye(bt,()=>o),Xt(()=>Gt(Z,"href",t.garden.socials)),_t(et,Z)};te(M,et=>{t.garden.socials&&et(V)})}var A=rt(M,2);{var k=et=>{var Z=Jp(),bt=rt(z(Z),2);ye(bt,()=>a),Xt(()=>Gt(Z,"href",`mailto:${t.garden.contact??""}`)),_t(et,Z)};te(A,et=>{t.garden.contact&&et(k)})}var X=rt(A,2),Y=z(X);As(Y,{direction:"right",onclick:r});var W=rt(L,2),U=z(W),T=z(U),ft=rt(U,2);{var yt=et=>{var Z=Qp(),bt=z(Z);ye(bt,()=>l),Xt(()=>Gt(Z,"href",t.garden.archivaldocs)),_t(et,Z)};te(ft,et=>{t.garden.archivaldocs&&et(yt)})}var tt=rt(ft,2);{var gt=et=>{var Z=t0(),bt=z(Z);ye(bt,()=>h),Xt(()=>Gt(Z,"href",t.garden.photos)),_t(et,Z)};te(tt,et=>{t.garden.photos&&et(gt)})}var xt=rt(tt,2);{var wt=et=>{var Z=e0(),bt=z(Z);ye(bt,()=>c),Xt(()=>Gt(Z,"href",t.garden.interview_vids)),_t(et,Z)};te(xt,et=>{t.garden.interview_vids&&et(wt)})}Xt(()=>{Tn(b,t.garden.garden),Tn(T,`${ae.currentIndex+1}/${Ti.length??""}`)}),tl(2,C,()=>lh,()=>({y:-10})),_t(S,C)};te(d,S=>{ce(e)?S(f):S(g,!1)})}var _=rt(d,2),m=z(_),p=z(m),y=z(p),w=rt(p,2),x=z(w),v=rt(w,2),R=rt(z(v));Xt(()=>{zh(_,1,`items-start flex flex-col-reverse sm:flex-row justify-center gap-4 px-4 ${ce(e)?"my-16":"mt-2"}`),Gt(p,"href",t.garden.photos),Gt(y,"alt",t.garden.alt),Gt(y,"src",t.garden.thumbnail),Tn(x,t.garden.description),Gt(R,"href",t.garden.photos)}),md("scroll",u,i),_t(n,u),dr()}var r0=St('<div class="w-[90vw] md:w-[60vw] mx-auto h-[30vh] flex items-end justify-center"><div class="flex items-center w-full"><div class="flex-grow"><!></div></div></div>');function o0(n,t){ur(t,!1),Td();var e=r0(),i=z(e),s=z(i),r=z(s);s0(r,{get garden(){return Ti[ae.currentIndex]}}),_t(n,e),dr()}var a0=St('<div class="fixed inset-0 flex flex-col overflow-hidden"><header class="bg-white shadow z-10 px-4 py-3 text-sm md:text-base"><div class="max-w-screen-xl mx-auto"><a href="https://leventhalmap.org" class="font-semibold text-blue-500 hover:underline">LMEC</a> <span class="mx-2 text-gray-500">❯</span> <a href="https://www.leventhalmap.org/projects/grants-in-aid/" class="text-gray-800 hover:underline">Grants in Aid</a> <span class="mx-2 text-gray-500">❯</span> <i class="text-yellow-900 font-bold">Gardens of Egleston</i></div></header> <div class="flex-1 relative"><div class="absolute inset-0 z-0"><div id="popup" class="absolute bg-white rounded-lg shadow-lg p-2 text-sm hidden"></div></div> <div class="absolute bottom-6 w-full flex justify-center z-10 pointer-events-none"><div class="pointer-events-auto"><!></div></div></div></div>');function l0(n,t){ur(t,!0);let e,i,s;function r(v){return new os({points:4,radius:30,angle:Math.PI/4,fill:new ci({color:v}),displacement:[0,15]})}function o(v,R){return new ds({src:v,anchor:[.5,.9],height:40,width:40,color:R})}function a(v,R,S,C,I){return new Hc({text:v.get("garden"),font:"bold 14px system-ui, Avenir, Helvetica, Arial, sans-serif",fill:new ci({color:R}),stroke:new mn({color:S,width:6}),offsetY:30,offsetX:0,placement:"point",backgroundFill:new ci({color:C}),backgroundStroke:new mn({color:I,width:4}),padding:[4,8,4,8]})}const l=v=>(s=`icons/${v.get("icon")}`,console.log(s),[new ue({image:r("#DEFCE2")}),new ue({image:o(s,"#DEFCE2"),text:a(v,"#000","#F3F4F6","#F3F4F6","#E5E7EB")})]),h=v=>(s=`icons/${v.get("icon")}`,[new ue({image:r("#FBDEF8")}),new ue({image:o(s,"#FBDEF8"),text:a(v,"#000","#F3F4F6","#F3F4F6","#E5E7EB")})]);let c=new xp,u=new gp({source:c,style:l}),d=new Ni({layers:[u]});const f=new f_({source:new kg});let g=new we({center:Rl([-71.1,42.315]),zoom:15});Ns(()=>{const v=Ti[ae.currentIndex];fetch("gardens.geojson").then(R=>R.json()).then(R=>{let S=Math.min(window.innerWidth,window.innerHeight);c.addFeatures(new Ip().readFeatures(R,{dataProjection:"EPSG:4326",featureProjection:"EPSG:3857"})),g.fit(new Li(Rl([v.long,v.lat])),{padding:[S,S,S,S],duration:500,maxZoom:19})})}),Md(()=>{i=new Gm({target:e,layers:[f,d],view:g}),i.on("singleclick",function(R){i.forEachFeatureAtPixel(R.pixel,function(S){const C=S.getGeometry();if(C){const L=i.getSize();i.getView().fit(C,{duration:500,padding:[50,50,50,50],maxZoom:19,size:L})}const I=S.get("garden"),b=Ti.findIndex(L=>L.garden===I);b!==-1&&(ae.currentIndex=b)})});let v=null;i.on("pointermove",function(R){const S=i.getEventPixel(R.originalEvent),C=i.hasFeatureAtPixel(S);i.getTargetElement().style.cursor=C?"pointer":"",v&&(v.setStyle(l(v)),v=null),i.forEachFeatureAtPixel(R.pixel,function(I){return v=I,I.setStyle(h(I)),!0})})});var _=a0(),m=rt(z(_),2),p=z(m);Sd(p,v=>e=v,()=>e);var y=rt(p,2),w=z(y),x=z(w);o0(x,{}),_t(n,_),dr()}var h0=St("<main><!> <!></main>");function c0(n){var t=h0(),e=z(t);l0(e,{});var i=rt(e,2);Fd(i),_t(n,t)}pd(c0,{target:document.getElementById("app")});
